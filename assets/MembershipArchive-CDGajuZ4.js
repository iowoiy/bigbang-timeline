import{c as U,j as e}from"./index-DtCib1SO.js";import{a as i,D as xe,P as Cs,c as Is,p as Ss,G as Us,q as Ts,w as $s,h as be,l as Ms,X as re,E as Ps,m as Es,f as As,v as Ve,I as Ds,U as zs,T as _s,j as Bs,b as Ls,C as Fs}from"./icons-CLN19_QX.js";import{u as Rs}from"./index-DsAOVHfT.js";import"./vendor-V74KKV6y.js";const ce=[{name:"å…¨å“¡",color:"#E5A500"},{name:"G-Dragon",color:"#ed609f"},{name:"T.O.P",color:"#8fc126"},{name:"å¤ªé™½",color:"#d7171e"},{name:"å¤§è²",color:"#f4e727"}],Xe={å¤§è²:["Daesung"],å¤ªé™½:["Taeyang"]};function le(l){var N,j;const c=Object.entries(Xe).find(([,g])=>g.includes(l));return c?((N=ce.find(g=>g.name===c[0]))==null?void 0:N.color)||"#E5A500":((j=ce.find(g=>g.name===l))==null?void 0:j.color)||"#E5A500"}function Ys(){return"mb-"+Date.now()}function Os(l){var c;return(c=l.backupUrl)!=null&&c.includes("cloudinary.com/")?l.backupUrl.replace("/upload/","/upload/w_400,q_auto,f_auto/"):l.backupUrl||l.url}function Gs(l){var c;return(c=l.backupUrl)!=null&&c.includes("cloudinary.com/")?l.backupUrl.replace("/upload/","/upload/w_1080,q_auto,f_auto/"):l.backupUrl||l.url}function Ks(l){if(!l)return"";const c=new Date(l);return`${c.getFullYear()}/${c.getMonth()+1}/${c.getDate()}`}function qe(l,c){const N=Ks(l);return N?c?`${N} ${c}`:N:""}const Q={gdragon:{label:"G-Dragon (gdragon.ai)",domain:"gdragon.ai",authorIds:"67a5e27bc8affa6b2c4b893b%2C677e145d5dba936413e31764",defaultMember:"G-Dragon",authorMap:{"67a5e27bc8affa6b2c4b893b":"G-Dragon","677e145d5dba936413e31764":"G-Dragon"}},daesung:{label:"Daesung (daesung.bstage.in)",domain:"daesung.bstage.in",authorIds:"64cb4a2654046402f5bde521",defaultMember:"å¤§è²",authorMap:{"64cb4a2654046402f5bde521":"å¤§è²"}},taeyang:{label:"Taeyang (taeyang.bstage.in)",domain:"taeyang.bstage.in",authorIds:"67361d0527162e668b09c620",defaultMember:"å¤ªé™½",authorMap:{"67361d0527162e668b09c620":"å¤ªé™½"}}},Je=U.MEMBERSHIP_IMGBB_API_KEY;async function Vs(l){const c=new FormData;c.append("image",l);const j=await(await fetch(`https://api.imgbb.com/1/upload?key=${Je}`,{method:"POST",body:c})).json();if(j.success)return j.data.url;throw new Error("ä¸Šå‚³å¤±æ•—")}async function He(l){const c=new FormData;c.append("image",l);const j=await(await fetch(`https://api.imgbb.com/1/upload?key=${Je}`,{method:"POST",body:c})).json();if(j.success)return j.data.url;throw new Error("ä¸Šå‚³å¤±æ•—")}async function je(l){var j;const c=U.MEMBERSHIP_CLOUDINARY_CLOUD_NAME,N=U.MEMBERSHIP_CLOUDINARY_PRESET;try{const g=new FormData;g.append("file",l),g.append("upload_preset",N);const _=await(await fetch(`https://api.cloudinary.com/v1_1/${c}/image/upload`,{method:"POST",body:g})).json();if(_.secure_url)return console.log("âœ… Cloudinary å‚™ä»½æˆåŠŸ:",_.secure_url),_.secure_url;throw new Error(((j=_.error)==null?void 0:j.message)||"ä¸Šå‚³å¤±æ•—")}catch(g){return console.warn("Cloudinary å‚™ä»½å¤±æ•—:",g.message),null}}function We(l){return l?/(?:youtube\.com\/(?:watch|embed|shorts)|youtu\.be\/)/i.test(l):!1}function Ze(l){if(!l)return null;const c=l.match(/(?:youtube\.com\/(?:watch\?v=|embed\/|shorts\/)|youtu\.be\/)([a-zA-Z0-9_-]{11})/);return c?c[1]:null}function oe(l){const c=Ze(l);return c?`https://img.youtube.com/vi/${c}/hqdefault.jpg`:null}function qs({isAdmin:l,onBack:c,currentPage:N,setCurrentPage:j}){var Oe,Ge;const[g,P]=i.useState([]),[_,ve]=i.useState(!0),[Ne,ye]=i.useState(!1),[ee,we]=i.useState(null),[ke,Y]=i.useState(!1),[O,Qe]=i.useState("all"),[se,es]=i.useState("all"),[ae,ss]=i.useState(""),[B,Ce]=i.useState("grid"),[as,D]=i.useState(!1),[S,Ie]=i.useState(null),[f,v]=i.useState({member:"å…¨å“¡",date:new Date().toISOString().split("T")[0],time:"",caption:"",media:[],sourceUrl:"",notes:""}),[Se,Ue]=i.useState(!1),[r,L]=i.useState(null),[G,F]=i.useState(0),[T,de]=i.useState(null),me=i.useRef(null),[te,ts]=i.useState(3),[Te,K]=i.useState(!1),[ue,V]=i.useState(""),[$e,Me]=i.useState(0),[ns,q]=i.useState(!1),[ne,H]=i.useState(""),[he,Pe]=i.useState("gdragon"),[k,z]=i.useState(null),[Ee,Ae]=i.useState({page:0,totalItems:0}),[E,W]=i.useState({current:0,total:0,skipped:0,success:0,failed:0}),[De,X]=i.useState([]),[ze,is]=i.useState(!1),R=i.useRef(!1);i.useEffect(()=>{rs()},[]);async function rs(){ve(!0);try{const s=await fetch(`${U.API_URL}/membership`);if(!s.ok)throw new Error("è¼‰å…¥å¤±æ•—");const a=await s.json();P(a)}catch(s){console.error("è¼‰å…¥å¤±æ•—",s),w("è¼‰å…¥å¤±æ•—","error")}finally{ve(!1)}}async function _e(s){const a=await fetch(`${U.API_URL}/membership`,{method:"POST",headers:{"Content-Type":"application/json","X-API-Key":U.API_KEY},body:JSON.stringify(s)});if(!a.ok)throw new Error("å»ºç«‹å¤±æ•—");return a.json()}async function Be(s){const a=await fetch(`${U.API_URL}/membership/${s.id}`,{method:"PUT",headers:{"Content-Type":"application/json","X-API-Key":U.API_KEY},body:JSON.stringify(s)});if(!a.ok)throw new Error("æ›´æ–°å¤±æ•—");return a.json()}async function ls(s){const a=await fetch(`${U.API_URL}/membership/${s}`,{method:"DELETE",headers:{"X-API-Key":U.API_KEY}});if(!a.ok)throw new Error("åˆªé™¤å¤±æ•—");return a.json()}function y(s,a="info"){X(n=>[...n,{msg:s,type:a,ts:Date.now()}])}async function os(s,a){var x;const n=Q[a],t=[];let d=1;const h=24;let I=!1;for(;!I&&!R.current;){const o=`https://${n.domain}/svc/home/api/v1/home/star/feeds?authorIds=${n.authorIds}&page=${d}&pageSize=${h}`,u=await fetch(o,{headers:{authorization:`Bearer ${s}`}});if(!u.ok)throw u.status===401?new Error("Token å·²éŽæœŸï¼Œè«‹é‡æ–°ç™»å…¥ b.stage å–å¾—æ–°çš„ Token"):new Error(`API éŒ¯èª¤: ${u.status}`);const m=await u.json();((x=m==null?void 0:m.items)==null?void 0:x.length)>0&&t.push(...m.items),I=(m==null?void 0:m.isLast)??!0,d++,Ae({page:d-1,totalItems:t.length}),y(`ç¬¬ ${d-1} é ï¼šå·²æŠ“å– ${t.length} ç­†`,"info"),await new Promise(b=>setTimeout(b,100))}return t}function pe(s){if(!s)return s;const a=s.split(`

`);return a.length===2&&a[0].trim()===a[1].trim()?a[0].trim():s}function cs(s,a){var p,$,A;const n=Q[a],t=new Date(s.publishedAt||s.createdAt),d=t.toISOString().split("T")[0],h=t.toTimeString().slice(0,5),I=[];if(s.images&&s.images.length>0)for(const M of s.images){const Z=typeof M=="string"?M:M.url||M.path||M.source;Z&&I.push({originalUrl:Z,type:"image"})}else if(s.mainImage){const M=typeof s.mainImage=="string"?s.mainImage:s.mainImage.url||s.mainImage.path;M&&I.push({originalUrl:M,type:"image"})}let x="";if(s.video){const M=s.video.thumbnailPaths||[];for(const ie of M){const Ke=typeof ie=="string"?ie:ie.url||ie.path;if(Ke){I.unshift({originalUrl:Ke,type:"image"});break}}const Z=((p=s.video.hlsPath)==null?void 0:p.path)||(($=s.video.dashPath)==null?void 0:$.path)||"";Z&&(x=`[å½±ç‰‡] ${Z}`)}const o=n.authorMap[(A=s.author)==null?void 0:A.id]||n.defaultMember;let u="";const m=(s.title||"").trim(),b=(s.description||"").trim();return m&&b?u=m===b?m:b.includes(m)?b:`${m}

${b}`:u=m||b,{id:`mb-bstage-${s.id}`,member:o,date:d,time:h,caption:u||"",images:I,sourceUrl:`https://${n.domain}/story/feed/${s.typeId||s.id}`,notes:x,bstageId:s.id,paid:s.paid||!1}}async function ds(s){var d,h,I;z("processing"),W({current:0,total:s.length,skipped:0,success:0,failed:0});let a=g;try{const x=await fetch(`${U.API_URL}/membership`);x.ok&&(a=await x.json(),P(a))}catch(x){console.warn("é‡æ–°è¼‰å…¥è³‡æ–™å¤±æ•—ï¼Œä½¿ç”¨ç¾æœ‰ state åŽ»é‡",x)}const n=new Set(a.map(x=>x.id)),t=new Set(a.map(x=>x.sourceUrl).filter(Boolean));for(let x=0;x<s.length&&!R.current;x++){const o=s[x];if(n.has(o.id)||t.has(o.sourceUrl)){if(ze){const u=n.has(o.id)?o.id:null,m=a.find(b=>b.id===u||b.sourceUrl===o.sourceUrl);if(m){const b=pe(o.caption),p={...m,caption:b,date:o.date,time:o.time,updatedAt:Date.now()};await Be(p).catch($=>console.warn("æ›´æ–°å¤±æ•—:",$)),P($=>$.map(A=>A.id===p.id?p:A)),y(`ðŸ”„ å·²æ›´æ–°: ${o.date} ${(b==null?void 0:b.slice(0,30))||"(ç„¡æ–‡å­—)"}`,"info")}}else y(`â­ è·³éŽï¼ˆå·²å­˜åœ¨ï¼‰: ${o.date} ${((d=o.caption)==null?void 0:d.slice(0,30))||"(ç„¡æ–‡å­—)"}`,"info");W(u=>({...u,current:u.current+1,skipped:u.skipped+1}));continue}try{const u=[];for(const p of o.images)try{const[$,A]=await Promise.all([He(p.originalUrl),je(p.originalUrl)]);u.push({url:$,type:p.type,...A&&{backupUrl:A}})}catch($){console.warn("åœ–ç‰‡ä¸Šå‚³å¤±æ•—ï¼Œä½¿ç”¨åŽŸå§‹ URL:",$),u.push({url:p.originalUrl,type:p.type}),y("âš  åœ–ç‰‡å‚™ä»½å¤±æ•—ï¼Œä½¿ç”¨åŽŸå§‹é€£çµ","warn")}const m={id:o.id,member:o.member,date:o.date,time:o.time,caption:o.caption,media:u,sourceUrl:o.sourceUrl,notes:o.notes,paid:o.paid||!1,createdAt:Date.now(),updatedAt:Date.now()};(await _e(m)).skipped?(W(p=>({...p,current:p.current+1,skipped:p.skipped+1})),y(`â­ è·³éŽï¼ˆD1 å·²å­˜åœ¨ï¼‰: ${o.date} ${((h=o.caption)==null?void 0:h.slice(0,30))||"(ç„¡æ–‡å­—)"}`,"info")):(P(p=>[m,...p]),n.add(o.id),t.add(o.sourceUrl),W(p=>({...p,current:p.current+1,success:p.success+1})),y(`âœ… ${o.date} ${((I=o.caption)==null?void 0:I.slice(0,40))||"(ç„¡æ–‡å­—)"}`,"success"))}catch(u){console.error(`åŒ¯å…¥å¤±æ•—: ${o.id}`,u),W(m=>({...m,current:m.current+1,failed:m.failed+1})),y(`âŒ å¤±æ•—: ${o.date} - ${u.message}`,"error")}await new Promise(u=>setTimeout(u,50))}}async function ms(){if(!ne.trim()){w("è«‹è¼¸å…¥ b.stage Token","error");return}let s=ne.trim();s.toLowerCase().startsWith("bearer ")&&(s=s.slice(7));const a=he,n=Q[a].label;R.current=!1,X([]),z("fetching"),Ae({page:0,totalItems:0}),y(`é–‹å§‹å¾ž ${n} æŠ“å–è³‡æ–™...`,"info");try{const t=await os(s,a);if(R.current){z("done"),y("å·²å–æ¶ˆåŒ¯å…¥","warn");return}y(`âœ… æŠ“å–å®Œæˆï¼šå…± ${t.length} ç­†è²¼æ–‡`,"success");const d=t.map(h=>cs(h,a));await ds(d),R.current?y("å·²å–æ¶ˆåŒ¯å…¥","warn"):y("ðŸŽ‰ åŒ¯å…¥å®Œæˆï¼","success")}catch(t){y(`âŒ éŒ¯èª¤: ${t.message}`,"error"),w(t.message,"error")}finally{z("done")}}function Le(){R.current=!0,y("æ­£åœ¨å–æ¶ˆ...","warn")}function w(s,a="success"){we({msg:s,type:a}),setTimeout(()=>we(null),2500)}function Fe({title:s,content:a,type:n="warning",confirmText:t="ç¢ºå®š",cancelText:d="å–æ¶ˆ"}){return new Promise(h=>{de({title:s,content:a,type:n,confirmText:t,cancelText:d,onConfirm:()=>{de(null),h(!0)},onCancel:()=>{de(null),h(!1)}})})}const C=i.useMemo(()=>g.filter(s=>{var a,n,t;return!(O!=="all"&&s.member!==O&&!((a=Xe[O])!=null&&a.includes(s.member))||se==="video"&&!((n=s.notes)!=null&&n.includes("[å½±ç‰‡]"))||se==="paid"&&!s.paid||ae&&!((t=s.caption)!=null&&t.toLowerCase().includes(ae.toLowerCase())))}).sort((s,a)=>new Date(a.date)-new Date(s.date)),[g,O,se,ae]);i.useEffect(()=>{const s=me.current;if(!s)return;const a=()=>{const t=s.clientWidth-32;ts(B==="grid"?Math.max(1,Math.floor(t/276)):1)};a();const n=new ResizeObserver(a);return n.observe(s),()=>n.disconnect()},[B]);const us=i.useMemo(()=>Math.ceil(C.length/te),[C.length,te]),fe=Rs({count:us,getScrollElement:()=>me.current,estimateSize:()=>B==="grid"?340:120,overscan:3});function Re(){Ie(null),v({member:"å…¨å“¡",date:new Date().toISOString().split("T")[0],time:"",caption:"",media:[],sourceUrl:"",notes:"",paid:!1}),K(!1),V(""),D(!0)}function hs(s){Ie(s),v({member:s.member,date:s.date,time:s.time||"",caption:s.caption||"",media:s.media||[],sourceUrl:s.sourceUrl||"",notes:s.notes||"",paid:s.paid||!1}),K(!1),V(""),D(!0)}function ps(s){L(s),F(0)}function fs(){const s=C.findIndex(a=>a.id===(r==null?void 0:r.id));s>0&&(L(C[s-1]),F(0))}function gs(){const s=C.findIndex(a=>a.id===(r==null?void 0:r.id));s<C.length-1&&(L(C[s+1]),F(0))}function ge(){return C.findIndex(s=>s.id===(r==null?void 0:r.id))}function xs(){r&&(hs(r),L(null))}async function bs(){if(!ue.trim())return;const s=ue.split(`
`).map(t=>t.trim()).filter(t=>t&&(t.startsWith("http")||t.startsWith("//")));if(s.length===0){w("è«‹è¼¸å…¥æœ‰æ•ˆçš„ç¶²å€","error");return}const a=s.map((t,d)=>We(t)?{url:t,type:"youtube",thumbnail:oe(t),index:f.media.length+d}:{url:t,type:"image",uploading:!0,originalUrl:t,index:f.media.length+d});v(t=>({...t,media:[...t.media,...a]}));const n=a.filter(t=>t.type==="image");Me(t=>t+n.length);for(const t of n)js(t.originalUrl,t.index);V(""),K(!1),w(`å·²æ–°å¢ž ${s.length} å€‹åª’é«”`)}async function js(s,a){try{const[n,t]=await Promise.all([He(s),je(s)]);v(d=>({...d,media:d.media.map((h,I)=>I===a?{...h,url:n,backupUrl:t,uploading:!1}:h)})),t&&console.log(`âœ… åœ–ç‰‡ ${a+1} é›™é‡å‚™ä»½å®Œæˆ`)}catch(n){console.warn(`åœ–ç‰‡ ${a+1} ä¸Šå‚³å¤±æ•—`,n),v(t=>({...t,media:t.media.map((d,h)=>h===a?{...d,uploading:!1,uploadFailed:!0}:d)}))}finally{Me(n=>n-1)}}async function vs(s){const a=Array.from(s.target.files);if(a.length){Ue(!0);try{const n=[];for(const t of a){const[d,h]=await Promise.all([Vs(t),je(URL.createObjectURL(t))]);n.push({url:d,type:"image",...h&&{backupUrl:h}})}v(t=>({...t,media:[...t.media,...n]})),w(`å·²æ–°å¢ž ${n.length} å€‹æª”æ¡ˆ`)}catch(n){console.error("ä¸Šå‚³å¤±æ•—",n),w("ä¸Šå‚³å¤±æ•—","error")}finally{Ue(!1)}}}const[J,Ye]=i.useState("");function Ns(){if(!J.trim())return;if(!We(J)){w("è«‹è¼¸å…¥æœ‰æ•ˆçš„ YouTube é€£çµ","error");return}const s=oe(J);v(a=>({...a,media:[...a.media,{url:J.trim(),type:"youtube",thumbnail:s}]})),Ye(""),w("å·²æ–°å¢ž YouTube å½±ç‰‡")}function ys(s){v(a=>({...a,media:a.media.filter((n,t)=>t!==s)}))}async function ws(){if(!f.date||!f.member){w("è«‹å¡«å¯«å¿…è¦æ¬„ä½","error");return}if(f.media.some(n=>n.uploading)&&!await Fe({title:"âš ï¸ ä¸Šå‚³æœªå®Œæˆ",type:"warning",confirmText:"ä»è¦å„²å­˜",cancelText:"ç­‰å¾…ä¸Šå‚³",content:e.jsxs("div",{className:"confirm-content",children:[e.jsx("p",{children:"é‚„æœ‰åœ–ç‰‡æ­£åœ¨ä¸Šå‚³ä¸­ï¼Œç¢ºå®šè¦ç¾åœ¨å„²å­˜å—Žï¼Ÿ"}),e.jsx("p",{className:"confirm-warning",children:"æœªå®Œæˆä¸Šå‚³çš„åœ–ç‰‡å¯èƒ½ç„¡æ³•æ­£å¸¸é¡¯ç¤º"})]})}))return;const a={id:(S==null?void 0:S.id)||Ys(),member:f.member,date:f.date,time:f.time,caption:f.caption,media:f.media.map(n=>({url:n.url,type:n.type,...n.backupUrl&&{backupUrl:n.backupUrl},...n.thumbnail&&{thumbnail:n.thumbnail}})),sourceUrl:f.sourceUrl,notes:f.notes,paid:f.paid||!1,createdAt:(S==null?void 0:S.createdAt)||Date.now(),updatedAt:Date.now()};ye(!0);try{S?(await Be(a),P(g.map(n=>n.id===S.id?a:n))):(await _e(a),P([a,...g])),w("å·²å„²å­˜"),D(!1)}catch(n){console.error("å„²å­˜å¤±æ•—",n),w("å„²å­˜å¤±æ•—","error")}finally{ye(!1)}}async function ks(s){if(await Fe({title:"ðŸ—‘ï¸ åˆªé™¤ç¢ºèª",type:"danger",confirmText:"åˆªé™¤",cancelText:"å–æ¶ˆ",content:e.jsxs("div",{className:"confirm-content",children:[e.jsx("p",{children:"ç¢ºå®šè¦åˆªé™¤é€™ç­†å‚™ä»½å—Žï¼Ÿ"}),e.jsx("p",{className:"confirm-warning",children:"æ­¤æ“ä½œç„¡æ³•å¾©åŽŸ"})]})}))try{await ls(s),P(g.filter(n=>n.id!==s)),w("å·²åˆªé™¤")}catch(n){console.error("åˆªé™¤å¤±æ•—",n),w("åˆªé™¤å¤±æ•—","error")}}return _?e.jsxs("div",{className:"membership-loading",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"è¼‰å…¥ä¸­..."})]}):e.jsxs("div",{className:"membership-archive",children:[e.jsxs("header",{className:"membership-header",children:[e.jsx("div",{style:{display:"flex",alignItems:"center",gap:8},children:e.jsx("h1",{children:"ðŸ”’ æœƒå“¡å‚™ä»½"})}),e.jsxs("div",{className:"header-actions",children:[l&&e.jsx("button",{className:"membership-import-btn",onClick:()=>q(!0),title:"å¾ž b.stage åŒ¯å…¥",children:e.jsx(xe,{size:18})}),e.jsx("button",{className:"add-btn",onClick:Re,title:"æ–°å¢žå‚™ä»½",children:e.jsx(Cs,{size:20})}),j&&e.jsxs("div",{className:"nav-menu-wrapper",children:[e.jsx("button",{onClick:()=>Y(!ke),className:"hamburger-btn",title:"é¸å–®",children:e.jsx(Is,{size:18})}),ke&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"nav-menu-overlay",onClick:()=>Y(!1)}),e.jsxs("div",{className:"nav-menu",children:[e.jsxs("button",{className:`nav-menu-item ${N==="timeline"?"active":""}`,onClick:()=>{j("timeline"),Y(!1)},children:[e.jsx("span",{children:"ðŸ“…"})," æ™‚é–“è»¸"]}),e.jsxs("button",{className:`nav-menu-item ${N==="social"?"active":""}`,onClick:()=>{j("social"),Y(!1)},children:[e.jsx("span",{children:"ðŸ“·"})," ç¤¾ç¾¤å‚™ä»½"]}),e.jsxs("button",{className:`nav-menu-item ${N==="membership"?"active":""}`,onClick:()=>{j("membership"),Y(!1)},children:[e.jsx("span",{children:"ðŸ”’"})," æœƒå“¡å‚™ä»½"]})]})]})]})]})]}),e.jsxs("div",{className:"membership-filters",children:[e.jsxs("div",{className:"filter-row",children:[e.jsxs("select",{value:O,onChange:s=>Qe(s.target.value),className:"filter-select",children:[e.jsx("option",{value:"all",children:"æ‰€æœ‰æˆå“¡"}),ce.map(s=>e.jsx("option",{value:s.name,children:s.name},s.name))]}),e.jsxs("select",{value:se,onChange:s=>es(s.target.value),className:"filter-select",children:[e.jsx("option",{value:"all",children:"æ‰€æœ‰é¡žåž‹"}),e.jsx("option",{value:"video",children:"ðŸŽ¬ å«å½±ç‰‡"}),e.jsx("option",{value:"paid",children:"ðŸ”’ æœƒå“¡é™å®š"})]}),e.jsxs("div",{className:"search-box",children:[e.jsx(Ss,{size:16}),e.jsx("input",{type:"text",placeholder:"æœå°‹å…§å®¹...",value:ae,onChange:s=>ss(s.target.value)})]}),e.jsxs("div",{className:"view-toggle",children:[e.jsx("button",{className:B==="grid"?"active":"",onClick:()=>Ce("grid"),children:e.jsx(Us,{size:16})}),e.jsx("button",{className:B==="list"?"active":"",onClick:()=>Ce("list"),children:e.jsx(Ts,{size:16})})]})]}),e.jsxs("div",{className:"filter-stats",children:["å…± ",C.length," ç­†å‚™ä»½"]})]}),e.jsx("div",{ref:me,className:"membership-content-scroll",children:C.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx($s,{size:48}),e.jsx("p",{children:"å°šç„¡æœƒå“¡å‚™ä»½è³‡æ–™"}),e.jsx("button",{onClick:Re,children:"æ–°å¢žç¬¬ä¸€ç­†"})]}):e.jsx("div",{style:{height:fe.getTotalSize(),position:"relative"},children:fe.getVirtualItems().map(s=>{const a=s.index*te,n=C.slice(a,a+te);return e.jsx("div",{className:`membership-content ${B}`,style:{position:"absolute",top:0,left:0,right:0,transform:`translateY(${s.start}px)`},ref:fe.measureElement,"data-index":s.index,children:n.map(t=>{var d,h;return e.jsxs("div",{className:"archive-card",onClick:()=>ps(t),children:[e.jsxs("div",{className:"archive-thumb",children:[(d=t.media)!=null&&d[0]?t.media[0].type==="youtube"?e.jsxs("div",{className:"video-thumb-img",children:[e.jsx("img",{src:t.media[0].thumbnail||oe(t.media[0].url),alt:"",loading:"lazy",width:260,height:260}),e.jsx(be,{size:24,className:"play-overlay"})]}):e.jsx("img",{src:Os(t.media[0]),alt:"",loading:"lazy",width:260,height:260}):e.jsx("div",{className:"no-thumb",children:e.jsx("img",{src:"/bigbang-timeline/bigbang-default.png",alt:"BIGBANG"})}),((h=t.media)==null?void 0:h.length)>1&&e.jsxs("span",{className:"media-count",children:["+",t.media.length-1]})]}),e.jsxs("div",{className:"archive-info",children:[e.jsxs("div",{className:"archive-meta",children:[e.jsx("span",{className:"member-tag",style:{background:le(t.member)+"30",color:le(t.member)},children:t.member}),t.paid&&e.jsx("span",{className:"paid-badge",children:"ðŸ”’ æœƒå“¡"}),e.jsx("span",{className:"date",children:qe(t.date,t.time)})]}),t.caption&&e.jsx("p",{className:"archive-caption",children:pe(t.caption)})]})]},t.id)})},s.key)})})}),r&&e.jsxs("div",{className:"modal-overlay view-modal-overlay",onClick:()=>L(null),children:[e.jsxs("div",{className:"post-nav-indicator",onClick:s=>s.stopPropagation(),children:[ge()+1," / ",C.length]}),e.jsx("button",{className:"post-nav-side prev",onClick:s=>{s.stopPropagation(),fs()},disabled:ge()<=0,title:"ä¸Šä¸€å‰‡",children:e.jsx(Ms,{size:32})}),e.jsxs("div",{className:"view-modal",onClick:s=>s.stopPropagation(),children:[e.jsx("button",{className:"view-close-btn",onClick:()=>L(null),children:e.jsx(re,{size:24})}),e.jsx("div",{className:"view-media-area",children:((Oe=r.media)==null?void 0:Oe.length)>0?e.jsxs(e.Fragment,{children:[((Ge=r.media[G])==null?void 0:Ge.type)==="youtube"?e.jsx("iframe",{src:`https://www.youtube.com/embed/${Ze(r.media[G].url)}?autoplay=1`,allow:"autoplay; encrypted-media",allowFullScreen:!0,className:"view-media view-youtube"}):e.jsx("img",{src:Gs(r.media[G]),alt:"",className:"view-media"},`${r.id}-${G}`),r.media.length>1&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"media-nav prev",onClick:()=>F(s=>(s-1+r.media.length)%r.media.length),children:"â€¹"}),e.jsx("button",{className:"media-nav next",onClick:()=>F(s=>(s+1)%r.media.length),children:"â€º"}),e.jsx("div",{className:"media-dots",children:r.media.map((s,a)=>e.jsx("span",{className:`dot ${a===G?"active":""}`,onClick:()=>F(a)},a))})]})]}):e.jsx("div",{className:"no-media",children:e.jsx("img",{src:"/bigbang-timeline/bigbang-default.png",alt:"BIGBANG",className:"no-media-img"})})}),e.jsxs("div",{className:"view-info-area",children:[e.jsxs("div",{className:"view-header",children:[e.jsx("span",{className:"member-tag",style:{background:le(r.member)+"30",color:le(r.member)},children:r.member}),r.paid&&e.jsx("span",{className:"paid-badge",children:"ðŸ”’ æœƒå“¡é™å®š"}),e.jsx("span",{className:"view-date",children:qe(r.date,r.time)})]}),r.caption&&e.jsx("div",{className:"view-caption",children:e.jsx("p",{children:pe(r.caption)})}),r.notes&&e.jsxs("div",{className:"view-notes",children:[e.jsx("strong",{children:"å‚™è¨»ï¼š"}),e.jsx("p",{children:r.notes})]}),e.jsxs("div",{className:"view-actions",children:[r.sourceUrl&&e.jsxs("a",{href:r.sourceUrl,target:"_blank",rel:"noopener noreferrer",className:"view-link-btn",children:[e.jsx(Ps,{size:16})," é–‹å•ŸåŽŸæ–‡"]}),e.jsx("button",{className:"view-edit-btn",onClick:xs,children:"âœï¸ ç·¨è¼¯"})]})]})]}),e.jsx("button",{className:"post-nav-side next",onClick:s=>{s.stopPropagation(),gs()},disabled:ge()>=C.length-1,title:"ä¸‹ä¸€å‰‡",children:e.jsx(Es,{size:32})})]}),as&&e.jsx("div",{className:"modal-overlay",onClick:()=>D(!1),children:e.jsxs("div",{className:"membership-modal",onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{children:S?"ç·¨è¼¯å‚™ä»½":"æ–°å¢žå‚™ä»½"}),e.jsx("button",{className:"close-btn",onClick:()=>D(!1),children:e.jsx(re,{size:20})})]}),e.jsxs("div",{className:"modal-body",children:[e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"æˆå“¡"}),e.jsx("select",{value:f.member,onChange:s=>v(a=>({...a,member:s.target.value})),children:ce.map(s=>e.jsx("option",{value:s.name,children:s.name},s.name))})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{children:[e.jsx(As,{size:14})," ç™¼æ–‡æ—¥æœŸ"]}),e.jsx("input",{type:"date",value:f.date,onChange:s=>v(a=>({...a,date:s.target.value}))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"æ™‚é–“ï¼ˆé¸å¡«ï¼‰"}),e.jsx("input",{type:"time",value:f.time,onChange:s=>v(a=>({...a,time:s.target.value}))})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{children:[e.jsx(Ve,{size:14})," b.stage åŽŸå§‹é€£çµï¼ˆé¸å¡«ï¼‰"]}),e.jsx("input",{type:"url",placeholder:"è²¼ä¸Š b.stage åŽŸå§‹é€£çµ...",value:f.sourceUrl,onChange:s=>v(a=>({...a,sourceUrl:s.target.value}))})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{children:[e.jsx(Ds,{size:14})," åœ–ç‰‡ / YouTube å½±ç‰‡",$e>0&&e.jsxs("span",{className:"upload-status",children:["ï¼ˆ",$e," å¼µä¸Šå‚³ä¸­...ï¼‰"]})]}),e.jsxs("div",{className:"media-upload-area",children:[f.media.map((s,a)=>e.jsxs("div",{className:`media-preview ${s.uploading?"uploading":""} ${s.uploadFailed?"failed":""}`,children:[s.type==="youtube"?e.jsxs("div",{className:"video-preview-img",children:[e.jsx("img",{src:s.thumbnail||oe(s.url),alt:""}),e.jsx(be,{size:16,className:"play-icon"})]}):e.jsx("img",{src:s.url,alt:""}),s.uploading&&e.jsx("div",{className:"upload-overlay",children:e.jsx("div",{className:"mini-spinner"})}),s.uploadFailed&&e.jsx("div",{className:"upload-failed-badge",title:"ä¸Šå‚³å¤±æ•—ï¼Œå°‡ä½¿ç”¨åŽŸå§‹é€£çµ",children:"âš ï¸"}),e.jsx("button",{className:"remove-media",onClick:()=>ys(a),children:e.jsx(re,{size:14})})]},a)),e.jsxs("label",{className:"upload-btn",children:[e.jsx("input",{type:"file",accept:"image/*",multiple:!0,onChange:vs,disabled:Se}),Se?e.jsx("span",{className:"uploading-text",children:"ä¸Šå‚³ä¸­..."}):e.jsxs(e.Fragment,{children:[e.jsx(zs,{size:20}),e.jsx("span",{children:"ä¸Šå‚³åœ–ç‰‡"})]})]}),e.jsxs("button",{type:"button",className:"manual-url-toggle",onClick:()=>K(!Te),children:[e.jsx(Ve,{size:16}),e.jsx("span",{children:"è²¼ä¸Šç¶²å€"})]})]}),e.jsxs("div",{className:"youtube-input-row",children:[e.jsx("input",{type:"url",placeholder:"è²¼ä¸Š YouTube é€£çµ...",value:J,onChange:s=>Ye(s.target.value)}),e.jsxs("button",{onClick:Ns,title:"æ–°å¢ž YouTube å½±ç‰‡",children:[e.jsx(be,{size:16})," æ–°å¢žå½±ç‰‡"]})]}),Te&&e.jsxs("div",{className:"manual-url-input",children:[e.jsx("p",{className:"manual-hint",children:"ðŸ’¡ æç¤ºï¼šæ¯è¡Œè²¼ä¸€å€‹åœ–ç‰‡ç¶²å€ï¼Œæ”¯æ´åœ–ç‰‡å’Œ YouTube é€£çµ"}),e.jsx("textarea",{placeholder:"è²¼ä¸Šåœ–ç‰‡/YouTube ç¶²å€ï¼Œæ¯è¡Œä¸€å€‹...",value:ue,onChange:s=>V(s.target.value),rows:4}),e.jsxs("div",{className:"manual-actions",children:[e.jsx("button",{type:"button",className:"cancel-manual",onClick:()=>{K(!1),V("")},children:"å–æ¶ˆ"}),e.jsx("button",{type:"button",className:"submit-manual",onClick:bs,children:"æ–°å¢žåª’é«”"})]})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"è²¼æ–‡å…§å®¹"}),e.jsx("textarea",{placeholder:"è²¼ä¸Š b.stage è²¼æ–‡å…§å®¹...",value:f.caption,onChange:s=>v(a=>({...a,caption:s.target.value})),rows:4})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"å‚™è¨»ï¼ˆé¸å¡«ï¼‰"}),e.jsx("textarea",{placeholder:"å…¶ä»–å‚™è¨»...",value:f.notes,onChange:s=>v(a=>({...a,notes:s.target.value})),rows:2})]}),e.jsx("div",{className:"form-group paid-checkbox-group",children:e.jsxs("label",{className:"paid-checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:f.paid||!1,onChange:s=>v(a=>({...a,paid:s.target.checked}))}),e.jsx("span",{children:"ðŸ”’ æœƒå“¡é™å®šå…§å®¹"})]})})]}),e.jsxs("div",{className:"modal-footer",children:[S&&e.jsxs("button",{className:"delete-btn",onClick:()=>{ks(S.id),D(!1)},children:[e.jsx(_s,{size:16})," åˆªé™¤"]}),e.jsx("button",{className:"cancel-btn",onClick:()=>D(!1),children:"å–æ¶ˆ"}),e.jsxs("button",{className:"save-btn",onClick:ws,disabled:Ne,children:[e.jsx(Bs,{size:16})," ",Ne?"å„²å­˜ä¸­...":"å„²å­˜"]})]})]})}),ee&&e.jsxs("div",{className:`toast ${ee.type}`,children:[ee.type==="error"?e.jsx(Ls,{size:16}):e.jsx(Fs,{size:16}),ee.msg]}),T&&e.jsx("div",{className:"confirm-modal-overlay",onClick:T.onCancel,children:e.jsxs("div",{className:`confirm-modal confirm-modal-${T.type}`,onClick:s=>s.stopPropagation(),children:[e.jsx("h3",{className:"confirm-modal-title",children:T.title}),e.jsx("div",{className:"confirm-modal-body",children:T.content}),e.jsxs("div",{className:"confirm-modal-actions",children:[e.jsx("button",{className:"confirm-modal-cancel",onClick:T.onCancel,children:T.cancelText}),e.jsx("button",{className:`confirm-modal-confirm confirm-modal-confirm-${T.type}`,onClick:T.onConfirm,children:T.confirmText})]})]})}),ns&&e.jsx("div",{className:"modal-overlay",onClick:()=>{(!k||k==="done")&&(q(!1),z(null),H(""),X([]))},children:e.jsxs("div",{className:"membership-modal import-modal",onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("h2",{children:[e.jsx(xe,{size:18})," å¾ž b.stage åŒ¯å…¥"]}),e.jsx("button",{className:"close-btn",onClick:()=>{k&&k!=="done"?Le():(q(!1),z(null),H(""),X([]))},children:e.jsx(re,{size:20})})]}),e.jsxs("div",{className:"modal-body",children:[!k&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"é¸æ“‡ç«™å°"}),e.jsx("select",{className:"import-site-select",value:he,onChange:s=>Pe(s.target.value),children:Object.entries(Q).map(([s,a])=>e.jsx("option",{value:s,children:a.label},s))})]}),e.jsxs("div",{className:"form-group",style:{marginTop:12},children:[e.jsx("label",{children:"Bearer Token"}),e.jsx("textarea",{className:"import-token-input",placeholder:"å¾ž b.stage é–‹ç™¼è€…å·¥å…·è¤‡è£½ Bearer token...",value:ne,onChange:s=>H(s.target.value),rows:3}),e.jsxs("p",{className:"import-hint",children:["åœ¨ ",Q[he].domain," ç™»å…¥ â†’ F12 é–‹ç™¼è€…å·¥å…· â†’ Network â†’ æ‰¾ä»»æ„ API è«‹æ±‚ â†’ è¤‡è£½ authorization header çš„å€¼",e.jsx("br",{}),"âš ï¸ Token ç´„ 30 åˆ†é˜éŽæœŸï¼Œæ¯å€‹ç«™å°éœ€ä½¿ç”¨å„è‡ªçš„ Token"]})]}),e.jsx("div",{className:"form-group",style:{marginTop:12},children:e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8,cursor:"pointer"},children:[e.jsx("input",{type:"checkbox",checked:ze,onChange:s=>is(s.target.checked)}),"å¼·åˆ¶æ›´æ–°å·²å­˜åœ¨çš„è²¼æ–‡ï¼ˆä¸é‡å‚³åœ–ç‰‡ï¼Œåƒ…æ›´æ–°æ–‡å­—/æ—¥æœŸï¼‰"]})})]}),k==="fetching"&&e.jsxs("div",{className:"import-progress-section",children:[e.jsx("h3",{children:"ðŸ”„ æŠ“å– b.stage è³‡æ–™ä¸­..."}),e.jsxs("p",{className:"import-progress-text",children:["ç¬¬ ",Ee.page," é ï¼Œå·²æŠ“å– ",Ee.totalItems," ç­†"]}),e.jsx("div",{className:"import-progress-bar",children:e.jsx("div",{className:"import-progress-bar-fill fetching"})})]}),(k==="processing"||k==="done")&&e.jsxs("div",{className:"import-progress-section",children:[e.jsx("h3",{children:k==="done"?"âœ… åŒ¯å…¥å®Œæˆ":"ðŸ“¦ è™•ç†ä¸­..."}),e.jsxs("div",{className:"import-stats",children:[e.jsxs("span",{className:"import-stat success",children:["âœ… ",E.success]}),e.jsxs("span",{className:"import-stat skipped",children:["â­ ",E.skipped]}),e.jsxs("span",{className:"import-stat failed",children:["âŒ ",E.failed]})]}),E.total>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"import-progress-bar",children:e.jsx("div",{className:"import-progress-bar-fill",style:{width:`${E.current/E.total*100}%`}})}),e.jsxs("p",{className:"import-progress-text",children:[E.current," / ",E.total]})]})]}),De.length>0&&e.jsx("div",{className:"import-log",children:De.map((s,a)=>e.jsx("div",{className:`import-log-line import-log-${s.type}`,children:s.msg},a))})]}),e.jsxs("div",{className:"modal-footer",children:[!k&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"cancel-btn",onClick:()=>{q(!1),H("")},children:"å–æ¶ˆ"}),e.jsxs("button",{className:"save-btn",onClick:ms,disabled:!ne.trim(),children:[e.jsx(xe,{size:16})," é–‹å§‹åŒ¯å…¥"]})]}),k&&k!=="done"&&e.jsx("button",{className:"cancel-btn",onClick:Le,children:"å–æ¶ˆåŒ¯å…¥"}),k==="done"&&e.jsx("button",{className:"save-btn",onClick:()=>{q(!1),z(null),H(""),X([]),Pe("gdragon")},children:"é—œé–‰"})]})]})})]})}const Zs=i.memo(qs);export{Zs as default};
