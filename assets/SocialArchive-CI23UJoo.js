import{s as Q,j as e,N as Ms,M as Lt,g as st,a as Yt,b as $e,f as Vt,c as Ds,d as zs,e as Ps,u as Fs,i as As,h as _t,k as Os,l as Te,m as Ie}from"./index-ZHGX8Olp.js";import{a as u,U as Be,d as Gs,A as Rs,F as Ls,o as at,p as Ys,G as Vs,q as _s,s as Et,t as nt,u as Es,f as ie,R as lt,C as Hs,X as re,E as Ws,b as qs,v as it,e as Js,I as Xs,T as Ks,S as Qs,w as Zs,i as Ht,j as ea}from"./icons-51PM2evP.js";import{u as ta}from"./ArchiveBase-B8d65I6t.js";import"./vendor-DhQqL_yF.js";const Y=[{id:"post",label:"è²¼æ–‡",icon:"ðŸ“·",color:"#E1306C"},{id:"story",label:"Story",icon:"â­•",color:"#833AB4"},{id:"reels",label:"Reels",icon:"ðŸŽ¬",color:"#F77737"}],Wt={"G-Dragon":{main:"xxxibgdrgn"},"T.O.P":{main:"ttt",extra:[{username:"tttopost",type:"post",dateFormat:"auto"},{username:"top.ttt.story",type:"story",dateFormat:"auto",isPrefix:!0}]},å¤ªé™½:{main:"__youngbae__"},å¤§è²:{main:"d_lable_official"},å‹åˆ©:{main:""},å…¨å“¡:{main:"bigbangofficial"}};function Me(N){if(!N)return"å…¨å“¡";const S=N.toLowerCase();for(const[I,B]of Object.entries(Wt)){if(B.main&&S===B.main.toLowerCase())return I;if(B.extra)for(const k of B.extra){const U=k.username.toLowerCase();if(k.isPrefix?S.startsWith(U):S===U)return I}}return"å…¨å“¡"}function De(N){if(!N)return null;const S=N.toLowerCase();for(const I of Object.values(Wt))if(I.extra)for(const B of I.extra){const k=B.username.toLowerCase();if(B.isPrefix?S.startsWith(k):S===k)return B}return null}function V(N,S){if(!N||!S)return null;function I(k){const U=k.match(/(\d{4})-(\d{1,2})-(\d{1,2})/);if(U){const _=U[1],R=U[2].padStart(2,"0"),Z=U[3].padStart(2,"0");return`${_}-${R}-${Z}`}return null}function B(k){const U=k.match(/\b(\d{6})\b/);if(U){const _=U[1],R=parseInt(_.substring(0,2),10),Z=_.substring(2,4),be=_.substring(4,6);return`${R>=50?1900+R:2e3+R}-${Z}-${be}`}return null}return S==="auto"?I(N)||B(N):S==="iso"?I(N):S==="6digits"?B(N):null}function sa(N){if(!N)return null;const S=N.match(/instagram\.com\/stories\/([^\/]+)\//);if(S)return S[1];const I=N.match(/instagram\.com\/([^\/]+)\/(?:p|reel|reels|tv)\//);return I&&!["p","reel","reels","tv","stories","explore"].includes(I[1])?I[1]:null}function ze(N,S){return N||sa(S)||null}async function Pe(N){try{const S=`${Os.IG_SCRAPER_URL}/scrape?url=${encodeURIComponent(N)}`;return await(await fetch(S)).json()}catch(S){return console.error("IG æŠ“å–å¤±æ•—:",S),{success:!1,error:S.message}}}function aa({isAdmin:N,onBack:S,currentPage:I,setCurrentPage:B}){var Mt,Dt,zt,Pt,Ft,At,Ot;const[k,U]=u.useState([]),[_,R]=u.useState(!0),[Z,be]=u.useState(!1),[ce,rt]=u.useState(null),[z,Fe]=u.useState([]),[F,ct]=u.useState("all"),[oe,qt]=u.useState(!1),[je,Jt]=u.useState(!1),[E,ot]=u.useState("all"),[ee,Xt]=u.useState(!0),[Ae,de]=u.useState(!1),[Oe,Ge]=u.useState(!1),[Re,ue]=u.useState(!1),[ve,Kt]=u.useState(""),[L,dt]=u.useState("grid"),[A,Qt]=u.useState({}),[Le,ut]=u.useState(!1),[mt,ht]=u.useState({current:0,total:0}),[Zt,H]=u.useState(!1),[M,pt]=u.useState(null),[v,$]=u.useState({type:"post",member:"å…¨å“¡",date:new Date().toISOString().split("T")[0],time:"",igUrl:"",caption:"",media:[],notes:""}),[ft,gt]=u.useState(!1),[m,W]=u.useState(null),[O,q]=u.useState(0),[J,xt]=u.useState(!1),[X,te]=u.useState([]),[bt,jt]=u.useState(!1),[vt,wt]=u.useState({current:0,total:0}),[es,yt]=u.useState(null),se=u.useRef(!1),[ts,me]=u.useState(!1),[he,Ye]=u.useState(""),[ae,Nt]=u.useState(!1),[pe,Ve]=u.useState({current:0,total:0}),[fe,K]=u.useState([]),ne=u.useRef(!1),[_e,ss]=u.useState(!1),[as,Ee]=u.useState(!1),[P,He]=u.useState(null),We=u.useRef(null),[ge,qe]=u.useState(()=>window.innerWidth<500?2:Math.max(2,Math.floor(Math.min(900,window.innerWidth)/280)));u.useEffect(()=>{ns()},[]);async function ns(){R(!0);try{const t=await Q.load();U(t)}catch(t){console.error("è¼‰å…¥å¤±æ•—",t),b("è¼‰å…¥å¤±æ•—","error")}finally{R(!1)}}function b(t,a="success"){rt({msg:t,type:a}),setTimeout(()=>rt(null),2500)}function we({title:t,content:a,type:n="warning",confirmText:s="ç¢ºå®š",cancelText:h="å–æ¶ˆ"}){return new Promise(c=>{He({title:t,content:a,type:n,confirmText:s,cancelText:h,onConfirm:()=>{He(null),c(!0)},onCancel:()=>{He(null),c(!1)}})})}function ls(t){var a;return(a=t.media)==null?void 0:a.some(n=>n.type==="video"||n.type==="youtube")}function is(t){var a;return((a=A[t.id])==null?void 0:a.length)>0}async function xe(t){if(!t)return!1;try{const a=new AbortController,n=setTimeout(()=>a.abort(),1e4),s=await fetch(t,{method:"HEAD",mode:"cors",signal:a.signal});return clearTimeout(n),s.ok?!0:(console.log(`âŒ åœ–ç‰‡æª¢æŸ¥å¤±æ•— (HTTP ${s.status}): ${t}`),!1)}catch{return new Promise(n=>{const s=new window.Image,h=setTimeout(()=>{s.src="",n(!1)},1e4);s.onload=()=>{clearTimeout(h),s.naturalWidth===0||s.naturalHeight===0?n(!1):n(!0)},s.onerror=()=>{clearTimeout(h),n(!1)},s.src=t})}}async function rs(){var s;ut(!0),ht({current:0,total:k.length});const t={};let a=0;for(const h of k){const c=[];if(((s=h.media)==null?void 0:s.length)>0)for(let r=0;r<h.media.length;r++){const l=h.media[r],x=l.type==="video"?l.thumbnail:l.url;x&&(await xe(x)||c.push(r))}c.length>0&&(t[h.id]=c),a++,ht({current:a,total:k.length})}Qt(t),ut(!1);const n=Object.keys(t).length;n>0?b(`æª¢æŸ¥å®Œæˆï¼š${n} ç­†æœ‰å£žåœ–`,"error"):b("æª¢æŸ¥å®Œæˆï¼šæ²’æœ‰ç™¼ç¾å£žåœ– âœ…")}const cs=u.useMemo(()=>{const t=new Set;k.forEach(n=>{if(n.date){const s=n.date.substring(0,4);s&&t.add(s)}});const a=Array.from(t).sort((n,s)=>s-n);return ee?a:a.reverse()},[k,ee]),T=u.useMemo(()=>k.filter(t=>{var a;return!(z.length>0&&!z.includes(t.member)||F!=="all"&&t.type!==F||oe&&!ls(t)||je&&!is(t)||E!=="all"&&t.date&&!t.date.startsWith(E)||ve&&!((a=t.caption)!=null&&a.toLowerCase().includes(ve.toLowerCase())))}).sort((t,a)=>{const n=new Date(t.date),s=new Date(a.date);return ee?s-n:n-s}),[k,z,F,oe,je,E,ve,ee,A]);u.useEffect(()=>{const t=We.current;if(!t)return;const a=()=>{if(L!=="grid"){qe(1);return}const s=Math.min(t.clientWidth,window.innerWidth);if(s<500){qe(2);return}qe(Math.max(2,Math.floor(s/280)))};a();const n=new ResizeObserver(a);return n.observe(t),()=>n.disconnect()},[L]);const os=u.useMemo(()=>Math.ceil(T.length/ge),[T.length,ge]),Je=ta({count:os,getScrollElement:()=>We.current,estimateSize:()=>L==="grid"?340:120,overscan:3,gap:L==="grid"?16:10});function kt(){pt(null),$({type:"post",member:"å…¨å“¡",date:new Date().toISOString().split("T")[0],time:"",igUrl:"",caption:"",media:[],notes:""}),H(!0)}function ds(t){pt(t),$({type:t.type,member:t.member,date:t.date,time:t.time||"",igUrl:t.igUrl||"",caption:t.caption||"",media:t.media||[],notes:t.notes||""}),H(!0)}function us(t){W(t),q(0)}function ms(){const t=T.findIndex(a=>a.id===(m==null?void 0:m.id));t>0&&(W(T[t-1]),q(0))}function hs(){const t=T.findIndex(a=>a.id===(m==null?void 0:m.id));t<T.length-1&&(W(T[t+1]),q(0))}function Xe(){return T.findIndex(t=>t.id===(m==null?void 0:m.id))}const[Ct,ye]=u.useState(new Set);function Ne(t){return Ct.has(t)}async function ps(){var n,s,h,c,r;if(!(m!=null&&m.igUrl)){b("æ­¤è²¼æ–‡æ²’æœ‰ IG é€£çµ","error");return}if(Ne(m.id)){b("æ­¤è²¼æ–‡æ­£åœ¨åŒæ­¥ä¸­...","info");return}const t={...m},a=m.id;ye(l=>new Set(l).add(a));try{const l=await Pe(t.igUrl);if(!l.success||!((n=l.media)!=null&&n.length)){if(!await we({title:"âš ï¸ æŠ“å–å¤±æ•—",type:"warning",confirmText:"æ¸…ç©ºåª’é«”",cancelText:"å–æ¶ˆ",content:e.jsxs("div",{className:"confirm-content",children:[e.jsx("p",{children:"å¯èƒ½åŽŸå› ï¼š"}),e.jsxs("ul",{children:[e.jsx("li",{children:"IG è²¼æ–‡å·²è¢«åˆªé™¤"}),e.jsx("li",{children:"IG API æš«æ™‚ç„¡æ³•å­˜å–"}),e.jsx("li",{children:"ç¶²è·¯é€£ç·šå•é¡Œ"})]}),e.jsx("p",{className:"confirm-warning",children:"æ˜¯å¦ä»è¦æ¸…ç©ºæ­¤è²¼æ–‡çš„åª’é«”è³‡æ–™ï¼Ÿ"})]})})){ye(f=>{const y=new Set(f);return y.delete(a),y});return}}else{const w=((s=t.media)==null?void 0:s.length)||0,f=((h=l.media)==null?void 0:h.length)||0,y=(t.caption||"").trim(),G=(l.caption||"").trim(),Ue=w!==f,Gt=y!==G&&G!=="";if(Ue||Gt){const Ts=y.substring(0,80)+(y.length>80?"...":""),Is=G.substring(0,80)+(G.length>80?"...":"");if(!await we({title:"ðŸ“ è³‡æ–™è®Šæ›´ç¢ºèª",type:"info",confirmText:"è¦†è“‹",cancelText:"å–æ¶ˆ",content:e.jsxs("div",{className:"confirm-content",children:[e.jsx("p",{children:"æŠ“å–åˆ°çš„è³‡æ–™èˆ‡ç¾æœ‰è³‡æ–™ä¸åŒï¼š"}),Ue&&e.jsxs("div",{className:"diff-item",children:[e.jsx("span",{className:"diff-label",children:"ðŸ“· åª’é«”æ•¸é‡"}),e.jsxs("div",{className:"diff-values",children:[e.jsxs("span",{className:"diff-old",children:[w," å¼µ"]}),e.jsx("span",{className:"diff-arrow",children:"â†’"}),e.jsxs("span",{className:"diff-new",children:[f," å¼µ"]})]})]}),Gt&&e.jsxs("div",{className:"diff-item",children:[e.jsx("span",{className:"diff-label",children:"ðŸ“ å…§å®¹"}),e.jsxs("div",{className:"diff-text",children:[e.jsx("div",{className:"diff-old",children:Ts||"(ç©º)"}),e.jsx("div",{className:"diff-new",children:Is})]})]}),e.jsx("p",{className:"confirm-question",children:"ç¢ºå®šè¦è¦†è“‹å—Žï¼Ÿ"})]})})){ye(Bs=>{const Rt=new Set(Bs);return Rt.delete(a),Rt}),b("å·²å–æ¶ˆåŒæ­¥");return}}}b("åŒæ­¥ä¸­ï¼Œæª¢æŸ¥ä¸¦ä¸Šå‚³åœ–ç‰‡...","info");const x=((c=l.media)==null?void 0:c.length)>0?await et(l.media,t.media||[],t.member):[],o=(t.media||[]).filter(w=>w.type==="youtube"),p=[...x,...o],d=ze((r=l.owner)==null?void 0:r.username,t.igUrl),i=Me(d),g=De(d);let j=t.date,C=t.time||"";if(g!=null&&g.dateFormat&&l.caption){const w=V(l.caption,g.dateFormat);w&&(j=w)}else if(l.date){const w=new Date(l.date),f=new Date(w.getTime()+480*60*1e3);j=`${f.getUTCFullYear()}-${String(f.getUTCMonth()+1).padStart(2,"0")}-${String(f.getUTCDate()).padStart(2,"0")}`,C=`${String(f.getUTCHours()).padStart(2,"0")}:${String(f.getUTCMinutes()).padStart(2,"0")}`}if(!g&&i==="å…¨å“¡"&&l.caption){const w=V(l.caption,"auto");w&&(j=w,C="")}const D={...t,media:p,caption:l.caption||t.caption,type:(g==null?void 0:g.type)||t.type,date:j,time:C,updatedAt:Date.now()};U(w=>{const f=w.map(y=>y.id===a?D:y);return Q.update(D).catch(y=>console.warn("D1 å„²å­˜å¤±æ•—:",y)),f}),W(w=>(w==null?void 0:w.id)===a?D:w),q(0),x.length>0?b(`âœ… åŒæ­¥å®Œæˆï¼š${x.length} å€‹åª’é«”`):b("å·²æ¸…ç©ºåª’é«”è³‡æ–™","info")}catch(l){console.error("åŒæ­¥å¤±æ•—:",l),b("âŒ åŒæ­¥å¤±æ•—ï¼š"+l.message,"error")}finally{ye(l=>{const x=new Set(l);return x.delete(a),x})}}function fs(){m&&(ds(m),W(null))}const[Ke,ke]=u.useState(!1),[St,Ce]=u.useState(""),[Ut,Se]=u.useState(0),[$t,le]=u.useState(!1),[Qe,Ze]=u.useState("");async function Tt(){var t,a;if(v.igUrl){ke(!0),Ce("æŠ“å–ä¸­...");try{const n=await Pe(v.igUrl);if(n.success&&((t=n.media)==null?void 0:t.length)>0){const s=ze((a=n.owner)==null?void 0:a.username,v.igUrl),h=Me(s),c=De(s);let r=v.date,l="";if(c!=null&&c.dateFormat&&n.caption){const i=V(n.caption,c.dateFormat);i&&(r=i)}else if(n.date){const i=new Date(n.date),g=new Date(i.getTime()+480*60*1e3);r=`${g.getUTCFullYear()}-${String(g.getUTCMonth()+1).padStart(2,"0")}-${String(g.getUTCDate()).padStart(2,"0")}`,l=`${String(g.getUTCHours()).padStart(2,"0")}:${String(g.getUTCMinutes()).padStart(2,"0")}`}if(!c&&h==="å…¨å“¡"&&n.caption){const i=V(n.caption,"auto");i&&(r=i,l="")}const x=n.media||[],o=x.map((i,g)=>({url:i.url||i.thumbnail,type:i.type,thumbnail:i.thumbnail||null,uploading:i.type==="image",thumbnailUploading:i.type==="video"&&i.thumbnail,originalUrl:i.url,originalThumbnail:i.thumbnail,index:g}));$(i=>({...i,type:(c==null?void 0:c.type)||n.type||i.type,member:h,date:r,time:l||i.time,caption:n.caption||i.caption,media:o})),ke(!1),Ce(""),le(!1),b(`âœ… å·²æŠ“å– ${x.length} å€‹åª’é«”ï¼ŒèƒŒæ™¯ä¸Šå‚³ä¸­...`);const p=o.filter(i=>i.type==="image"),d=o.filter(i=>i.type==="video"&&i.thumbnail);Se(p.length+d.length);for(const i of p)It(i.originalUrl,i.index,h);for(const i of d)xs(i.originalThumbnail,i.index,h)}else{const s=v.igUrl.match(/instagram\.com\/p\//),h=v.igUrl.match(/instagram\.com\/(?:reel|reels)\//);let c="post";h&&(c="reels"),$(r=>({...r,type:c})),le(!0),b("âš ï¸ è‡ªå‹•æŠ“å–å¤±æ•—ï¼Œè«‹æ‰‹å‹•è¼¸å…¥åª’é«”ç¶²å€","info"),ke(!1),Ce("")}}catch(n){console.error("è§£æžå¤±æ•—",n),le(!0),b("âš ï¸ æŠ“å–å¤±æ•—ï¼Œè«‹æ‰‹å‹•è¼¸å…¥åª’é«”ç¶²å€","error"),ke(!1),Ce("")}}}async function gs(){if(!Qe.trim())return;const t=Qe.split(`
`).map(s=>s.trim()).filter(s=>s&&(s.startsWith("http")||s.startsWith("//")));if(t.length===0){b("è«‹è¼¸å…¥æœ‰æ•ˆçš„ç¶²å€","error");return}const a=t.map((s,h)=>{if(As(s))return{url:s,type:"youtube",thumbnail:st(s),index:v.media.length+h};const c=/\.(mp4|mov|webm|m4v)/i.test(s)||s.includes("video");return{url:s,type:c?"video":"image",uploading:!c,originalUrl:s,index:v.media.length+h}});$(s=>({...s,media:[...s.media,...a]}));const n=a.filter(s=>s.type==="image");Se(s=>s+n.length);for(const s of n)It(s.originalUrl,s.index,v.member);Ze(""),le(!1),b(`å·²æ–°å¢ž ${t.length} å€‹åª’é«”`)}async function It(t,a,n){try{const s={context:"social",member:n},[h,c]=await Promise.all([Te(t,s),Ie(t,s).catch(r=>(console.warn("ImgBB å‚™ä»½å¤±æ•—:",r.message),null))]);$(r=>({...r,media:r.media.map((l,x)=>x===a?{...l,url:h,backupUrl:c,uploading:!1}:l)}))}catch(s){console.warn(`åœ–ç‰‡ ${a+1} ä¸Šå‚³å¤±æ•—`,s),$(h=>({...h,media:h.media.map((c,r)=>r===a?{...c,uploading:!1,uploadFailed:!0}:c)}))}finally{Se(s=>s-1)}}async function xs(t,a,n){try{const s={context:"social",member:n},[h,c]=await Promise.all([Te(t,s),Ie(t,s).catch(r=>(console.warn("ImgBB å‚™ä»½å¤±æ•—:",r.message),null))]);$(r=>({...r,media:r.media.map((l,x)=>x===a?{...l,thumbnail:h,thumbnailBackupUrl:c,thumbnailUploading:!1}:l)})),c&&console.log(`âœ… å½±ç‰‡ ${a+1} ç¸®åœ–é›™é‡å‚™ä»½å®Œæˆ`)}catch(s){console.warn(`å½±ç‰‡ ${a+1} ç¸®åœ–ä¸Šå‚³å¤±æ•—`,s),$(h=>({...h,media:h.media.map((c,r)=>r===a?{...c,thumbnailUploading:!1,thumbnailFailed:!0}:c)}))}finally{Se(s=>s-1)}}async function bs(t){const a=Array.from(t.target.files);if(a.length){gt(!0);try{const n=[];for(const s of a)if(s.type.startsWith("video/")){const c=URL.createObjectURL(s);n.push({url:c,type:"video",localFile:s})}else{const{url:c,backupUrl:r}=await Fs(s,{context:"social",member:v.member});n.push({url:c,type:"image",...r&&{backupUrl:r}})}$(s=>({...s,media:[...s.media,...n]})),b(`å·²æ–°å¢ž ${n.length} å€‹æª”æ¡ˆ`)}catch(n){console.error("ä¸Šå‚³å¤±æ•—",n),b("ä¸Šå‚³å¤±æ•—","error")}finally{gt(!1)}}}function js(t){$(a=>({...a,media:a.media.filter((n,s)=>s!==t)}))}async function vs(){if(!v.date||!v.member){b("è«‹å¡«å¯«å¿…è¦æ¬„ä½","error");return}if(v.media.some(n=>n.uploading)&&!await we({title:"âš ï¸ ä¸Šå‚³æœªå®Œæˆ",type:"warning",confirmText:"ä»è¦å„²å­˜",cancelText:"ç­‰å¾…ä¸Šå‚³",content:e.jsxs("div",{className:"confirm-content",children:[e.jsx("p",{children:"é‚„æœ‰åœ–ç‰‡æ­£åœ¨ä¸Šå‚³ä¸­ï¼Œç¢ºå®šè¦ç¾åœ¨å„²å­˜å—Žï¼Ÿ"}),e.jsx("p",{className:"confirm-warning",children:"æœªå®Œæˆä¸Šå‚³çš„åœ–ç‰‡å¯èƒ½ç„¡æ³•æ­£å¸¸é¡¯ç¤º"})]})}))return;const a={id:(M==null?void 0:M.id)||_t("s"),type:v.type,member:v.member,date:v.date,time:v.time,igUrl:v.igUrl,caption:v.caption,media:v.media.map(n=>({url:n.url,type:n.type,...n.backupUrl&&{backupUrl:n.backupUrl},...n.thumbnail&&{thumbnail:n.thumbnail},...n.thumbnailBackupUrl&&{thumbnailBackupUrl:n.thumbnailBackupUrl}})),notes:v.notes,createdAt:(M==null?void 0:M.createdAt)||Date.now(),updatedAt:Date.now()};be(!0);try{M?(await Q.update(a),U(k.map(n=>n.id===M.id?a:n))):(await Q.create(a),U([a,...k])),b("å·²å„²å­˜"),H(!1)}catch(n){console.error("å„²å­˜å¤±æ•—",n),b("å„²å­˜å¤±æ•—","error")}finally{be(!1)}}async function ws(t){if(await we({title:"ðŸ—‘ï¸ åˆªé™¤ç¢ºèª",type:"danger",confirmText:"åˆªé™¤",cancelText:"å–æ¶ˆ",content:e.jsxs("div",{className:"confirm-content",children:[e.jsx("p",{children:"ç¢ºå®šè¦åˆªé™¤é€™ç­†å‚™ä»½å—Žï¼Ÿ"}),e.jsx("p",{className:"confirm-warning",children:"æ­¤æ“ä½œç„¡æ³•å¾©åŽŸ"})]})}))try{await Q.delete(t),U(k.filter(n=>n.id!==t)),b("å·²åˆªé™¤")}catch(n){console.error("åˆªé™¤å¤±æ•—",n),b("åˆªé™¤å¤±æ•—","error")}}function Bt(t){te(a=>a.includes(t)?a.filter(n=>n!==t):[...a,t])}function ys(){X.length===T.length?te([]):te(T.map(t=>t.id))}async function et(t,a=[],n){var c,r,l,x;const s=[],h=[];for(let o=0;o<t.length;o++){const p=t[o],d=a[o];if(p.type==="image"){if((d==null?void 0:d.type)==="image"){if((c=d==null?void 0:d.url)!=null&&c.includes("cloudinary")&&await xe(d.url)){console.log(`âœ… åœ–ç‰‡ ${o+1} Cloudinary å‚™ä»½å¯ç”¨ï¼Œè·³éŽä¸Šå‚³`),s.push({...d});continue}if((r=d==null?void 0:d.backupUrl)!=null&&r.includes("i.ibb.co")&&await xe(d.backupUrl)){console.log(`âœ… åœ–ç‰‡ ${o+1} ImgBB å‚™ä»½å¯ç”¨ï¼Œåˆ‡æ›ä½¿ç”¨`),s.push({url:d.backupUrl,type:"image",backupUrl:d.backupUrl});continue}console.log(`âš ï¸ åœ–ç‰‡ ${o+1} æ‰€æœ‰å‚™ä»½éƒ½å¤±æ•ˆï¼Œé‡æ–°ä¸Šå‚³`)}try{console.log(`ðŸ“¤ ä¸Šå‚³åœ–ç‰‡ ${o+1}...`);const i={context:"social",member:n},j={url:await Te(p.url,i),type:"image"};s.push(j);const C=s.length-1;h.push(Ie(p.url,i).then(D=>{D&&(s[C].backupUrl=D)}).catch(D=>console.warn("ImgBB èƒŒæ™¯ä¸Šå‚³å¤±æ•—:",D)))}catch(i){console.warn("åœ–ç‰‡ä¸Šå‚³å¤±æ•—:",i),s.push({url:p.url,type:"image"})}}else if(p.type==="video"){const i={url:p.url,type:"video"};if(p.thumbnail){if((d==null?void 0:d.type)==="video"){if((l=d==null?void 0:d.thumbnail)!=null&&l.includes("cloudinary")&&await xe(d.thumbnail)){console.log(`âœ… å½±ç‰‡ ${o+1} ç¸®åœ– Cloudinary å‚™ä»½å¯ç”¨ï¼Œè·³éŽä¸Šå‚³`),i.thumbnail=d.thumbnail,d.thumbnailBackupUrl&&(i.thumbnailBackupUrl=d.thumbnailBackupUrl),s.push(i);continue}if((x=d==null?void 0:d.thumbnailBackupUrl)!=null&&x.includes("i.ibb.co")&&await xe(d.thumbnailBackupUrl)){console.log(`âœ… å½±ç‰‡ ${o+1} ç¸®åœ– ImgBB å‚™ä»½å¯ç”¨ï¼Œåˆ‡æ›ä½¿ç”¨`),i.thumbnail=d.thumbnailBackupUrl,i.thumbnailBackupUrl=d.thumbnailBackupUrl,s.push(i);continue}console.log(`âš ï¸ å½±ç‰‡ ${o+1} ç¸®åœ–æ‰€æœ‰å‚™ä»½éƒ½å¤±æ•ˆï¼Œé‡æ–°ä¸Šå‚³`)}try{console.log(`ðŸ“¤ ä¸Šå‚³å½±ç‰‡ ${o+1} ç¸®åœ–...`);const g={context:"social",member:n},j=await Te(p.thumbnail,g);i.thumbnail=j,h.push(Ie(p.thumbnail,g).then(C=>{C&&(i.thumbnailBackupUrl=C)}).catch(C=>console.warn("ImgBB ç¸®åœ–èƒŒæ™¯ä¸Šå‚³å¤±æ•—:",C)))}catch(g){console.warn("ç¸®åœ–ä¸Šå‚³å¤±æ•—:",g),i.thumbnail=p.thumbnail}}s.push(i)}}return h.length>0&&Promise.all(h).then(()=>{console.log("âœ… ImgBB èƒŒæ™¯ä¸Šå‚³å®Œæˆ")}),s}function Ns(t,a){return t.map((s,h)=>{const c=a[h];return s.type==="video"&&(c==null?void 0:c.type)==="video"?{...s,url:c.url}:(s.type==="image",s)})}function ks(){se.current=!0,b("æ­£åœ¨å–æ¶ˆåŒæ­¥...","info")}async function Cs(){var h,c;const t=k.filter(r=>X.includes(r.id)&&r.igUrl);if(t.length===0){b("æ²’æœ‰å¯åŒæ­¥çš„é …ç›®ï¼ˆéœ€æœ‰ IG é€£çµï¼‰","error");return}const a=oe;se.current=!1,jt(!0),wt({current:0,total:t.length});let n=0;for(const r of t){if(se.current)break;yt(r.id),await new Promise(l=>setTimeout(l,0));try{const l=await Pe(r.igUrl);if(se.current)break;if(l.success&&((h=l.media)==null?void 0:h.length)>0){const x=ze((c=l.owner)==null?void 0:c.username,r.igUrl),o=Me(x),p=De(x);let d=r.date,i=r.time||"";if(p!=null&&p.dateFormat&&l.caption){const j=V(l.caption,p.dateFormat);j&&(d=j)}else if(l.date){const j=new Date(l.date),C=new Date(j.getTime()+480*60*1e3);d=`${C.getUTCFullYear()}-${String(C.getUTCMonth()+1).padStart(2,"0")}-${String(C.getUTCDate()).padStart(2,"0")}`,i=`${String(C.getUTCHours()).padStart(2,"0")}:${String(C.getUTCMinutes()).padStart(2,"0")}`}if(!p&&o==="å…¨å“¡"&&l.caption){const j=V(l.caption,"auto");j&&(d=j,i="")}let g;if(a){const j=Ns(r.media,l.media);g={...r,media:j,type:(p==null?void 0:p.type)||r.type,date:d,time:i,updatedAt:Date.now()},console.log(`âœ… ${r.id} å½±ç‰‡ URL å·²æ›´æ–°ï¼ˆä¿ç•™ thumbnailï¼‰`)}else{const j=await et(l.media,r.media||[],r.member);if(se.current)break;const C=(r.media||[]).filter(w=>w.type==="youtube"),D=[...j,...C];g={...r,media:D,caption:l.caption||r.caption,type:(p==null?void 0:p.type)||r.type,date:d,time:i,updatedAt:Date.now()}}U(j=>j.map(C=>C.id===r.id?g:C)),Q.update(g).catch(j=>console.warn("D1 å„²å­˜å¤±æ•—:",j)),n++,await new Promise(j=>setTimeout(j,0))}}catch(l){console.warn(`åŒæ­¥ ${r.id} å¤±æ•—:`,l)}wt(l=>({...l,current:l.current+1})),await new Promise(l=>setTimeout(l,0))}const s=se.current;yt(null),jt(!1),xt(!1),te([]),s?b(`å·²å–æ¶ˆåŒæ­¥ï¼ˆå·²å®Œæˆ ${n} ç­†ï¼‰`,"info"):b(a?`å½±ç‰‡åŒæ­¥å®Œæˆï¼š${n}/${t.length} ç­†æˆåŠŸ`:`åŒæ­¥å®Œæˆï¼š${n}/${t.length} ç­†æˆåŠŸ`)}const Ss=`(async()=>{const d=ms=>new Promise(r=>setTimeout(r,ms));const urls=new Set();let last=0,retries=0;console.log('é–‹å§‹æ”¶é›†è²¼æ–‡ URL...');while(retries<5){document.querySelectorAll('a[href*="/p/"],a[href*="/reel/"],a[href*="/reels/"]').forEach(a=>{const h=a.href.split('?')[0];if(/\\/(p|reel|reels)\\//.test(h))urls.add(h)});console.log('å·²æ‰¾åˆ° '+urls.size+' ç­†');if(urls.size===last)retries++;else{retries=0;last=urls.size}window.scrollTo(0,document.body.scrollHeight);await d(1500)}const r=[...urls].join('\\n');console.log('\\nå®Œæˆï¼å…± '+urls.size+' ç­†ï¼š\\n'+r);try{await navigator.clipboard.writeText(r);console.log('\\nâœ… å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿')}catch{console.log('\\nâš ï¸ è«‹æ‰‹å‹•è¤‡è£½ä¸Šæ–¹æ–‡å­—')}})();`;function tt(t){const a=new Set;return t.split(`
`).map(n=>n.trim()).filter(n=>n&&/instagram\.com\/(?:[^\/]+\/)?(p|reel|reels|tv)\//.test(n)).filter(n=>{const s=n.split("?")[0].replace(/\/$/,"");return a.has(s)?!1:(a.add(s),!0)})}function Us(){ne.current=!0,b("æ­£åœ¨å–æ¶ˆæ‰¹æ¬¡å‚™ä»½...","info")}async function $s(){var c,r;const t=tt(he);if(t.length===0){b("æ²’æœ‰æœ‰æ•ˆçš„ IG é€£çµ","error");return}new Set(k.map(l=>l.igUrl).filter(Boolean));const a=[],n=[];for(const l of t){const x=l.split("?")[0].replace(/\/$/,"");k.some(p=>p.igUrl?p.igUrl.split("?")[0].replace(/\/$/,"")===x:!1)?n.push(l):a.push(l)}if(a.length===0){b(`å…¨éƒ¨ ${n.length} ç­†éƒ½æ˜¯é‡è¤‡çš„`,"error");return}ne.current=!1,Nt(!0),Ve({current:0,total:a.length}),K(a.map(l=>({url:l,status:"pending"})));let s=0;for(let l=0;l<a.length&&!ne.current;l++){const x=a[l];K(o=>o.map((p,d)=>d===l?{...p,status:"processing"}:p)),await new Promise(o=>setTimeout(o,0));try{console.log(`[æ‰¹æ¬¡å‚™ä»½ ${l+1}] é–‹å§‹æŠ“å–: ${x}`);const o=await Pe(x);if(console.log(`[æ‰¹æ¬¡å‚™ä»½ ${l+1}] fetchIGData å›žå‚³:`,JSON.stringify(o,null,2)),ne.current)break;if(!o.success||!((c=o.media)!=null&&c.length)){const f=o.error||o.message||(o.success?"ç„¡åª’é«”":"æŠ“å–å¤±æ•—");console.warn(`[æ‰¹æ¬¡å‚™ä»½ ${l+1}] è·³éŽ: ${f}`),K(y=>y.map((G,Ue)=>Ue===l?{...G,status:"error",error:f}:G)),Ve(y=>({...y,current:y.current+1}));continue}const p=ze((r=o.owner)==null?void 0:r.username,x),d=Me(p),i=De(p);console.log(`[æ‰¹æ¬¡å‚™ä»½ ${l+1}] æˆå“¡: ${d}, username: ${p}, media: ${o.media.length} ç­†`);let g=new Date().toISOString().split("T")[0],j="";if(i!=null&&i.dateFormat&&o.caption){const f=V(o.caption,i.dateFormat);f&&(g=f)}else if(o.date){const f=new Date(o.date),y=new Date(f.getTime()+480*60*1e3);g=`${y.getUTCFullYear()}-${String(y.getUTCMonth()+1).padStart(2,"0")}-${String(y.getUTCDate()).padStart(2,"0")}`,j=`${String(y.getUTCHours()).padStart(2,"0")}:${String(y.getUTCMinutes()).padStart(2,"0")}`}if(!i&&d==="å…¨å“¡"&&o.caption){const f=V(o.caption,"auto");f&&(g=f,j="")}console.log(`[æ‰¹æ¬¡å‚™ä»½ ${l+1}] æ—¥æœŸ: ${g} ${j}`),console.log(`[æ‰¹æ¬¡å‚™ä»½ ${l+1}] é–‹å§‹ä¸Šå‚³åª’é«”...`);const C=await et(o.media,[],d);if(console.log(`[æ‰¹æ¬¡å‚™ä»½ ${l+1}] ä¸Šå‚³å®Œæˆ:`,C.map(f=>{var y;return{url:(y=f.url)==null?void 0:y.substring(0,50),type:f.type}})),ne.current)break;const D=(i==null?void 0:i.type)||o.type||"post",w={id:_t("s"),type:D,member:d,date:g,time:j,igUrl:x,caption:o.caption||"",media:C.map(f=>({url:f.url,type:f.type,...f.backupUrl&&{backupUrl:f.backupUrl},...f.thumbnail&&{thumbnail:f.thumbnail},...f.thumbnailBackupUrl&&{thumbnailBackupUrl:f.thumbnailBackupUrl}})),notes:"",createdAt:Date.now(),updatedAt:Date.now()};console.log(`[æ‰¹æ¬¡å‚™ä»½ ${l+1}] å­˜å…¥ D1...`,{id:w.id,type:w.type,member:w.member,mediaCount:w.media.length}),await Q.create(w),U(f=>[w,...f]),s++,console.log(`[æ‰¹æ¬¡å‚™ä»½ ${l+1}] âœ… æˆåŠŸ`),K(f=>f.map((y,G)=>G===l?{...y,status:"success",member:d,type:D}:y))}catch(o){console.error(`[æ‰¹æ¬¡å‚™ä»½ ${l+1}] âŒ å¤±æ•—:`,o),K(p=>p.map((d,i)=>i===l?{...d,status:"error",error:o.message||"æœªçŸ¥éŒ¯èª¤"}:d))}Ve(o=>({...o,current:o.current+1})),await new Promise(o=>setTimeout(o,0))}const h=ne.current;if(Nt(!1),h)b(`å·²å–æ¶ˆï¼ˆå·²å®Œæˆ ${s} ç­†ï¼‰`,"info");else{const l=a.length-s,x=n.length>0?`ï¼Œè·³éŽ ${n.length} ç­†é‡è¤‡`:"";b(`æ‰¹æ¬¡å‚™ä»½å®Œæˆï¼š${s} ç­†æˆåŠŸ${l>0?`ï¼Œ${l} ç­†å¤±æ•—`:""}${x}`)}}return _?e.jsxs("div",{className:"archive-page-loading",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"è¼‰å…¥ä¸­..."})]}):e.jsxs("div",{className:"social-archive archive-page",children:[e.jsxs("header",{className:"archive-header",children:[e.jsx("div",{style:{display:"flex",alignItems:"center",gap:8},children:e.jsx("h1",{children:"ðŸ“± ç¤¾ç¾¤å‚™ä»½"})}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6},children:[e.jsx("button",{className:"add-btn",onClick:()=>me(!0),title:"æ‰¹æ¬¡å‚™ä»½",children:e.jsx(Be,{size:20})}),e.jsx("button",{className:"add-btn",onClick:kt,title:"æ–°å¢žå‚™ä»½",children:e.jsx(Gs,{size:20})}),B&&e.jsx(Ms,{currentPage:I,setCurrentPage:B})]})]}),e.jsxs("div",{className:"archive-filters",children:[e.jsxs("div",{className:"filter-row",children:[e.jsxs("div",{className:"filter-dropdown",children:[e.jsxs("button",{className:`filter-btn dropdown-toggle ${z.length>0?"active":""}`,onClick:()=>{Ge(!Oe),de(!1),ue(!1)},children:[z.length===0?"æˆå“¡":`æˆå“¡(${z.length})`," ",e.jsx("span",{className:"dropdown-arrow",children:Oe?"â–²":"â–¼"})]}),Oe&&e.jsxs("div",{className:"filter-dropdown-list",children:[e.jsx("button",{className:`filter-dropdown-item ${z.length===0?"active":""}`,onClick:()=>Fe([]),children:"å…¨éƒ¨"}),Lt.filter(t=>t.name!=="å…¨å“¡").map(t=>e.jsx("button",{className:`filter-dropdown-item ${z.includes(t.name)?"active":""}`,style:{color:z.includes(t.name)?t.color:void 0},onClick:()=>{z.includes(t.name)?Fe(z.filter(a=>a!==t.name)):Fe([...z,t.name])},children:t.name},t.name))]})]}),e.jsxs("div",{className:"filter-dropdown",children:[e.jsxs("button",{className:`filter-btn dropdown-toggle ${F!=="all"?"active":""}`,onClick:()=>{ue(!Re),Ge(!1),de(!1)},children:[F==="all"?"é¡žåž‹":((Mt=Y.find(t=>t.id===F))==null?void 0:Mt.label)||F," ",e.jsx("span",{className:"dropdown-arrow",children:Re?"â–²":"â–¼"})]}),Re&&e.jsxs("div",{className:"filter-dropdown-list",children:[e.jsx("button",{className:`filter-dropdown-item ${F==="all"?"active":""}`,onClick:()=>{ct("all"),ue(!1)},children:"å…¨éƒ¨"}),Y.map(t=>e.jsxs("button",{className:`filter-dropdown-item ${F===t.id?"active":""}`,onClick:()=>{ct(t.id),ue(!1)},children:[t.icon," ",t.label]},t.id))]})]}),e.jsxs("div",{className:"filter-dropdown",children:[e.jsxs("button",{className:"filter-btn dropdown-toggle",onClick:()=>{de(!Ae),Ge(!1),ue(!1)},children:[E==="all"?"å¹´ä»½":E," ",e.jsx("span",{className:"dropdown-arrow",children:Ae?"â–²":"â–¼"})]}),Ae&&e.jsxs("div",{className:"filter-dropdown-list",children:[e.jsx("button",{className:`filter-dropdown-item ${E==="all"?"active":""}`,onClick:()=>{ot("all"),de(!1)},children:"å…¨éƒ¨"}),cs.map(t=>e.jsx("button",{className:`filter-dropdown-item ${E===t?"active":""}`,onClick:()=>{ot(t),de(!1)},children:t},t))]})]}),e.jsx("button",{className:"year-sort-btn",onClick:()=>Xt(!ee),title:ee?"ç›®å‰ï¼šæ–° â†’ èˆŠ":"ç›®å‰ï¼šèˆŠ â†’ æ–°",children:e.jsx(Rs,{size:12})}),e.jsxs("button",{className:`filter-video-btn ${oe?"active":""}`,onClick:()=>qt(!oe),title:"åªé¡¯ç¤ºå«å½±ç‰‡çš„è²¼æ–‡",children:[e.jsx(Ls,{size:16}),e.jsx("span",{children:"å½±ç‰‡"})]}),N&&e.jsx("button",{className:`filter-broken-btn ${je?"active":""}`,onClick:()=>{Object.keys(A).length===0&&!Le&&rs(),Jt(!je)},title:"æª¢æŸ¥ä¸¦ç¯©é¸å£žåœ–",disabled:Le,children:Le?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"mini-spinner"}),e.jsxs("span",{children:[mt.current,"/",mt.total]})]}):e.jsxs(e.Fragment,{children:[e.jsx(at,{size:16}),e.jsxs("span",{children:["å£žåœ–",Object.keys(A).length>0?` (${Object.keys(A).length})`:""]})]})}),e.jsxs("div",{className:"search-box",children:[e.jsx(Ys,{size:16}),e.jsx("input",{type:"text",placeholder:"æœå°‹å…§å®¹...",value:ve,onChange:t=>Kt(t.target.value)})]}),e.jsxs("div",{className:"view-toggle",children:[e.jsx("button",{className:L==="grid"?"active":"",onClick:()=>dt("grid"),children:e.jsx(Vs,{size:16})}),e.jsx("button",{className:L==="list"?"active":"",onClick:()=>dt("list"),children:e.jsx(_s,{size:16})})]}),N&&e.jsx("button",{className:`select-mode-btn ${J?"active":""}`,onClick:()=>{xt(!J),te([])},title:"å‹¾é¸æ¨¡å¼",children:e.jsx(Et,{size:16})})]}),e.jsxs("div",{className:"filter-stats",children:["å…± ",T.length," ç­†å‚™ä»½",J&&T.length>0&&e.jsx("button",{className:"select-all-btn",onClick:ys,children:X.length===T.length?"å–æ¶ˆå…¨é¸":"å…¨é¸"})]})]}),e.jsx("div",{ref:We,className:"social-content-scroll",children:T.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx(nt,{size:48}),e.jsx("p",{children:"å°šç„¡å‚™ä»½è³‡æ–™"}),e.jsx("button",{onClick:kt,children:"æ–°å¢žç¬¬ä¸€ç­†"})]}):e.jsx("div",{style:{height:Je.getTotalSize(),position:"relative"},children:Je.getVirtualItems().map(t=>{const a=t.index*ge,n=T.slice(a,a+ge);return e.jsx("div",{className:`archive-content ${L}`,style:{position:"absolute",top:0,left:0,right:0,transform:`translateY(${t.start}px)`,...L==="grid"?{gridTemplateColumns:`repeat(${ge}, 1fr)`}:{}},ref:Je.measureElement,"data-index":t.index,children:n.map(s=>{var h,c,r,l,x;return e.jsxs("div",{className:`archive-card ${J&&X.includes(s.id)?"selected":""}`,onClick:()=>J?Bt(s.id):us(s),children:[J&&e.jsx("div",{className:"card-checkbox",onClick:o=>{o.stopPropagation(),Bt(s.id)},children:X.includes(s.id)?e.jsx(Et,{size:20}):e.jsx(Es,{size:20})}),e.jsxs("div",{className:"archive-thumb",children:[(h=s.media)!=null&&h[0]?s.media[0].type==="youtube"?e.jsxs("div",{className:"video-thumb-img",children:[e.jsx("img",{src:s.media[0].thumbnail||st(s.media[0].url),alt:"",loading:"lazy",width:260,height:260}),e.jsx(ie,{size:24,className:"play-overlay"})]}):s.media[0].type==="video"?s.media[0].thumbnail?e.jsxs("div",{className:"video-thumb-img",children:[e.jsx("img",{src:Yt(s.media[0]),alt:"",loading:"lazy",width:260,height:260}),e.jsx(ie,{size:24,className:"play-overlay"})]}):e.jsxs("div",{className:"video-thumb-auto",children:[e.jsx("video",{src:s.media[0].backupUrl||s.media[0].url,muted:!0,preload:"metadata"}),e.jsx(ie,{size:24,className:"play-overlay"})]}):e.jsx("img",{src:Yt(s.media[0]),alt:"",loading:"lazy",width:260,height:260}):e.jsx("div",{className:"no-thumb",children:e.jsx("img",{src:"/bigbang-timeline/bigbang-default.png",alt:"BIGBANG"})}),((c=s.media)==null?void 0:c.length)>1&&e.jsxs("span",{className:"media-count",children:["+",s.media.length-1]}),e.jsx("span",{className:"type-badge",style:{background:(r=Y.find(o=>o.id===s.type))==null?void 0:r.color},children:(l=Y.find(o=>o.id===s.type))==null?void 0:l.icon}),((x=A[s.id])==null?void 0:x.length)>0&&e.jsxs("span",{className:"broken-badge",title:`${A[s.id].length} å¼µåœ–ç‰‡æå£ž`,children:[e.jsx(at,{size:14}),A[s.id].length]}),(Ct.has(s.id)||es===s.id)&&e.jsxs("div",{className:"syncing-overlay",children:[e.jsx(lt,{size:24,className:"spinning"}),e.jsx("span",{children:"åŒæ­¥ä¸­..."})]})]}),e.jsxs("div",{className:"archive-info",children:[e.jsxs("div",{className:"archive-meta",children:[e.jsx("span",{className:"member-tag",style:{background:$e(s.member)+"30",color:$e(s.member)},children:s.member}),e.jsx("span",{className:"date",children:Vt(s.date)})]}),s.caption&&e.jsx("p",{className:"archive-caption",children:s.caption})]})]},s.id)})},t.key)})})}),m&&e.jsxs("div",{className:"modal-overlay view-modal-overlay",onClick:()=>W(null),children:[e.jsxs("div",{className:"post-nav-indicator",onClick:t=>t.stopPropagation(),children:[Xe()+1," / ",T.length]}),e.jsx("button",{className:"post-nav-side prev",onClick:t=>{t.stopPropagation(),ms()},disabled:Xe()<=0,title:"ä¸Šä¸€å‰‡",children:e.jsx(Hs,{size:32})}),e.jsxs("div",{className:"view-modal",onClick:t=>t.stopPropagation(),children:[e.jsx("button",{className:"view-close-btn",onClick:()=>W(null),children:e.jsx(re,{size:24})}),e.jsx("div",{className:"view-media-area",children:((Dt=m.media)==null?void 0:Dt.length)>0?e.jsxs(e.Fragment,{children:[((zt=m.media[O])==null?void 0:zt.type)==="youtube"?e.jsx("iframe",{src:`https://www.youtube.com/embed/${Ds(m.media[O].url)}?autoplay=1`,allow:"autoplay; encrypted-media",allowFullScreen:!0,className:"view-media view-youtube"}):((Pt=m.media[O])==null?void 0:Pt.type)==="video"?e.jsx("video",{src:m.media[O].backupUrl||m.media[O].url,controls:!0,autoPlay:!0,className:"view-media"},`${m.id}-${O}`):e.jsx("img",{src:zs(m.media[O]),alt:"",className:"view-media"},`${m.id}-${O}`),m.media.length>1&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"media-nav prev",onClick:()=>q(t=>(t-1+m.media.length)%m.media.length),children:"â€¹"}),e.jsx("button",{className:"media-nav next",onClick:()=>q(t=>(t+1)%m.media.length),children:"â€º"}),e.jsx("div",{className:"media-dots",children:m.media.map((t,a)=>e.jsx("span",{className:`dot ${a===O?"active":""}`,onClick:()=>q(a)},a))})]})]}):e.jsx("div",{className:"no-media",children:e.jsx("img",{src:"/bigbang-timeline/bigbang-default.png",alt:"BIGBANG",className:"no-media-img"})})}),e.jsxs("div",{className:"view-info-area",children:[e.jsxs("div",{className:"view-header",children:[e.jsx("span",{className:"member-tag",style:{background:$e(m.member)+"30",color:$e(m.member)},children:m.member}),e.jsxs("span",{className:"type-badge",style:{background:(Ft=Y.find(t=>t.id===m.type))==null?void 0:Ft.color},children:[(At=Y.find(t=>t.id===m.type))==null?void 0:At.icon," ",(Ot=Y.find(t=>t.id===m.type))==null?void 0:Ot.label]}),e.jsx("span",{className:"view-date",children:N&&m.time?Ps(m.date,m.time):Vt(m.date)})]}),m.caption&&e.jsx("div",{className:"view-caption",children:e.jsx("p",{children:m.caption})}),m.notes&&e.jsxs("div",{className:"view-notes",children:[e.jsx("strong",{children:"å‚™è¨»ï¼š"}),e.jsx("p",{children:m.notes})]}),e.jsxs("div",{className:"view-actions",children:[m.igUrl&&e.jsxs(e.Fragment,{children:[e.jsxs("a",{href:m.igUrl,target:"_blank",rel:"noopener noreferrer",className:"view-link-btn",children:[e.jsx(Ws,{size:16})," é–‹å•Ÿ IG"]}),N&&e.jsxs("button",{className:"view-sync-btn",onClick:ps,disabled:Ne(m.id),title:"é‡æ–°æŠ“å– IG è³‡æ–™",children:[e.jsx(lt,{size:16,className:Ne(m.id)?"spinning":""}),Ne(m.id)?"åŒæ­¥ä¸­...":"åŒæ­¥"]})]}),e.jsx("button",{className:"view-edit-btn",onClick:fs,children:"âœï¸ ç·¨è¼¯"})]})]})]}),e.jsx("button",{className:"post-nav-side next",onClick:t=>{t.stopPropagation(),hs()},disabled:Xe()>=T.length-1,title:"ä¸‹ä¸€å‰‡",children:e.jsx(qs,{size:32})})]}),Zt&&e.jsx("div",{className:"modal-overlay",onClick:()=>H(!1),children:e.jsxs("div",{className:"archive-modal",onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{children:M?"ç·¨è¼¯å‚™ä»½":"æ–°å¢žå‚™ä»½"}),e.jsx("button",{className:"close-btn",onClick:()=>H(!1),children:e.jsx(re,{size:20})})]}),e.jsxs("div",{className:"modal-body",children:[e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{children:[e.jsx(nt,{size:14})," IG é€£çµ","ï¼ˆè‡ªå‹•æŠ“å–ï¼‰"]}),e.jsxs("div",{className:"ig-url-input",children:[e.jsx("input",{type:"url",placeholder:"è²¼ä¸Š Instagram é€£çµï¼Œè‡ªå‹•æŠ“å–åœ–ç‰‡å’Œæ–‡å­—...",value:v.igUrl,onChange:t=>$(a=>({...a,igUrl:t.target.value})),onBlur:Tt,disabled:Ke}),e.jsx("button",{onClick:Tt,title:"æŠ“å–è³‡æ–™",disabled:Ke,children:Ke?e.jsx("span",{className:"fetching-spinner"}):e.jsx(it,{size:16})}),St&&e.jsx("span",{className:"fetch-progress",children:St})]})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"é¡žåž‹"}),e.jsx("div",{className:"type-selector",children:Y.map(t=>e.jsxs("button",{className:v.type===t.id?"active":"",style:v.type===t.id?{background:t.color}:{},onClick:()=>$(a=>({...a,type:t.id})),children:[t.icon," ",t.label]},t.id))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"æˆå“¡"}),e.jsx("select",{value:v.member,onChange:t=>$(a=>({...a,member:t.target.value})),children:Lt.map(t=>e.jsx("option",{value:t.name,children:t.name},t.name))})]})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{children:[e.jsx(Js,{size:14})," ç™¼æ–‡æ—¥æœŸ"]}),e.jsx("input",{type:"date",value:v.date,onChange:t=>$(a=>({...a,date:t.target.value}))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"æ™‚é–“ï¼ˆé¸å¡«ï¼‰"}),e.jsx("input",{type:"time",value:v.time,onChange:t=>$(a=>({...a,time:t.target.value}))})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{children:[e.jsx(Xs,{size:14})," åœ–ç‰‡/å½±ç‰‡",Ut>0&&e.jsxs("span",{className:"upload-status",children:["ï¼ˆ",Ut," å¼µä¸Šå‚³ä¸­...ï¼‰"]})]}),e.jsxs("div",{className:"media-upload-area",children:[v.media.map((t,a)=>{var s;const n=M&&((s=A[M.id])==null?void 0:s.includes(a));return e.jsxs("div",{className:`media-preview ${t.uploading?"uploading":""} ${t.uploadFailed?"failed":""} ${n?"broken":""}`,children:[t.type==="youtube"?e.jsxs("div",{className:"video-preview-img",children:[e.jsx("img",{src:t.thumbnail||st(t.url),alt:""}),e.jsx(ie,{size:16,className:"play-icon"})]}):t.type==="video"?t.thumbnail?e.jsxs("div",{className:"video-preview-img",children:[e.jsx("img",{src:t.thumbnailBackupUrl||t.thumbnail,alt:""}),e.jsx(ie,{size:16,className:"play-icon"})]}):e.jsxs("div",{className:"video-preview-auto",children:[e.jsx("video",{src:t.backupUrl||t.url,muted:!0,preload:"metadata"}),e.jsx(ie,{size:16,className:"play-icon"})]}):e.jsx("img",{src:t.backupUrl||t.url,alt:""}),t.uploading&&e.jsx("div",{className:"upload-overlay",children:e.jsx("div",{className:"mini-spinner"})}),t.uploadFailed&&e.jsx("div",{className:"upload-failed-badge",title:"ä¸Šå‚³å¤±æ•—ï¼Œå°‡ä½¿ç”¨åŽŸå§‹é€£çµ",children:"âš ï¸"}),n&&e.jsx("div",{className:"broken-image-badge",title:"æ­¤åœ–ç‰‡å·²æå£žï¼Œè«‹é‡æ–°ä¸Šå‚³",children:e.jsx(at,{size:14})}),e.jsx("button",{className:"remove-media",onClick:()=>js(a),children:e.jsx(re,{size:14})})]},a)}),e.jsxs("label",{className:"upload-btn",children:[e.jsx("input",{type:"file",accept:"image/*,video/*",multiple:!0,onChange:bs,disabled:ft}),ft?e.jsx("span",{className:"uploading",children:"ä¸Šå‚³ä¸­..."}):e.jsxs(e.Fragment,{children:[e.jsx(Be,{size:20}),e.jsx("span",{children:"ä¸Šå‚³"})]})]}),e.jsxs("button",{type:"button",className:"manual-url-toggle",onClick:()=>le(!$t),children:[e.jsx(it,{size:16}),e.jsx("span",{children:"è²¼ä¸Šç¶²å€"})]})]}),$t&&e.jsxs("div",{className:"manual-url-input",children:[e.jsx("p",{className:"manual-hint",children:"ðŸ’¡ æç¤ºï¼šæ”¯æ´åœ–ç‰‡ã€å½±ç‰‡ã€YouTube é€£çµï¼Œæ¯è¡Œä¸€å€‹"}),e.jsx("textarea",{placeholder:`è²¼ä¸Šåœ–ç‰‡/å½±ç‰‡/YouTube ç¶²å€ï¼Œæ¯è¡Œä¸€å€‹...
ä¾‹å¦‚ï¼š
https://scontent-xxx.cdninstagram.com/...jpg
https://www.youtube.com/watch?v=xxxxx`,value:Qe,onChange:t=>Ze(t.target.value),rows:4}),e.jsxs("div",{className:"manual-actions",children:[e.jsx("button",{type:"button",className:"cancel-manual",onClick:()=>{le(!1),Ze("")},children:"å–æ¶ˆ"}),e.jsx("button",{type:"button",className:"submit-manual",onClick:gs,children:"æ–°å¢žåª’é«”"})]})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"åŽŸæ–‡å…§å®¹"}),e.jsx("textarea",{placeholder:"è²¼ä¸Š IG åŽŸæ–‡å…§å®¹...",value:v.caption,onChange:t=>$(a=>({...a,caption:t.target.value})),rows:4})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"å‚™è¨»ï¼ˆé¸å¡«ï¼‰"}),e.jsx("textarea",{placeholder:"å…¶ä»–å‚™è¨»...",value:v.notes,onChange:t=>$(a=>({...a,notes:t.target.value})),rows:2})]})]}),e.jsxs("div",{className:"modal-footer",children:[M&&e.jsxs("button",{className:"delete-btn",onClick:()=>{ws(M.id),H(!1)},children:[e.jsx(Ks,{size:16})," åˆªé™¤"]}),e.jsx("button",{className:"cancel-btn",onClick:()=>H(!1),children:"å–æ¶ˆ"}),e.jsxs("button",{className:"save-btn",onClick:vs,disabled:Z,children:[e.jsx(Qs,{size:16})," ",Z?"å„²å­˜ä¸­...":"å„²å­˜"]})]})]})}),ts&&e.jsx("div",{className:"modal-overlay",onClick:()=>!ae&&me(!1),children:e.jsxs("div",{className:"archive-modal batch-create-modal",onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("h2",{children:[e.jsx(Be,{size:20})," æ‰¹æ¬¡å‚™ä»½ IG è²¼æ–‡"]}),!ae&&e.jsx("button",{className:"close-btn",onClick:()=>me(!1),children:e.jsx(re,{size:20})})]}),!ae&&fe.length===0&&e.jsxs("div",{className:"batch-create-input",children:[e.jsx("label",{children:"æ¯è¡Œè²¼ä¸Šä¸€å€‹ IG é€£çµï¼š"}),e.jsxs("div",{className:"script-helper",children:[e.jsxs("button",{className:"script-helper-toggle",onClick:()=>{ss(!_e),Ee(!1)},children:[e.jsx(nt,{size:14}),e.jsx("span",{children:"å¾ž IG å¸³è™Ÿä¸€æ¬¡åŒ¯å…¥æ‰€æœ‰è²¼æ–‡ URL"}),e.jsx(Zs,{size:14,style:{transform:_e?"rotate(180deg)":"none",transition:"transform 0.2s"}})]}),_e&&e.jsxs("div",{className:"script-helper-content",children:[e.jsxs("ol",{className:"script-helper-steps",children:[e.jsx("li",{children:"åœ¨ç€è¦½å™¨é–‹å•Ÿç›®æ¨™ IG å¸³è™Ÿé é¢"}),e.jsxs("li",{children:["æŒ‰ ",e.jsx("kbd",{children:"F12"})," é–‹å•Ÿ DevTools â†’ ",e.jsx("kbd",{children:"Console"})]}),e.jsx("li",{children:"é»žä¸‹æ–¹æŒ‰éˆ•è¤‡è£½è…³æœ¬ï¼Œè²¼åˆ° Console æŒ‰ Enter"}),e.jsx("li",{children:"ç­‰å¾…è‡ªå‹•æ»¾å‹•å®Œæˆï¼ŒURL æœƒè¤‡è£½åˆ°å‰ªè²¼ç°¿"}),e.jsx("li",{children:"å›žåˆ°é€™è£¡ï¼Œç›´æŽ¥ Ctrl+V è²¼ä¸Š"})]}),e.jsx("button",{className:"copy-script-btn",onClick:()=>{navigator.clipboard.writeText(Ss),Ee(!0),setTimeout(()=>Ee(!1),3e3)},children:as?e.jsxs(e.Fragment,{children:[e.jsx(Ht,{size:14})," å·²è¤‡è£½ï¼"]}):e.jsxs(e.Fragment,{children:[e.jsx(it,{size:14})," è¤‡è£½è…³æœ¬"]})})]})]}),e.jsx("textarea",{className:"batch-urls-textarea",value:he,onChange:t=>Ye(t.target.value),placeholder:`https://www.instagram.com/p/ABC123/
https://www.instagram.com/tttopost/p/DEF456/
https://www.instagram.com/reel/GHI789/`,rows:8,autoFocus:!0}),(()=>{const t=tt(he),a=he.split(`
`).filter(s=>s.trim()).length,n=t.filter(s=>{const h=s.split("?")[0].replace(/\/$/,"");return k.some(c=>c.igUrl&&c.igUrl.split("?")[0].replace(/\/$/,"")===h)}).length;return e.jsxs("div",{className:"batch-url-info",children:[e.jsxs("span",{children:[t.length," ç­†æœ‰æ•ˆé€£çµ",a>t.length?`ï¼ˆ${a-t.length} ç­†ç„¡æ•ˆå·²å¿½ç•¥ï¼‰`:""]}),n>0&&e.jsxs("span",{className:"batch-dup-warn",children:["å…¶ä¸­ ",n," ç­†å·²å‚™ä»½éŽï¼Œå°‡è‡ªå‹•è·³éŽ"]})]})})(),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{className:"cancel-btn",onClick:()=>me(!1),children:"å–æ¶ˆ"}),e.jsxs("button",{className:"save-btn",onClick:$s,disabled:tt(he).length===0,children:[e.jsx(Be,{size:16})," é–‹å§‹å‚™ä»½"]})]})]}),(ae||fe.length>0)&&e.jsxs("div",{className:"batch-create-progress",children:[e.jsx("div",{className:"batch-progress-bar-container",children:e.jsx("div",{className:"batch-progress-bar-fill",style:{width:`${pe.total>0?pe.current/pe.total*100:0}%`}})}),e.jsx("div",{className:"batch-progress-text",children:ae?`è™•ç†ä¸­ ${pe.current}/${pe.total}`:`å®Œæˆ ${fe.filter(t=>t.status==="success").length}/${fe.length}`}),e.jsx("div",{className:"batch-results-list",children:fe.map((t,a)=>e.jsxs("div",{className:`batch-result-item batch-result-${t.status}`,children:[e.jsxs("span",{className:"batch-result-icon",children:[t.status==="success"&&"âœ“",t.status==="error"&&"âœ—",t.status==="processing"&&"â³",t.status==="pending"&&"Â·"]}),e.jsx("span",{className:"batch-result-url",children:t.url.replace(/https?:\/\/(www\.)?instagram\.com\//,"")}),t.status==="success"&&e.jsxs("span",{className:"batch-result-meta",children:[t.member," Â· ",t.type]}),t.status==="error"&&e.jsx("span",{className:"batch-result-error",children:t.error})]},a))}),e.jsx("div",{className:"modal-footer",children:ae?e.jsxs("button",{className:"cancel-btn",onClick:Us,children:[e.jsx(re,{size:16})," å–æ¶ˆ"]}):e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"cancel-btn",onClick:()=>{me(!1),K([]),Ye("")},children:"é—œé–‰"}),e.jsx("button",{className:"save-btn",onClick:()=>{K([]),Ye("")},children:"ç¹¼çºŒæ–°å¢ž"})]})})]})]})}),J&&X.length>0&&e.jsxs("div",{className:"batch-action-bar",children:[e.jsxs("span",{className:"batch-count",children:["å·²é¸å– ",X.length," ç­†"]}),e.jsxs("div",{className:"batch-actions",children:[!bt&&e.jsx("button",{className:"batch-cancel-btn",onClick:()=>te([]),children:"å–æ¶ˆé¸å–"}),bt?e.jsxs("button",{className:"batch-stop-btn",onClick:ks,children:[e.jsx(re,{size:16}),"å–æ¶ˆåŒæ­¥ (",vt.current,"/",vt.total,")"]}):e.jsxs("button",{className:"batch-sync-btn",onClick:Cs,children:[e.jsx(lt,{size:16}),"åŒæ­¥æŠ“å–"]})]})]}),ce&&e.jsxs("div",{className:`toast ${ce.type}`,children:[ce.type==="error"?e.jsx(ea,{size:16}):e.jsx(Ht,{size:16}),ce.msg]}),P&&e.jsx("div",{className:"confirm-modal-overlay",onClick:P.onCancel,children:e.jsxs("div",{className:`confirm-modal confirm-modal-${P.type}`,onClick:t=>t.stopPropagation(),children:[e.jsx("h3",{className:"confirm-modal-title",children:P.title}),e.jsx("div",{className:"confirm-modal-body",children:P.content}),e.jsxs("div",{className:"confirm-modal-actions",children:[e.jsx("button",{className:"confirm-modal-cancel",onClick:P.onCancel,children:P.cancelText}),e.jsx("button",{className:`confirm-modal-confirm confirm-modal-confirm-${P.type}`,onClick:P.onConfirm,children:P.confirmText})]})]})})]})}const oa=u.memo(aa);export{oa as default};
