import{s as K,j as e,N as Ms,M as Bs,g as et,a as Rt,b as $e,f as Lt,c as Ds,d as zs,e as Ps,h as Fs,u as As,i as Os,k as Yt,l as Gs,m as Te,n as Ie}from"./index-BucoZdXQ.js";import{a as u,U as Me,d as Rs,A as Ls,F as Ys,o as tt,p as Vs,G as _s,q as Es,s as Vt,t as st,u as Hs,f as le,R as at,C as Ws,X as ie,E as qs,b as Js,v as nt,e as Xs,I as Ks,T as Qs,S as Zs,w as ea,i as _t,j as ta}from"./icons-51PM2evP.js";import{u as sa}from"./ArchiveBase-BAZiaiJN.js";import"./vendor-DhQqL_yF.js";const L=[{id:"post",label:"è²¼æ–‡",icon:"ðŸ“·",color:"#E1306C"},{id:"story",label:"Story",icon:"â­•",color:"#833AB4"},{id:"reels",label:"Reels",icon:"ðŸŽ¬",color:"#F77737"}],Et={"G-Dragon":{main:"xxxibgdrgn"},"T.O.P":{main:"ttt",extra:[{username:"tttopost",type:"post",dateFormat:"auto"},{username:"top.ttt.story",type:"story",dateFormat:"auto",isPrefix:!0}]},å¤ªé™½:{main:"__youngbae__"},å¤§è²:{main:"d_lable_official"},å‹åˆ©:{main:""},å…¨å“¡:{main:"bigbangofficial"}};function Be(N){if(!N)return"å…¨å“¡";const S=N.toLowerCase();for(const[I,M]of Object.entries(Et)){if(M.main&&S===M.main.toLowerCase())return I;if(M.extra)for(const k of M.extra){const U=k.username.toLowerCase();if(k.isPrefix?S.startsWith(U):S===U)return I}}return"å…¨å“¡"}function De(N){if(!N)return null;const S=N.toLowerCase();for(const I of Object.values(Et))if(I.extra)for(const M of I.extra){const k=M.username.toLowerCase();if(M.isPrefix?S.startsWith(k):S===k)return M}return null}function Y(N,S){if(!N||!S)return null;function I(k){const U=k.match(/(\d{4})-(\d{1,2})-(\d{1,2})/);if(U){const V=U[1],G=U[2].padStart(2,"0"),Q=U[3].padStart(2,"0");return`${V}-${G}-${Q}`}return null}function M(k){const U=k.match(/\b(\d{6})\b/);if(U){const V=U[1],G=parseInt(V.substring(0,2),10),Q=V.substring(2,4),xe=V.substring(4,6);return`${G>=50?1900+G:2e3+G}-${Q}-${xe}`}return null}return S==="auto"?I(N)||M(N):S==="iso"?I(N):S==="6digits"?M(N):null}function aa(N){if(!N)return null;const S=N.match(/instagram\.com\/stories\/([^\/]+)\//);if(S)return S[1];const I=N.match(/instagram\.com\/([^\/]+)\/(?:p|reel|reels|tv)\//);return I&&!["p","reel","reels","tv","stories","explore"].includes(I[1])?I[1]:null}function ze(N,S){return N||aa(S)||null}async function Pe(N){try{const S=`${Gs.IG_SCRAPER_URL}/scrape?url=${encodeURIComponent(N)}`;return await(await fetch(S)).json()}catch(S){return console.error("IG æŠ“å–å¤±æ•—:",S),{success:!1,error:S.message}}}function na({isAdmin:N,onBack:S,currentPage:I,setCurrentPage:M}){var Mt,Bt,Dt,zt,Pt,Ft,At;const[k,U]=u.useState([]),[V,G]=u.useState(!0),[Q,xe]=u.useState(!1),[re,lt]=u.useState(null),[be,Ht]=u.useState([]),[P,it]=u.useState("all"),[ce,Wt]=u.useState(!1),[je,qt]=u.useState(!1),[_,rt]=u.useState("all"),[Z,Jt]=u.useState(!0),[Fe,oe]=u.useState(!1),[ct,Ae]=u.useState(!1),[Oe,de]=u.useState(!1),[ve,Xt]=u.useState(""),[R,ot]=u.useState("grid"),[F,Kt]=u.useState({}),[Ge,dt]=u.useState(!1),[ut,mt]=u.useState({current:0,total:0}),[Qt,E]=u.useState(!1),[B,ht]=u.useState(null),[v,$]=u.useState({type:"post",member:"å…¨å“¡",date:new Date().toISOString().split("T")[0],time:"",igUrl:"",caption:"",media:[],notes:""}),[pt,ft]=u.useState(!1),[m,H]=u.useState(null),[A,W]=u.useState(0),[q,gt]=u.useState(!1),[J,ee]=u.useState([]),[xt,bt]=u.useState(!1),[jt,vt]=u.useState({current:0,total:0}),[Zt,yt]=u.useState(null),te=u.useRef(!1),[es,ue]=u.useState(!1),[me,Re]=u.useState(""),[se,wt]=u.useState(!1),[he,Le]=u.useState({current:0,total:0}),[pe,X]=u.useState([]),ae=u.useRef(!1),[Ye,ts]=u.useState(!1),[ss,Ve]=u.useState(!1),[z,_e]=u.useState(null),Ee=u.useRef(null),[fe,He]=u.useState(()=>window.innerWidth<500?2:Math.max(2,Math.floor(Math.min(900,window.innerWidth)/280)));u.useEffect(()=>{as()},[]);async function as(){G(!0);try{const t=await K.load();U(t)}catch(t){console.error("è¼‰å…¥å¤±æ•—",t),b("è¼‰å…¥å¤±æ•—","error")}finally{G(!1)}}function b(t,a="success"){lt({msg:t,type:a}),setTimeout(()=>lt(null),2500)}function ye({title:t,content:a,type:n="warning",confirmText:s="ç¢ºå®š",cancelText:h="å–æ¶ˆ"}){return new Promise(c=>{_e({title:t,content:a,type:n,confirmText:s,cancelText:h,onConfirm:()=>{_e(null),c(!0)},onCancel:()=>{_e(null),c(!1)}})})}function ns(t){var a;return(a=t.media)==null?void 0:a.some(n=>n.type==="video"||n.type==="youtube")}function ls(t){var a;return((a=F[t.id])==null?void 0:a.length)>0}async function ge(t){if(!t)return!1;try{const a=new AbortController,n=setTimeout(()=>a.abort(),1e4),s=await fetch(t,{method:"HEAD",mode:"cors",signal:a.signal});return clearTimeout(n),s.ok?!0:(console.log(`âŒ åœ–ç‰‡æª¢æŸ¥å¤±æ•— (HTTP ${s.status}): ${t}`),!1)}catch{return new Promise(n=>{const s=new window.Image,h=setTimeout(()=>{s.src="",n(!1)},1e4);s.onload=()=>{clearTimeout(h),s.naturalWidth===0||s.naturalHeight===0?n(!1):n(!0)},s.onerror=()=>{clearTimeout(h),n(!1)},s.src=t})}}async function is(){var s;dt(!0),mt({current:0,total:k.length});const t={};let a=0;for(const h of k){const c=[];if(((s=h.media)==null?void 0:s.length)>0)for(let r=0;r<h.media.length;r++){const l=h.media[r],x=l.type==="video"?l.thumbnail:l.url;x&&(await ge(x)||c.push(r))}c.length>0&&(t[h.id]=c),a++,mt({current:a,total:k.length})}Kt(t),dt(!1);const n=Object.keys(t).length;n>0?b(`æª¢æŸ¥å®Œæˆï¼š${n} ç­†æœ‰å£žåœ–`,"error"):b("æª¢æŸ¥å®Œæˆï¼šæ²’æœ‰ç™¼ç¾å£žåœ– âœ…")}const rs=u.useMemo(()=>{const t=new Set;k.forEach(n=>{if(n.date){const s=n.date.substring(0,4);s&&t.add(s)}});const a=Array.from(t).sort((n,s)=>s-n);return Z?a:a.reverse()},[k,Z]),T=u.useMemo(()=>k.filter(t=>{var a;return!(be.length>0&&!be.includes(t.member)||P!=="all"&&t.type!==P||ce&&!ns(t)||je&&!ls(t)||_!=="all"&&t.date&&!t.date.startsWith(_)||ve&&!((a=t.caption)!=null&&a.toLowerCase().includes(ve.toLowerCase())))}).sort((t,a)=>{const n=new Date(t.date),s=new Date(a.date);return Z?s-n:n-s}),[k,be,P,ce,je,_,ve,Z,F]);u.useEffect(()=>{const t=Ee.current;if(!t)return;const a=()=>{if(R!=="grid"){He(1);return}const s=Math.min(t.clientWidth,window.innerWidth);if(s<500){He(2);return}He(Math.max(2,Math.floor(s/280)))};a();const n=new ResizeObserver(a);return n.observe(t),()=>n.disconnect()},[R]);const cs=u.useMemo(()=>Math.ceil(T.length/fe),[T.length,fe]),We=sa({count:cs,getScrollElement:()=>Ee.current,estimateSize:()=>R==="grid"?340:120,overscan:3,gap:R==="grid"?16:10});function Nt(){ht(null),$({type:"post",member:"å…¨å“¡",date:new Date().toISOString().split("T")[0],time:"",igUrl:"",caption:"",media:[],notes:""}),E(!0)}function os(t){ht(t),$({type:t.type,member:t.member,date:t.date,time:t.time||"",igUrl:t.igUrl||"",caption:t.caption||"",media:t.media||[],notes:t.notes||""}),E(!0)}function ds(t){H(t),W(0)}function us(){const t=T.findIndex(a=>a.id===(m==null?void 0:m.id));t>0&&(H(T[t-1]),W(0))}function ms(){const t=T.findIndex(a=>a.id===(m==null?void 0:m.id));t<T.length-1&&(H(T[t+1]),W(0))}function qe(){return T.findIndex(t=>t.id===(m==null?void 0:m.id))}const[kt,we]=u.useState(new Set);function Ne(t){return kt.has(t)}async function hs(){var n,s,h,c,r;if(!(m!=null&&m.igUrl)){b("æ­¤è²¼æ–‡æ²’æœ‰ IG é€£çµ","error");return}if(Ne(m.id)){b("æ­¤è²¼æ–‡æ­£åœ¨åŒæ­¥ä¸­...","info");return}const t={...m},a=m.id;we(l=>new Set(l).add(a));try{const l=await Pe(t.igUrl);if(!l.success||!((n=l.media)!=null&&n.length)){if(!await ye({title:"âš ï¸ æŠ“å–å¤±æ•—",type:"warning",confirmText:"æ¸…ç©ºåª’é«”",cancelText:"å–æ¶ˆ",content:e.jsxs("div",{className:"confirm-content",children:[e.jsx("p",{children:"å¯èƒ½åŽŸå› ï¼š"}),e.jsxs("ul",{children:[e.jsx("li",{children:"IG è²¼æ–‡å·²è¢«åˆªé™¤"}),e.jsx("li",{children:"IG API æš«æ™‚ç„¡æ³•å­˜å–"}),e.jsx("li",{children:"ç¶²è·¯é€£ç·šå•é¡Œ"})]}),e.jsx("p",{className:"confirm-warning",children:"æ˜¯å¦ä»è¦æ¸…ç©ºæ­¤è²¼æ–‡çš„åª’é«”è³‡æ–™ï¼Ÿ"})]})})){we(f=>{const w=new Set(f);return w.delete(a),w});return}}else{const y=((s=t.media)==null?void 0:s.length)||0,f=((h=l.media)==null?void 0:h.length)||0,w=(t.caption||"").trim(),O=(l.caption||"").trim(),Ue=y!==f,Ot=w!==O&&O!=="";if(Ue||Ot){const $s=w.substring(0,80)+(w.length>80?"...":""),Ts=O.substring(0,80)+(O.length>80?"...":"");if(!await ye({title:"ðŸ“ è³‡æ–™è®Šæ›´ç¢ºèª",type:"info",confirmText:"è¦†è“‹",cancelText:"å–æ¶ˆ",content:e.jsxs("div",{className:"confirm-content",children:[e.jsx("p",{children:"æŠ“å–åˆ°çš„è³‡æ–™èˆ‡ç¾æœ‰è³‡æ–™ä¸åŒï¼š"}),Ue&&e.jsxs("div",{className:"diff-item",children:[e.jsx("span",{className:"diff-label",children:"ðŸ“· åª’é«”æ•¸é‡"}),e.jsxs("div",{className:"diff-values",children:[e.jsxs("span",{className:"diff-old",children:[y," å¼µ"]}),e.jsx("span",{className:"diff-arrow",children:"â†’"}),e.jsxs("span",{className:"diff-new",children:[f," å¼µ"]})]})]}),Ot&&e.jsxs("div",{className:"diff-item",children:[e.jsx("span",{className:"diff-label",children:"ðŸ“ å…§å®¹"}),e.jsxs("div",{className:"diff-text",children:[e.jsx("div",{className:"diff-old",children:$s||"(ç©º)"}),e.jsx("div",{className:"diff-new",children:Ts})]})]}),e.jsx("p",{className:"confirm-question",children:"ç¢ºå®šè¦è¦†è“‹å—Žï¼Ÿ"})]})})){we(Is=>{const Gt=new Set(Is);return Gt.delete(a),Gt}),b("å·²å–æ¶ˆåŒæ­¥");return}}}b("åŒæ­¥ä¸­ï¼Œæª¢æŸ¥ä¸¦ä¸Šå‚³åœ–ç‰‡...","info");const x=((c=l.media)==null?void 0:c.length)>0?await Qe(l.media,t.media||[],t.member):[],o=(t.media||[]).filter(y=>y.type==="youtube"),p=[...x,...o],d=ze((r=l.owner)==null?void 0:r.username,t.igUrl),i=Be(d),g=De(d);let j=t.date,C=t.time||"";if(g!=null&&g.dateFormat&&l.caption){const y=Y(l.caption,g.dateFormat);y&&(j=y)}else if(l.date){const y=new Date(l.date),f=new Date(y.getTime()+480*60*1e3);j=`${f.getUTCFullYear()}-${String(f.getUTCMonth()+1).padStart(2,"0")}-${String(f.getUTCDate()).padStart(2,"0")}`,C=`${String(f.getUTCHours()).padStart(2,"0")}:${String(f.getUTCMinutes()).padStart(2,"0")}`}if(!g&&i==="å…¨å“¡"&&l.caption){const y=Y(l.caption,"auto");y&&(j=y,C="")}const D={...t,media:p,caption:l.caption||t.caption,type:(g==null?void 0:g.type)||t.type,date:j,time:C,updatedAt:Date.now()};U(y=>{const f=y.map(w=>w.id===a?D:w);return K.update(D).catch(w=>console.warn("D1 å„²å­˜å¤±æ•—:",w)),f}),H(y=>(y==null?void 0:y.id)===a?D:y),W(0),x.length>0?b(`âœ… åŒæ­¥å®Œæˆï¼š${x.length} å€‹åª’é«”`):b("å·²æ¸…ç©ºåª’é«”è³‡æ–™","info")}catch(l){console.error("åŒæ­¥å¤±æ•—:",l),b("âŒ åŒæ­¥å¤±æ•—ï¼š"+l.message,"error")}finally{we(l=>{const x=new Set(l);return x.delete(a),x})}}function ps(){m&&(os(m),H(null))}const[Je,ke]=u.useState(!1),[Ct,Ce]=u.useState(""),[St,Se]=u.useState(0),[Ut,ne]=u.useState(!1),[Xe,Ke]=u.useState("");async function $t(){var t,a;if(v.igUrl){ke(!0),Ce("æŠ“å–ä¸­...");try{const n=await Pe(v.igUrl);if(n.success&&((t=n.media)==null?void 0:t.length)>0){const s=ze((a=n.owner)==null?void 0:a.username,v.igUrl),h=Be(s),c=De(s);let r=v.date,l="";if(c!=null&&c.dateFormat&&n.caption){const i=Y(n.caption,c.dateFormat);i&&(r=i)}else if(n.date){const i=new Date(n.date),g=new Date(i.getTime()+480*60*1e3);r=`${g.getUTCFullYear()}-${String(g.getUTCMonth()+1).padStart(2,"0")}-${String(g.getUTCDate()).padStart(2,"0")}`,l=`${String(g.getUTCHours()).padStart(2,"0")}:${String(g.getUTCMinutes()).padStart(2,"0")}`}if(!c&&h==="å…¨å“¡"&&n.caption){const i=Y(n.caption,"auto");i&&(r=i,l="")}const x=n.media||[],o=x.map((i,g)=>({url:i.url||i.thumbnail,type:i.type,thumbnail:i.thumbnail||null,uploading:i.type==="image",thumbnailUploading:i.type==="video"&&i.thumbnail,originalUrl:i.url,originalThumbnail:i.thumbnail,index:g}));$(i=>({...i,type:(c==null?void 0:c.type)||n.type||i.type,member:h,date:r,time:l||i.time,caption:n.caption||i.caption,media:o})),ke(!1),Ce(""),ne(!1),b(`âœ… å·²æŠ“å– ${x.length} å€‹åª’é«”ï¼ŒèƒŒæ™¯ä¸Šå‚³ä¸­...`);const p=o.filter(i=>i.type==="image"),d=o.filter(i=>i.type==="video"&&i.thumbnail);Se(p.length+d.length);for(const i of p)Tt(i.originalUrl,i.index,h);for(const i of d)gs(i.originalThumbnail,i.index,h)}else{const s=v.igUrl.match(/instagram\.com\/p\//),h=v.igUrl.match(/instagram\.com\/(?:reel|reels)\//);let c="post";h&&(c="reels"),$(r=>({...r,type:c})),ne(!0),b("âš ï¸ è‡ªå‹•æŠ“å–å¤±æ•—ï¼Œè«‹æ‰‹å‹•è¼¸å…¥åª’é«”ç¶²å€","info"),ke(!1),Ce("")}}catch(n){console.error("è§£æžå¤±æ•—",n),ne(!0),b("âš ï¸ æŠ“å–å¤±æ•—ï¼Œè«‹æ‰‹å‹•è¼¸å…¥åª’é«”ç¶²å€","error"),ke(!1),Ce("")}}}async function fs(){if(!Xe.trim())return;const t=Xe.split(`
`).map(s=>s.trim()).filter(s=>s&&(s.startsWith("http")||s.startsWith("//")));if(t.length===0){b("è«‹è¼¸å…¥æœ‰æ•ˆçš„ç¶²å€","error");return}const a=t.map((s,h)=>{if(Os(s))return{url:s,type:"youtube",thumbnail:et(s),index:v.media.length+h};const c=/\.(mp4|mov|webm|m4v)/i.test(s)||s.includes("video");return{url:s,type:c?"video":"image",uploading:!c,originalUrl:s,index:v.media.length+h}});$(s=>({...s,media:[...s.media,...a]}));const n=a.filter(s=>s.type==="image");Se(s=>s+n.length);for(const s of n)Tt(s.originalUrl,s.index,v.member);Ke(""),ne(!1),b(`å·²æ–°å¢ž ${t.length} å€‹åª’é«”`)}async function Tt(t,a,n){try{const s={context:"social",member:n},[h,c]=await Promise.all([Te(t,s),Ie(t,s).catch(r=>(console.warn("ImgBB å‚™ä»½å¤±æ•—:",r.message),null))]);$(r=>({...r,media:r.media.map((l,x)=>x===a?{...l,url:h,backupUrl:c,uploading:!1}:l)}))}catch(s){console.warn(`åœ–ç‰‡ ${a+1} ä¸Šå‚³å¤±æ•—`,s),$(h=>({...h,media:h.media.map((c,r)=>r===a?{...c,uploading:!1,uploadFailed:!0}:c)}))}finally{Se(s=>s-1)}}async function gs(t,a,n){try{const s={context:"social",member:n},[h,c]=await Promise.all([Te(t,s),Ie(t,s).catch(r=>(console.warn("ImgBB å‚™ä»½å¤±æ•—:",r.message),null))]);$(r=>({...r,media:r.media.map((l,x)=>x===a?{...l,thumbnail:h,thumbnailBackupUrl:c,thumbnailUploading:!1}:l)})),c&&console.log(`âœ… å½±ç‰‡ ${a+1} ç¸®åœ–é›™é‡å‚™ä»½å®Œæˆ`)}catch(s){console.warn(`å½±ç‰‡ ${a+1} ç¸®åœ–ä¸Šå‚³å¤±æ•—`,s),$(h=>({...h,media:h.media.map((c,r)=>r===a?{...c,thumbnailUploading:!1,thumbnailFailed:!0}:c)}))}finally{Se(s=>s-1)}}async function xs(t){const a=Array.from(t.target.files);if(a.length){ft(!0);try{const n=[];for(const s of a)if(s.type.startsWith("video/")){const c=URL.createObjectURL(s);n.push({url:c,type:"video",localFile:s})}else{const{url:c,backupUrl:r}=await As(s,{context:"social",member:v.member});n.push({url:c,type:"image",...r&&{backupUrl:r}})}$(s=>({...s,media:[...s.media,...n]})),b(`å·²æ–°å¢ž ${n.length} å€‹æª”æ¡ˆ`)}catch(n){console.error("ä¸Šå‚³å¤±æ•—",n),b("ä¸Šå‚³å¤±æ•—","error")}finally{ft(!1)}}}function bs(t){$(a=>({...a,media:a.media.filter((n,s)=>s!==t)}))}async function js(){if(!v.date||!v.member){b("è«‹å¡«å¯«å¿…è¦æ¬„ä½","error");return}if(v.media.some(n=>n.uploading)&&!await ye({title:"âš ï¸ ä¸Šå‚³æœªå®Œæˆ",type:"warning",confirmText:"ä»è¦å„²å­˜",cancelText:"ç­‰å¾…ä¸Šå‚³",content:e.jsxs("div",{className:"confirm-content",children:[e.jsx("p",{children:"é‚„æœ‰åœ–ç‰‡æ­£åœ¨ä¸Šå‚³ä¸­ï¼Œç¢ºå®šè¦ç¾åœ¨å„²å­˜å—Žï¼Ÿ"}),e.jsx("p",{className:"confirm-warning",children:"æœªå®Œæˆä¸Šå‚³çš„åœ–ç‰‡å¯èƒ½ç„¡æ³•æ­£å¸¸é¡¯ç¤º"})]})}))return;const a={id:(B==null?void 0:B.id)||Yt("s"),type:v.type,member:v.member,date:v.date,time:v.time,igUrl:v.igUrl,caption:v.caption,media:v.media.map(n=>({url:n.url,type:n.type,...n.backupUrl&&{backupUrl:n.backupUrl},...n.thumbnail&&{thumbnail:n.thumbnail},...n.thumbnailBackupUrl&&{thumbnailBackupUrl:n.thumbnailBackupUrl}})),notes:v.notes,createdAt:(B==null?void 0:B.createdAt)||Date.now(),updatedAt:Date.now()};xe(!0);try{B?(await K.update(a),U(k.map(n=>n.id===B.id?a:n))):(await K.create(a),U([a,...k])),b("å·²å„²å­˜"),E(!1)}catch(n){console.error("å„²å­˜å¤±æ•—",n),b("å„²å­˜å¤±æ•—","error")}finally{xe(!1)}}async function vs(t){if(await ye({title:"ðŸ—‘ï¸ åˆªé™¤ç¢ºèª",type:"danger",confirmText:"åˆªé™¤",cancelText:"å–æ¶ˆ",content:e.jsxs("div",{className:"confirm-content",children:[e.jsx("p",{children:"ç¢ºå®šè¦åˆªé™¤é€™ç­†å‚™ä»½å—Žï¼Ÿ"}),e.jsx("p",{className:"confirm-warning",children:"æ­¤æ“ä½œç„¡æ³•å¾©åŽŸ"})]})}))try{await K.delete(t),U(k.filter(n=>n.id!==t)),b("å·²åˆªé™¤")}catch(n){console.error("åˆªé™¤å¤±æ•—",n),b("åˆªé™¤å¤±æ•—","error")}}function It(t){ee(a=>a.includes(t)?a.filter(n=>n!==t):[...a,t])}function ys(){J.length===T.length?ee([]):ee(T.map(t=>t.id))}async function Qe(t,a=[],n){var c,r,l,x;const s=[],h=[];for(let o=0;o<t.length;o++){const p=t[o],d=a[o];if(p.type==="image"){if((d==null?void 0:d.type)==="image"){if((c=d==null?void 0:d.url)!=null&&c.includes("cloudinary")&&await ge(d.url)){console.log(`âœ… åœ–ç‰‡ ${o+1} Cloudinary å‚™ä»½å¯ç”¨ï¼Œè·³éŽä¸Šå‚³`),s.push({...d});continue}if((r=d==null?void 0:d.backupUrl)!=null&&r.includes("i.ibb.co")&&await ge(d.backupUrl)){console.log(`âœ… åœ–ç‰‡ ${o+1} ImgBB å‚™ä»½å¯ç”¨ï¼Œåˆ‡æ›ä½¿ç”¨`),s.push({url:d.backupUrl,type:"image",backupUrl:d.backupUrl});continue}console.log(`âš ï¸ åœ–ç‰‡ ${o+1} æ‰€æœ‰å‚™ä»½éƒ½å¤±æ•ˆï¼Œé‡æ–°ä¸Šå‚³`)}try{console.log(`ðŸ“¤ ä¸Šå‚³åœ–ç‰‡ ${o+1}...`);const i={context:"social",member:n},j={url:await Te(p.url,i),type:"image"};s.push(j);const C=s.length-1;h.push(Ie(p.url,i).then(D=>{D&&(s[C].backupUrl=D)}).catch(D=>console.warn("ImgBB èƒŒæ™¯ä¸Šå‚³å¤±æ•—:",D)))}catch(i){console.warn("åœ–ç‰‡ä¸Šå‚³å¤±æ•—:",i),s.push({url:p.url,type:"image"})}}else if(p.type==="video"){const i={url:p.url,type:"video"};if(p.thumbnail){if((d==null?void 0:d.type)==="video"){if((l=d==null?void 0:d.thumbnail)!=null&&l.includes("cloudinary")&&await ge(d.thumbnail)){console.log(`âœ… å½±ç‰‡ ${o+1} ç¸®åœ– Cloudinary å‚™ä»½å¯ç”¨ï¼Œè·³éŽä¸Šå‚³`),i.thumbnail=d.thumbnail,d.thumbnailBackupUrl&&(i.thumbnailBackupUrl=d.thumbnailBackupUrl),s.push(i);continue}if((x=d==null?void 0:d.thumbnailBackupUrl)!=null&&x.includes("i.ibb.co")&&await ge(d.thumbnailBackupUrl)){console.log(`âœ… å½±ç‰‡ ${o+1} ç¸®åœ– ImgBB å‚™ä»½å¯ç”¨ï¼Œåˆ‡æ›ä½¿ç”¨`),i.thumbnail=d.thumbnailBackupUrl,i.thumbnailBackupUrl=d.thumbnailBackupUrl,s.push(i);continue}console.log(`âš ï¸ å½±ç‰‡ ${o+1} ç¸®åœ–æ‰€æœ‰å‚™ä»½éƒ½å¤±æ•ˆï¼Œé‡æ–°ä¸Šå‚³`)}try{console.log(`ðŸ“¤ ä¸Šå‚³å½±ç‰‡ ${o+1} ç¸®åœ–...`);const g={context:"social",member:n},j=await Te(p.thumbnail,g);i.thumbnail=j,h.push(Ie(p.thumbnail,g).then(C=>{C&&(i.thumbnailBackupUrl=C)}).catch(C=>console.warn("ImgBB ç¸®åœ–èƒŒæ™¯ä¸Šå‚³å¤±æ•—:",C)))}catch(g){console.warn("ç¸®åœ–ä¸Šå‚³å¤±æ•—:",g),i.thumbnail=p.thumbnail}}s.push(i)}}return h.length>0&&Promise.all(h).then(()=>{console.log("âœ… ImgBB èƒŒæ™¯ä¸Šå‚³å®Œæˆ")}),s}function ws(t,a){return t.map((s,h)=>{const c=a[h];return s.type==="video"&&(c==null?void 0:c.type)==="video"?{...s,url:c.url}:(s.type==="image",s)})}function Ns(){te.current=!0,b("æ­£åœ¨å–æ¶ˆåŒæ­¥...","info")}async function ks(){var h,c;const t=k.filter(r=>J.includes(r.id)&&r.igUrl);if(t.length===0){b("æ²’æœ‰å¯åŒæ­¥çš„é …ç›®ï¼ˆéœ€æœ‰ IG é€£çµï¼‰","error");return}const a=ce;te.current=!1,bt(!0),vt({current:0,total:t.length});let n=0;for(const r of t){if(te.current)break;yt(r.id),await new Promise(l=>setTimeout(l,0));try{const l=await Pe(r.igUrl);if(te.current)break;if(l.success&&((h=l.media)==null?void 0:h.length)>0){const x=ze((c=l.owner)==null?void 0:c.username,r.igUrl),o=Be(x),p=De(x);let d=r.date,i=r.time||"";if(p!=null&&p.dateFormat&&l.caption){const j=Y(l.caption,p.dateFormat);j&&(d=j)}else if(l.date){const j=new Date(l.date),C=new Date(j.getTime()+480*60*1e3);d=`${C.getUTCFullYear()}-${String(C.getUTCMonth()+1).padStart(2,"0")}-${String(C.getUTCDate()).padStart(2,"0")}`,i=`${String(C.getUTCHours()).padStart(2,"0")}:${String(C.getUTCMinutes()).padStart(2,"0")}`}if(!p&&o==="å…¨å“¡"&&l.caption){const j=Y(l.caption,"auto");j&&(d=j,i="")}let g;if(a){const j=ws(r.media,l.media);g={...r,media:j,type:(p==null?void 0:p.type)||r.type,date:d,time:i,updatedAt:Date.now()},console.log(`âœ… ${r.id} å½±ç‰‡ URL å·²æ›´æ–°ï¼ˆä¿ç•™ thumbnailï¼‰`)}else{const j=await Qe(l.media,r.media||[],r.member);if(te.current)break;const C=(r.media||[]).filter(y=>y.type==="youtube"),D=[...j,...C];g={...r,media:D,caption:l.caption||r.caption,type:(p==null?void 0:p.type)||r.type,date:d,time:i,updatedAt:Date.now()}}U(j=>j.map(C=>C.id===r.id?g:C)),K.update(g).catch(j=>console.warn("D1 å„²å­˜å¤±æ•—:",j)),n++,await new Promise(j=>setTimeout(j,0))}}catch(l){console.warn(`åŒæ­¥ ${r.id} å¤±æ•—:`,l)}vt(l=>({...l,current:l.current+1})),await new Promise(l=>setTimeout(l,0))}const s=te.current;yt(null),bt(!1),gt(!1),ee([]),s?b(`å·²å–æ¶ˆåŒæ­¥ï¼ˆå·²å®Œæˆ ${n} ç­†ï¼‰`,"info"):b(a?`å½±ç‰‡åŒæ­¥å®Œæˆï¼š${n}/${t.length} ç­†æˆåŠŸ`:`åŒæ­¥å®Œæˆï¼š${n}/${t.length} ç­†æˆåŠŸ`)}const Cs=`(async()=>{const d=ms=>new Promise(r=>setTimeout(r,ms));const urls=new Set();let last=0,retries=0;console.log('é–‹å§‹æ”¶é›†è²¼æ–‡ URL...');while(retries<5){document.querySelectorAll('a[href*="/p/"],a[href*="/reel/"],a[href*="/reels/"]').forEach(a=>{const h=a.href.split('?')[0];if(/\\/(p|reel|reels)\\//.test(h))urls.add(h)});console.log('å·²æ‰¾åˆ° '+urls.size+' ç­†');if(urls.size===last)retries++;else{retries=0;last=urls.size}window.scrollTo(0,document.body.scrollHeight);await d(1500)}const r=[...urls].join('\\n');console.log('\\nå®Œæˆï¼å…± '+urls.size+' ç­†ï¼š\\n'+r);try{await navigator.clipboard.writeText(r);console.log('\\nâœ… å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿')}catch{console.log('\\nâš ï¸ è«‹æ‰‹å‹•è¤‡è£½ä¸Šæ–¹æ–‡å­—')}})();`;function Ze(t){const a=new Set;return t.split(`
`).map(n=>n.trim()).filter(n=>n&&/instagram\.com\/(?:[^\/]+\/)?(p|reel|reels|tv)\//.test(n)).filter(n=>{const s=n.split("?")[0].replace(/\/$/,"");return a.has(s)?!1:(a.add(s),!0)})}function Ss(){ae.current=!0,b("æ­£åœ¨å–æ¶ˆæ‰¹æ¬¡å‚™ä»½...","info")}async function Us(){var c,r;const t=Ze(me);if(t.length===0){b("æ²’æœ‰æœ‰æ•ˆçš„ IG é€£çµ","error");return}new Set(k.map(l=>l.igUrl).filter(Boolean));const a=[],n=[];for(const l of t){const x=l.split("?")[0].replace(/\/$/,"");k.some(p=>p.igUrl?p.igUrl.split("?")[0].replace(/\/$/,"")===x:!1)?n.push(l):a.push(l)}if(a.length===0){b(`å…¨éƒ¨ ${n.length} ç­†éƒ½æ˜¯é‡è¤‡çš„`,"error");return}ae.current=!1,wt(!0),Le({current:0,total:a.length}),X(a.map(l=>({url:l,status:"pending"})));let s=0;for(let l=0;l<a.length&&!ae.current;l++){const x=a[l];X(o=>o.map((p,d)=>d===l?{...p,status:"processing"}:p)),await new Promise(o=>setTimeout(o,0));try{console.log(`[æ‰¹æ¬¡å‚™ä»½ ${l+1}] é–‹å§‹æŠ“å–: ${x}`);const o=await Pe(x);if(console.log(`[æ‰¹æ¬¡å‚™ä»½ ${l+1}] fetchIGData å›žå‚³:`,JSON.stringify(o,null,2)),ae.current)break;if(!o.success||!((c=o.media)!=null&&c.length)){const f=o.error||o.message||(o.success?"ç„¡åª’é«”":"æŠ“å–å¤±æ•—");console.warn(`[æ‰¹æ¬¡å‚™ä»½ ${l+1}] è·³éŽ: ${f}`),X(w=>w.map((O,Ue)=>Ue===l?{...O,status:"error",error:f}:O)),Le(w=>({...w,current:w.current+1}));continue}const p=ze((r=o.owner)==null?void 0:r.username,x),d=Be(p),i=De(p);console.log(`[æ‰¹æ¬¡å‚™ä»½ ${l+1}] æˆå“¡: ${d}, username: ${p}, media: ${o.media.length} ç­†`);let g=new Date().toISOString().split("T")[0],j="";if(i!=null&&i.dateFormat&&o.caption){const f=Y(o.caption,i.dateFormat);f&&(g=f)}else if(o.date){const f=new Date(o.date),w=new Date(f.getTime()+480*60*1e3);g=`${w.getUTCFullYear()}-${String(w.getUTCMonth()+1).padStart(2,"0")}-${String(w.getUTCDate()).padStart(2,"0")}`,j=`${String(w.getUTCHours()).padStart(2,"0")}:${String(w.getUTCMinutes()).padStart(2,"0")}`}if(!i&&d==="å…¨å“¡"&&o.caption){const f=Y(o.caption,"auto");f&&(g=f,j="")}console.log(`[æ‰¹æ¬¡å‚™ä»½ ${l+1}] æ—¥æœŸ: ${g} ${j}`),console.log(`[æ‰¹æ¬¡å‚™ä»½ ${l+1}] é–‹å§‹ä¸Šå‚³åª’é«”...`);const C=await Qe(o.media,[],d);if(console.log(`[æ‰¹æ¬¡å‚™ä»½ ${l+1}] ä¸Šå‚³å®Œæˆ:`,C.map(f=>{var w;return{url:(w=f.url)==null?void 0:w.substring(0,50),type:f.type}})),ae.current)break;const D=(i==null?void 0:i.type)||o.type||"post",y={id:Yt("s"),type:D,member:d,date:g,time:j,igUrl:x,caption:o.caption||"",media:C.map(f=>({url:f.url,type:f.type,...f.backupUrl&&{backupUrl:f.backupUrl},...f.thumbnail&&{thumbnail:f.thumbnail},...f.thumbnailBackupUrl&&{thumbnailBackupUrl:f.thumbnailBackupUrl}})),notes:"",createdAt:Date.now(),updatedAt:Date.now()};console.log(`[æ‰¹æ¬¡å‚™ä»½ ${l+1}] å­˜å…¥ D1...`,{id:y.id,type:y.type,member:y.member,mediaCount:y.media.length}),await K.create(y),U(f=>[y,...f]),s++,console.log(`[æ‰¹æ¬¡å‚™ä»½ ${l+1}] âœ… æˆåŠŸ`),X(f=>f.map((w,O)=>O===l?{...w,status:"success",member:d,type:D}:w))}catch(o){console.error(`[æ‰¹æ¬¡å‚™ä»½ ${l+1}] âŒ å¤±æ•—:`,o),X(p=>p.map((d,i)=>i===l?{...d,status:"error",error:o.message||"æœªçŸ¥éŒ¯èª¤"}:d))}Le(o=>({...o,current:o.current+1})),await new Promise(o=>setTimeout(o,0))}const h=ae.current;if(wt(!1),h)b(`å·²å–æ¶ˆï¼ˆå·²å®Œæˆ ${s} ç­†ï¼‰`,"info");else{const l=a.length-s,x=n.length>0?`ï¼Œè·³éŽ ${n.length} ç­†é‡è¤‡`:"";b(`æ‰¹æ¬¡å‚™ä»½å®Œæˆï¼š${s} ç­†æˆåŠŸ${l>0?`ï¼Œ${l} ç­†å¤±æ•—`:""}${x}`)}}return V?e.jsxs("div",{className:"archive-page-loading",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"è¼‰å…¥ä¸­..."})]}):e.jsxs("div",{className:"social-archive archive-page",children:[e.jsxs("header",{className:"archive-header",children:[e.jsx("div",{style:{display:"flex",alignItems:"center",gap:8},children:e.jsx("h1",{children:"ðŸ“± ç¤¾ç¾¤å‚™ä»½"})}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6},children:[N&&e.jsx("button",{className:"add-btn",onClick:()=>ue(!0),title:"æ‰¹æ¬¡å‚™ä»½",children:e.jsx(Me,{size:20})}),e.jsx("button",{className:"add-btn",onClick:Nt,title:"æ–°å¢žå‚™ä»½",children:e.jsx(Rs,{size:20})}),M&&e.jsx(Ms,{currentPage:I,setCurrentPage:M})]})]}),e.jsxs("div",{className:"archive-filters",children:[e.jsxs("div",{className:"filter-row",children:[e.jsx(Bs,{selectedMembers:be,onChange:Ht,isOpen:ct,onToggle:()=>{Ae(!ct),oe(!1),de(!1)}}),e.jsxs("div",{className:"filter-dropdown",children:[e.jsxs("button",{className:`filter-btn dropdown-toggle ${P!=="all"?"active":""}`,onClick:()=>{de(!Oe),Ae(!1),oe(!1)},children:[P==="all"?"é¡žåž‹":((Mt=L.find(t=>t.id===P))==null?void 0:Mt.label)||P," ",e.jsx("span",{className:"dropdown-arrow",children:Oe?"â–²":"â–¼"})]}),Oe&&e.jsxs("div",{className:"filter-dropdown-list",children:[e.jsx("button",{className:`filter-dropdown-item ${P==="all"?"active":""}`,onClick:()=>{it("all"),de(!1)},children:"å…¨éƒ¨"}),L.map(t=>e.jsxs("button",{className:`filter-dropdown-item ${P===t.id?"active":""}`,onClick:()=>{it(t.id),de(!1)},children:[t.icon," ",t.label]},t.id))]})]}),e.jsxs("div",{className:"filter-dropdown",children:[e.jsxs("button",{className:"filter-btn dropdown-toggle",onClick:()=>{oe(!Fe),Ae(!1),de(!1)},children:[_==="all"?"å¹´ä»½":_," ",e.jsx("span",{className:"dropdown-arrow",children:Fe?"â–²":"â–¼"})]}),Fe&&e.jsxs("div",{className:"filter-dropdown-list",children:[e.jsx("button",{className:`filter-dropdown-item ${_==="all"?"active":""}`,onClick:()=>{rt("all"),oe(!1)},children:"å…¨éƒ¨"}),rs.map(t=>e.jsx("button",{className:`filter-dropdown-item ${_===t?"active":""}`,onClick:()=>{rt(t),oe(!1)},children:t},t))]})]}),e.jsx("button",{className:"year-sort-btn",onClick:()=>Jt(!Z),title:Z?"ç›®å‰ï¼šæ–° â†’ èˆŠ":"ç›®å‰ï¼šèˆŠ â†’ æ–°",children:e.jsx(Ls,{size:12})}),e.jsxs("button",{className:`filter-video-btn ${ce?"active":""}`,onClick:()=>Wt(!ce),title:"åªé¡¯ç¤ºå«å½±ç‰‡çš„è²¼æ–‡",children:[e.jsx(Ys,{size:16}),e.jsx("span",{children:"å½±ç‰‡"})]}),N&&e.jsx("button",{className:`filter-broken-btn ${je?"active":""}`,onClick:()=>{Object.keys(F).length===0&&!Ge&&is(),qt(!je)},title:"æª¢æŸ¥ä¸¦ç¯©é¸å£žåœ–",disabled:Ge,children:Ge?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"mini-spinner"}),e.jsxs("span",{children:[ut.current,"/",ut.total]})]}):e.jsxs(e.Fragment,{children:[e.jsx(tt,{size:16}),e.jsxs("span",{children:["å£žåœ–",Object.keys(F).length>0?` (${Object.keys(F).length})`:""]})]})}),e.jsxs("div",{className:"search-box",children:[e.jsx(Vs,{size:16}),e.jsx("input",{type:"text",placeholder:"æœå°‹å…§å®¹...",value:ve,onChange:t=>Xt(t.target.value)})]}),e.jsxs("div",{className:"view-toggle",children:[e.jsx("button",{className:R==="grid"?"active":"",onClick:()=>ot("grid"),children:e.jsx(_s,{size:16})}),e.jsx("button",{className:R==="list"?"active":"",onClick:()=>ot("list"),children:e.jsx(Es,{size:16})})]}),N&&e.jsx("button",{className:`select-mode-btn ${q?"active":""}`,onClick:()=>{gt(!q),ee([])},title:"å‹¾é¸æ¨¡å¼",children:e.jsx(Vt,{size:16})})]}),e.jsxs("div",{className:"filter-stats",children:["å…± ",T.length," ç­†å‚™ä»½",q&&T.length>0&&e.jsx("button",{className:"select-all-btn",onClick:ys,children:J.length===T.length?"å–æ¶ˆå…¨é¸":"å…¨é¸"})]})]}),e.jsx("div",{ref:Ee,className:"social-content-scroll",children:T.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx(st,{size:48}),e.jsx("p",{children:"å°šç„¡å‚™ä»½è³‡æ–™"}),e.jsx("button",{onClick:Nt,children:"æ–°å¢žç¬¬ä¸€ç­†"})]}):e.jsx("div",{style:{height:We.getTotalSize(),position:"relative"},children:We.getVirtualItems().map(t=>{const a=t.index*fe,n=T.slice(a,a+fe);return e.jsx("div",{className:`archive-content ${R}`,style:{position:"absolute",top:0,left:0,right:0,transform:`translateY(${t.start}px)`,...R==="grid"?{gridTemplateColumns:`repeat(${fe}, 1fr)`}:{}},ref:We.measureElement,"data-index":t.index,children:n.map(s=>{var h,c,r,l,x;return e.jsxs("div",{className:`archive-card ${q&&J.includes(s.id)?"selected":""}`,onClick:()=>q?It(s.id):ds(s),children:[q&&e.jsx("div",{className:"card-checkbox",onClick:o=>{o.stopPropagation(),It(s.id)},children:J.includes(s.id)?e.jsx(Vt,{size:20}):e.jsx(Hs,{size:20})}),e.jsxs("div",{className:"archive-thumb",children:[(h=s.media)!=null&&h[0]?s.media[0].type==="youtube"?e.jsxs("div",{className:"video-thumb-img",children:[e.jsx("img",{src:s.media[0].thumbnail||et(s.media[0].url),alt:"",loading:"lazy",width:260,height:260}),e.jsx(le,{size:24,className:"play-overlay"})]}):s.media[0].type==="video"?s.media[0].thumbnail?e.jsxs("div",{className:"video-thumb-img",children:[e.jsx("img",{src:Rt(s.media[0]),alt:"",loading:"lazy",width:260,height:260}),e.jsx(le,{size:24,className:"play-overlay"})]}):e.jsxs("div",{className:"video-thumb-auto",children:[e.jsx("video",{src:s.media[0].backupUrl||s.media[0].url,muted:!0,preload:"metadata"}),e.jsx(le,{size:24,className:"play-overlay"})]}):e.jsx("img",{src:Rt(s.media[0]),alt:"",loading:"lazy",width:260,height:260}):e.jsx("div",{className:"no-thumb",children:e.jsx("img",{src:"/bigbang-timeline/bigbang-default.png",alt:"BIGBANG"})}),((c=s.media)==null?void 0:c.length)>1&&e.jsxs("span",{className:"media-count",children:["+",s.media.length-1]}),e.jsx("span",{className:"type-badge",style:{background:(r=L.find(o=>o.id===s.type))==null?void 0:r.color},children:(l=L.find(o=>o.id===s.type))==null?void 0:l.icon}),((x=F[s.id])==null?void 0:x.length)>0&&e.jsxs("span",{className:"broken-badge",title:`${F[s.id].length} å¼µåœ–ç‰‡æå£ž`,children:[e.jsx(tt,{size:14}),F[s.id].length]}),(kt.has(s.id)||Zt===s.id)&&e.jsxs("div",{className:"syncing-overlay",children:[e.jsx(at,{size:24,className:"spinning"}),e.jsx("span",{children:"åŒæ­¥ä¸­..."})]})]}),e.jsxs("div",{className:"archive-info",children:[e.jsxs("div",{className:"archive-meta",children:[e.jsx("span",{className:"member-tag",style:{background:$e(s.member)+"30",color:$e(s.member)},children:s.member}),e.jsx("span",{className:"date",children:Lt(s.date)})]}),s.caption&&e.jsx("p",{className:"archive-caption",children:s.caption})]})]},s.id)})},t.key)})})}),m&&e.jsxs("div",{className:"modal-overlay view-modal-overlay",onClick:()=>H(null),children:[e.jsxs("div",{className:"post-nav-indicator",onClick:t=>t.stopPropagation(),children:[qe()+1," / ",T.length]}),e.jsx("button",{className:"post-nav-side prev",onClick:t=>{t.stopPropagation(),us()},disabled:qe()<=0,title:"ä¸Šä¸€å‰‡",children:e.jsx(Ws,{size:32})}),e.jsxs("div",{className:"view-modal",onClick:t=>t.stopPropagation(),children:[e.jsx("button",{className:"view-close-btn",onClick:()=>H(null),children:e.jsx(ie,{size:24})}),e.jsx("div",{className:"view-media-area",children:((Bt=m.media)==null?void 0:Bt.length)>0?e.jsxs(e.Fragment,{children:[((Dt=m.media[A])==null?void 0:Dt.type)==="youtube"?e.jsx("iframe",{src:`https://www.youtube.com/embed/${Ds(m.media[A].url)}?autoplay=1`,allow:"autoplay; encrypted-media",allowFullScreen:!0,className:"view-media view-youtube"}):((zt=m.media[A])==null?void 0:zt.type)==="video"?e.jsx("video",{src:m.media[A].backupUrl||m.media[A].url,controls:!0,autoPlay:!0,className:"view-media"},`${m.id}-${A}`):e.jsx("img",{src:zs(m.media[A]),alt:"",className:"view-media"},`${m.id}-${A}`),m.media.length>1&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"media-nav prev",onClick:()=>W(t=>(t-1+m.media.length)%m.media.length),children:"â€¹"}),e.jsx("button",{className:"media-nav next",onClick:()=>W(t=>(t+1)%m.media.length),children:"â€º"}),e.jsx("div",{className:"media-dots",children:m.media.map((t,a)=>e.jsx("span",{className:`dot ${a===A?"active":""}`,onClick:()=>W(a)},a))})]})]}):e.jsx("div",{className:"no-media",children:e.jsx("img",{src:"/bigbang-timeline/bigbang-default.png",alt:"BIGBANG",className:"no-media-img"})})}),e.jsxs("div",{className:"view-info-area",children:[e.jsxs("div",{className:"view-header",children:[e.jsx("span",{className:"member-tag",style:{background:$e(m.member)+"30",color:$e(m.member)},children:m.member}),e.jsxs("span",{className:"type-badge",style:{background:(Pt=L.find(t=>t.id===m.type))==null?void 0:Pt.color},children:[(Ft=L.find(t=>t.id===m.type))==null?void 0:Ft.icon," ",(At=L.find(t=>t.id===m.type))==null?void 0:At.label]}),e.jsx("span",{className:"view-date",children:N&&m.time?Ps(m.date,m.time):Lt(m.date)})]}),m.caption&&e.jsx("div",{className:"view-caption",children:e.jsx("p",{children:m.caption})}),m.notes&&e.jsxs("div",{className:"view-notes",children:[e.jsx("strong",{children:"å‚™è¨»ï¼š"}),e.jsx("p",{children:m.notes})]}),e.jsxs("div",{className:"view-actions",children:[m.igUrl&&e.jsxs(e.Fragment,{children:[e.jsxs("a",{href:m.igUrl,target:"_blank",rel:"noopener noreferrer",className:"view-link-btn",children:[e.jsx(qs,{size:16})," é–‹å•Ÿ IG"]}),N&&e.jsxs("button",{className:"view-sync-btn",onClick:hs,disabled:Ne(m.id),title:"é‡æ–°æŠ“å– IG è³‡æ–™",children:[e.jsx(at,{size:16,className:Ne(m.id)?"spinning":""}),Ne(m.id)?"åŒæ­¥ä¸­...":"åŒæ­¥"]})]}),e.jsx("button",{className:"view-edit-btn",onClick:ps,children:"âœï¸ ç·¨è¼¯"})]})]})]}),e.jsx("button",{className:"post-nav-side next",onClick:t=>{t.stopPropagation(),ms()},disabled:qe()>=T.length-1,title:"ä¸‹ä¸€å‰‡",children:e.jsx(Js,{size:32})})]}),Qt&&e.jsx("div",{className:"modal-overlay",onClick:()=>E(!1),children:e.jsxs("div",{className:"archive-modal",onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{children:B?"ç·¨è¼¯å‚™ä»½":"æ–°å¢žå‚™ä»½"}),e.jsx("button",{className:"close-btn",onClick:()=>E(!1),children:e.jsx(ie,{size:20})})]}),e.jsxs("div",{className:"modal-body",children:[e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{children:[e.jsx(st,{size:14})," IG é€£çµ","ï¼ˆè‡ªå‹•æŠ“å–ï¼‰"]}),e.jsxs("div",{className:"ig-url-input",children:[e.jsx("input",{type:"url",placeholder:"è²¼ä¸Š Instagram é€£çµï¼Œè‡ªå‹•æŠ“å–åœ–ç‰‡å’Œæ–‡å­—...",value:v.igUrl,onChange:t=>$(a=>({...a,igUrl:t.target.value})),onBlur:$t,disabled:Je}),e.jsx("button",{onClick:$t,title:"æŠ“å–è³‡æ–™",disabled:Je,children:Je?e.jsx("span",{className:"fetching-spinner"}):e.jsx(nt,{size:16})}),Ct&&e.jsx("span",{className:"fetch-progress",children:Ct})]})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"é¡žåž‹"}),e.jsx("div",{className:"type-selector",children:L.map(t=>e.jsxs("button",{className:v.type===t.id?"active":"",style:v.type===t.id?{background:t.color}:{},onClick:()=>$(a=>({...a,type:t.id})),children:[t.icon," ",t.label]},t.id))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"æˆå“¡"}),e.jsx("select",{value:v.member,onChange:t=>$(a=>({...a,member:t.target.value})),children:Fs.map(t=>e.jsx("option",{value:t.name,children:t.name},t.name))})]})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{children:[e.jsx(Xs,{size:14})," ç™¼æ–‡æ—¥æœŸ"]}),e.jsx("input",{type:"date",value:v.date,onChange:t=>$(a=>({...a,date:t.target.value}))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"æ™‚é–“ï¼ˆé¸å¡«ï¼‰"}),e.jsx("input",{type:"time",value:v.time,onChange:t=>$(a=>({...a,time:t.target.value}))})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{children:[e.jsx(Ks,{size:14})," åœ–ç‰‡/å½±ç‰‡",St>0&&e.jsxs("span",{className:"upload-status",children:["ï¼ˆ",St," å¼µä¸Šå‚³ä¸­...ï¼‰"]})]}),e.jsxs("div",{className:"media-upload-area",children:[v.media.map((t,a)=>{var s;const n=B&&((s=F[B.id])==null?void 0:s.includes(a));return e.jsxs("div",{className:`media-preview ${t.uploading?"uploading":""} ${t.uploadFailed?"failed":""} ${n?"broken":""}`,children:[t.type==="youtube"?e.jsxs("div",{className:"video-preview-img",children:[e.jsx("img",{src:t.thumbnail||et(t.url),alt:""}),e.jsx(le,{size:16,className:"play-icon"})]}):t.type==="video"?t.thumbnail?e.jsxs("div",{className:"video-preview-img",children:[e.jsx("img",{src:t.thumbnailBackupUrl||t.thumbnail,alt:""}),e.jsx(le,{size:16,className:"play-icon"})]}):e.jsxs("div",{className:"video-preview-auto",children:[e.jsx("video",{src:t.backupUrl||t.url,muted:!0,preload:"metadata"}),e.jsx(le,{size:16,className:"play-icon"})]}):e.jsx("img",{src:t.backupUrl||t.url,alt:""}),t.uploading&&e.jsx("div",{className:"upload-overlay",children:e.jsx("div",{className:"mini-spinner"})}),t.uploadFailed&&e.jsx("div",{className:"upload-failed-badge",title:"ä¸Šå‚³å¤±æ•—ï¼Œå°‡ä½¿ç”¨åŽŸå§‹é€£çµ",children:"âš ï¸"}),n&&e.jsx("div",{className:"broken-image-badge",title:"æ­¤åœ–ç‰‡å·²æå£žï¼Œè«‹é‡æ–°ä¸Šå‚³",children:e.jsx(tt,{size:14})}),e.jsx("button",{className:"remove-media",onClick:()=>bs(a),children:e.jsx(ie,{size:14})})]},a)}),e.jsxs("label",{className:"upload-btn",children:[e.jsx("input",{type:"file",accept:"image/*,video/*",multiple:!0,onChange:xs,disabled:pt}),pt?e.jsx("span",{className:"uploading",children:"ä¸Šå‚³ä¸­..."}):e.jsxs(e.Fragment,{children:[e.jsx(Me,{size:20}),e.jsx("span",{children:"ä¸Šå‚³"})]})]}),e.jsxs("button",{type:"button",className:"manual-url-toggle",onClick:()=>ne(!Ut),children:[e.jsx(nt,{size:16}),e.jsx("span",{children:"è²¼ä¸Šç¶²å€"})]})]}),Ut&&e.jsxs("div",{className:"manual-url-input",children:[e.jsx("p",{className:"manual-hint",children:"ðŸ’¡ æç¤ºï¼šæ”¯æ´åœ–ç‰‡ã€å½±ç‰‡ã€YouTube é€£çµï¼Œæ¯è¡Œä¸€å€‹"}),e.jsx("textarea",{placeholder:`è²¼ä¸Šåœ–ç‰‡/å½±ç‰‡/YouTube ç¶²å€ï¼Œæ¯è¡Œä¸€å€‹...
ä¾‹å¦‚ï¼š
https://scontent-xxx.cdninstagram.com/...jpg
https://www.youtube.com/watch?v=xxxxx`,value:Xe,onChange:t=>Ke(t.target.value),rows:4}),e.jsxs("div",{className:"manual-actions",children:[e.jsx("button",{type:"button",className:"cancel-manual",onClick:()=>{ne(!1),Ke("")},children:"å–æ¶ˆ"}),e.jsx("button",{type:"button",className:"submit-manual",onClick:fs,children:"æ–°å¢žåª’é«”"})]})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"åŽŸæ–‡å…§å®¹"}),e.jsx("textarea",{placeholder:"è²¼ä¸Š IG åŽŸæ–‡å…§å®¹...",value:v.caption,onChange:t=>$(a=>({...a,caption:t.target.value})),rows:4})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"å‚™è¨»ï¼ˆé¸å¡«ï¼‰"}),e.jsx("textarea",{placeholder:"å…¶ä»–å‚™è¨»...",value:v.notes,onChange:t=>$(a=>({...a,notes:t.target.value})),rows:2})]})]}),e.jsxs("div",{className:"modal-footer",children:[B&&e.jsxs("button",{className:"delete-btn",onClick:()=>{vs(B.id),E(!1)},children:[e.jsx(Qs,{size:16})," åˆªé™¤"]}),e.jsx("button",{className:"cancel-btn",onClick:()=>E(!1),children:"å–æ¶ˆ"}),e.jsxs("button",{className:"save-btn",onClick:js,disabled:Q,children:[e.jsx(Zs,{size:16})," ",Q?"å„²å­˜ä¸­...":"å„²å­˜"]})]})]})}),es&&e.jsx("div",{className:"modal-overlay",onClick:()=>!se&&ue(!1),children:e.jsxs("div",{className:"archive-modal batch-create-modal",onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("h2",{children:[e.jsx(Me,{size:20})," æ‰¹æ¬¡å‚™ä»½ IG è²¼æ–‡"]}),!se&&e.jsx("button",{className:"close-btn",onClick:()=>ue(!1),children:e.jsx(ie,{size:20})})]}),!se&&pe.length===0&&e.jsxs("div",{className:"batch-create-input",children:[e.jsx("label",{children:"æ¯è¡Œè²¼ä¸Šä¸€å€‹ IG é€£çµï¼š"}),e.jsxs("div",{className:"script-helper",children:[e.jsxs("button",{className:"script-helper-toggle",onClick:()=>{ts(!Ye),Ve(!1)},children:[e.jsx(st,{size:14}),e.jsx("span",{children:"å¾ž IG å¸³è™Ÿä¸€æ¬¡åŒ¯å…¥æ‰€æœ‰è²¼æ–‡ URL"}),e.jsx(ea,{size:14,style:{transform:Ye?"rotate(180deg)":"none",transition:"transform 0.2s"}})]}),Ye&&e.jsxs("div",{className:"script-helper-content",children:[e.jsxs("ol",{className:"script-helper-steps",children:[e.jsx("li",{children:"åœ¨ç€è¦½å™¨é–‹å•Ÿç›®æ¨™ IG å¸³è™Ÿé é¢"}),e.jsxs("li",{children:["æŒ‰ ",e.jsx("kbd",{children:"F12"})," é–‹å•Ÿ DevTools â†’ ",e.jsx("kbd",{children:"Console"})]}),e.jsx("li",{children:"é»žä¸‹æ–¹æŒ‰éˆ•è¤‡è£½è…³æœ¬ï¼Œè²¼åˆ° Console æŒ‰ Enter"}),e.jsx("li",{children:"ç­‰å¾…è‡ªå‹•æ»¾å‹•å®Œæˆï¼ŒURL æœƒè¤‡è£½åˆ°å‰ªè²¼ç°¿"}),e.jsx("li",{children:"å›žåˆ°é€™è£¡ï¼Œç›´æŽ¥ Ctrl+V è²¼ä¸Š"})]}),e.jsx("button",{className:"copy-script-btn",onClick:()=>{navigator.clipboard.writeText(Cs),Ve(!0),setTimeout(()=>Ve(!1),3e3)},children:ss?e.jsxs(e.Fragment,{children:[e.jsx(_t,{size:14})," å·²è¤‡è£½ï¼"]}):e.jsxs(e.Fragment,{children:[e.jsx(nt,{size:14})," è¤‡è£½è…³æœ¬"]})})]})]}),e.jsx("textarea",{className:"batch-urls-textarea",value:me,onChange:t=>Re(t.target.value),placeholder:`https://www.instagram.com/p/ABC123/
https://www.instagram.com/tttopost/p/DEF456/
https://www.instagram.com/reel/GHI789/`,rows:8,autoFocus:!0}),(()=>{const t=Ze(me),a=me.split(`
`).filter(s=>s.trim()).length,n=t.filter(s=>{const h=s.split("?")[0].replace(/\/$/,"");return k.some(c=>c.igUrl&&c.igUrl.split("?")[0].replace(/\/$/,"")===h)}).length;return e.jsxs("div",{className:"batch-url-info",children:[e.jsxs("span",{children:[t.length," ç­†æœ‰æ•ˆé€£çµ",a>t.length?`ï¼ˆ${a-t.length} ç­†ç„¡æ•ˆå·²å¿½ç•¥ï¼‰`:""]}),n>0&&e.jsxs("span",{className:"batch-dup-warn",children:["å…¶ä¸­ ",n," ç­†å·²å‚™ä»½éŽï¼Œå°‡è‡ªå‹•è·³éŽ"]})]})})(),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{className:"cancel-btn",onClick:()=>ue(!1),children:"å–æ¶ˆ"}),e.jsxs("button",{className:"save-btn",onClick:Us,disabled:Ze(me).length===0,children:[e.jsx(Me,{size:16})," é–‹å§‹å‚™ä»½"]})]})]}),(se||pe.length>0)&&e.jsxs("div",{className:"batch-create-progress",children:[e.jsx("div",{className:"batch-progress-bar-container",children:e.jsx("div",{className:"batch-progress-bar-fill",style:{width:`${he.total>0?he.current/he.total*100:0}%`}})}),e.jsx("div",{className:"batch-progress-text",children:se?`è™•ç†ä¸­ ${he.current}/${he.total}`:`å®Œæˆ ${pe.filter(t=>t.status==="success").length}/${pe.length}`}),e.jsx("div",{className:"batch-results-list",children:pe.map((t,a)=>e.jsxs("div",{className:`batch-result-item batch-result-${t.status}`,children:[e.jsxs("span",{className:"batch-result-icon",children:[t.status==="success"&&"âœ“",t.status==="error"&&"âœ—",t.status==="processing"&&"â³",t.status==="pending"&&"Â·"]}),e.jsx("span",{className:"batch-result-url",children:t.url.replace(/https?:\/\/(www\.)?instagram\.com\//,"")}),t.status==="success"&&e.jsxs("span",{className:"batch-result-meta",children:[t.member," Â· ",t.type]}),t.status==="error"&&e.jsx("span",{className:"batch-result-error",children:t.error})]},a))}),e.jsx("div",{className:"modal-footer",children:se?e.jsxs("button",{className:"cancel-btn",onClick:Ss,children:[e.jsx(ie,{size:16})," å–æ¶ˆ"]}):e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"cancel-btn",onClick:()=>{ue(!1),X([]),Re("")},children:"é—œé–‰"}),e.jsx("button",{className:"save-btn",onClick:()=>{X([]),Re("")},children:"ç¹¼çºŒæ–°å¢ž"})]})})]})]})}),q&&J.length>0&&e.jsxs("div",{className:"batch-action-bar",children:[e.jsxs("span",{className:"batch-count",children:["å·²é¸å– ",J.length," ç­†"]}),e.jsxs("div",{className:"batch-actions",children:[!xt&&e.jsx("button",{className:"batch-cancel-btn",onClick:()=>ee([]),children:"å–æ¶ˆé¸å–"}),xt?e.jsxs("button",{className:"batch-stop-btn",onClick:Ns,children:[e.jsx(ie,{size:16}),"å–æ¶ˆåŒæ­¥ (",jt.current,"/",jt.total,")"]}):e.jsxs("button",{className:"batch-sync-btn",onClick:ks,children:[e.jsx(at,{size:16}),"åŒæ­¥æŠ“å–"]})]})]}),re&&e.jsxs("div",{className:`toast ${re.type}`,children:[re.type==="error"?e.jsx(ta,{size:16}):e.jsx(_t,{size:16}),re.msg]}),z&&e.jsx("div",{className:"confirm-modal-overlay",onClick:z.onCancel,children:e.jsxs("div",{className:`confirm-modal confirm-modal-${z.type}`,onClick:t=>t.stopPropagation(),children:[e.jsx("h3",{className:"confirm-modal-title",children:z.title}),e.jsx("div",{className:"confirm-modal-body",children:z.content}),e.jsxs("div",{className:"confirm-modal-actions",children:[e.jsx("button",{className:"confirm-modal-cancel",onClick:z.onCancel,children:z.cancelText}),e.jsx("button",{className:`confirm-modal-confirm confirm-modal-confirm-${z.type}`,onClick:z.onConfirm,children:z.confirmText})]})]})})]})}const da=u.memo(na);export{da as default};
