import{m as _,n as Ns,j as e,N as ys,o as Ge,g as ne,a as ws,b as le,f as ks,c as Cs,d as Ss,e as Us,_ as Is,u as xe,l as be,i as Re,h as $s}from"./index-C0-c8-6Z.js";import{a as r,D as je,d as Ts,p as Ms,G as Ps,q as zs,w as We,f as re,C as Ds,X as oe,E as As,b as Es,e as Bs,v as qe,I as Fs,U as _s,T as Ls,S as Os,j as Vs,i as Ys}from"./icons-DlS2GzSP.js";import{u as Gs}from"./ArchiveBase-CCIq2_BE.js";import"./vendor-C2p7Ne83.js";function Rs({src:P,className:ve}){const Z=r.useRef(null);return r.useEffect(()=>{const z=Z.current;if(!z||!P)return;if(z.canPlayType("application/vnd.apple.mpegurl")){z.src=P;return}let C=null;return Is(async()=>{const{default:S}=await import("./hls-jw_vZdHi.js");return{default:S}},[]).then(({default:S})=>{if(!S.isSupported()){z.src=P;return}C=new S,C.loadSource(P),C.attachMedia(z)}).catch(()=>{z.src=P}),()=>{C&&C.destroy()}},[P]),e.jsx("video",{ref:Z,controls:!0,playsInline:!0,className:ve})}const G={gdragon:{label:"G-Dragon (gdragon.ai)",domain:"gdragon.ai",mediaPrefix:"gd",authorIds:"67a5e27bc8affa6b2c4b893b%2C677e145d5dba936413e31764",defaultMember:"G-Dragon",authorMap:{"67a5e27bc8affa6b2c4b893b":"G-Dragon","677e145d5dba936413e31764":"G-Dragon"}},daesung:{label:"Daesung (daesung.bstage.in)",domain:"daesung.bstage.in",mediaPrefix:"daesung",authorIds:"64cb4a2654046402f5bde521",defaultMember:"å¤§è²",authorMap:{"64cb4a2654046402f5bde521":"å¤§è²"}},taeyang:{label:"Taeyang (taeyang.bstage.in)",domain:"taeyang.bstage.in",mediaPrefix:"taeyang",authorIds:"67361d0527162e668b09c620",defaultMember:"å¤ªé™½",authorMap:{"67361d0527162e668b09c620":"å¤ªé™½"}}};function Ws({isAdmin:P,onBack:ve,currentPage:Z,setCurrentPage:z}){var Oe,Ve,Ye;const[C,S]=r.useState([]),[He,Ne]=r.useState(!0),[ye,we]=r.useState(!1),[ee,ke]=r.useState(null),[R,Ke]=r.useState("all"),[se,Xe]=r.useState("all"),[ae,Je]=r.useState(""),[D,Ce]=r.useState("grid"),[Qe,B]=r.useState(!1),[I,Se]=r.useState(null),[h,j]=r.useState({member:"å…¨å“¡",date:new Date().toISOString().split("T")[0],time:"",caption:"",media:[],sourceUrl:"",notes:""}),[Ue,Ie]=r.useState(!1),[l,L]=r.useState(null),[A,O]=r.useState(0),[M,ce]=r.useState(null),de=r.useRef(null),[W,me]=r.useState(()=>window.innerWidth<500?2:Math.max(2,Math.floor(Math.min(900,window.innerWidth)/280))),[$e,q]=r.useState(!1),[ue,H]=r.useState(""),[Te,Me]=r.useState(0),[Ze,K]=r.useState(!1),[te,X]=r.useState(""),[he,Pe]=r.useState("gdragon"),[w,F]=r.useState(null),[ze,De]=r.useState({page:0,totalItems:0}),[E,V]=r.useState({current:0,total:0,skipped:0,success:0,failed:0}),[Ae,J]=r.useState([]),[Ee,es]=r.useState(!1),[ie,ss]=r.useState(!1),Y=r.useRef(!1);r.useEffect(()=>{as()},[]);async function as(){Ne(!0);try{const s=await _.load();S(s)}catch(s){console.error("è¼‰å…¥å¤±æ•—",s),N("è¼‰å…¥å¤±æ•—","error")}finally{Ne(!1)}}function x(s,a="info"){J(i=>[...i,{msg:s,type:a,ts:Date.now()}])}async function ts(s,a){var f;const i=G[a],t=[];let c=1;const d=24;let m=!1;for(;!m&&!Y.current;){const $=`https://${i.domain}/svc/home/api/v1/home/star/feeds?authorIds=${i.authorIds}&page=${c}&pageSize=${d}`,p=await fetch($,{headers:{authorization:`Bearer ${s}`}});if(!p.ok)throw p.status===401?new Error("Token å·²éŽæœŸï¼Œè«‹é‡æ–°ç™»å…¥ b.stage å–å¾—æ–°çš„ Token"):new Error(`API éŒ¯èª¤: ${p.status}`);const n=await p.json();((f=n==null?void 0:n.items)==null?void 0:f.length)>0&&t.push(...n.items),m=(n==null?void 0:n.isLast)??!0,c++,De({page:c-1,totalItems:t.length}),x(`ç¬¬ ${c-1} é ï¼šå·²æŠ“å– ${t.length} ç­†`,"info"),await new Promise(U=>setTimeout(U,100))}return t}function pe(s){if(!s)return s;const a=s.split(`

`);return a.length===2&&a[0].trim()===a[1].trim()?a[0].trim():s}function is(s,a){var u,y,T;const i=G[a],t=new Date(s.publishedAt||s.createdAt),c=t.toISOString().split("T")[0],d=t.toTimeString().slice(0,5),m=[];if(s.images&&s.images.length>0)for(const o of s.images){const b=typeof o=="string"?o:o.url||o.path||o.source;b&&m.push({originalUrl:b,type:"image"})}else if(s.mainImage){const o=typeof s.mainImage=="string"?s.mainImage:s.mainImage.url||s.mainImage.path;o&&m.push({originalUrl:o,type:"image"})}let f="";if(s.video){const o=s.video.thumbnailPaths||[];for(const g of o){const v=typeof g=="string"?g:g.url||g.path;if(v){m.unshift({originalUrl:v,type:"image"});break}}const b=s.video.id||s.video._id||"";if(b){const g=`https://media.static.bstage.in/${i.mediaPrefix}/media/${b}/hls/ori.m3u8`;m.push({originalUrl:g,type:"video"}),f=`[å½±ç‰‡] ${g}`}else{const g=((u=s.video.hlsPath)==null?void 0:u.path)||((y=s.video.dashPath)==null?void 0:y.path)||"";if(g){let v=g;if(!g.startsWith("http")){const vs=g.startsWith("/")?g.slice(1):g;v=`https://media.static.bstage.in/${i.mediaPrefix}/${vs}`}m.push({originalUrl:v,type:"video"}),f=`[å½±ç‰‡] ${v}`}}}const $=i.authorMap[(T=s.author)==null?void 0:T.id]||i.defaultMember;let p="";const n=(s.title||"").trim(),U=(s.description||"").trim();return n&&U?p=n===U?n:U.includes(n)?U:`${n}

${U}`:p=n||U,{id:`mb-bstage-${s.id}`,member:$,date:c,time:d,caption:p||"",images:m,sourceUrl:`https://${i.domain}/story/feed/${s.typeId||s.id}`,notes:f,bstageId:s.id,paid:s.paid||!1}}async function ns(s){var c,d,m,f,$;F("processing"),V({current:0,total:s.length,skipped:0,success:0,failed:0});let a=C;try{a=await _.load(),S(a)}catch(p){console.warn("é‡æ–°è¼‰å…¥è³‡æ–™å¤±æ•—ï¼Œä½¿ç”¨ç¾æœ‰ state åŽ»é‡",p)}const i=new Set(a.map(p=>p.id)),t=new Set(a.map(p=>p.sourceUrl).filter(Boolean));for(let p=0;p<s.length&&!Y.current;p++){const n=s[p],U=(c=n.images)==null?void 0:c.some(u=>u.type==="video");if(ie&&!U){V(u=>({...u,current:u.current+1,skipped:u.skipped+1})),x(`â­ è·³éŽï¼ˆéžå½±ç‰‡ï¼‰: ${n.date} ${((d=n.caption)==null?void 0:d.slice(0,30))||"(ç„¡æ–‡å­—)"}`,"info");continue}if(i.has(n.id)||t.has(n.sourceUrl)){if(Ee||ie){const u=i.has(n.id)?n.id:null,y=a.find(T=>T.id===u||T.sourceUrl===n.sourceUrl);if(y){const T=pe(n.caption),o={...y,caption:T,date:n.date,time:n.time,updatedAt:Date.now()};if(ie&&U){const b=(y.media||[]).filter(v=>v.type!=="video"),g=n.images.filter(v=>v.type==="video").map(v=>({url:v.originalUrl,type:"video"}));o.media=[...b,...g],o.notes=n.notes||y.notes}await _.update(o).catch(b=>console.warn("æ›´æ–°å¤±æ•—:",b)),S(b=>b.map(g=>g.id===o.id?o:g)),x(`ðŸ”„ å·²æ›´æ–°${U?"ï¼ˆå«å½±ç‰‡ï¼‰":""}: ${n.date} ${(T==null?void 0:T.slice(0,30))||"(ç„¡æ–‡å­—)"}`,"info")}}else x(`â­ è·³éŽï¼ˆå·²å­˜åœ¨ï¼‰: ${n.date} ${((m=n.caption)==null?void 0:m.slice(0,30))||"(ç„¡æ–‡å­—)"}`,"info");V(u=>({...u,current:u.current+1,skipped:u.skipped+1}));continue}try{const u=[];for(const o of n.images){if(o.type==="video"){u.push({url:o.originalUrl,type:"video"});continue}try{const b={context:"membership"},[g,v]=await Promise.all([xe(o.originalUrl,b),be(o.originalUrl,b)]);u.push({url:g,type:o.type,...v&&{backupUrl:v}})}catch(b){console.warn("åœ–ç‰‡ä¸Šå‚³å¤±æ•—ï¼Œä½¿ç”¨åŽŸå§‹ URL:",b),u.push({url:o.originalUrl,type:o.type}),x("âš  åœ–ç‰‡å‚™ä»½å¤±æ•—ï¼Œä½¿ç”¨åŽŸå§‹é€£çµ","warn")}}const y={id:n.id,member:n.member,date:n.date,time:n.time,caption:n.caption,media:u,sourceUrl:n.sourceUrl,notes:n.notes,paid:n.paid||!1,createdAt:Date.now(),updatedAt:Date.now()};(await _.create(y)).skipped?(V(o=>({...o,current:o.current+1,skipped:o.skipped+1})),x(`â­ è·³éŽï¼ˆD1 å·²å­˜åœ¨ï¼‰: ${n.date} ${((f=n.caption)==null?void 0:f.slice(0,30))||"(ç„¡æ–‡å­—)"}`,"info")):(S(o=>[y,...o]),i.add(n.id),t.add(n.sourceUrl),V(o=>({...o,current:o.current+1,success:o.success+1})),x(`âœ… ${n.date} ${(($=n.caption)==null?void 0:$.slice(0,40))||"(ç„¡æ–‡å­—)"}`,"success"))}catch(u){console.error(`åŒ¯å…¥å¤±æ•—: ${n.id}`,u),V(y=>({...y,current:y.current+1,failed:y.failed+1})),x(`âŒ å¤±æ•—: ${n.date} - ${u.message}`,"error")}await new Promise(u=>setTimeout(u,50))}}async function ls(){if(!te.trim()){N("è«‹è¼¸å…¥ b.stage Token","error");return}let s=te.trim();s.toLowerCase().startsWith("bearer ")&&(s=s.slice(7));const a=he,i=G[a].label;Y.current=!1,J([]),F("fetching"),De({page:0,totalItems:0}),x(`é–‹å§‹å¾ž ${i} æŠ“å–è³‡æ–™...`,"info");try{const t=await ts(s,a);if(Y.current){F("done"),x("å·²å–æ¶ˆåŒ¯å…¥","warn");return}x(`âœ… æŠ“å–å®Œæˆï¼šå…± ${t.length} ç­†è²¼æ–‡`,"success");const c=t.map(m=>is(m,a)),d=c.filter(m=>{var f;return(f=m.images)==null?void 0:f.some($=>$.type==="video")}).length;d>0&&x(`ðŸŽ¬ å…¶ä¸­ ${d} ç­†å«å½±ç‰‡`,"info"),await ns(c),Y.current?x("å·²å–æ¶ˆåŒ¯å…¥","warn"):x("ðŸŽ‰ åŒ¯å…¥å®Œæˆï¼","success")}catch(t){x(`âŒ éŒ¯èª¤: ${t.message}`,"error"),N(t.message,"error")}finally{F("done")}}function Be(){Y.current=!0,x("æ­£åœ¨å–æ¶ˆ...","warn")}function N(s,a="success"){ke({msg:s,type:a}),setTimeout(()=>ke(null),2500)}function Fe({title:s,content:a,type:i="warning",confirmText:t="ç¢ºå®š",cancelText:c="å–æ¶ˆ"}){return new Promise(d=>{ce({title:s,content:a,type:i,confirmText:t,cancelText:c,onConfirm:()=>{ce(null),d(!0)},onCancel:()=>{ce(null),d(!1)}})})}const k=r.useMemo(()=>C.filter(s=>{var a,i,t;return!(R!=="all"&&s.member!==R&&!((a=Ns[R])!=null&&a.includes(s.member))||se==="video"&&!((i=s.notes)!=null&&i.includes("[å½±ç‰‡]"))||se==="paid"&&!s.paid||ae&&!((t=s.caption)!=null&&t.toLowerCase().includes(ae.toLowerCase())))}).sort((s,a)=>new Date(a.date)-new Date(s.date)),[C,R,se,ae]);r.useEffect(()=>{const s=de.current;if(!s)return;const a=()=>{if(D!=="grid"){me(1);return}const t=Math.min(s.clientWidth,window.innerWidth);if(t<500){me(2);return}me(Math.max(2,Math.floor(t/280)))};a();const i=new ResizeObserver(a);return i.observe(s),()=>i.disconnect()},[D]);const rs=r.useMemo(()=>Math.ceil(k.length/W),[k.length,W]),ge=Gs({count:rs,getScrollElement:()=>de.current,estimateSize:()=>D==="grid"?340:120,overscan:3,gap:D==="grid"?16:10});function _e(){Se(null),j({member:"å…¨å“¡",date:new Date().toISOString().split("T")[0],time:"",caption:"",media:[],sourceUrl:"",notes:"",paid:!1}),q(!1),H(""),B(!0)}function os(s){Se(s),j({member:s.member,date:s.date,time:s.time||"",caption:s.caption||"",media:s.media||[],sourceUrl:s.sourceUrl||"",notes:s.notes||"",paid:s.paid||!1}),q(!1),H(""),B(!0)}function cs(s){L(s),O(0)}function ds(){const s=k.findIndex(a=>a.id===(l==null?void 0:l.id));s>0&&(L(k[s-1]),O(0))}function ms(){const s=k.findIndex(a=>a.id===(l==null?void 0:l.id));s<k.length-1&&(L(k[s+1]),O(0))}function fe(){return k.findIndex(s=>s.id===(l==null?void 0:l.id))}function us(){l&&(os(l),L(null))}async function hs(){if(!ue.trim())return;const s=ue.split(`
`).map(t=>t.trim()).filter(t=>t&&(t.startsWith("http")||t.startsWith("//")));if(s.length===0){N("è«‹è¼¸å…¥æœ‰æ•ˆçš„ç¶²å€","error");return}const a=s.map((t,c)=>Re(t)?{url:t,type:"youtube",thumbnail:ne(t),index:h.media.length+c}:{url:t,type:"image",uploading:!0,originalUrl:t,index:h.media.length+c});j(t=>({...t,media:[...t.media,...a]}));const i=a.filter(t=>t.type==="image");Me(t=>t+i.length);for(const t of i)ps(t.originalUrl,t.index);H(""),q(!1),N(`å·²æ–°å¢ž ${s.length} å€‹åª’é«”`)}async function ps(s,a){try{const i={context:"membership"},[t,c]=await Promise.all([xe(s,i),be(s,i)]);j(d=>({...d,media:d.media.map((m,f)=>f===a?{...m,url:t,backupUrl:c,uploading:!1}:m)})),c&&console.log(`âœ… åœ–ç‰‡ ${a+1} é›™é‡å‚™ä»½å®Œæˆ`)}catch(i){console.warn(`åœ–ç‰‡ ${a+1} ä¸Šå‚³å¤±æ•—`,i),j(t=>({...t,media:t.media.map((c,d)=>d===a?{...c,uploading:!1,uploadFailed:!0}:c)}))}finally{Me(i=>i-1)}}async function gs(s){const a=Array.from(s.target.files);if(a.length){Ie(!0);try{const i=[];for(const t of a){const c={context:"membership"},[d,m]=await Promise.all([xe(t,c),be(t,c)]);i.push({url:d,type:"image",...m&&{backupUrl:m}})}j(t=>({...t,media:[...t.media,...i]})),N(`å·²æ–°å¢ž ${i.length} å€‹æª”æ¡ˆ`)}catch(i){console.error("ä¸Šå‚³å¤±æ•—",i),N("ä¸Šå‚³å¤±æ•—","error")}finally{Ie(!1)}}}const[Q,Le]=r.useState("");function fs(){if(!Q.trim())return;if(!Re(Q)){N("è«‹è¼¸å…¥æœ‰æ•ˆçš„ YouTube é€£çµ","error");return}const s=ne(Q);j(a=>({...a,media:[...a.media,{url:Q.trim(),type:"youtube",thumbnail:s}]})),Le(""),N("å·²æ–°å¢ž YouTube å½±ç‰‡")}function xs(s){j(a=>({...a,media:a.media.filter((i,t)=>t!==s)}))}async function bs(){if(!h.date||!h.member){N("è«‹å¡«å¯«å¿…è¦æ¬„ä½","error");return}if(h.media.some(i=>i.uploading)&&!await Fe({title:"âš ï¸ ä¸Šå‚³æœªå®Œæˆ",type:"warning",confirmText:"ä»è¦å„²å­˜",cancelText:"ç­‰å¾…ä¸Šå‚³",content:e.jsxs("div",{className:"confirm-content",children:[e.jsx("p",{children:"é‚„æœ‰åœ–ç‰‡æ­£åœ¨ä¸Šå‚³ä¸­ï¼Œç¢ºå®šè¦ç¾åœ¨å„²å­˜å—Žï¼Ÿ"}),e.jsx("p",{className:"confirm-warning",children:"æœªå®Œæˆä¸Šå‚³çš„åœ–ç‰‡å¯èƒ½ç„¡æ³•æ­£å¸¸é¡¯ç¤º"})]})}))return;const a={id:(I==null?void 0:I.id)||$s("mb"),member:h.member,date:h.date,time:h.time,caption:h.caption,media:h.media.map(i=>({url:i.url,type:i.type,...i.backupUrl&&{backupUrl:i.backupUrl},...i.thumbnail&&{thumbnail:i.thumbnail}})),sourceUrl:h.sourceUrl,notes:h.notes,paid:h.paid||!1,createdAt:(I==null?void 0:I.createdAt)||Date.now(),updatedAt:Date.now()};we(!0);try{I?(await _.update(a),S(C.map(i=>i.id===I.id?a:i))):(await _.create(a),S([a,...C])),N("å·²å„²å­˜"),B(!1)}catch(i){console.error("å„²å­˜å¤±æ•—",i),N("å„²å­˜å¤±æ•—","error")}finally{we(!1)}}async function js(s){if(await Fe({title:"ðŸ—‘ï¸ åˆªé™¤ç¢ºèª",type:"danger",confirmText:"åˆªé™¤",cancelText:"å–æ¶ˆ",content:e.jsxs("div",{className:"confirm-content",children:[e.jsx("p",{children:"ç¢ºå®šè¦åˆªé™¤é€™ç­†å‚™ä»½å—Žï¼Ÿ"}),e.jsx("p",{className:"confirm-warning",children:"æ­¤æ“ä½œç„¡æ³•å¾©åŽŸ"})]})}))try{await _.delete(s),S(C.filter(i=>i.id!==s)),N("å·²åˆªé™¤")}catch(i){console.error("åˆªé™¤å¤±æ•—",i),N("åˆªé™¤å¤±æ•—","error")}}return He?e.jsxs("div",{className:"archive-page-loading",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"è¼‰å…¥ä¸­..."})]}):e.jsxs("div",{className:"membership-archive archive-page",children:[e.jsxs("header",{className:"archive-header",children:[e.jsx("div",{style:{display:"flex",alignItems:"center",gap:8},children:e.jsx("h1",{children:"ðŸ”’ æœƒå“¡å‚™ä»½"})}),e.jsxs("div",{className:"header-actions",children:[P&&e.jsx("button",{className:"membership-import-btn",onClick:()=>K(!0),title:"å¾ž b.stage åŒ¯å…¥",children:e.jsx(je,{size:18})}),e.jsx("button",{className:"add-btn",onClick:_e,title:"æ–°å¢žå‚™ä»½",children:e.jsx(Ts,{size:20})}),z&&e.jsx(ys,{currentPage:Z,setCurrentPage:z})]})]}),e.jsxs("div",{className:"archive-filters",children:[e.jsxs("div",{className:"filter-row",children:[e.jsxs("select",{value:R,onChange:s=>Ke(s.target.value),className:"filter-select",children:[e.jsx("option",{value:"all",children:"æ‰€æœ‰æˆå“¡"}),Ge.map(s=>e.jsx("option",{value:s.name,children:s.name},s.name))]}),e.jsxs("select",{value:se,onChange:s=>Xe(s.target.value),className:"filter-select",children:[e.jsx("option",{value:"all",children:"æ‰€æœ‰é¡žåž‹"}),e.jsx("option",{value:"video",children:"ðŸŽ¬ å«å½±ç‰‡"}),e.jsx("option",{value:"paid",children:"ðŸ”’ æœƒå“¡é™å®š"})]}),e.jsxs("div",{className:"search-box",children:[e.jsx(Ms,{size:16}),e.jsx("input",{type:"text",placeholder:"æœå°‹å…§å®¹...",value:ae,onChange:s=>Je(s.target.value)})]}),e.jsxs("div",{className:"view-toggle",children:[e.jsx("button",{className:D==="grid"?"active":"",onClick:()=>Ce("grid"),children:e.jsx(Ps,{size:16})}),e.jsx("button",{className:D==="list"?"active":"",onClick:()=>Ce("list"),children:e.jsx(zs,{size:16})})]})]}),e.jsxs("div",{className:"filter-stats",children:["å…± ",k.length," ç­†å‚™ä»½"]})]}),e.jsx("div",{ref:de,className:"membership-content-scroll",children:k.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx(We,{size:48}),e.jsx("p",{children:"å°šç„¡æœƒå“¡å‚™ä»½è³‡æ–™"}),e.jsx("button",{onClick:_e,children:"æ–°å¢žç¬¬ä¸€ç­†"})]}):e.jsx("div",{style:{height:ge.getTotalSize(),position:"relative"},children:ge.getVirtualItems().map(s=>{const a=s.index*W,i=k.slice(a,a+W);return e.jsx("div",{className:`archive-content ${D}`,style:{position:"absolute",top:0,left:0,right:0,transform:`translateY(${s.start}px)`,...D==="grid"?{gridTemplateColumns:`repeat(${W}, 1fr)`}:{}},ref:ge.measureElement,"data-index":s.index,children:i.map(t=>{var c;return e.jsxs("div",{className:"archive-card",onClick:()=>cs(t),children:[e.jsxs("div",{className:"archive-thumb",children:[(()=>{var f,$,p;const d=((f=t.media)==null?void 0:f.find(n=>n.type!=="video"))||(($=t.media)==null?void 0:$[0]),m=(p=t.media)==null?void 0:p.some(n=>n.type==="video");return d?d.type==="youtube"?e.jsxs("div",{className:"video-thumb-img",children:[e.jsx("img",{src:d.thumbnail||ne(d.url),alt:"",loading:"lazy",width:260,height:260}),e.jsx(re,{size:24,className:"play-overlay"})]}):e.jsxs("div",{className:m?"video-thumb-img":"",children:[e.jsx("img",{src:ws(d),alt:"",loading:"lazy",width:260,height:260}),m&&e.jsx(re,{size:24,className:"play-overlay"})]}):e.jsx("div",{className:"no-thumb",children:e.jsx("img",{src:"/bigbang-timeline/bigbang-default.png",alt:"BIGBANG"})})})(),((c=t.media)==null?void 0:c.length)>1&&e.jsxs("span",{className:"media-count",children:["+",t.media.length-1]}),t.paid&&e.jsx("span",{className:"paid-overlay",children:e.jsx(We,{size:14})})]}),e.jsxs("div",{className:"archive-info",children:[e.jsxs("div",{className:"archive-meta",children:[e.jsx("span",{className:"member-tag",style:{background:le(t.member)+"30",color:le(t.member)},children:t.member}),e.jsx("span",{className:"date",children:ks(t.date)})]}),t.caption&&e.jsx("p",{className:"archive-caption",children:pe(t.caption)})]})]},t.id)})},s.key)})})}),l&&e.jsxs("div",{className:"modal-overlay view-modal-overlay",onClick:()=>L(null),children:[e.jsxs("div",{className:"post-nav-indicator",onClick:s=>s.stopPropagation(),children:[fe()+1," / ",k.length]}),e.jsx("button",{className:"post-nav-side prev",onClick:s=>{s.stopPropagation(),ds()},disabled:fe()<=0,title:"ä¸Šä¸€å‰‡",children:e.jsx(Ds,{size:32})}),e.jsxs("div",{className:"view-modal",onClick:s=>s.stopPropagation(),children:[e.jsx("button",{className:"view-close-btn",onClick:()=>L(null),children:e.jsx(oe,{size:24})}),e.jsx("div",{className:"view-media-area",children:((Oe=l.media)==null?void 0:Oe.length)>0?e.jsxs(e.Fragment,{children:[((Ve=l.media[A])==null?void 0:Ve.type)==="youtube"?e.jsx("iframe",{src:`https://www.youtube.com/embed/${Cs(l.media[A].url)}?autoplay=1`,allow:"autoplay; encrypted-media",allowFullScreen:!0,className:"view-media view-youtube"}):((Ye=l.media[A])==null?void 0:Ye.type)==="video"?e.jsx(Rs,{src:l.media[A].url,className:"view-media"},`${l.id}-${A}`):e.jsx("img",{src:Ss(l.media[A]),alt:"",className:"view-media"},`${l.id}-${A}`),l.media.length>1&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"media-nav prev",onClick:()=>O(s=>(s-1+l.media.length)%l.media.length),children:"â€¹"}),e.jsx("button",{className:"media-nav next",onClick:()=>O(s=>(s+1)%l.media.length),children:"â€º"}),e.jsx("div",{className:"media-dots",children:l.media.map((s,a)=>e.jsx("span",{className:`dot ${a===A?"active":""}`,onClick:()=>O(a)},a))})]})]}):e.jsx("div",{className:"no-media",children:e.jsx("img",{src:"/bigbang-timeline/bigbang-default.png",alt:"BIGBANG",className:"no-media-img"})})}),e.jsxs("div",{className:"view-info-area",children:[e.jsxs("div",{className:"view-header",children:[e.jsx("span",{className:"member-tag",style:{background:le(l.member)+"30",color:le(l.member)},children:l.member}),l.paid&&e.jsx("span",{className:"paid-badge",children:"ðŸ”’ æœƒå“¡é™å®š"}),e.jsx("span",{className:"view-date",children:Us(l.date,l.time)})]}),l.caption&&e.jsx("div",{className:"view-caption",children:e.jsx("p",{children:pe(l.caption)})}),P&&l.notes&&e.jsxs("div",{className:"view-notes",children:[e.jsx("strong",{children:"å‚™è¨»ï¼š"}),e.jsx("p",{children:(()=>{var a;const s=((a=Object.values(G).find(i=>{var t;return(t=l.sourceUrl)==null?void 0:t.includes(i.domain)}))==null?void 0:a.mediaPrefix)||"";return l.notes.split(/(https?:\/\/[^\s]+|\/media\/[^\s]+)/g).map((i,t)=>{if(/^https?:\/\//.test(i))return e.jsx("a",{href:i,target:"_blank",rel:"noopener noreferrer",style:{color:"#D4AF37",wordBreak:"break-all"},children:i},t);if(/^\/media\//.test(i)){const c=`https://media.static.bstage.in/${s}${i}`;return e.jsx("a",{href:c,target:"_blank",rel:"noopener noreferrer",style:{color:"#D4AF37",wordBreak:"break-all"},children:i},t)}return i})})()})]}),e.jsxs("div",{className:"view-actions",children:[l.sourceUrl&&e.jsxs("a",{href:l.sourceUrl,target:"_blank",rel:"noopener noreferrer",className:"view-link-btn",children:[e.jsx(As,{size:16})," é–‹å•ŸåŽŸæ–‡"]}),e.jsx("button",{className:"view-edit-btn",onClick:us,children:"âœï¸ ç·¨è¼¯"})]})]})]}),e.jsx("button",{className:"post-nav-side next",onClick:s=>{s.stopPropagation(),ms()},disabled:fe()>=k.length-1,title:"ä¸‹ä¸€å‰‡",children:e.jsx(Es,{size:32})})]}),Qe&&e.jsx("div",{className:"modal-overlay",onClick:()=>B(!1),children:e.jsxs("div",{className:"archive-modal",onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{children:I?"ç·¨è¼¯å‚™ä»½":"æ–°å¢žå‚™ä»½"}),e.jsx("button",{className:"close-btn",onClick:()=>B(!1),children:e.jsx(oe,{size:20})})]}),e.jsxs("div",{className:"modal-body",children:[e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"æˆå“¡"}),e.jsx("select",{value:h.member,onChange:s=>j(a=>({...a,member:s.target.value})),children:Ge.map(s=>e.jsx("option",{value:s.name,children:s.name},s.name))})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{children:[e.jsx(Bs,{size:14})," ç™¼æ–‡æ—¥æœŸ"]}),e.jsx("input",{type:"date",value:h.date,onChange:s=>j(a=>({...a,date:s.target.value}))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"æ™‚é–“ï¼ˆé¸å¡«ï¼‰"}),e.jsx("input",{type:"time",value:h.time,onChange:s=>j(a=>({...a,time:s.target.value}))})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{children:[e.jsx(qe,{size:14})," b.stage åŽŸå§‹é€£çµï¼ˆé¸å¡«ï¼‰"]}),e.jsx("input",{type:"url",placeholder:"è²¼ä¸Š b.stage åŽŸå§‹é€£çµ...",value:h.sourceUrl,onChange:s=>j(a=>({...a,sourceUrl:s.target.value}))})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{children:[e.jsx(Fs,{size:14})," åœ–ç‰‡ / YouTube å½±ç‰‡",Te>0&&e.jsxs("span",{className:"upload-status",children:["ï¼ˆ",Te," å¼µä¸Šå‚³ä¸­...ï¼‰"]})]}),e.jsxs("div",{className:"media-upload-area",children:[h.media.map((s,a)=>e.jsxs("div",{className:`media-preview ${s.uploading?"uploading":""} ${s.uploadFailed?"failed":""}`,children:[s.type==="youtube"?e.jsxs("div",{className:"video-preview-img",children:[e.jsx("img",{src:s.thumbnail||ne(s.url),alt:""}),e.jsx(re,{size:16,className:"play-icon"})]}):e.jsx("img",{src:s.url,alt:""}),s.uploading&&e.jsx("div",{className:"upload-overlay",children:e.jsx("div",{className:"mini-spinner"})}),s.uploadFailed&&e.jsx("div",{className:"upload-failed-badge",title:"ä¸Šå‚³å¤±æ•—ï¼Œå°‡ä½¿ç”¨åŽŸå§‹é€£çµ",children:"âš ï¸"}),e.jsx("button",{className:"remove-media",onClick:()=>xs(a),children:e.jsx(oe,{size:14})})]},a)),e.jsxs("label",{className:"upload-btn",children:[e.jsx("input",{type:"file",accept:"image/*",multiple:!0,onChange:gs,disabled:Ue}),Ue?e.jsx("span",{className:"uploading-text",children:"ä¸Šå‚³ä¸­..."}):e.jsxs(e.Fragment,{children:[e.jsx(_s,{size:20}),e.jsx("span",{children:"ä¸Šå‚³åœ–ç‰‡"})]})]}),e.jsxs("button",{type:"button",className:"manual-url-toggle",onClick:()=>q(!$e),children:[e.jsx(qe,{size:16}),e.jsx("span",{children:"è²¼ä¸Šç¶²å€"})]})]}),e.jsxs("div",{className:"youtube-input-row",children:[e.jsx("input",{type:"url",placeholder:"è²¼ä¸Š YouTube é€£çµ...",value:Q,onChange:s=>Le(s.target.value)}),e.jsxs("button",{onClick:fs,title:"æ–°å¢ž YouTube å½±ç‰‡",children:[e.jsx(re,{size:16})," æ–°å¢žå½±ç‰‡"]})]}),$e&&e.jsxs("div",{className:"manual-url-input",children:[e.jsx("p",{className:"manual-hint",children:"ðŸ’¡ æç¤ºï¼šæ¯è¡Œè²¼ä¸€å€‹åœ–ç‰‡ç¶²å€ï¼Œæ”¯æ´åœ–ç‰‡å’Œ YouTube é€£çµ"}),e.jsx("textarea",{placeholder:"è²¼ä¸Šåœ–ç‰‡/YouTube ç¶²å€ï¼Œæ¯è¡Œä¸€å€‹...",value:ue,onChange:s=>H(s.target.value),rows:4}),e.jsxs("div",{className:"manual-actions",children:[e.jsx("button",{type:"button",className:"cancel-manual",onClick:()=>{q(!1),H("")},children:"å–æ¶ˆ"}),e.jsx("button",{type:"button",className:"submit-manual",onClick:hs,children:"æ–°å¢žåª’é«”"})]})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"è²¼æ–‡å…§å®¹"}),e.jsx("textarea",{placeholder:"è²¼ä¸Š b.stage è²¼æ–‡å…§å®¹...",value:h.caption,onChange:s=>j(a=>({...a,caption:s.target.value})),rows:4})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"å‚™è¨»ï¼ˆé¸å¡«ï¼‰"}),e.jsx("textarea",{placeholder:"å…¶ä»–å‚™è¨»...",value:h.notes,onChange:s=>j(a=>({...a,notes:s.target.value})),rows:2})]}),e.jsx("div",{className:"form-group paid-checkbox-group",children:e.jsxs("label",{className:"paid-checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:h.paid||!1,onChange:s=>j(a=>({...a,paid:s.target.checked}))}),e.jsx("span",{children:"ðŸ”’ æœƒå“¡é™å®šå…§å®¹"})]})})]}),e.jsxs("div",{className:"modal-footer",children:[I&&e.jsxs("button",{className:"delete-btn",onClick:()=>{js(I.id),B(!1)},children:[e.jsx(Ls,{size:16})," åˆªé™¤"]}),e.jsx("button",{className:"cancel-btn",onClick:()=>B(!1),children:"å–æ¶ˆ"}),e.jsxs("button",{className:"save-btn",onClick:bs,disabled:ye,children:[e.jsx(Os,{size:16})," ",ye?"å„²å­˜ä¸­...":"å„²å­˜"]})]})]})}),ee&&e.jsxs("div",{className:`toast ${ee.type}`,children:[ee.type==="error"?e.jsx(Vs,{size:16}):e.jsx(Ys,{size:16}),ee.msg]}),M&&e.jsx("div",{className:"confirm-modal-overlay",onClick:M.onCancel,children:e.jsxs("div",{className:`confirm-modal confirm-modal-${M.type}`,onClick:s=>s.stopPropagation(),children:[e.jsx("h3",{className:"confirm-modal-title",children:M.title}),e.jsx("div",{className:"confirm-modal-body",children:M.content}),e.jsxs("div",{className:"confirm-modal-actions",children:[e.jsx("button",{className:"confirm-modal-cancel",onClick:M.onCancel,children:M.cancelText}),e.jsx("button",{className:`confirm-modal-confirm confirm-modal-confirm-${M.type}`,onClick:M.onConfirm,children:M.confirmText})]})]})}),Ze&&e.jsx("div",{className:"modal-overlay",onClick:()=>{(!w||w==="done")&&(K(!1),F(null),X(""),J([]))},children:e.jsxs("div",{className:"archive-modal import-modal",onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("h2",{children:[e.jsx(je,{size:18})," å¾ž b.stage åŒ¯å…¥"]}),e.jsx("button",{className:"close-btn",onClick:()=>{w&&w!=="done"?Be():(K(!1),F(null),X(""),J([]))},children:e.jsx(oe,{size:20})})]}),e.jsxs("div",{className:"modal-body",children:[!w&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"é¸æ“‡ç«™å°"}),e.jsx("select",{className:"import-site-select",value:he,onChange:s=>Pe(s.target.value),children:Object.entries(G).map(([s,a])=>e.jsx("option",{value:s,children:a.label},s))})]}),e.jsxs("div",{className:"form-group",style:{marginTop:12},children:[e.jsx("label",{children:"Bearer Token"}),e.jsx("textarea",{className:"import-token-input",placeholder:"å¾ž b.stage é–‹ç™¼è€…å·¥å…·è¤‡è£½ Bearer token...",value:te,onChange:s=>X(s.target.value),rows:3}),e.jsxs("p",{className:"import-hint",children:["åœ¨ ",G[he].domain," ç™»å…¥ â†’ F12 é–‹ç™¼è€…å·¥å…· â†’ Network â†’ æ‰¾ä»»æ„ API è«‹æ±‚ â†’ è¤‡è£½ authorization header çš„å€¼",e.jsx("br",{}),"âš ï¸ Token ç´„ 30 åˆ†é˜éŽæœŸï¼Œæ¯å€‹ç«™å°éœ€ä½¿ç”¨å„è‡ªçš„ Token"]})]}),e.jsxs("div",{className:"form-group",style:{marginTop:12,display:"flex",flexDirection:"column",gap:8},children:[e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8,cursor:"pointer"},children:[e.jsx("input",{type:"checkbox",checked:Ee,onChange:s=>es(s.target.checked)}),"å¼·åˆ¶æ›´æ–°å·²å­˜åœ¨çš„è²¼æ–‡ï¼ˆä¸é‡å‚³åœ–ç‰‡ï¼Œåƒ…æ›´æ–°æ–‡å­—/æ—¥æœŸï¼‰"]}),e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8,cursor:"pointer"},children:[e.jsx("input",{type:"checkbox",checked:ie,onChange:s=>ss(s.target.checked)}),"ðŸŽ¬ åªè™•ç†å«å½±ç‰‡çš„è²¼æ–‡ï¼ˆæ›´æ–°å½±ç‰‡é€£çµåˆ°å·²å­˜åœ¨çš„è²¼æ–‡ï¼‰"]})]})]}),w==="fetching"&&e.jsxs("div",{className:"import-progress-section",children:[e.jsx("h3",{children:"ðŸ”„ æŠ“å– b.stage è³‡æ–™ä¸­..."}),e.jsxs("p",{className:"import-progress-text",children:["ç¬¬ ",ze.page," é ï¼Œå·²æŠ“å– ",ze.totalItems," ç­†"]}),e.jsx("div",{className:"import-progress-bar",children:e.jsx("div",{className:"import-progress-bar-fill fetching"})})]}),(w==="processing"||w==="done")&&e.jsxs("div",{className:"import-progress-section",children:[e.jsx("h3",{children:w==="done"?"âœ… åŒ¯å…¥å®Œæˆ":"ðŸ“¦ è™•ç†ä¸­..."}),e.jsxs("div",{className:"import-stats",children:[e.jsxs("span",{className:"import-stat success",children:["âœ… ",E.success]}),e.jsxs("span",{className:"import-stat skipped",children:["â­ ",E.skipped]}),e.jsxs("span",{className:"import-stat failed",children:["âŒ ",E.failed]})]}),E.total>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"import-progress-bar",children:e.jsx("div",{className:"import-progress-bar-fill",style:{width:`${E.current/E.total*100}%`}})}),e.jsxs("p",{className:"import-progress-text",children:[E.current," / ",E.total]})]})]}),Ae.length>0&&e.jsx("div",{className:"import-log",children:Ae.map((s,a)=>e.jsx("div",{className:`import-log-line import-log-${s.type}`,children:s.msg},a))})]}),e.jsxs("div",{className:"modal-footer",children:[!w&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"cancel-btn",onClick:()=>{K(!1),X("")},children:"å–æ¶ˆ"}),e.jsxs("button",{className:"save-btn",onClick:ls,disabled:!te.trim(),children:[e.jsx(je,{size:16})," é–‹å§‹åŒ¯å…¥"]})]}),w&&w!=="done"&&e.jsx("button",{className:"cancel-btn",onClick:Be,children:"å–æ¶ˆåŒ¯å…¥"}),w==="done"&&e.jsx("button",{className:"save-btn",onClick:()=>{K(!1),F(null),X(""),J([]),Pe("gdragon")},children:"é—œé–‰"})]})]})})]})}const Js=r.memo(Ws);export{Js as default};
