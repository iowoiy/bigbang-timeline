import{o as _,p as ys,j as e,N as ws,M as ks,g as ne,a as Cs,b as re,f as Ss,c as Is,d as Us,e as $s,q as Ts,_ as Ms,m as be,n as je,i as We,k as Ps}from"./index-SWjb4LDT.js";import{a as r,D as ve,d as zs,p as Ds,G as As,q as Bs,x as qe,f as le,C as Es,X as oe,E as Fs,b as _s,e as Ls,v as He,I as Os,U as Vs,T as Ys,S as Gs,j as Rs,i as Ws}from"./icons-51PM2evP.js";import{u as qs}from"./ArchiveBase-DG1HYpDb.js";import"./vendor-DhQqL_yF.js";function Hs({src:P,className:Ne}){const Q=r.useRef(null);return r.useEffect(()=>{const z=Q.current;if(!z||!P)return;if(z.canPlayType("application/vnd.apple.mpegurl")){z.src=P;return}let C=null;return Ms(async()=>{const{default:S}=await import("./hls-jw_vZdHi.js");return{default:S}},[]).then(({default:S})=>{if(!S.isSupported()){z.src=P;return}C=new S,C.loadSource(P),C.attachMedia(z)}).catch(()=>{z.src=P}),()=>{C&&C.destroy()}},[P]),e.jsx("video",{ref:Q,controls:!0,playsInline:!0,className:Ne})}const G={gdragon:{label:"G-Dragon (gdragon.ai)",domain:"gdragon.ai",mediaPrefix:"gd",authorIds:"67a5e27bc8affa6b2c4b893b%2C677e145d5dba936413e31764",defaultMember:"G-Dragon",authorMap:{"67a5e27bc8affa6b2c4b893b":"G-Dragon","677e145d5dba936413e31764":"G-Dragon"}},daesung:{label:"Daesung (daesung.bstage.in)",domain:"daesung.bstage.in",mediaPrefix:"daesung",authorIds:"64cb4a2654046402f5bde521",defaultMember:"å¤§è²",authorMap:{"64cb4a2654046402f5bde521":"å¤§è²"}},taeyang:{label:"Taeyang (taeyang.bstage.in)",domain:"taeyang.bstage.in",mediaPrefix:"taeyang",authorIds:"67361d0527162e668b09c620",defaultMember:"å¤ªé™½",authorMap:{"67361d0527162e668b09c620":"å¤ªé™½"}}};function Ks({isAdmin:P,onBack:Ne,currentPage:Q,setCurrentPage:z}){var Ye,Ge,Re;const[C,S]=r.useState([]),[Ke,ye]=r.useState(!0),[we,ke]=r.useState(!1),[Z,Ce]=r.useState(null),[ee,Xe]=r.useState([]),[Se,Je]=r.useState(!1),[se,Qe]=r.useState("all"),[ae,Ze]=r.useState(""),[D,Ie]=r.useState("grid"),[es,E]=r.useState(!1),[U,Ue]=r.useState(null),[h,j]=r.useState({member:"å…¨å“¡",date:new Date().toISOString().split("T")[0],time:"",caption:"",media:[],sourceUrl:"",notes:""}),[$e,Te]=r.useState(!1),[l,L]=r.useState(null),[A,O]=r.useState(0),[M,ce]=r.useState(null),de=r.useRef(null),[R,me]=r.useState(()=>window.innerWidth<500?2:Math.max(2,Math.floor(Math.min(900,window.innerWidth)/280))),[Me,W]=r.useState(!1),[ue,q]=r.useState(""),[Pe,ze]=r.useState(0),[ss,H]=r.useState(!1),[te,K]=r.useState(""),[he,De]=r.useState("gdragon"),[w,F]=r.useState(null),[Ae,Be]=r.useState({page:0,totalItems:0}),[B,V]=r.useState({current:0,total:0,skipped:0,success:0,failed:0}),[Ee,X]=r.useState([]),[Fe,as]=r.useState(!1),[ie,ts]=r.useState(!1),Y=r.useRef(!1);r.useEffect(()=>{is()},[]);async function is(){ye(!0);try{const s=await _.load();S(s)}catch(s){console.error("è¼‰å…¥å¤±æ•—",s),N("è¼‰å…¥å¤±æ•—","error")}finally{ye(!1)}}function x(s,a="info"){X(i=>[...i,{msg:s,type:a,ts:Date.now()}])}async function ns(s,a){var f;const i=G[a],t=[];let o=1;const d=24;let m=!1;for(;!m&&!Y.current;){const $=`https://${i.domain}/svc/home/api/v1/home/star/feeds?authorIds=${i.authorIds}&page=${o}&pageSize=${d}`,p=await fetch($,{headers:{authorization:`Bearer ${s}`}});if(!p.ok)throw p.status===401?new Error("Token å·²éŽæœŸï¼Œè«‹é‡æ–°ç™»å…¥ b.stage å–å¾—æ–°çš„ Token"):new Error(`API éŒ¯èª¤: ${p.status}`);const n=await p.json();((f=n==null?void 0:n.items)==null?void 0:f.length)>0&&t.push(...n.items),m=(n==null?void 0:n.isLast)??!0,o++,Be({page:o-1,totalItems:t.length}),x(`ç¬¬ ${o-1} é ï¼šå·²æŠ“å– ${t.length} ç­†`,"info"),await new Promise(I=>setTimeout(I,100))}return t}function pe(s){if(!s)return s;const a=s.split(`

`);return a.length===2&&a[0].trim()===a[1].trim()?a[0].trim():s}function rs(s,a){var u,y,T;const i=G[a],t=new Date(s.publishedAt||s.createdAt),o=t.toISOString().split("T")[0],d=t.toTimeString().slice(0,5),m=[];if(s.images&&s.images.length>0)for(const c of s.images){const b=typeof c=="string"?c:c.url||c.path||c.source;b&&m.push({originalUrl:b,type:"image"})}else if(s.mainImage){const c=typeof s.mainImage=="string"?s.mainImage:s.mainImage.url||s.mainImage.path;c&&m.push({originalUrl:c,type:"image"})}let f="";if(s.video){const c=s.video.thumbnailPaths||[];for(const g of c){const v=typeof g=="string"?g:g.url||g.path;if(v){m.unshift({originalUrl:v,type:"image"});break}}const b=s.video.id||s.video._id||"";if(b){const g=`https://media.static.bstage.in/${i.mediaPrefix}/media/${b}/hls/ori.m3u8`;m.push({originalUrl:g,type:"video"}),f=`[å½±ç‰‡] ${g}`}else{const g=((u=s.video.hlsPath)==null?void 0:u.path)||((y=s.video.dashPath)==null?void 0:y.path)||"";if(g){let v=g;if(!g.startsWith("http")){const xe=g.startsWith("/")?g.slice(1):g;v=`https://media.static.bstage.in/${i.mediaPrefix}/${xe}`}m.push({originalUrl:v,type:"video"}),f=`[å½±ç‰‡] ${v}`}}}const $=i.authorMap[(T=s.author)==null?void 0:T.id]||i.defaultMember;let p="";const n=(s.title||"").trim(),I=(s.description||"").trim();return n&&I?p=n===I?n:I.includes(n)?I:`${n}

${I}`:p=n||I,{id:`mb-bstage-${s.id}`,member:$,date:o,time:d,caption:p||"",images:m,sourceUrl:`https://${i.domain}/story/feed/${s.typeId||s.id}`,notes:f,bstageId:s.id,paid:s.paid||!1}}async function ls(s){var o,d,m,f,$;F("processing"),V({current:0,total:s.length,skipped:0,success:0,failed:0});let a=C;try{a=await _.load(),S(a)}catch(p){console.warn("é‡æ–°è¼‰å…¥è³‡æ–™å¤±æ•—ï¼Œä½¿ç”¨ç¾æœ‰ state åŽ»é‡",p)}const i=new Set(a.map(p=>p.id)),t=new Set(a.map(p=>p.sourceUrl).filter(Boolean));for(let p=0;p<s.length&&!Y.current;p++){const n=s[p],I=(o=n.images)==null?void 0:o.some(u=>u.type==="video");if(ie&&!I){V(u=>({...u,current:u.current+1,skipped:u.skipped+1})),x(`â­ è·³éŽï¼ˆéžå½±ç‰‡ï¼‰: ${n.date} ${((d=n.caption)==null?void 0:d.slice(0,30))||"(ç„¡æ–‡å­—)"}`,"info");continue}if(i.has(n.id)||t.has(n.sourceUrl)){if(Fe||ie){const u=i.has(n.id)?n.id:null,y=a.find(T=>T.id===u||T.sourceUrl===n.sourceUrl);if(y){const T=pe(n.caption),c={...y,caption:T,date:n.date,time:n.time,updatedAt:Date.now()};if(ie&&I){const b=(y.media||[]).filter(v=>v.type!=="video"),g=n.images.filter(v=>v.type==="video").map(v=>({url:v.originalUrl,type:"video"}));c.media=[...b,...g],c.notes=n.notes||y.notes}await _.update(c).catch(b=>console.warn("æ›´æ–°å¤±æ•—:",b)),S(b=>b.map(g=>g.id===c.id?c:g)),x(`ðŸ”„ å·²æ›´æ–°${I?"ï¼ˆå«å½±ç‰‡ï¼‰":""}: ${n.date} ${(T==null?void 0:T.slice(0,30))||"(ç„¡æ–‡å­—)"}`,"info")}}else x(`â­ è·³éŽï¼ˆå·²å­˜åœ¨ï¼‰: ${n.date} ${((m=n.caption)==null?void 0:m.slice(0,30))||"(ç„¡æ–‡å­—)"}`,"info");V(u=>({...u,current:u.current+1,skipped:u.skipped+1}));continue}try{const u=[];for(const c of n.images){if(c.type==="video"){u.push({url:c.originalUrl,type:"video"});continue}try{const b={context:"membership"},[g,v]=await Promise.all([be(c.originalUrl,b),je(c.originalUrl,b).catch(xe=>(console.warn("ImgBB å‚™ä»½å¤±æ•—:",xe.message),null))]);u.push({url:g,type:c.type,...v&&{backupUrl:v}})}catch(b){console.warn("åœ–ç‰‡ä¸Šå‚³å¤±æ•—ï¼Œä½¿ç”¨åŽŸå§‹ URL:",b),u.push({url:c.originalUrl,type:c.type}),x("âš  åœ–ç‰‡å‚™ä»½å¤±æ•—ï¼Œä½¿ç”¨åŽŸå§‹é€£çµ","warn")}}const y={id:n.id,member:n.member,date:n.date,time:n.time,caption:n.caption,media:u,sourceUrl:n.sourceUrl,notes:n.notes,paid:n.paid||!1,createdAt:Date.now(),updatedAt:Date.now()};(await _.create(y)).skipped?(V(c=>({...c,current:c.current+1,skipped:c.skipped+1})),x(`â­ è·³éŽï¼ˆD1 å·²å­˜åœ¨ï¼‰: ${n.date} ${((f=n.caption)==null?void 0:f.slice(0,30))||"(ç„¡æ–‡å­—)"}`,"info")):(S(c=>[y,...c]),i.add(n.id),t.add(n.sourceUrl),V(c=>({...c,current:c.current+1,success:c.success+1})),x(`âœ… ${n.date} ${(($=n.caption)==null?void 0:$.slice(0,40))||"(ç„¡æ–‡å­—)"}`,"success"))}catch(u){console.error(`åŒ¯å…¥å¤±æ•—: ${n.id}`,u),V(y=>({...y,current:y.current+1,failed:y.failed+1})),x(`âŒ å¤±æ•—: ${n.date} - ${u.message}`,"error")}await new Promise(u=>setTimeout(u,50))}}async function os(){if(!te.trim()){N("è«‹è¼¸å…¥ b.stage Token","error");return}let s=te.trim();s.toLowerCase().startsWith("bearer ")&&(s=s.slice(7));const a=he,i=G[a].label;Y.current=!1,X([]),F("fetching"),Be({page:0,totalItems:0}),x(`é–‹å§‹å¾ž ${i} æŠ“å–è³‡æ–™...`,"info");try{const t=await ns(s,a);if(Y.current){F("done"),x("å·²å–æ¶ˆåŒ¯å…¥","warn");return}x(`âœ… æŠ“å–å®Œæˆï¼šå…± ${t.length} ç­†è²¼æ–‡`,"success");const o=t.map(m=>rs(m,a)),d=o.filter(m=>{var f;return(f=m.images)==null?void 0:f.some($=>$.type==="video")}).length;d>0&&x(`ðŸŽ¬ å…¶ä¸­ ${d} ç­†å«å½±ç‰‡`,"info"),await ls(o),Y.current?x("å·²å–æ¶ˆåŒ¯å…¥","warn"):x("ðŸŽ‰ åŒ¯å…¥å®Œæˆï¼","success")}catch(t){x(`âŒ éŒ¯èª¤: ${t.message}`,"error"),N(t.message,"error")}finally{F("done")}}function _e(){Y.current=!0,x("æ­£åœ¨å–æ¶ˆ...","warn")}function N(s,a="success"){Ce({msg:s,type:a}),setTimeout(()=>Ce(null),2500)}function Le({title:s,content:a,type:i="warning",confirmText:t="ç¢ºå®š",cancelText:o="å–æ¶ˆ"}){return new Promise(d=>{ce({title:s,content:a,type:i,confirmText:t,cancelText:o,onConfirm:()=>{ce(null),d(!0)},onCancel:()=>{ce(null),d(!1)}})})}const k=r.useMemo(()=>C.filter(s=>{var a,i;return!(ee.length>0&&!ee.some(o=>{var d;return s.member===o||((d=ys[o])==null?void 0:d.includes(s.member))})||se==="video"&&!((a=s.notes)!=null&&a.includes("[å½±ç‰‡]"))||se==="paid"&&!s.paid||ae&&!((i=s.caption)!=null&&i.toLowerCase().includes(ae.toLowerCase())))}).sort((s,a)=>new Date(a.date)-new Date(s.date)),[C,ee,se,ae]);r.useEffect(()=>{const s=de.current;if(!s)return;const a=()=>{if(D!=="grid"){me(1);return}const t=Math.min(s.clientWidth,window.innerWidth);if(t<500){me(2);return}me(Math.max(2,Math.floor(t/280)))};a();const i=new ResizeObserver(a);return i.observe(s),()=>i.disconnect()},[D]);const cs=r.useMemo(()=>Math.ceil(k.length/R),[k.length,R]),ge=qs({count:cs,getScrollElement:()=>de.current,estimateSize:()=>D==="grid"?340:120,overscan:3,gap:D==="grid"?16:10});function Oe(){Ue(null),j({member:"å…¨å“¡",date:new Date().toISOString().split("T")[0],time:"",caption:"",media:[],sourceUrl:"",notes:"",paid:!1}),W(!1),q(""),E(!0)}function ds(s){Ue(s),j({member:s.member,date:s.date,time:s.time||"",caption:s.caption||"",media:s.media||[],sourceUrl:s.sourceUrl||"",notes:s.notes||"",paid:s.paid||!1}),W(!1),q(""),E(!0)}function ms(s){L(s),O(0)}function us(){const s=k.findIndex(a=>a.id===(l==null?void 0:l.id));s>0&&(L(k[s-1]),O(0))}function hs(){const s=k.findIndex(a=>a.id===(l==null?void 0:l.id));s<k.length-1&&(L(k[s+1]),O(0))}function fe(){return k.findIndex(s=>s.id===(l==null?void 0:l.id))}function ps(){l&&(ds(l),L(null))}async function gs(){if(!ue.trim())return;const s=ue.split(`
`).map(t=>t.trim()).filter(t=>t&&(t.startsWith("http")||t.startsWith("//")));if(s.length===0){N("è«‹è¼¸å…¥æœ‰æ•ˆçš„ç¶²å€","error");return}const a=s.map((t,o)=>We(t)?{url:t,type:"youtube",thumbnail:ne(t),index:h.media.length+o}:{url:t,type:"image",uploading:!0,originalUrl:t,index:h.media.length+o});j(t=>({...t,media:[...t.media,...a]}));const i=a.filter(t=>t.type==="image");ze(t=>t+i.length);for(const t of i)fs(t.originalUrl,t.index);q(""),W(!1),N(`å·²æ–°å¢ž ${s.length} å€‹åª’é«”`)}async function fs(s,a){try{const i={context:"membership"},[t,o]=await Promise.all([be(s,i),je(s,i).catch(d=>(console.warn("ImgBB å‚™ä»½å¤±æ•—:",d.message),null))]);j(d=>({...d,media:d.media.map((m,f)=>f===a?{...m,url:t,backupUrl:o,uploading:!1}:m)})),o&&console.log(`âœ… åœ–ç‰‡ ${a+1} é›™é‡å‚™ä»½å®Œæˆ`)}catch(i){console.warn(`åœ–ç‰‡ ${a+1} ä¸Šå‚³å¤±æ•—`,i),j(t=>({...t,media:t.media.map((o,d)=>d===a?{...o,uploading:!1,uploadFailed:!0}:o)}))}finally{ze(i=>i-1)}}async function xs(s){const a=Array.from(s.target.files);if(a.length){Te(!0);try{const i=[];for(const t of a){const o={context:"membership"},[d,m]=await Promise.all([be(t,o),je(t,o).catch(f=>(console.warn("ImgBB å‚™ä»½å¤±æ•—:",f.message),null))]);i.push({url:d,type:"image",...m&&{backupUrl:m}})}j(t=>({...t,media:[...t.media,...i]})),N(`å·²æ–°å¢ž ${i.length} å€‹æª”æ¡ˆ`)}catch(i){console.error("ä¸Šå‚³å¤±æ•—",i),N("ä¸Šå‚³å¤±æ•—","error")}finally{Te(!1)}}}const[J,Ve]=r.useState("");function bs(){if(!J.trim())return;if(!We(J)){N("è«‹è¼¸å…¥æœ‰æ•ˆçš„ YouTube é€£çµ","error");return}const s=ne(J);j(a=>({...a,media:[...a.media,{url:J.trim(),type:"youtube",thumbnail:s}]})),Ve(""),N("å·²æ–°å¢ž YouTube å½±ç‰‡")}function js(s){j(a=>({...a,media:a.media.filter((i,t)=>t!==s)}))}async function vs(){if(!h.date||!h.member){N("è«‹å¡«å¯«å¿…è¦æ¬„ä½","error");return}if(h.media.some(i=>i.uploading)&&!await Le({title:"âš ï¸ ä¸Šå‚³æœªå®Œæˆ",type:"warning",confirmText:"ä»è¦å„²å­˜",cancelText:"ç­‰å¾…ä¸Šå‚³",content:e.jsxs("div",{className:"confirm-content",children:[e.jsx("p",{children:"é‚„æœ‰åœ–ç‰‡æ­£åœ¨ä¸Šå‚³ä¸­ï¼Œç¢ºå®šè¦ç¾åœ¨å„²å­˜å—Žï¼Ÿ"}),e.jsx("p",{className:"confirm-warning",children:"æœªå®Œæˆä¸Šå‚³çš„åœ–ç‰‡å¯èƒ½ç„¡æ³•æ­£å¸¸é¡¯ç¤º"})]})}))return;const a={id:(U==null?void 0:U.id)||Ps("mb"),member:h.member,date:h.date,time:h.time,caption:h.caption,media:h.media.map(i=>({url:i.url,type:i.type,...i.backupUrl&&{backupUrl:i.backupUrl},...i.thumbnail&&{thumbnail:i.thumbnail}})),sourceUrl:h.sourceUrl,notes:h.notes,paid:h.paid||!1,createdAt:(U==null?void 0:U.createdAt)||Date.now(),updatedAt:Date.now()};ke(!0);try{U?(await _.update(a),S(C.map(i=>i.id===U.id?a:i))):(await _.create(a),S([a,...C])),N("å·²å„²å­˜"),E(!1)}catch(i){console.error("å„²å­˜å¤±æ•—",i),N("å„²å­˜å¤±æ•—","error")}finally{ke(!1)}}async function Ns(s){if(await Le({title:"ðŸ—‘ï¸ åˆªé™¤ç¢ºèª",type:"danger",confirmText:"åˆªé™¤",cancelText:"å–æ¶ˆ",content:e.jsxs("div",{className:"confirm-content",children:[e.jsx("p",{children:"ç¢ºå®šè¦åˆªé™¤é€™ç­†å‚™ä»½å—Žï¼Ÿ"}),e.jsx("p",{className:"confirm-warning",children:"æ­¤æ“ä½œç„¡æ³•å¾©åŽŸ"})]})}))try{await _.delete(s),S(C.filter(i=>i.id!==s)),N("å·²åˆªé™¤")}catch(i){console.error("åˆªé™¤å¤±æ•—",i),N("åˆªé™¤å¤±æ•—","error")}}return Ke?e.jsxs("div",{className:"archive-page-loading",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"è¼‰å…¥ä¸­..."})]}):e.jsxs("div",{className:"membership-archive archive-page",children:[e.jsxs("header",{className:"archive-header",children:[e.jsx("div",{style:{display:"flex",alignItems:"center",gap:8},children:e.jsx("h1",{children:"ðŸ”’ æœƒå“¡å‚™ä»½"})}),e.jsxs("div",{className:"header-actions",children:[P&&e.jsx("button",{className:"membership-import-btn",onClick:()=>H(!0),title:"å¾ž b.stage åŒ¯å…¥",children:e.jsx(ve,{size:18})}),e.jsx("button",{className:"add-btn",onClick:Oe,title:"æ–°å¢žå‚™ä»½",children:e.jsx(zs,{size:20})}),z&&e.jsx(ws,{currentPage:Q,setCurrentPage:z})]})]}),e.jsxs("div",{className:"archive-filters",children:[e.jsxs("div",{className:"filter-row",children:[e.jsx(ks,{selectedMembers:ee,onChange:Xe,isOpen:Se,onToggle:()=>Je(!Se)}),e.jsxs("select",{value:se,onChange:s=>Qe(s.target.value),className:"filter-select",children:[e.jsx("option",{value:"all",children:"æ‰€æœ‰é¡žåž‹"}),e.jsx("option",{value:"video",children:"ðŸŽ¬ å«å½±ç‰‡"}),e.jsx("option",{value:"paid",children:"ðŸ”’ æœƒå“¡é™å®š"})]}),e.jsxs("div",{className:"search-box",children:[e.jsx(Ds,{size:16}),e.jsx("input",{type:"text",placeholder:"æœå°‹å…§å®¹...",value:ae,onChange:s=>Ze(s.target.value)})]}),e.jsxs("div",{className:"view-toggle",children:[e.jsx("button",{className:D==="grid"?"active":"",onClick:()=>Ie("grid"),children:e.jsx(As,{size:16})}),e.jsx("button",{className:D==="list"?"active":"",onClick:()=>Ie("list"),children:e.jsx(Bs,{size:16})})]})]}),e.jsxs("div",{className:"filter-stats",children:["å…± ",k.length," ç­†å‚™ä»½"]})]}),e.jsx("div",{ref:de,className:"membership-content-scroll",children:k.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx(qe,{size:48}),e.jsx("p",{children:"å°šç„¡æœƒå“¡å‚™ä»½è³‡æ–™"}),e.jsx("button",{onClick:Oe,children:"æ–°å¢žç¬¬ä¸€ç­†"})]}):e.jsx("div",{style:{height:ge.getTotalSize(),position:"relative"},children:ge.getVirtualItems().map(s=>{const a=s.index*R,i=k.slice(a,a+R);return e.jsx("div",{className:`archive-content ${D}`,style:{position:"absolute",top:0,left:0,right:0,transform:`translateY(${s.start}px)`,...D==="grid"?{gridTemplateColumns:`repeat(${R}, 1fr)`}:{}},ref:ge.measureElement,"data-index":s.index,children:i.map(t=>{var o;return e.jsxs("div",{className:"archive-card",onClick:()=>ms(t),children:[e.jsxs("div",{className:"archive-thumb",children:[(()=>{var f,$,p;const d=((f=t.media)==null?void 0:f.find(n=>n.type!=="video"))||(($=t.media)==null?void 0:$[0]),m=(p=t.media)==null?void 0:p.some(n=>n.type==="video");return d?d.type==="youtube"?e.jsxs("div",{className:"video-thumb-img",children:[e.jsx("img",{src:d.thumbnail||ne(d.url),alt:"",loading:"lazy",width:260,height:260}),e.jsx(le,{size:24,className:"play-overlay"})]}):e.jsxs("div",{className:m?"video-thumb-img":"",children:[e.jsx("img",{src:Cs(d),alt:"",loading:"lazy",width:260,height:260}),m&&e.jsx(le,{size:24,className:"play-overlay"})]}):e.jsx("div",{className:"no-thumb",children:e.jsx("img",{src:"/bigbang-timeline/bigbang-default.png",alt:"BIGBANG"})})})(),((o=t.media)==null?void 0:o.length)>1&&e.jsxs("span",{className:"media-count",children:["+",t.media.length-1]}),t.paid&&e.jsx("span",{className:"paid-overlay",children:e.jsx(qe,{size:14})})]}),e.jsxs("div",{className:"archive-info",children:[e.jsxs("div",{className:"archive-meta",children:[e.jsx("span",{className:"member-tag",style:{background:re(t.member)+"30",color:re(t.member)},children:t.member}),e.jsx("span",{className:"date",children:Ss(t.date)})]}),t.caption&&e.jsx("p",{className:"archive-caption",children:pe(t.caption)})]})]},t.id)})},s.key)})})}),l&&e.jsxs("div",{className:"modal-overlay view-modal-overlay",onClick:()=>L(null),children:[e.jsxs("div",{className:"post-nav-indicator",onClick:s=>s.stopPropagation(),children:[fe()+1," / ",k.length]}),e.jsx("button",{className:"post-nav-side prev",onClick:s=>{s.stopPropagation(),us()},disabled:fe()<=0,title:"ä¸Šä¸€å‰‡",children:e.jsx(Es,{size:32})}),e.jsxs("div",{className:"view-modal",onClick:s=>s.stopPropagation(),children:[e.jsx("button",{className:"view-close-btn",onClick:()=>L(null),children:e.jsx(oe,{size:24})}),e.jsx("div",{className:"view-media-area",children:((Ye=l.media)==null?void 0:Ye.length)>0?e.jsxs(e.Fragment,{children:[((Ge=l.media[A])==null?void 0:Ge.type)==="youtube"?e.jsx("iframe",{src:`https://www.youtube.com/embed/${Is(l.media[A].url)}?autoplay=1`,allow:"autoplay; encrypted-media",allowFullScreen:!0,className:"view-media view-youtube"}):((Re=l.media[A])==null?void 0:Re.type)==="video"?e.jsx(Hs,{src:l.media[A].url,className:"view-media"},`${l.id}-${A}`):e.jsx("img",{src:Us(l.media[A]),alt:"",className:"view-media"},`${l.id}-${A}`),l.media.length>1&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"media-nav prev",onClick:()=>O(s=>(s-1+l.media.length)%l.media.length),children:"â€¹"}),e.jsx("button",{className:"media-nav next",onClick:()=>O(s=>(s+1)%l.media.length),children:"â€º"}),e.jsx("div",{className:"media-dots",children:l.media.map((s,a)=>e.jsx("span",{className:`dot ${a===A?"active":""}`,onClick:()=>O(a)},a))})]})]}):e.jsx("div",{className:"no-media",children:e.jsx("img",{src:"/bigbang-timeline/bigbang-default.png",alt:"BIGBANG",className:"no-media-img"})})}),e.jsxs("div",{className:"view-info-area",children:[e.jsxs("div",{className:"view-header",children:[e.jsx("span",{className:"member-tag",style:{background:re(l.member)+"30",color:re(l.member)},children:l.member}),l.paid&&e.jsx("span",{className:"paid-badge",children:"ðŸ”’ æœƒå“¡é™å®š"}),e.jsx("span",{className:"view-date",children:$s(l.date,l.time)})]}),l.caption&&e.jsx("div",{className:"view-caption",children:e.jsx("p",{children:pe(l.caption)})}),P&&l.notes&&e.jsxs("div",{className:"view-notes",children:[e.jsx("strong",{children:"å‚™è¨»ï¼š"}),e.jsx("p",{children:(()=>{var a;const s=((a=Object.values(G).find(i=>{var t;return(t=l.sourceUrl)==null?void 0:t.includes(i.domain)}))==null?void 0:a.mediaPrefix)||"";return l.notes.split(/(https?:\/\/[^\s]+|\/media\/[^\s]+)/g).map((i,t)=>{if(/^https?:\/\//.test(i))return e.jsx("a",{href:i,target:"_blank",rel:"noopener noreferrer",style:{color:"#D4AF37",wordBreak:"break-all"},children:i},t);if(/^\/media\//.test(i)){const o=`https://media.static.bstage.in/${s}${i}`;return e.jsx("a",{href:o,target:"_blank",rel:"noopener noreferrer",style:{color:"#D4AF37",wordBreak:"break-all"},children:i},t)}return i})})()})]}),e.jsxs("div",{className:"view-actions",children:[l.sourceUrl&&e.jsxs("a",{href:l.sourceUrl,target:"_blank",rel:"noopener noreferrer",className:"view-link-btn",children:[e.jsx(Fs,{size:16})," é–‹å•ŸåŽŸæ–‡"]}),e.jsx("button",{className:"view-edit-btn",onClick:ps,children:"âœï¸ ç·¨è¼¯"})]})]})]}),e.jsx("button",{className:"post-nav-side next",onClick:s=>{s.stopPropagation(),hs()},disabled:fe()>=k.length-1,title:"ä¸‹ä¸€å‰‡",children:e.jsx(_s,{size:32})})]}),es&&e.jsx("div",{className:"modal-overlay",onClick:()=>E(!1),children:e.jsxs("div",{className:"archive-modal",onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{children:U?"ç·¨è¼¯å‚™ä»½":"æ–°å¢žå‚™ä»½"}),e.jsx("button",{className:"close-btn",onClick:()=>E(!1),children:e.jsx(oe,{size:20})})]}),e.jsxs("div",{className:"modal-body",children:[e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"æˆå“¡"}),e.jsx("select",{value:h.member,onChange:s=>j(a=>({...a,member:s.target.value})),children:Ts.map(s=>e.jsx("option",{value:s.name,children:s.name},s.name))})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{children:[e.jsx(Ls,{size:14})," ç™¼æ–‡æ—¥æœŸ"]}),e.jsx("input",{type:"date",value:h.date,onChange:s=>j(a=>({...a,date:s.target.value}))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"æ™‚é–“ï¼ˆé¸å¡«ï¼‰"}),e.jsx("input",{type:"time",value:h.time,onChange:s=>j(a=>({...a,time:s.target.value}))})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{children:[e.jsx(He,{size:14})," b.stage åŽŸå§‹é€£çµï¼ˆé¸å¡«ï¼‰"]}),e.jsx("input",{type:"url",placeholder:"è²¼ä¸Š b.stage åŽŸå§‹é€£çµ...",value:h.sourceUrl,onChange:s=>j(a=>({...a,sourceUrl:s.target.value}))})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{children:[e.jsx(Os,{size:14})," åœ–ç‰‡ / YouTube å½±ç‰‡",Pe>0&&e.jsxs("span",{className:"upload-status",children:["ï¼ˆ",Pe," å¼µä¸Šå‚³ä¸­...ï¼‰"]})]}),e.jsxs("div",{className:"media-upload-area",children:[h.media.map((s,a)=>e.jsxs("div",{className:`media-preview ${s.uploading?"uploading":""} ${s.uploadFailed?"failed":""}`,children:[s.type==="youtube"?e.jsxs("div",{className:"video-preview-img",children:[e.jsx("img",{src:s.thumbnail||ne(s.url),alt:""}),e.jsx(le,{size:16,className:"play-icon"})]}):e.jsx("img",{src:s.url,alt:""}),s.uploading&&e.jsx("div",{className:"upload-overlay",children:e.jsx("div",{className:"mini-spinner"})}),s.uploadFailed&&e.jsx("div",{className:"upload-failed-badge",title:"ä¸Šå‚³å¤±æ•—ï¼Œå°‡ä½¿ç”¨åŽŸå§‹é€£çµ",children:"âš ï¸"}),e.jsx("button",{className:"remove-media",onClick:()=>js(a),children:e.jsx(oe,{size:14})})]},a)),e.jsxs("label",{className:"upload-btn",children:[e.jsx("input",{type:"file",accept:"image/*",multiple:!0,onChange:xs,disabled:$e}),$e?e.jsx("span",{className:"uploading-text",children:"ä¸Šå‚³ä¸­..."}):e.jsxs(e.Fragment,{children:[e.jsx(Vs,{size:20}),e.jsx("span",{children:"ä¸Šå‚³åœ–ç‰‡"})]})]}),e.jsxs("button",{type:"button",className:"manual-url-toggle",onClick:()=>W(!Me),children:[e.jsx(He,{size:16}),e.jsx("span",{children:"è²¼ä¸Šç¶²å€"})]})]}),e.jsxs("div",{className:"youtube-input-row",children:[e.jsx("input",{type:"url",placeholder:"è²¼ä¸Š YouTube é€£çµ...",value:J,onChange:s=>Ve(s.target.value)}),e.jsxs("button",{onClick:bs,title:"æ–°å¢ž YouTube å½±ç‰‡",children:[e.jsx(le,{size:16})," æ–°å¢žå½±ç‰‡"]})]}),Me&&e.jsxs("div",{className:"manual-url-input",children:[e.jsx("p",{className:"manual-hint",children:"ðŸ’¡ æç¤ºï¼šæ¯è¡Œè²¼ä¸€å€‹åœ–ç‰‡ç¶²å€ï¼Œæ”¯æ´åœ–ç‰‡å’Œ YouTube é€£çµ"}),e.jsx("textarea",{placeholder:"è²¼ä¸Šåœ–ç‰‡/YouTube ç¶²å€ï¼Œæ¯è¡Œä¸€å€‹...",value:ue,onChange:s=>q(s.target.value),rows:4}),e.jsxs("div",{className:"manual-actions",children:[e.jsx("button",{type:"button",className:"cancel-manual",onClick:()=>{W(!1),q("")},children:"å–æ¶ˆ"}),e.jsx("button",{type:"button",className:"submit-manual",onClick:gs,children:"æ–°å¢žåª’é«”"})]})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"è²¼æ–‡å…§å®¹"}),e.jsx("textarea",{placeholder:"è²¼ä¸Š b.stage è²¼æ–‡å…§å®¹...",value:h.caption,onChange:s=>j(a=>({...a,caption:s.target.value})),rows:4})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"å‚™è¨»ï¼ˆé¸å¡«ï¼‰"}),e.jsx("textarea",{placeholder:"å…¶ä»–å‚™è¨»...",value:h.notes,onChange:s=>j(a=>({...a,notes:s.target.value})),rows:2})]}),e.jsx("div",{className:"form-group paid-checkbox-group",children:e.jsxs("label",{className:"paid-checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:h.paid||!1,onChange:s=>j(a=>({...a,paid:s.target.checked}))}),e.jsx("span",{children:"ðŸ”’ æœƒå“¡é™å®šå…§å®¹"})]})})]}),e.jsxs("div",{className:"modal-footer",children:[U&&e.jsxs("button",{className:"delete-btn",onClick:()=>{Ns(U.id),E(!1)},children:[e.jsx(Ys,{size:16})," åˆªé™¤"]}),e.jsx("button",{className:"cancel-btn",onClick:()=>E(!1),children:"å–æ¶ˆ"}),e.jsxs("button",{className:"save-btn",onClick:vs,disabled:we,children:[e.jsx(Gs,{size:16})," ",we?"å„²å­˜ä¸­...":"å„²å­˜"]})]})]})}),Z&&e.jsxs("div",{className:`toast ${Z.type}`,children:[Z.type==="error"?e.jsx(Rs,{size:16}):e.jsx(Ws,{size:16}),Z.msg]}),M&&e.jsx("div",{className:"confirm-modal-overlay",onClick:M.onCancel,children:e.jsxs("div",{className:`confirm-modal confirm-modal-${M.type}`,onClick:s=>s.stopPropagation(),children:[e.jsx("h3",{className:"confirm-modal-title",children:M.title}),e.jsx("div",{className:"confirm-modal-body",children:M.content}),e.jsxs("div",{className:"confirm-modal-actions",children:[e.jsx("button",{className:"confirm-modal-cancel",onClick:M.onCancel,children:M.cancelText}),e.jsx("button",{className:`confirm-modal-confirm confirm-modal-confirm-${M.type}`,onClick:M.onConfirm,children:M.confirmText})]})]})}),ss&&e.jsx("div",{className:"modal-overlay",onClick:()=>{(!w||w==="done")&&(H(!1),F(null),K(""),X([]))},children:e.jsxs("div",{className:"archive-modal import-modal",onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("h2",{children:[e.jsx(ve,{size:18})," å¾ž b.stage åŒ¯å…¥"]}),e.jsx("button",{className:"close-btn",onClick:()=>{w&&w!=="done"?_e():(H(!1),F(null),K(""),X([]))},children:e.jsx(oe,{size:20})})]}),e.jsxs("div",{className:"modal-body",children:[!w&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"é¸æ“‡ç«™å°"}),e.jsx("select",{className:"import-site-select",value:he,onChange:s=>De(s.target.value),children:Object.entries(G).map(([s,a])=>e.jsx("option",{value:s,children:a.label},s))})]}),e.jsxs("div",{className:"form-group",style:{marginTop:12},children:[e.jsx("label",{children:"Bearer Token"}),e.jsx("textarea",{className:"import-token-input",placeholder:"å¾ž b.stage é–‹ç™¼è€…å·¥å…·è¤‡è£½ Bearer token...",value:te,onChange:s=>K(s.target.value),rows:3}),e.jsxs("p",{className:"import-hint",children:["åœ¨ ",G[he].domain," ç™»å…¥ â†’ F12 é–‹ç™¼è€…å·¥å…· â†’ Network â†’ æ‰¾ä»»æ„ API è«‹æ±‚ â†’ è¤‡è£½ authorization header çš„å€¼",e.jsx("br",{}),"âš ï¸ Token ç´„ 30 åˆ†é˜éŽæœŸï¼Œæ¯å€‹ç«™å°éœ€ä½¿ç”¨å„è‡ªçš„ Token"]})]}),e.jsxs("div",{className:"form-group",style:{marginTop:12,display:"flex",flexDirection:"column",gap:8},children:[e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8,cursor:"pointer"},children:[e.jsx("input",{type:"checkbox",checked:Fe,onChange:s=>as(s.target.checked)}),"å¼·åˆ¶æ›´æ–°å·²å­˜åœ¨çš„è²¼æ–‡ï¼ˆä¸é‡å‚³åœ–ç‰‡ï¼Œåƒ…æ›´æ–°æ–‡å­—/æ—¥æœŸï¼‰"]}),e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8,cursor:"pointer"},children:[e.jsx("input",{type:"checkbox",checked:ie,onChange:s=>ts(s.target.checked)}),"ðŸŽ¬ åªè™•ç†å«å½±ç‰‡çš„è²¼æ–‡ï¼ˆæ›´æ–°å½±ç‰‡é€£çµåˆ°å·²å­˜åœ¨çš„è²¼æ–‡ï¼‰"]})]})]}),w==="fetching"&&e.jsxs("div",{className:"import-progress-section",children:[e.jsx("h3",{children:"ðŸ”„ æŠ“å– b.stage è³‡æ–™ä¸­..."}),e.jsxs("p",{className:"import-progress-text",children:["ç¬¬ ",Ae.page," é ï¼Œå·²æŠ“å– ",Ae.totalItems," ç­†"]}),e.jsx("div",{className:"import-progress-bar",children:e.jsx("div",{className:"import-progress-bar-fill fetching"})})]}),(w==="processing"||w==="done")&&e.jsxs("div",{className:"import-progress-section",children:[e.jsx("h3",{children:w==="done"?"âœ… åŒ¯å…¥å®Œæˆ":"ðŸ“¦ è™•ç†ä¸­..."}),e.jsxs("div",{className:"import-stats",children:[e.jsxs("span",{className:"import-stat success",children:["âœ… ",B.success]}),e.jsxs("span",{className:"import-stat skipped",children:["â­ ",B.skipped]}),e.jsxs("span",{className:"import-stat failed",children:["âŒ ",B.failed]})]}),B.total>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"import-progress-bar",children:e.jsx("div",{className:"import-progress-bar-fill",style:{width:`${B.current/B.total*100}%`}})}),e.jsxs("p",{className:"import-progress-text",children:[B.current," / ",B.total]})]})]}),Ee.length>0&&e.jsx("div",{className:"import-log",children:Ee.map((s,a)=>e.jsx("div",{className:`import-log-line import-log-${s.type}`,children:s.msg},a))})]}),e.jsxs("div",{className:"modal-footer",children:[!w&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"cancel-btn",onClick:()=>{H(!1),K("")},children:"å–æ¶ˆ"}),e.jsxs("button",{className:"save-btn",onClick:os,disabled:!te.trim(),children:[e.jsx(ve,{size:16})," é–‹å§‹åŒ¯å…¥"]})]}),w&&w!=="done"&&e.jsx("button",{className:"cancel-btn",onClick:_e,children:"å–æ¶ˆåŒ¯å…¥"}),w==="done"&&e.jsx("button",{className:"save-btn",onClick:()=>{H(!1),F(null),K(""),X([]),De("gdragon")},children:"é—œé–‰"})]})]})})]})}const ea=r.memo(Ks);export{ea as default};
