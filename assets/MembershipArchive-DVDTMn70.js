import{c as D,j as e,_ as Ts}from"./index-BYKQnq5r.js";import{a as l,D as ye,P as Ps,c as Ms,p as Es,G as As,q as Ds,w as qe,h as oe,l as _s,X as ce,E as zs,m as Bs,f as Ls,v as Xe,I as Fs,U as Rs,T as Os,j as Ys,b as Gs,C as Vs}from"./icons-CLN19_QX.js";import{u as Ks}from"./index-DsAOVHfT.js";import"./vendor-V74KKV6y.js";function Ws({src:r,className:d}){const v=l.useRef(null);return l.useEffect(()=>{const g=v.current;if(!g||!r)return;if(g.canPlayType("application/vnd.apple.mpegurl")){g.src=r;return}let h=null;return Ts(async()=>{const{default:U}=await import("./hls-jw_vZdHi.js");return{default:U}},[]).then(({default:U})=>{if(!U.isSupported()){g.src=r;return}h=new U,h.loadSource(r),h.attachMedia(g)}).catch(()=>{g.src=r}),()=>{h&&h.destroy()}},[r]),e.jsx("video",{ref:v,controls:!0,playsInline:!0,className:d})}const me=[{name:"å…¨å“¡",color:"#E5A500"},{name:"G-Dragon",color:"#ed609f"},{name:"T.O.P",color:"#8fc126"},{name:"å¤ªé™½",color:"#d7171e"},{name:"å¤§è²",color:"#f4e727"}],Qe={å¤§è²:["Daesung"],å¤ªé™½:["Taeyang"]};function de(r){var v,g;const d=Object.entries(Qe).find(([,h])=>h.includes(r));return d?((v=me.find(h=>h.name===d[0]))==null?void 0:v.color)||"#E5A500":((g=me.find(h=>h.name===r))==null?void 0:g.color)||"#E5A500"}function Hs(){return"mb-"+Date.now()}function qs(r){var d;return(d=r.backupUrl)!=null&&d.includes("cloudinary.com/")?r.backupUrl.replace("/upload/","/upload/w_400,q_auto,f_auto/"):r.backupUrl||r.url}function Xs(r){var d;return(d=r.backupUrl)!=null&&d.includes("cloudinary.com/")?r.backupUrl.replace("/upload/","/upload/w_1080,q_auto,f_auto/"):r.backupUrl||r.url}function es(r){if(!r)return"";const d=new Date(r);return`${d.getFullYear()}/${d.getMonth()+1}/${d.getDate()}`}function Js(r,d){const v=es(r);return v?d?`${v} ${d}`:v:""}const W={gdragon:{label:"G-Dragon (gdragon.ai)",domain:"gdragon.ai",mediaPrefix:"gd",authorIds:"67a5e27bc8affa6b2c4b893b%2C677e145d5dba936413e31764",defaultMember:"G-Dragon",authorMap:{"67a5e27bc8affa6b2c4b893b":"G-Dragon","677e145d5dba936413e31764":"G-Dragon"}},daesung:{label:"Daesung (daesung.bstage.in)",domain:"daesung.bstage.in",mediaPrefix:"daesung",authorIds:"64cb4a2654046402f5bde521",defaultMember:"å¤§è²",authorMap:{"64cb4a2654046402f5bde521":"å¤§è²"}},taeyang:{label:"Taeyang (taeyang.bstage.in)",domain:"taeyang.bstage.in",mediaPrefix:"taeyang",authorIds:"67361d0527162e668b09c620",defaultMember:"å¤ªé™½",authorMap:{"67361d0527162e668b09c620":"å¤ªé™½"}}},ss=D.MEMBERSHIP_IMGBB_API_KEY;async function Zs(r){const d=new FormData;d.append("image",r);const g=await(await fetch(`https://api.imgbb.com/1/upload?key=${ss}`,{method:"POST",body:d})).json();if(g.success)return g.data.url;throw new Error("ä¸Šå‚³å¤±æ•—")}async function Je(r){const d=new FormData;d.append("image",r);const g=await(await fetch(`https://api.imgbb.com/1/upload?key=${ss}`,{method:"POST",body:d})).json();if(g.success)return g.data.url;throw new Error("ä¸Šå‚³å¤±æ•—")}async function Ne(r){var g;const d=D.MEMBERSHIP_CLOUDINARY_CLOUD_NAME,v=D.MEMBERSHIP_CLOUDINARY_PRESET;try{const h=new FormData;h.append("file",r),h.append("upload_preset",v);const O=await(await fetch(`https://api.cloudinary.com/v1_1/${d}/image/upload`,{method:"POST",body:h})).json();if(O.secure_url)return console.log("âœ… Cloudinary å‚™ä»½æˆåŠŸ:",O.secure_url),O.secure_url;throw new Error(((g=O.error)==null?void 0:g.message)||"ä¸Šå‚³å¤±æ•—")}catch(h){return console.warn("Cloudinary å‚™ä»½å¤±æ•—:",h.message),null}}function Ze(r){return r?/(?:youtube\.com\/(?:watch|embed|shorts)|youtu\.be\/)/i.test(r):!1}function as(r){if(!r)return null;const d=r.match(/(?:youtube\.com\/(?:watch\?v=|embed\/|shorts\/)|youtu\.be\/)([a-zA-Z0-9_-]{11})/);return d?d[1]:null}function ue(r){const d=as(r);return d?`https://img.youtube.com/vi/${d}/hqdefault.jpg`:null}function Qs({isAdmin:r,onBack:d,currentPage:v,setCurrentPage:g}){var Ke,We,He;const[h,U]=l.useState([]),[O,we]=l.useState(!0),[ke,Ce]=l.useState(!1),[te,Ie]=l.useState(null),[Ue,H]=l.useState(!1),[q,ts]=l.useState("all"),[ne,ns]=l.useState("all"),[ie,is]=l.useState(""),[z,Se]=l.useState("grid"),[rs,F]=l.useState(!1),[M,$e]=l.useState(null),[b,N]=l.useState({member:"å…¨å“¡",date:new Date().toISOString().split("T")[0],time:"",caption:"",media:[],sourceUrl:"",notes:""}),[Te,Pe]=l.useState(!1),[o,Y]=l.useState(null),[B,G]=l.useState(0),[_,he]=l.useState(null),pe=l.useRef(null),[X,fe]=l.useState(()=>window.innerWidth<500?2:Math.max(2,Math.floor(Math.min(900,window.innerWidth)/280))),[Me,J]=l.useState(!1),[ge,Z]=l.useState(""),[Ee,Ae]=l.useState(0),[ls,Q]=l.useState(!1),[re,ee]=l.useState(""),[xe,De]=l.useState("gdragon"),[S,R]=l.useState(null),[_e,ze]=l.useState({page:0,totalItems:0}),[L,V]=l.useState({current:0,total:0,skipped:0,success:0,failed:0}),[Be,se]=l.useState([]),[Le,os]=l.useState(!1),[le,cs]=l.useState(!1),K=l.useRef(!1);l.useEffect(()=>{ds()},[]);async function ds(){we(!0);try{const s=await fetch(`${D.API_URL}/membership`);if(!s.ok)throw new Error("è¼‰å…¥å¤±æ•—");const a=await s.json();U(a)}catch(s){console.error("è¼‰å…¥å¤±æ•—",s),C("è¼‰å…¥å¤±æ•—","error")}finally{we(!1)}}async function Fe(s){const a=await fetch(`${D.API_URL}/membership`,{method:"POST",headers:{"Content-Type":"application/json","X-API-Key":D.API_KEY},body:JSON.stringify(s)});if(!a.ok)throw new Error("å»ºç«‹å¤±æ•—");return a.json()}async function Re(s){const a=await fetch(`${D.API_URL}/membership/${s.id}`,{method:"PUT",headers:{"Content-Type":"application/json","X-API-Key":D.API_KEY},body:JSON.stringify(s)});if(!a.ok)throw new Error("æ›´æ–°å¤±æ•—");return a.json()}async function us(s){const a=await fetch(`${D.API_URL}/membership/${s}`,{method:"DELETE",headers:{"X-API-Key":D.API_KEY}});if(!a.ok)throw new Error("åˆªé™¤å¤±æ•—");return a.json()}function y(s,a="info"){se(n=>[...n,{msg:s,type:a,ts:Date.now()}])}async function ms(s,a){var w;const n=W[a],t=[];let u=1;const m=24;let j=!1;for(;!j&&!K.current;){const E=`https://${n.domain}/svc/home/api/v1/home/star/feeds?authorIds=${n.authorIds}&page=${u}&pageSize=${m}`,p=await fetch(E,{headers:{authorization:`Bearer ${s}`}});if(!p.ok)throw p.status===401?new Error("Token å·²éŽæœŸï¼Œè«‹é‡æ–°ç™»å…¥ b.stage å–å¾—æ–°çš„ Token"):new Error(`API éŒ¯èª¤: ${p.status}`);const i=await p.json();((w=i==null?void 0:i.items)==null?void 0:w.length)>0&&t.push(...i.items),j=(i==null?void 0:i.isLast)??!0,u++,ze({page:u-1,totalItems:t.length}),y(`ç¬¬ ${u-1} é ï¼šå·²æŠ“å– ${t.length} ç­†`,"info"),await new Promise(T=>setTimeout(T,100))}return t}function be(s){if(!s)return s;const a=s.split(`

`);return a.length===2&&a[0].trim()===a[1].trim()?a[0].trim():s}function hs(s,a){var f,I,A;const n=W[a],t=new Date(s.publishedAt||s.createdAt),u=t.toISOString().split("T")[0],m=t.toTimeString().slice(0,5),j=[];if(s.images&&s.images.length>0)for(const c of s.images){const k=typeof c=="string"?c:c.url||c.path||c.source;k&&j.push({originalUrl:k,type:"image"})}else if(s.mainImage){const c=typeof s.mainImage=="string"?s.mainImage:s.mainImage.url||s.mainImage.path;c&&j.push({originalUrl:c,type:"image"})}let w="";if(s.video){const c=s.video.thumbnailPaths||[];for(const x of c){const P=typeof x=="string"?x:x.url||x.path;if(P){j.unshift({originalUrl:P,type:"image"});break}}const k=s.video.id||s.video._id||"";if(k){const x=`https://media.static.bstage.in/${n.mediaPrefix}/media/${k}/hls/ori.m3u8`;j.push({originalUrl:x,type:"video"}),w=`[å½±ç‰‡] ${x}`}else{const x=((f=s.video.hlsPath)==null?void 0:f.path)||((I=s.video.dashPath)==null?void 0:I.path)||"";if(x){let P=x;if(!x.startsWith("http")){const $s=x.startsWith("/")?x.slice(1):x;P=`https://media.static.bstage.in/${n.mediaPrefix}/${$s}`}j.push({originalUrl:P,type:"video"}),w=`[å½±ç‰‡] ${P}`}}}const E=n.authorMap[(A=s.author)==null?void 0:A.id]||n.defaultMember;let p="";const i=(s.title||"").trim(),T=(s.description||"").trim();return i&&T?p=i===T?i:T.includes(i)?T:`${i}

${T}`:p=i||T,{id:`mb-bstage-${s.id}`,member:E,date:u,time:m,caption:p||"",images:j,sourceUrl:`https://${n.domain}/story/feed/${s.typeId||s.id}`,notes:w,bstageId:s.id,paid:s.paid||!1}}async function ps(s){var u,m,j,w,E;R("processing"),V({current:0,total:s.length,skipped:0,success:0,failed:0});let a=h;try{const p=await fetch(`${D.API_URL}/membership`);p.ok&&(a=await p.json(),U(a))}catch(p){console.warn("é‡æ–°è¼‰å…¥è³‡æ–™å¤±æ•—ï¼Œä½¿ç”¨ç¾æœ‰ state åŽ»é‡",p)}const n=new Set(a.map(p=>p.id)),t=new Set(a.map(p=>p.sourceUrl).filter(Boolean));for(let p=0;p<s.length&&!K.current;p++){const i=s[p],T=(u=i.images)==null?void 0:u.some(f=>f.type==="video");if(le&&!T){V(f=>({...f,current:f.current+1,skipped:f.skipped+1})),y(`â­ è·³éŽï¼ˆéžå½±ç‰‡ï¼‰: ${i.date} ${((m=i.caption)==null?void 0:m.slice(0,30))||"(ç„¡æ–‡å­—)"}`,"info");continue}if(n.has(i.id)||t.has(i.sourceUrl)){if(Le||le){const f=n.has(i.id)?i.id:null,I=a.find(A=>A.id===f||A.sourceUrl===i.sourceUrl);if(I){const A=be(i.caption),c={...I,caption:A,date:i.date,time:i.time,updatedAt:Date.now()};if(le&&T){const k=(I.media||[]).filter(P=>P.type!=="video"),x=i.images.filter(P=>P.type==="video").map(P=>({url:P.originalUrl,type:"video"}));c.media=[...k,...x],c.notes=i.notes||I.notes}await Re(c).catch(k=>console.warn("æ›´æ–°å¤±æ•—:",k)),U(k=>k.map(x=>x.id===c.id?c:x)),y(`ðŸ”„ å·²æ›´æ–°${T?"ï¼ˆå«å½±ç‰‡ï¼‰":""}: ${i.date} ${(A==null?void 0:A.slice(0,30))||"(ç„¡æ–‡å­—)"}`,"info")}}else y(`â­ è·³éŽï¼ˆå·²å­˜åœ¨ï¼‰: ${i.date} ${((j=i.caption)==null?void 0:j.slice(0,30))||"(ç„¡æ–‡å­—)"}`,"info");V(f=>({...f,current:f.current+1,skipped:f.skipped+1}));continue}try{const f=[];for(const c of i.images){if(c.type==="video"){f.push({url:c.originalUrl,type:"video"});continue}try{const[k,x]=await Promise.all([Je(c.originalUrl),Ne(c.originalUrl)]);f.push({url:k,type:c.type,...x&&{backupUrl:x}})}catch(k){console.warn("åœ–ç‰‡ä¸Šå‚³å¤±æ•—ï¼Œä½¿ç”¨åŽŸå§‹ URL:",k),f.push({url:c.originalUrl,type:c.type}),y("âš  åœ–ç‰‡å‚™ä»½å¤±æ•—ï¼Œä½¿ç”¨åŽŸå§‹é€£çµ","warn")}}const I={id:i.id,member:i.member,date:i.date,time:i.time,caption:i.caption,media:f,sourceUrl:i.sourceUrl,notes:i.notes,paid:i.paid||!1,createdAt:Date.now(),updatedAt:Date.now()};(await Fe(I)).skipped?(V(c=>({...c,current:c.current+1,skipped:c.skipped+1})),y(`â­ è·³éŽï¼ˆD1 å·²å­˜åœ¨ï¼‰: ${i.date} ${((w=i.caption)==null?void 0:w.slice(0,30))||"(ç„¡æ–‡å­—)"}`,"info")):(U(c=>[I,...c]),n.add(i.id),t.add(i.sourceUrl),V(c=>({...c,current:c.current+1,success:c.success+1})),y(`âœ… ${i.date} ${((E=i.caption)==null?void 0:E.slice(0,40))||"(ç„¡æ–‡å­—)"}`,"success"))}catch(f){console.error(`åŒ¯å…¥å¤±æ•—: ${i.id}`,f),V(I=>({...I,current:I.current+1,failed:I.failed+1})),y(`âŒ å¤±æ•—: ${i.date} - ${f.message}`,"error")}await new Promise(f=>setTimeout(f,50))}}async function fs(){if(!re.trim()){C("è«‹è¼¸å…¥ b.stage Token","error");return}let s=re.trim();s.toLowerCase().startsWith("bearer ")&&(s=s.slice(7));const a=xe,n=W[a].label;K.current=!1,se([]),R("fetching"),ze({page:0,totalItems:0}),y(`é–‹å§‹å¾ž ${n} æŠ“å–è³‡æ–™...`,"info");try{const t=await ms(s,a);if(K.current){R("done"),y("å·²å–æ¶ˆåŒ¯å…¥","warn");return}y(`âœ… æŠ“å–å®Œæˆï¼šå…± ${t.length} ç­†è²¼æ–‡`,"success");const u=t.map(j=>hs(j,a)),m=u.filter(j=>{var w;return(w=j.images)==null?void 0:w.some(E=>E.type==="video")}).length;m>0&&y(`ðŸŽ¬ å…¶ä¸­ ${m} ç­†å«å½±ç‰‡`,"info"),await ps(u),K.current?y("å·²å–æ¶ˆåŒ¯å…¥","warn"):y("ðŸŽ‰ åŒ¯å…¥å®Œæˆï¼","success")}catch(t){y(`âŒ éŒ¯èª¤: ${t.message}`,"error"),C(t.message,"error")}finally{R("done")}}function Oe(){K.current=!0,y("æ­£åœ¨å–æ¶ˆ...","warn")}function C(s,a="success"){Ie({msg:s,type:a}),setTimeout(()=>Ie(null),2500)}function Ye({title:s,content:a,type:n="warning",confirmText:t="ç¢ºå®š",cancelText:u="å–æ¶ˆ"}){return new Promise(m=>{he({title:s,content:a,type:n,confirmText:t,cancelText:u,onConfirm:()=>{he(null),m(!0)},onCancel:()=>{he(null),m(!1)}})})}const $=l.useMemo(()=>h.filter(s=>{var a,n,t;return!(q!=="all"&&s.member!==q&&!((a=Qe[q])!=null&&a.includes(s.member))||ne==="video"&&!((n=s.notes)!=null&&n.includes("[å½±ç‰‡]"))||ne==="paid"&&!s.paid||ie&&!((t=s.caption)!=null&&t.toLowerCase().includes(ie.toLowerCase())))}).sort((s,a)=>new Date(a.date)-new Date(s.date)),[h,q,ne,ie]);l.useEffect(()=>{const s=pe.current;if(!s)return;const a=()=>{if(z!=="grid"){fe(1);return}const t=Math.min(s.clientWidth,window.innerWidth);if(t<500){fe(2);return}fe(Math.max(2,Math.floor(t/280)))};a();const n=new ResizeObserver(a);return n.observe(s),()=>n.disconnect()},[z]);const gs=l.useMemo(()=>Math.ceil($.length/X),[$.length,X]),je=Ks({count:gs,getScrollElement:()=>pe.current,estimateSize:()=>z==="grid"?340:120,overscan:3,gap:z==="grid"?16:10});function Ge(){$e(null),N({member:"å…¨å“¡",date:new Date().toISOString().split("T")[0],time:"",caption:"",media:[],sourceUrl:"",notes:"",paid:!1}),J(!1),Z(""),F(!0)}function xs(s){$e(s),N({member:s.member,date:s.date,time:s.time||"",caption:s.caption||"",media:s.media||[],sourceUrl:s.sourceUrl||"",notes:s.notes||"",paid:s.paid||!1}),J(!1),Z(""),F(!0)}function bs(s){Y(s),G(0)}function js(){const s=$.findIndex(a=>a.id===(o==null?void 0:o.id));s>0&&(Y($[s-1]),G(0))}function vs(){const s=$.findIndex(a=>a.id===(o==null?void 0:o.id));s<$.length-1&&(Y($[s+1]),G(0))}function ve(){return $.findIndex(s=>s.id===(o==null?void 0:o.id))}function ys(){o&&(xs(o),Y(null))}async function Ns(){if(!ge.trim())return;const s=ge.split(`
`).map(t=>t.trim()).filter(t=>t&&(t.startsWith("http")||t.startsWith("//")));if(s.length===0){C("è«‹è¼¸å…¥æœ‰æ•ˆçš„ç¶²å€","error");return}const a=s.map((t,u)=>Ze(t)?{url:t,type:"youtube",thumbnail:ue(t),index:b.media.length+u}:{url:t,type:"image",uploading:!0,originalUrl:t,index:b.media.length+u});N(t=>({...t,media:[...t.media,...a]}));const n=a.filter(t=>t.type==="image");Ae(t=>t+n.length);for(const t of n)ws(t.originalUrl,t.index);Z(""),J(!1),C(`å·²æ–°å¢ž ${s.length} å€‹åª’é«”`)}async function ws(s,a){try{const[n,t]=await Promise.all([Je(s),Ne(s)]);N(u=>({...u,media:u.media.map((m,j)=>j===a?{...m,url:n,backupUrl:t,uploading:!1}:m)})),t&&console.log(`âœ… åœ–ç‰‡ ${a+1} é›™é‡å‚™ä»½å®Œæˆ`)}catch(n){console.warn(`åœ–ç‰‡ ${a+1} ä¸Šå‚³å¤±æ•—`,n),N(t=>({...t,media:t.media.map((u,m)=>m===a?{...u,uploading:!1,uploadFailed:!0}:u)}))}finally{Ae(n=>n-1)}}async function ks(s){const a=Array.from(s.target.files);if(a.length){Pe(!0);try{const n=[];for(const t of a){const[u,m]=await Promise.all([Zs(t),Ne(URL.createObjectURL(t))]);n.push({url:u,type:"image",...m&&{backupUrl:m}})}N(t=>({...t,media:[...t.media,...n]})),C(`å·²æ–°å¢ž ${n.length} å€‹æª”æ¡ˆ`)}catch(n){console.error("ä¸Šå‚³å¤±æ•—",n),C("ä¸Šå‚³å¤±æ•—","error")}finally{Pe(!1)}}}const[ae,Ve]=l.useState("");function Cs(){if(!ae.trim())return;if(!Ze(ae)){C("è«‹è¼¸å…¥æœ‰æ•ˆçš„ YouTube é€£çµ","error");return}const s=ue(ae);N(a=>({...a,media:[...a.media,{url:ae.trim(),type:"youtube",thumbnail:s}]})),Ve(""),C("å·²æ–°å¢ž YouTube å½±ç‰‡")}function Is(s){N(a=>({...a,media:a.media.filter((n,t)=>t!==s)}))}async function Us(){if(!b.date||!b.member){C("è«‹å¡«å¯«å¿…è¦æ¬„ä½","error");return}if(b.media.some(n=>n.uploading)&&!await Ye({title:"âš ï¸ ä¸Šå‚³æœªå®Œæˆ",type:"warning",confirmText:"ä»è¦å„²å­˜",cancelText:"ç­‰å¾…ä¸Šå‚³",content:e.jsxs("div",{className:"confirm-content",children:[e.jsx("p",{children:"é‚„æœ‰åœ–ç‰‡æ­£åœ¨ä¸Šå‚³ä¸­ï¼Œç¢ºå®šè¦ç¾åœ¨å„²å­˜å—Žï¼Ÿ"}),e.jsx("p",{className:"confirm-warning",children:"æœªå®Œæˆä¸Šå‚³çš„åœ–ç‰‡å¯èƒ½ç„¡æ³•æ­£å¸¸é¡¯ç¤º"})]})}))return;const a={id:(M==null?void 0:M.id)||Hs(),member:b.member,date:b.date,time:b.time,caption:b.caption,media:b.media.map(n=>({url:n.url,type:n.type,...n.backupUrl&&{backupUrl:n.backupUrl},...n.thumbnail&&{thumbnail:n.thumbnail}})),sourceUrl:b.sourceUrl,notes:b.notes,paid:b.paid||!1,createdAt:(M==null?void 0:M.createdAt)||Date.now(),updatedAt:Date.now()};Ce(!0);try{M?(await Re(a),U(h.map(n=>n.id===M.id?a:n))):(await Fe(a),U([a,...h])),C("å·²å„²å­˜"),F(!1)}catch(n){console.error("å„²å­˜å¤±æ•—",n),C("å„²å­˜å¤±æ•—","error")}finally{Ce(!1)}}async function Ss(s){if(await Ye({title:"ðŸ—‘ï¸ åˆªé™¤ç¢ºèª",type:"danger",confirmText:"åˆªé™¤",cancelText:"å–æ¶ˆ",content:e.jsxs("div",{className:"confirm-content",children:[e.jsx("p",{children:"ç¢ºå®šè¦åˆªé™¤é€™ç­†å‚™ä»½å—Žï¼Ÿ"}),e.jsx("p",{className:"confirm-warning",children:"æ­¤æ“ä½œç„¡æ³•å¾©åŽŸ"})]})}))try{await us(s),U(h.filter(n=>n.id!==s)),C("å·²åˆªé™¤")}catch(n){console.error("åˆªé™¤å¤±æ•—",n),C("åˆªé™¤å¤±æ•—","error")}}return O?e.jsxs("div",{className:"membership-loading",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"è¼‰å…¥ä¸­..."})]}):e.jsxs("div",{className:"membership-archive",children:[e.jsxs("header",{className:"membership-header",children:[e.jsx("div",{style:{display:"flex",alignItems:"center",gap:8},children:e.jsx("h1",{children:"ðŸ”’ æœƒå“¡å‚™ä»½"})}),e.jsxs("div",{className:"header-actions",children:[r&&e.jsx("button",{className:"membership-import-btn",onClick:()=>Q(!0),title:"å¾ž b.stage åŒ¯å…¥",children:e.jsx(ye,{size:18})}),e.jsx("button",{className:"add-btn",onClick:Ge,title:"æ–°å¢žå‚™ä»½",children:e.jsx(Ps,{size:20})}),g&&e.jsxs("div",{className:"nav-menu-wrapper",children:[e.jsx("button",{onClick:()=>H(!Ue),className:"hamburger-btn",title:"é¸å–®",children:e.jsx(Ms,{size:18})}),Ue&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"nav-menu-overlay",onClick:()=>H(!1)}),e.jsxs("div",{className:"nav-menu",children:[e.jsxs("button",{className:`nav-menu-item ${v==="timeline"?"active":""}`,onClick:()=>{g("timeline"),H(!1)},children:[e.jsx("span",{children:"ðŸ“…"})," æ™‚é–“è»¸"]}),e.jsxs("button",{className:`nav-menu-item ${v==="social"?"active":""}`,onClick:()=>{g("social"),H(!1)},children:[e.jsx("span",{children:"ðŸ“·"})," ç¤¾ç¾¤å‚™ä»½"]}),e.jsxs("button",{className:`nav-menu-item ${v==="membership"?"active":""}`,onClick:()=>{g("membership"),H(!1)},children:[e.jsx("span",{children:"ðŸ”’"})," æœƒå“¡å‚™ä»½"]})]})]})]})]})]}),e.jsxs("div",{className:"membership-filters",children:[e.jsxs("div",{className:"filter-row",children:[e.jsxs("select",{value:q,onChange:s=>ts(s.target.value),className:"filter-select",children:[e.jsx("option",{value:"all",children:"æ‰€æœ‰æˆå“¡"}),me.map(s=>e.jsx("option",{value:s.name,children:s.name},s.name))]}),e.jsxs("select",{value:ne,onChange:s=>ns(s.target.value),className:"filter-select",children:[e.jsx("option",{value:"all",children:"æ‰€æœ‰é¡žåž‹"}),e.jsx("option",{value:"video",children:"ðŸŽ¬ å«å½±ç‰‡"}),e.jsx("option",{value:"paid",children:"ðŸ”’ æœƒå“¡é™å®š"})]}),e.jsxs("div",{className:"search-box",children:[e.jsx(Es,{size:16}),e.jsx("input",{type:"text",placeholder:"æœå°‹å…§å®¹...",value:ie,onChange:s=>is(s.target.value)})]}),e.jsxs("div",{className:"view-toggle",children:[e.jsx("button",{className:z==="grid"?"active":"",onClick:()=>Se("grid"),children:e.jsx(As,{size:16})}),e.jsx("button",{className:z==="list"?"active":"",onClick:()=>Se("list"),children:e.jsx(Ds,{size:16})})]})]}),e.jsxs("div",{className:"filter-stats",children:["å…± ",$.length," ç­†å‚™ä»½"]})]}),e.jsx("div",{ref:pe,className:"membership-content-scroll",children:$.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx(qe,{size:48}),e.jsx("p",{children:"å°šç„¡æœƒå“¡å‚™ä»½è³‡æ–™"}),e.jsx("button",{onClick:Ge,children:"æ–°å¢žç¬¬ä¸€ç­†"})]}):e.jsx("div",{style:{height:je.getTotalSize(),position:"relative"},children:je.getVirtualItems().map(s=>{const a=s.index*X,n=$.slice(a,a+X);return e.jsx("div",{className:`membership-content ${z}`,style:{position:"absolute",top:0,left:0,right:0,transform:`translateY(${s.start}px)`,...z==="grid"?{gridTemplateColumns:`repeat(${X}, 1fr)`}:{}},ref:je.measureElement,"data-index":s.index,children:n.map(t=>{var u;return e.jsxs("div",{className:"archive-card",onClick:()=>bs(t),children:[e.jsxs("div",{className:"archive-thumb",children:[(()=>{var w,E,p;const m=((w=t.media)==null?void 0:w.find(i=>i.type!=="video"))||((E=t.media)==null?void 0:E[0]),j=(p=t.media)==null?void 0:p.some(i=>i.type==="video");return m?m.type==="youtube"?e.jsxs("div",{className:"video-thumb-img",children:[e.jsx("img",{src:m.thumbnail||ue(m.url),alt:"",loading:"lazy",width:260,height:260}),e.jsx(oe,{size:24,className:"play-overlay"})]}):e.jsxs("div",{className:j?"video-thumb-img":"",children:[e.jsx("img",{src:qs(m),alt:"",loading:"lazy",width:260,height:260}),j&&e.jsx(oe,{size:24,className:"play-overlay"})]}):e.jsx("div",{className:"no-thumb",children:e.jsx("img",{src:"/bigbang-timeline/bigbang-default.png",alt:"BIGBANG"})})})(),((u=t.media)==null?void 0:u.length)>1&&e.jsxs("span",{className:"media-count",children:["+",t.media.length-1]}),t.paid&&e.jsx("span",{className:"paid-overlay",children:e.jsx(qe,{size:14})})]}),e.jsxs("div",{className:"archive-info",children:[e.jsxs("div",{className:"archive-meta",children:[e.jsx("span",{className:"member-tag",style:{background:de(t.member)+"30",color:de(t.member)},children:t.member}),e.jsx("span",{className:"date",children:es(t.date)})]}),t.caption&&e.jsx("p",{className:"archive-caption",children:be(t.caption)})]})]},t.id)})},s.key)})})}),o&&e.jsxs("div",{className:"modal-overlay view-modal-overlay",onClick:()=>Y(null),children:[e.jsxs("div",{className:"post-nav-indicator",onClick:s=>s.stopPropagation(),children:[ve()+1," / ",$.length]}),e.jsx("button",{className:"post-nav-side prev",onClick:s=>{s.stopPropagation(),js()},disabled:ve()<=0,title:"ä¸Šä¸€å‰‡",children:e.jsx(_s,{size:32})}),e.jsxs("div",{className:"view-modal",onClick:s=>s.stopPropagation(),children:[e.jsx("button",{className:"view-close-btn",onClick:()=>Y(null),children:e.jsx(ce,{size:24})}),e.jsx("div",{className:"view-media-area",children:((Ke=o.media)==null?void 0:Ke.length)>0?e.jsxs(e.Fragment,{children:[((We=o.media[B])==null?void 0:We.type)==="youtube"?e.jsx("iframe",{src:`https://www.youtube.com/embed/${as(o.media[B].url)}?autoplay=1`,allow:"autoplay; encrypted-media",allowFullScreen:!0,className:"view-media view-youtube"}):((He=o.media[B])==null?void 0:He.type)==="video"?e.jsx(Ws,{src:o.media[B].url,className:"view-media"},`${o.id}-${B}`):e.jsx("img",{src:Xs(o.media[B]),alt:"",className:"view-media"},`${o.id}-${B}`),o.media.length>1&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"media-nav prev",onClick:()=>G(s=>(s-1+o.media.length)%o.media.length),children:"â€¹"}),e.jsx("button",{className:"media-nav next",onClick:()=>G(s=>(s+1)%o.media.length),children:"â€º"}),e.jsx("div",{className:"media-dots",children:o.media.map((s,a)=>e.jsx("span",{className:`dot ${a===B?"active":""}`,onClick:()=>G(a)},a))})]})]}):e.jsx("div",{className:"no-media",children:e.jsx("img",{src:"/bigbang-timeline/bigbang-default.png",alt:"BIGBANG",className:"no-media-img"})})}),e.jsxs("div",{className:"view-info-area",children:[e.jsxs("div",{className:"view-header",children:[e.jsx("span",{className:"member-tag",style:{background:de(o.member)+"30",color:de(o.member)},children:o.member}),o.paid&&e.jsx("span",{className:"paid-badge",children:"ðŸ”’ æœƒå“¡é™å®š"}),e.jsx("span",{className:"view-date",children:Js(o.date,o.time)})]}),o.caption&&e.jsx("div",{className:"view-caption",children:e.jsx("p",{children:be(o.caption)})}),r&&o.notes&&e.jsxs("div",{className:"view-notes",children:[e.jsx("strong",{children:"å‚™è¨»ï¼š"}),e.jsx("p",{children:(()=>{var a;const s=((a=Object.values(W).find(n=>{var t;return(t=o.sourceUrl)==null?void 0:t.includes(n.domain)}))==null?void 0:a.mediaPrefix)||"";return o.notes.split(/(https?:\/\/[^\s]+|\/media\/[^\s]+)/g).map((n,t)=>{if(/^https?:\/\//.test(n))return e.jsx("a",{href:n,target:"_blank",rel:"noopener noreferrer",style:{color:"#D4AF37",wordBreak:"break-all"},children:n},t);if(/^\/media\//.test(n)){const u=`https://media.static.bstage.in/${s}${n}`;return e.jsx("a",{href:u,target:"_blank",rel:"noopener noreferrer",style:{color:"#D4AF37",wordBreak:"break-all"},children:n},t)}return n})})()})]}),e.jsxs("div",{className:"view-actions",children:[o.sourceUrl&&e.jsxs("a",{href:o.sourceUrl,target:"_blank",rel:"noopener noreferrer",className:"view-link-btn",children:[e.jsx(zs,{size:16})," é–‹å•ŸåŽŸæ–‡"]}),e.jsx("button",{className:"view-edit-btn",onClick:ys,children:"âœï¸ ç·¨è¼¯"})]})]})]}),e.jsx("button",{className:"post-nav-side next",onClick:s=>{s.stopPropagation(),vs()},disabled:ve()>=$.length-1,title:"ä¸‹ä¸€å‰‡",children:e.jsx(Bs,{size:32})})]}),rs&&e.jsx("div",{className:"modal-overlay",onClick:()=>F(!1),children:e.jsxs("div",{className:"membership-modal",onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{children:M?"ç·¨è¼¯å‚™ä»½":"æ–°å¢žå‚™ä»½"}),e.jsx("button",{className:"close-btn",onClick:()=>F(!1),children:e.jsx(ce,{size:20})})]}),e.jsxs("div",{className:"modal-body",children:[e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"æˆå“¡"}),e.jsx("select",{value:b.member,onChange:s=>N(a=>({...a,member:s.target.value})),children:me.map(s=>e.jsx("option",{value:s.name,children:s.name},s.name))})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{children:[e.jsx(Ls,{size:14})," ç™¼æ–‡æ—¥æœŸ"]}),e.jsx("input",{type:"date",value:b.date,onChange:s=>N(a=>({...a,date:s.target.value}))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"æ™‚é–“ï¼ˆé¸å¡«ï¼‰"}),e.jsx("input",{type:"time",value:b.time,onChange:s=>N(a=>({...a,time:s.target.value}))})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{children:[e.jsx(Xe,{size:14})," b.stage åŽŸå§‹é€£çµï¼ˆé¸å¡«ï¼‰"]}),e.jsx("input",{type:"url",placeholder:"è²¼ä¸Š b.stage åŽŸå§‹é€£çµ...",value:b.sourceUrl,onChange:s=>N(a=>({...a,sourceUrl:s.target.value}))})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{children:[e.jsx(Fs,{size:14})," åœ–ç‰‡ / YouTube å½±ç‰‡",Ee>0&&e.jsxs("span",{className:"upload-status",children:["ï¼ˆ",Ee," å¼µä¸Šå‚³ä¸­...ï¼‰"]})]}),e.jsxs("div",{className:"media-upload-area",children:[b.media.map((s,a)=>e.jsxs("div",{className:`media-preview ${s.uploading?"uploading":""} ${s.uploadFailed?"failed":""}`,children:[s.type==="youtube"?e.jsxs("div",{className:"video-preview-img",children:[e.jsx("img",{src:s.thumbnail||ue(s.url),alt:""}),e.jsx(oe,{size:16,className:"play-icon"})]}):e.jsx("img",{src:s.url,alt:""}),s.uploading&&e.jsx("div",{className:"upload-overlay",children:e.jsx("div",{className:"mini-spinner"})}),s.uploadFailed&&e.jsx("div",{className:"upload-failed-badge",title:"ä¸Šå‚³å¤±æ•—ï¼Œå°‡ä½¿ç”¨åŽŸå§‹é€£çµ",children:"âš ï¸"}),e.jsx("button",{className:"remove-media",onClick:()=>Is(a),children:e.jsx(ce,{size:14})})]},a)),e.jsxs("label",{className:"upload-btn",children:[e.jsx("input",{type:"file",accept:"image/*",multiple:!0,onChange:ks,disabled:Te}),Te?e.jsx("span",{className:"uploading-text",children:"ä¸Šå‚³ä¸­..."}):e.jsxs(e.Fragment,{children:[e.jsx(Rs,{size:20}),e.jsx("span",{children:"ä¸Šå‚³åœ–ç‰‡"})]})]}),e.jsxs("button",{type:"button",className:"manual-url-toggle",onClick:()=>J(!Me),children:[e.jsx(Xe,{size:16}),e.jsx("span",{children:"è²¼ä¸Šç¶²å€"})]})]}),e.jsxs("div",{className:"youtube-input-row",children:[e.jsx("input",{type:"url",placeholder:"è²¼ä¸Š YouTube é€£çµ...",value:ae,onChange:s=>Ve(s.target.value)}),e.jsxs("button",{onClick:Cs,title:"æ–°å¢ž YouTube å½±ç‰‡",children:[e.jsx(oe,{size:16})," æ–°å¢žå½±ç‰‡"]})]}),Me&&e.jsxs("div",{className:"manual-url-input",children:[e.jsx("p",{className:"manual-hint",children:"ðŸ’¡ æç¤ºï¼šæ¯è¡Œè²¼ä¸€å€‹åœ–ç‰‡ç¶²å€ï¼Œæ”¯æ´åœ–ç‰‡å’Œ YouTube é€£çµ"}),e.jsx("textarea",{placeholder:"è²¼ä¸Šåœ–ç‰‡/YouTube ç¶²å€ï¼Œæ¯è¡Œä¸€å€‹...",value:ge,onChange:s=>Z(s.target.value),rows:4}),e.jsxs("div",{className:"manual-actions",children:[e.jsx("button",{type:"button",className:"cancel-manual",onClick:()=>{J(!1),Z("")},children:"å–æ¶ˆ"}),e.jsx("button",{type:"button",className:"submit-manual",onClick:Ns,children:"æ–°å¢žåª’é«”"})]})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"è²¼æ–‡å…§å®¹"}),e.jsx("textarea",{placeholder:"è²¼ä¸Š b.stage è²¼æ–‡å…§å®¹...",value:b.caption,onChange:s=>N(a=>({...a,caption:s.target.value})),rows:4})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"å‚™è¨»ï¼ˆé¸å¡«ï¼‰"}),e.jsx("textarea",{placeholder:"å…¶ä»–å‚™è¨»...",value:b.notes,onChange:s=>N(a=>({...a,notes:s.target.value})),rows:2})]}),e.jsx("div",{className:"form-group paid-checkbox-group",children:e.jsxs("label",{className:"paid-checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:b.paid||!1,onChange:s=>N(a=>({...a,paid:s.target.checked}))}),e.jsx("span",{children:"ðŸ”’ æœƒå“¡é™å®šå…§å®¹"})]})})]}),e.jsxs("div",{className:"modal-footer",children:[M&&e.jsxs("button",{className:"delete-btn",onClick:()=>{Ss(M.id),F(!1)},children:[e.jsx(Os,{size:16})," åˆªé™¤"]}),e.jsx("button",{className:"cancel-btn",onClick:()=>F(!1),children:"å–æ¶ˆ"}),e.jsxs("button",{className:"save-btn",onClick:Us,disabled:ke,children:[e.jsx(Ys,{size:16})," ",ke?"å„²å­˜ä¸­...":"å„²å­˜"]})]})]})}),te&&e.jsxs("div",{className:`toast ${te.type}`,children:[te.type==="error"?e.jsx(Gs,{size:16}):e.jsx(Vs,{size:16}),te.msg]}),_&&e.jsx("div",{className:"confirm-modal-overlay",onClick:_.onCancel,children:e.jsxs("div",{className:`confirm-modal confirm-modal-${_.type}`,onClick:s=>s.stopPropagation(),children:[e.jsx("h3",{className:"confirm-modal-title",children:_.title}),e.jsx("div",{className:"confirm-modal-body",children:_.content}),e.jsxs("div",{className:"confirm-modal-actions",children:[e.jsx("button",{className:"confirm-modal-cancel",onClick:_.onCancel,children:_.cancelText}),e.jsx("button",{className:`confirm-modal-confirm confirm-modal-confirm-${_.type}`,onClick:_.onConfirm,children:_.confirmText})]})]})}),ls&&e.jsx("div",{className:"modal-overlay",onClick:()=>{(!S||S==="done")&&(Q(!1),R(null),ee(""),se([]))},children:e.jsxs("div",{className:"membership-modal import-modal",onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("h2",{children:[e.jsx(ye,{size:18})," å¾ž b.stage åŒ¯å…¥"]}),e.jsx("button",{className:"close-btn",onClick:()=>{S&&S!=="done"?Oe():(Q(!1),R(null),ee(""),se([]))},children:e.jsx(ce,{size:20})})]}),e.jsxs("div",{className:"modal-body",children:[!S&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"é¸æ“‡ç«™å°"}),e.jsx("select",{className:"import-site-select",value:xe,onChange:s=>De(s.target.value),children:Object.entries(W).map(([s,a])=>e.jsx("option",{value:s,children:a.label},s))})]}),e.jsxs("div",{className:"form-group",style:{marginTop:12},children:[e.jsx("label",{children:"Bearer Token"}),e.jsx("textarea",{className:"import-token-input",placeholder:"å¾ž b.stage é–‹ç™¼è€…å·¥å…·è¤‡è£½ Bearer token...",value:re,onChange:s=>ee(s.target.value),rows:3}),e.jsxs("p",{className:"import-hint",children:["åœ¨ ",W[xe].domain," ç™»å…¥ â†’ F12 é–‹ç™¼è€…å·¥å…· â†’ Network â†’ æ‰¾ä»»æ„ API è«‹æ±‚ â†’ è¤‡è£½ authorization header çš„å€¼",e.jsx("br",{}),"âš ï¸ Token ç´„ 30 åˆ†é˜éŽæœŸï¼Œæ¯å€‹ç«™å°éœ€ä½¿ç”¨å„è‡ªçš„ Token"]})]}),e.jsxs("div",{className:"form-group",style:{marginTop:12,display:"flex",flexDirection:"column",gap:8},children:[e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8,cursor:"pointer"},children:[e.jsx("input",{type:"checkbox",checked:Le,onChange:s=>os(s.target.checked)}),"å¼·åˆ¶æ›´æ–°å·²å­˜åœ¨çš„è²¼æ–‡ï¼ˆä¸é‡å‚³åœ–ç‰‡ï¼Œåƒ…æ›´æ–°æ–‡å­—/æ—¥æœŸï¼‰"]}),e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8,cursor:"pointer"},children:[e.jsx("input",{type:"checkbox",checked:le,onChange:s=>cs(s.target.checked)}),"ðŸŽ¬ åªè™•ç†å«å½±ç‰‡çš„è²¼æ–‡ï¼ˆæ›´æ–°å½±ç‰‡é€£çµåˆ°å·²å­˜åœ¨çš„è²¼æ–‡ï¼‰"]})]})]}),S==="fetching"&&e.jsxs("div",{className:"import-progress-section",children:[e.jsx("h3",{children:"ðŸ”„ æŠ“å– b.stage è³‡æ–™ä¸­..."}),e.jsxs("p",{className:"import-progress-text",children:["ç¬¬ ",_e.page," é ï¼Œå·²æŠ“å– ",_e.totalItems," ç­†"]}),e.jsx("div",{className:"import-progress-bar",children:e.jsx("div",{className:"import-progress-bar-fill fetching"})})]}),(S==="processing"||S==="done")&&e.jsxs("div",{className:"import-progress-section",children:[e.jsx("h3",{children:S==="done"?"âœ… åŒ¯å…¥å®Œæˆ":"ðŸ“¦ è™•ç†ä¸­..."}),e.jsxs("div",{className:"import-stats",children:[e.jsxs("span",{className:"import-stat success",children:["âœ… ",L.success]}),e.jsxs("span",{className:"import-stat skipped",children:["â­ ",L.skipped]}),e.jsxs("span",{className:"import-stat failed",children:["âŒ ",L.failed]})]}),L.total>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"import-progress-bar",children:e.jsx("div",{className:"import-progress-bar-fill",style:{width:`${L.current/L.total*100}%`}})}),e.jsxs("p",{className:"import-progress-text",children:[L.current," / ",L.total]})]})]}),Be.length>0&&e.jsx("div",{className:"import-log",children:Be.map((s,a)=>e.jsx("div",{className:`import-log-line import-log-${s.type}`,children:s.msg},a))})]}),e.jsxs("div",{className:"modal-footer",children:[!S&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"cancel-btn",onClick:()=>{Q(!1),ee("")},children:"å–æ¶ˆ"}),e.jsxs("button",{className:"save-btn",onClick:fs,disabled:!re.trim(),children:[e.jsx(ye,{size:16})," é–‹å§‹åŒ¯å…¥"]})]}),S&&S!=="done"&&e.jsx("button",{className:"cancel-btn",onClick:Oe,children:"å–æ¶ˆåŒ¯å…¥"}),S==="done"&&e.jsx("button",{className:"save-btn",onClick:()=>{Q(!1),R(null),ee(""),se([]),De("gdragon")},children:"é—œé–‰"})]})]})})]})}const na=l.memo(Qs);export{na as default};
