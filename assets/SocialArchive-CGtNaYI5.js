import{s as _,j as e,M as la,g as ve,a as ca,b as re,f as ra,c as Ya,d as Wa,e as Ha,u as J,i as qa,h as Xa,k as Ja,l as oe}from"./index-BaNA-BqL.js";import{a as u,d as Ka,l as Qa,F as Za,o as ye,p as es,G as as,q as ss,s as oa,t as da,u as ts,f as Y,R as Ne,C as ns,X as de,E as is,b as ls,v as ua,e as cs,I as rs,U as os,T as ds,S as us,j as ms,i as hs}from"./icons-BnVRUeaG.js";import{u as ps}from"./index-V2gf2ww2.js";import"./vendor-m-KbOPhb.js";const O=[{id:"post",label:"è²¼æ–‡",icon:"ðŸ“·",color:"#E1306C"},{id:"story",label:"Story",icon:"â­•",color:"#833AB4"},{id:"reels",label:"Reels",icon:"ðŸŽ¬",color:"#F77737"}],gs={"G-Dragon":"xxxibgdrgn","T.O.P":"ttt",å¤ªé™½:"__youngbae__",å¤§è²:"d_lable_official",å‹åˆ©:"",å…¨å“¡:"bigbangofficial"};function fs(C){if(!C)return"å…¨å“¡";const z=C.toLowerCase();for(const[G,M]of Object.entries(gs))if(M&&z===M.toLowerCase())return G;return"å…¨å“¡"}async function we(C){try{const z=`${Ja.IG_SCRAPER_URL}/scrape?url=${encodeURIComponent(C)}`;return await(await fetch(z)).json()}catch(z){return console.error("IG æŠ“å–å¤±æ•—:",z),{success:!1,error:z.message}}}function xs({isAdmin:C,onBack:z,currentPage:G,setCurrentPage:M}){var Ke,Qe,Ze,ea,aa,sa;const[S,E]=u.useState([]),[ma,ke]=u.useState(!0),[Ce,Se]=u.useState(!1),[K,Ue]=u.useState(null),[Te,W]=u.useState(!1),[Q,ha]=u.useState("all"),[Z,pa]=u.useState("all"),[H,ga]=u.useState(!1),[ee,fa]=u.useState(!1),[ae,xa]=u.useState(""),[I,$e]=u.useState("grid"),[U,ba]=u.useState({}),[ue,Me]=u.useState(!1),[Ie,ze]=u.useState({current:0,total:0}),[ja,B]=u.useState(!1),[w,Be]=u.useState(null),[h,j]=u.useState({type:"post",member:"å…¨å“¡",date:new Date().toISOString().split("T")[0],time:"",igUrl:"",caption:"",media:[],notes:""}),[De,Ae]=u.useState(!1),[o,D]=u.useState(null),[T,A]=u.useState(0),[P,Pe]=u.useState(!1),[F,L]=u.useState([]),[Fe,Oe]=u.useState(!1),[Ge,Ee]=u.useState({current:0,total:0}),[va,Le]=u.useState(null),R=u.useRef(!1),[k,me]=u.useState(null),he=u.useRef(null),[q,pe]=u.useState(()=>window.innerWidth<500?2:Math.max(2,Math.floor(Math.min(900,window.innerWidth)/280)));u.useEffect(()=>{ya()},[]);async function ya(){ke(!0);try{const a=await _.load();E(a)}catch(a){console.error("è¼‰å…¥å¤±æ•—",a),g("è¼‰å…¥å¤±æ•—","error")}finally{ke(!1)}}function g(a,t="success"){Ue({msg:a,type:t}),setTimeout(()=>Ue(null),2500)}function se({title:a,content:t,type:n="warning",confirmText:s="ç¢ºå®š",cancelText:d="å–æ¶ˆ"}){return new Promise(i=>{me({title:a,content:t,type:n,confirmText:s,cancelText:d,onConfirm:()=>{me(null),i(!0)},onCancel:()=>{me(null),i(!1)}})})}function Na(a){var t;return(t=a.media)==null?void 0:t.some(n=>n.type==="video"||n.type==="youtube")}function wa(a){var t;return((t=U[a.id])==null?void 0:t.length)>0}async function X(a){if(!a)return!1;try{const t=new AbortController,n=setTimeout(()=>t.abort(),1e4),s=await fetch(a,{method:"HEAD",mode:"cors",signal:t.signal});return clearTimeout(n),s.ok?!0:(console.log(`âŒ åœ–ç‰‡æª¢æŸ¥å¤±æ•— (HTTP ${s.status}): ${a}`),!1)}catch{return new Promise(n=>{const s=new window.Image,d=setTimeout(()=>{s.src="",n(!1)},1e4);s.onload=()=>{clearTimeout(d),s.naturalWidth===0||s.naturalHeight===0?n(!1):n(!0)},s.onerror=()=>{clearTimeout(d),n(!1)},s.src=a})}}async function ka(){var s;Me(!0),ze({current:0,total:S.length});const a={};let t=0;for(const d of S){const i=[];if(((s=d.media)==null?void 0:s.length)>0)for(let l=0;l<d.media.length;l++){const m=d.media[l],b=m.type==="video"?m.thumbnail:m.url;b&&(await X(b)||i.push(l))}i.length>0&&(a[d.id]=i),t++,ze({current:t,total:S.length})}ba(a),Me(!1);const n=Object.keys(a).length;n>0?g(`æª¢æŸ¥å®Œæˆï¼š${n} ç­†æœ‰å£žåœ–`,"error"):g("æª¢æŸ¥å®Œæˆï¼šæ²’æœ‰ç™¼ç¾å£žåœ– âœ…")}const y=u.useMemo(()=>S.filter(a=>{var t;return!(Q!=="all"&&a.member!==Q||Z!=="all"&&a.type!==Z||H&&!Na(a)||ee&&!wa(a)||ae&&!((t=a.caption)!=null&&t.toLowerCase().includes(ae.toLowerCase())))}).sort((a,t)=>new Date(t.date)-new Date(a.date)),[S,Q,Z,H,ee,ae,U]);u.useEffect(()=>{const a=he.current;if(!a)return;const t=()=>{if(I!=="grid"){pe(1);return}const s=Math.min(a.clientWidth,window.innerWidth);if(s<500){pe(2);return}pe(Math.max(2,Math.floor(s/280)))};t();const n=new ResizeObserver(t);return n.observe(a),()=>n.disconnect()},[I]);const Ca=u.useMemo(()=>Math.ceil(y.length/q),[y.length,q]),ge=ps({count:Ca,getScrollElement:()=>he.current,estimateSize:()=>I==="grid"?340:120,overscan:3,gap:I==="grid"?16:10});function Re(){Be(null),j({type:"post",member:"å…¨å“¡",date:new Date().toISOString().split("T")[0],time:"",igUrl:"",caption:"",media:[],notes:""}),B(!0)}function Sa(a){Be(a),j({type:a.type,member:a.member,date:a.date,time:a.time||"",igUrl:a.igUrl||"",caption:a.caption||"",media:a.media||[],notes:a.notes||""}),B(!0)}function Ua(a){D(a),A(0)}function Ta(){const a=y.findIndex(t=>t.id===(o==null?void 0:o.id));a>0&&(D(y[a-1]),A(0))}function $a(){const a=y.findIndex(t=>t.id===(o==null?void 0:o.id));a<y.length-1&&(D(y[a+1]),A(0))}function fe(){return y.findIndex(a=>a.id===(o==null?void 0:o.id))}const[Ve,te]=u.useState(new Set);function ne(a){return Ve.has(a)}async function Ma(){var n,s,d,i;if(!(o!=null&&o.igUrl)){g("æ­¤è²¼æ–‡æ²’æœ‰ IG é€£çµ","error");return}if(ne(o.id)){g("æ­¤è²¼æ–‡æ­£åœ¨åŒæ­¥ä¸­...","info");return}const a={...o},t=o.id;te(l=>new Set(l).add(t));try{const l=await we(a.igUrl);if(!l.success||!((n=l.media)!=null&&n.length)){if(!await se({title:"âš ï¸ æŠ“å–å¤±æ•—",type:"warning",confirmText:"æ¸…ç©ºåª’é«”",cancelText:"å–æ¶ˆ",content:e.jsxs("div",{className:"confirm-content",children:[e.jsx("p",{children:"å¯èƒ½åŽŸå› ï¼š"}),e.jsxs("ul",{children:[e.jsx("li",{children:"IG è²¼æ–‡å·²è¢«åˆªé™¤"}),e.jsx("li",{children:"IG API æš«æ™‚ç„¡æ³•å­˜å–"}),e.jsx("li",{children:"ç¶²è·¯é€£ç·šå•é¡Œ"})]}),e.jsx("p",{className:"confirm-warning",children:"æ˜¯å¦ä»è¦æ¸…ç©ºæ­¤è²¼æ–‡çš„åª’é«”è³‡æ–™ï¼Ÿ"})]})})){te(N=>{const v=new Set(N);return v.delete(t),v});return}}else{const f=((s=a.media)==null?void 0:s.length)||0,N=((d=l.media)==null?void 0:d.length)||0,v=(a.caption||"").trim(),$=(l.caption||"").trim(),ta=f!==N,na=v!==$&&$!=="";if(ta||na){const Ra=v.substring(0,80)+(v.length>80?"...":""),Va=$.substring(0,80)+($.length>80?"...":"");if(!await se({title:"ðŸ“ è³‡æ–™è®Šæ›´ç¢ºèª",type:"info",confirmText:"è¦†è“‹",cancelText:"å–æ¶ˆ",content:e.jsxs("div",{className:"confirm-content",children:[e.jsx("p",{children:"æŠ“å–åˆ°çš„è³‡æ–™èˆ‡ç¾æœ‰è³‡æ–™ä¸åŒï¼š"}),ta&&e.jsxs("div",{className:"diff-item",children:[e.jsx("span",{className:"diff-label",children:"ðŸ“· åª’é«”æ•¸é‡"}),e.jsxs("div",{className:"diff-values",children:[e.jsxs("span",{className:"diff-old",children:[f," å¼µ"]}),e.jsx("span",{className:"diff-arrow",children:"â†’"}),e.jsxs("span",{className:"diff-new",children:[N," å¼µ"]})]})]}),na&&e.jsxs("div",{className:"diff-item",children:[e.jsx("span",{className:"diff-label",children:"ðŸ“ å…§å®¹"}),e.jsxs("div",{className:"diff-text",children:[e.jsx("div",{className:"diff-old",children:Ra||"(ç©º)"}),e.jsx("div",{className:"diff-new",children:Va})]})]}),e.jsx("p",{className:"confirm-question",children:"ç¢ºå®šè¦è¦†è“‹å—Žï¼Ÿ"})]})})){te(_a=>{const ia=new Set(_a);return ia.delete(t),ia}),g("å·²å–æ¶ˆåŒæ­¥");return}}}g("åŒæ­¥ä¸­ï¼Œæª¢æŸ¥ä¸¦ä¸Šå‚³åœ–ç‰‡...","info");const m=((i=l.media)==null?void 0:i.length)>0?await Je(l.media,a.media||[],a.member):[],b=(a.media||[]).filter(f=>f.type==="youtube"),p=[...m,...b];let c=a.date,r=a.time||"";if(l.date){const f=new Date(l.date),N=new Date(f.getTime()+480*60*1e3);c=`${N.getUTCFullYear()}-${String(N.getUTCMonth()+1).padStart(2,"0")}-${String(N.getUTCDate()).padStart(2,"0")}`,r=`${String(N.getUTCHours()).padStart(2,"0")}:${String(N.getUTCMinutes()).padStart(2,"0")}`}const x={...a,media:p,caption:l.caption||a.caption,date:c,time:r,updatedAt:Date.now()};E(f=>{const N=f.map(v=>v.id===t?x:v);return _.update(x).catch(v=>console.warn("D1 å„²å­˜å¤±æ•—:",v)),N}),D(f=>(f==null?void 0:f.id)===t?x:f),A(0),m.length>0?g(`âœ… åŒæ­¥å®Œæˆï¼š${m.length} å€‹åª’é«”`):g("å·²æ¸…ç©ºåª’é«”è³‡æ–™","info")}catch(l){console.error("åŒæ­¥å¤±æ•—:",l),g("âŒ åŒæ­¥å¤±æ•—ï¼š"+l.message,"error")}finally{te(l=>{const m=new Set(l);return m.delete(t),m})}}function Ia(){o&&(Sa(o),D(null))}const[xe,ie]=u.useState(!1),[_e,le]=u.useState(""),[Ye,ce]=u.useState(0),[We,V]=u.useState(!1),[be,je]=u.useState("");async function He(){var a,t;if(h.igUrl){ie(!0),le("æŠ“å–ä¸­...");try{const n=await we(h.igUrl);if(n.success&&((a=n.media)==null?void 0:a.length)>0){const s=fs((t=n.owner)==null?void 0:t.username);let d=h.date,i="";if(n.date){const c=new Date(n.date),r=new Date(c.getTime()+480*60*1e3);d=`${r.getUTCFullYear()}-${String(r.getUTCMonth()+1).padStart(2,"0")}-${String(r.getUTCDate()).padStart(2,"0")}`,i=`${String(r.getUTCHours()).padStart(2,"0")}:${String(r.getUTCMinutes()).padStart(2,"0")}`}const l=n.media||[],m=l.map((c,r)=>({url:c.url||c.thumbnail,type:c.type,thumbnail:c.thumbnail||null,uploading:c.type==="image",thumbnailUploading:c.type==="video"&&c.thumbnail,originalUrl:c.url,originalThumbnail:c.thumbnail,index:r}));j(c=>({...c,type:n.type||c.type,member:s,date:d,time:i||c.time,caption:n.caption||c.caption,media:m})),ie(!1),le(""),V(!1),g(`âœ… å·²æŠ“å– ${l.length} å€‹åª’é«”ï¼ŒèƒŒæ™¯ä¸Šå‚³ä¸­...`);const b=m.filter(c=>c.type==="image"),p=m.filter(c=>c.type==="video"&&c.thumbnail);ce(b.length+p.length);for(const c of b)qe(c.originalUrl,c.index,s);for(const c of p)Ba(c.originalThumbnail,c.index,s)}else{const s=h.igUrl.match(/instagram\.com\/p\//),d=h.igUrl.match(/instagram\.com\/(?:reel|reels)\//);let i="post";d&&(i="reels"),j(l=>({...l,type:i})),V(!0),g("âš ï¸ è‡ªå‹•æŠ“å–å¤±æ•—ï¼Œè«‹æ‰‹å‹•è¼¸å…¥åª’é«”ç¶²å€","info"),ie(!1),le("")}}catch(n){console.error("è§£æžå¤±æ•—",n),V(!0),g("âš ï¸ æŠ“å–å¤±æ•—ï¼Œè«‹æ‰‹å‹•è¼¸å…¥åª’é«”ç¶²å€","error"),ie(!1),le("")}}}async function za(){if(!be.trim())return;const a=be.split(`
`).map(s=>s.trim()).filter(s=>s&&(s.startsWith("http")||s.startsWith("//")));if(a.length===0){g("è«‹è¼¸å…¥æœ‰æ•ˆçš„ç¶²å€","error");return}const t=a.map((s,d)=>{if(qa(s))return{url:s,type:"youtube",thumbnail:ve(s),index:h.media.length+d};const i=/\.(mp4|mov|webm|m4v)/i.test(s)||s.includes("video");return{url:s,type:i?"video":"image",uploading:!i,originalUrl:s,index:h.media.length+d}});j(s=>({...s,media:[...s.media,...t]}));const n=t.filter(s=>s.type==="image");ce(s=>s+n.length);for(const s of n)qe(s.originalUrl,s.index,h.member);je(""),V(!1),g(`å·²æ–°å¢ž ${a.length} å€‹åª’é«”`)}async function qe(a,t,n){try{const s={context:"social",member:n},[d,i]=await Promise.all([J(a,s),oe(a,s)]);j(l=>({...l,media:l.media.map((m,b)=>b===t?{...m,url:d,backupUrl:i,uploading:!1}:m)})),i&&console.log(`âœ… åœ–ç‰‡ ${t+1} é›™é‡å‚™ä»½å®Œæˆ`)}catch(s){console.warn(`åœ–ç‰‡ ${t+1} ä¸Šå‚³å¤±æ•—`,s),j(d=>({...d,media:d.media.map((i,l)=>l===t?{...i,uploading:!1,uploadFailed:!0}:i)}))}finally{ce(s=>s-1)}}async function Ba(a,t,n){try{const s={context:"social",member:n},[d,i]=await Promise.all([J(a,s),oe(a,s)]);j(l=>({...l,media:l.media.map((m,b)=>b===t?{...m,thumbnail:d,thumbnailBackupUrl:i,thumbnailUploading:!1}:m)})),i&&console.log(`âœ… å½±ç‰‡ ${t+1} ç¸®åœ–é›™é‡å‚™ä»½å®Œæˆ`)}catch(s){console.warn(`å½±ç‰‡ ${t+1} ç¸®åœ–ä¸Šå‚³å¤±æ•—`,s),j(d=>({...d,media:d.media.map((i,l)=>l===t?{...i,thumbnailUploading:!1,thumbnailFailed:!0}:i)}))}finally{ce(s=>s-1)}}async function Da(a){const t=Array.from(a.target.files);if(t.length){Ae(!0);try{const n=[];for(const s of t)if(s.type.startsWith("video/")){const i=URL.createObjectURL(s);n.push({url:i,type:"video",localFile:s})}else{const i=await J(s,{context:"social",member:h.member});n.push({url:i,type:"image"})}j(s=>({...s,media:[...s.media,...n]})),g(`å·²æ–°å¢ž ${n.length} å€‹æª”æ¡ˆ`)}catch(n){console.error("ä¸Šå‚³å¤±æ•—",n),g("ä¸Šå‚³å¤±æ•—","error")}finally{Ae(!1)}}}function Aa(a){j(t=>({...t,media:t.media.filter((n,s)=>s!==a)}))}async function Pa(){if(!h.date||!h.member){g("è«‹å¡«å¯«å¿…è¦æ¬„ä½","error");return}if(h.media.some(n=>n.uploading)&&!await se({title:"âš ï¸ ä¸Šå‚³æœªå®Œæˆ",type:"warning",confirmText:"ä»è¦å„²å­˜",cancelText:"ç­‰å¾…ä¸Šå‚³",content:e.jsxs("div",{className:"confirm-content",children:[e.jsx("p",{children:"é‚„æœ‰åœ–ç‰‡æ­£åœ¨ä¸Šå‚³ä¸­ï¼Œç¢ºå®šè¦ç¾åœ¨å„²å­˜å—Žï¼Ÿ"}),e.jsx("p",{className:"confirm-warning",children:"æœªå®Œæˆä¸Šå‚³çš„åœ–ç‰‡å¯èƒ½ç„¡æ³•æ­£å¸¸é¡¯ç¤º"})]})}))return;const t={id:(w==null?void 0:w.id)||Xa("s"),type:h.type,member:h.member,date:h.date,time:h.time,igUrl:h.igUrl,caption:h.caption,media:h.media.map(n=>({url:n.url,type:n.type,...n.backupUrl&&{backupUrl:n.backupUrl},...n.thumbnail&&{thumbnail:n.thumbnail},...n.thumbnailBackupUrl&&{thumbnailBackupUrl:n.thumbnailBackupUrl}})),notes:h.notes,createdAt:(w==null?void 0:w.createdAt)||Date.now(),updatedAt:Date.now()};Se(!0);try{w?(await _.update(t),E(S.map(n=>n.id===w.id?t:n))):(await _.create(t),E([t,...S])),g("å·²å„²å­˜"),B(!1)}catch(n){console.error("å„²å­˜å¤±æ•—",n),g("å„²å­˜å¤±æ•—","error")}finally{Se(!1)}}async function Fa(a){if(await se({title:"ðŸ—‘ï¸ åˆªé™¤ç¢ºèª",type:"danger",confirmText:"åˆªé™¤",cancelText:"å–æ¶ˆ",content:e.jsxs("div",{className:"confirm-content",children:[e.jsx("p",{children:"ç¢ºå®šè¦åˆªé™¤é€™ç­†å‚™ä»½å—Žï¼Ÿ"}),e.jsx("p",{className:"confirm-warning",children:"æ­¤æ“ä½œç„¡æ³•å¾©åŽŸ"})]})}))try{await _.delete(a),E(S.filter(n=>n.id!==a)),g("å·²åˆªé™¤")}catch(n){console.error("åˆªé™¤å¤±æ•—",n),g("åˆªé™¤å¤±æ•—","error")}}function Xe(a){L(t=>t.includes(a)?t.filter(n=>n!==a):[...t,a])}function Oa(){F.length===y.length?L([]):L(y.map(a=>a.id))}async function Je(a,t=[],n){var i,l,m,b;const s=[],d=[];for(let p=0;p<a.length;p++){const c=a[p],r=t[p];if(c.type==="image"){if((r==null?void 0:r.type)==="image"){if((i=r==null?void 0:r.url)!=null&&i.includes("i.ibb.co")&&await X(r.url)){console.log(`âœ… åœ–ç‰‡ ${p+1} ImgBB å‚™ä»½å¯ç”¨ï¼Œè·³éŽä¸Šå‚³`),s.push({...r});continue}if((l=r==null?void 0:r.backupUrl)!=null&&l.includes("cloudinary")&&await X(r.backupUrl)){console.log(`âœ… åœ–ç‰‡ ${p+1} Cloudinary å‚™ä»½å¯ç”¨ï¼Œåˆ‡æ›ä½¿ç”¨`),s.push({url:r.backupUrl,type:"image",backupUrl:r.backupUrl});continue}console.log(`âš ï¸ åœ–ç‰‡ ${p+1} æ‰€æœ‰å‚™ä»½éƒ½å¤±æ•ˆï¼Œé‡æ–°ä¸Šå‚³`)}try{console.log(`ðŸ“¤ ä¸Šå‚³åœ–ç‰‡ ${p+1}...`);const x={context:"social",member:n},N={url:await J(c.url,x),type:"image"};s.push(N);const v=s.length-1;d.push(oe(c.url,x).then($=>{$&&(s[v].backupUrl=$)}).catch($=>console.warn("Cloudinary èƒŒæ™¯ä¸Šå‚³å¤±æ•—:",$)))}catch(x){console.warn("åœ–ç‰‡ä¸Šå‚³å¤±æ•—:",x),s.push({url:c.url,type:"image"})}}else if(c.type==="video"){const x={url:c.url,type:"video"};if(c.thumbnail){if((r==null?void 0:r.type)==="video"){if((m=r==null?void 0:r.thumbnail)!=null&&m.includes("i.ibb.co")&&await X(r.thumbnail)){console.log(`âœ… å½±ç‰‡ ${p+1} ç¸®åœ– ImgBB å‚™ä»½å¯ç”¨ï¼Œè·³éŽä¸Šå‚³`),x.thumbnail=r.thumbnail,r.thumbnailBackupUrl&&(x.thumbnailBackupUrl=r.thumbnailBackupUrl),s.push(x);continue}if((b=r==null?void 0:r.thumbnailBackupUrl)!=null&&b.includes("cloudinary")&&await X(r.thumbnailBackupUrl)){console.log(`âœ… å½±ç‰‡ ${p+1} ç¸®åœ– Cloudinary å‚™ä»½å¯ç”¨ï¼Œåˆ‡æ›ä½¿ç”¨`),x.thumbnail=r.thumbnailBackupUrl,x.thumbnailBackupUrl=r.thumbnailBackupUrl,s.push(x);continue}console.log(`âš ï¸ å½±ç‰‡ ${p+1} ç¸®åœ–æ‰€æœ‰å‚™ä»½éƒ½å¤±æ•ˆï¼Œé‡æ–°ä¸Šå‚³`)}try{console.log(`ðŸ“¤ ä¸Šå‚³å½±ç‰‡ ${p+1} ç¸®åœ–...`);const f={context:"social",member:n},N=await J(c.thumbnail,f);x.thumbnail=N,d.push(oe(c.thumbnail,f).then(v=>{v&&(x.thumbnailBackupUrl=v)}).catch(v=>console.warn("Cloudinary ç¸®åœ–èƒŒæ™¯ä¸Šå‚³å¤±æ•—:",v)))}catch(f){console.warn("ç¸®åœ–ä¸Šå‚³å¤±æ•—:",f),x.thumbnail=c.thumbnail}}s.push(x)}}return d.length>0&&Promise.all(d).then(()=>{console.log("âœ… Cloudinary èƒŒæ™¯ä¸Šå‚³å®Œæˆ")}),s}function Ga(a,t){return a.map((s,d)=>{const i=t[d];return s.type==="video"&&(i==null?void 0:i.type)==="video"?{...s,url:i.url}:(s.type==="image",s)})}function Ea(){R.current=!0,g("æ­£åœ¨å–æ¶ˆåŒæ­¥...","info")}async function La(){var d;const a=S.filter(i=>F.includes(i.id)&&i.igUrl);if(a.length===0){g("æ²’æœ‰å¯åŒæ­¥çš„é …ç›®ï¼ˆéœ€æœ‰ IG é€£çµï¼‰","error");return}const t=H;R.current=!1,Oe(!0),Ee({current:0,total:a.length});let n=0;for(const i of a){if(R.current)break;Le(i.id),await new Promise(l=>setTimeout(l,0));try{const l=await we(i.igUrl);if(R.current)break;if(l.success&&((d=l.media)==null?void 0:d.length)>0){let m=i.date,b=i.time||"";if(l.date){const c=new Date(l.date),r=new Date(c.getTime()+480*60*1e3);m=`${r.getUTCFullYear()}-${String(r.getUTCMonth()+1).padStart(2,"0")}-${String(r.getUTCDate()).padStart(2,"0")}`,b=`${String(r.getUTCHours()).padStart(2,"0")}:${String(r.getUTCMinutes()).padStart(2,"0")}`}let p;if(t){const c=Ga(i.media,l.media);p={...i,media:c,date:m,time:b,updatedAt:Date.now()},console.log(`âœ… ${i.id} å½±ç‰‡ URL å·²æ›´æ–°ï¼ˆä¿ç•™ thumbnailï¼‰`)}else{const c=await Je(l.media,i.media||[],i.member);if(R.current)break;const r=(i.media||[]).filter(f=>f.type==="youtube"),x=[...c,...r];p={...i,media:x,caption:l.caption||i.caption,date:m,time:b,updatedAt:Date.now()}}E(c=>c.map(r=>r.id===i.id?p:r)),_.update(p).catch(c=>console.warn("D1 å„²å­˜å¤±æ•—:",c)),n++,await new Promise(c=>setTimeout(c,0))}}catch(l){console.warn(`åŒæ­¥ ${i.id} å¤±æ•—:`,l)}Ee(l=>({...l,current:l.current+1})),await new Promise(l=>setTimeout(l,0))}const s=R.current;Le(null),Oe(!1),Pe(!1),L([]),s?g(`å·²å–æ¶ˆåŒæ­¥ï¼ˆå·²å®Œæˆ ${n} ç­†ï¼‰`,"info"):g(t?`å½±ç‰‡åŒæ­¥å®Œæˆï¼š${n}/${a.length} ç­†æˆåŠŸ`:`åŒæ­¥å®Œæˆï¼š${n}/${a.length} ç­†æˆåŠŸ`)}return ma?e.jsxs("div",{className:"social-archive-loading",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"è¼‰å…¥ä¸­..."})]}):e.jsxs("div",{className:"social-archive",children:[e.jsxs("header",{className:"social-header",children:[e.jsx("div",{style:{display:"flex",alignItems:"center",gap:8},children:e.jsx("h1",{children:"ðŸ“± ç¤¾ç¾¤å‚™ä»½"})}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6},children:[e.jsx("button",{className:"add-btn",onClick:Re,title:"æ–°å¢žå‚™ä»½",children:e.jsx(Ka,{size:20})}),M&&e.jsxs("div",{className:"nav-menu-wrapper",children:[e.jsx("button",{onClick:()=>W(!Te),className:"hamburger-btn",title:"é¸å–®",children:e.jsx(Qa,{size:18})}),Te&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"nav-menu-overlay",onClick:()=>W(!1)}),e.jsxs("div",{className:"nav-menu",children:[e.jsxs("button",{className:`nav-menu-item ${G==="timeline"?"active":""}`,onClick:()=>{M("timeline"),W(!1)},children:[e.jsx("span",{children:"ðŸ“…"})," æ™‚é–“è»¸"]}),e.jsxs("button",{className:`nav-menu-item ${G==="social"?"active":""}`,onClick:()=>{M("social"),W(!1)},children:[e.jsx("span",{children:"ðŸ“·"})," ç¤¾ç¾¤å‚™ä»½"]}),e.jsxs("button",{className:`nav-menu-item ${G==="membership"?"active":""}`,onClick:()=>{M("membership"),W(!1)},children:[e.jsx("span",{children:"ðŸ”’"})," æœƒå“¡å‚™ä»½"]})]})]})]})]})]}),e.jsxs("div",{className:"social-filters",children:[e.jsxs("div",{className:"filter-row",children:[e.jsxs("select",{value:Q,onChange:a=>ha(a.target.value),className:"filter-select",children:[e.jsx("option",{value:"all",children:"æ‰€æœ‰æˆå“¡"}),la.map(a=>e.jsx("option",{value:a.name,children:a.name},a.name))]}),e.jsxs("select",{value:Z,onChange:a=>pa(a.target.value),className:"filter-select",children:[e.jsx("option",{value:"all",children:"æ‰€æœ‰é¡žåž‹"}),O.map(a=>e.jsxs("option",{value:a.id,children:[a.icon," ",a.label]},a.id))]}),e.jsxs("button",{className:`filter-video-btn ${H?"active":""}`,onClick:()=>ga(!H),title:"åªé¡¯ç¤ºå«å½±ç‰‡çš„è²¼æ–‡",children:[e.jsx(Za,{size:16}),e.jsx("span",{children:"å½±ç‰‡"})]}),C&&e.jsx("button",{className:`filter-broken-btn ${ee?"active":""}`,onClick:()=>{Object.keys(U).length===0&&!ue&&ka(),fa(!ee)},title:"æª¢æŸ¥ä¸¦ç¯©é¸å£žåœ–",disabled:ue,children:ue?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"mini-spinner"}),e.jsxs("span",{children:[Ie.current,"/",Ie.total]})]}):e.jsxs(e.Fragment,{children:[e.jsx(ye,{size:16}),e.jsxs("span",{children:["å£žåœ–",Object.keys(U).length>0?` (${Object.keys(U).length})`:""]})]})}),e.jsxs("div",{className:"search-box",children:[e.jsx(es,{size:16}),e.jsx("input",{type:"text",placeholder:"æœå°‹å…§å®¹...",value:ae,onChange:a=>xa(a.target.value)})]}),e.jsxs("div",{className:"view-toggle",children:[e.jsx("button",{className:I==="grid"?"active":"",onClick:()=>$e("grid"),children:e.jsx(as,{size:16})}),e.jsx("button",{className:I==="list"?"active":"",onClick:()=>$e("list"),children:e.jsx(ss,{size:16})})]}),C&&e.jsx("button",{className:`select-mode-btn ${P?"active":""}`,onClick:()=>{Pe(!P),L([])},title:"å‹¾é¸æ¨¡å¼",children:e.jsx(oa,{size:16})})]}),e.jsxs("div",{className:"filter-stats",children:["å…± ",y.length," ç­†å‚™ä»½",P&&y.length>0&&e.jsx("button",{className:"select-all-btn",onClick:Oa,children:F.length===y.length?"å–æ¶ˆå…¨é¸":"å…¨é¸"})]})]}),e.jsx("div",{ref:he,className:"social-content-scroll",children:y.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx(da,{size:48}),e.jsx("p",{children:"å°šç„¡å‚™ä»½è³‡æ–™"}),e.jsx("button",{onClick:Re,children:"æ–°å¢žç¬¬ä¸€ç­†"})]}):e.jsx("div",{style:{height:ge.getTotalSize(),position:"relative"},children:ge.getVirtualItems().map(a=>{const t=a.index*q,n=y.slice(t,t+q);return e.jsx("div",{className:`social-content ${I}`,style:{position:"absolute",top:0,left:0,right:0,transform:`translateY(${a.start}px)`,...I==="grid"?{gridTemplateColumns:`repeat(${q}, 1fr)`}:{}},ref:ge.measureElement,"data-index":a.index,children:n.map(s=>{var d,i,l,m,b;return e.jsxs("div",{className:`archive-card ${P&&F.includes(s.id)?"selected":""}`,onClick:()=>P?Xe(s.id):Ua(s),children:[P&&e.jsx("div",{className:"card-checkbox",onClick:p=>{p.stopPropagation(),Xe(s.id)},children:F.includes(s.id)?e.jsx(oa,{size:20}):e.jsx(ts,{size:20})}),e.jsxs("div",{className:"archive-thumb",children:[(d=s.media)!=null&&d[0]?s.media[0].type==="youtube"?e.jsxs("div",{className:"video-thumb-img",children:[e.jsx("img",{src:s.media[0].thumbnail||ve(s.media[0].url),alt:"",loading:"lazy",width:260,height:260}),e.jsx(Y,{size:24,className:"play-overlay"})]}):s.media[0].type==="video"?s.media[0].thumbnail?e.jsxs("div",{className:"video-thumb-img",children:[e.jsx("img",{src:ca(s.media[0]),alt:"",loading:"lazy",width:260,height:260}),e.jsx(Y,{size:24,className:"play-overlay"})]}):e.jsxs("div",{className:"video-thumb-auto",children:[e.jsx("video",{src:s.media[0].backupUrl||s.media[0].url,muted:!0,preload:"metadata"}),e.jsx(Y,{size:24,className:"play-overlay"})]}):e.jsx("img",{src:ca(s.media[0]),alt:"",loading:"lazy",width:260,height:260}):e.jsx("div",{className:"no-thumb",children:e.jsx("img",{src:"/bigbang-timeline/bigbang-default.png",alt:"BIGBANG"})}),((i=s.media)==null?void 0:i.length)>1&&e.jsxs("span",{className:"media-count",children:["+",s.media.length-1]}),e.jsx("span",{className:"type-badge",style:{background:(l=O.find(p=>p.id===s.type))==null?void 0:l.color},children:(m=O.find(p=>p.id===s.type))==null?void 0:m.icon}),((b=U[s.id])==null?void 0:b.length)>0&&e.jsxs("span",{className:"broken-badge",title:`${U[s.id].length} å¼µåœ–ç‰‡æå£ž`,children:[e.jsx(ye,{size:14}),U[s.id].length]}),(Ve.has(s.id)||va===s.id)&&e.jsxs("div",{className:"syncing-overlay",children:[e.jsx(Ne,{size:24,className:"spinning"}),e.jsx("span",{children:"åŒæ­¥ä¸­..."})]})]}),e.jsxs("div",{className:"archive-info",children:[e.jsxs("div",{className:"archive-meta",children:[e.jsx("span",{className:"member-tag",style:{background:re(s.member)+"30",color:re(s.member)},children:s.member}),e.jsx("span",{className:"date",children:ra(s.date)})]}),s.caption&&e.jsx("p",{className:"archive-caption",children:s.caption})]})]},s.id)})},a.key)})})}),o&&e.jsxs("div",{className:"modal-overlay view-modal-overlay",onClick:()=>D(null),children:[e.jsxs("div",{className:"post-nav-indicator",onClick:a=>a.stopPropagation(),children:[fe()+1," / ",y.length]}),e.jsx("button",{className:"post-nav-side prev",onClick:a=>{a.stopPropagation(),Ta()},disabled:fe()<=0,title:"ä¸Šä¸€å‰‡",children:e.jsx(ns,{size:32})}),e.jsxs("div",{className:"view-modal",onClick:a=>a.stopPropagation(),children:[e.jsx("button",{className:"view-close-btn",onClick:()=>D(null),children:e.jsx(de,{size:24})}),e.jsx("div",{className:"view-media-area",children:((Ke=o.media)==null?void 0:Ke.length)>0?e.jsxs(e.Fragment,{children:[((Qe=o.media[T])==null?void 0:Qe.type)==="youtube"?e.jsx("iframe",{src:`https://www.youtube.com/embed/${Ya(o.media[T].url)}?autoplay=1`,allow:"autoplay; encrypted-media",allowFullScreen:!0,className:"view-media view-youtube"}):((Ze=o.media[T])==null?void 0:Ze.type)==="video"?e.jsx("video",{src:o.media[T].backupUrl||o.media[T].url,controls:!0,autoPlay:!0,className:"view-media"},`${o.id}-${T}`):e.jsx("img",{src:Wa(o.media[T]),alt:"",className:"view-media"},`${o.id}-${T}`),o.media.length>1&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"media-nav prev",onClick:()=>A(a=>(a-1+o.media.length)%o.media.length),children:"â€¹"}),e.jsx("button",{className:"media-nav next",onClick:()=>A(a=>(a+1)%o.media.length),children:"â€º"}),e.jsx("div",{className:"media-dots",children:o.media.map((a,t)=>e.jsx("span",{className:`dot ${t===T?"active":""}`,onClick:()=>A(t)},t))})]})]}):e.jsx("div",{className:"no-media",children:e.jsx("img",{src:"/bigbang-timeline/bigbang-default.png",alt:"BIGBANG",className:"no-media-img"})})}),e.jsxs("div",{className:"view-info-area",children:[e.jsxs("div",{className:"view-header",children:[e.jsx("span",{className:"member-tag",style:{background:re(o.member)+"30",color:re(o.member)},children:o.member}),e.jsxs("span",{className:"type-badge",style:{background:(ea=O.find(a=>a.id===o.type))==null?void 0:ea.color},children:[(aa=O.find(a=>a.id===o.type))==null?void 0:aa.icon," ",(sa=O.find(a=>a.id===o.type))==null?void 0:sa.label]}),e.jsx("span",{className:"view-date",children:C&&o.time?Ha(o.date,o.time):ra(o.date)})]}),o.caption&&e.jsx("div",{className:"view-caption",children:e.jsx("p",{children:o.caption})}),o.notes&&e.jsxs("div",{className:"view-notes",children:[e.jsx("strong",{children:"å‚™è¨»ï¼š"}),e.jsx("p",{children:o.notes})]}),e.jsxs("div",{className:"view-actions",children:[o.igUrl&&e.jsxs(e.Fragment,{children:[e.jsxs("a",{href:o.igUrl,target:"_blank",rel:"noopener noreferrer",className:"view-link-btn",children:[e.jsx(is,{size:16})," é–‹å•Ÿ IG"]}),C&&e.jsxs("button",{className:"view-sync-btn",onClick:Ma,disabled:ne(o.id),title:"é‡æ–°æŠ“å– IG è³‡æ–™",children:[e.jsx(Ne,{size:16,className:ne(o.id)?"spinning":""}),ne(o.id)?"åŒæ­¥ä¸­...":"åŒæ­¥"]})]}),e.jsx("button",{className:"view-edit-btn",onClick:Ia,children:"âœï¸ ç·¨è¼¯"})]})]})]}),e.jsx("button",{className:"post-nav-side next",onClick:a=>{a.stopPropagation(),$a()},disabled:fe()>=y.length-1,title:"ä¸‹ä¸€å‰‡",children:e.jsx(ls,{size:32})})]}),ja&&e.jsx("div",{className:"modal-overlay",onClick:()=>B(!1),children:e.jsxs("div",{className:"social-modal",onClick:a=>a.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{children:w?"ç·¨è¼¯å‚™ä»½":"æ–°å¢žå‚™ä»½"}),e.jsx("button",{className:"close-btn",onClick:()=>B(!1),children:e.jsx(de,{size:20})})]}),e.jsxs("div",{className:"modal-body",children:[e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{children:[e.jsx(da,{size:14})," IG é€£çµ","ï¼ˆè‡ªå‹•æŠ“å–ï¼‰"]}),e.jsxs("div",{className:"ig-url-input",children:[e.jsx("input",{type:"url",placeholder:"è²¼ä¸Š Instagram é€£çµï¼Œè‡ªå‹•æŠ“å–åœ–ç‰‡å’Œæ–‡å­—...",value:h.igUrl,onChange:a=>j(t=>({...t,igUrl:a.target.value})),onBlur:He,disabled:xe}),e.jsx("button",{onClick:He,title:"æŠ“å–è³‡æ–™",disabled:xe,children:xe?e.jsx("span",{className:"fetching-spinner"}):e.jsx(ua,{size:16})}),_e&&e.jsx("span",{className:"fetch-progress",children:_e})]})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"é¡žåž‹"}),e.jsx("div",{className:"type-selector",children:O.map(a=>e.jsxs("button",{className:h.type===a.id?"active":"",style:h.type===a.id?{background:a.color}:{},onClick:()=>j(t=>({...t,type:a.id})),children:[a.icon," ",a.label]},a.id))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"æˆå“¡"}),e.jsx("select",{value:h.member,onChange:a=>j(t=>({...t,member:a.target.value})),children:la.map(a=>e.jsx("option",{value:a.name,children:a.name},a.name))})]})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{children:[e.jsx(cs,{size:14})," ç™¼æ–‡æ—¥æœŸ"]}),e.jsx("input",{type:"date",value:h.date,onChange:a=>j(t=>({...t,date:a.target.value}))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"æ™‚é–“ï¼ˆé¸å¡«ï¼‰"}),e.jsx("input",{type:"time",value:h.time,onChange:a=>j(t=>({...t,time:a.target.value}))})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{children:[e.jsx(rs,{size:14})," åœ–ç‰‡/å½±ç‰‡",Ye>0&&e.jsxs("span",{className:"upload-status",children:["ï¼ˆ",Ye," å¼µä¸Šå‚³ä¸­...ï¼‰"]})]}),e.jsxs("div",{className:"media-upload-area",children:[h.media.map((a,t)=>{var s;const n=w&&((s=U[w.id])==null?void 0:s.includes(t));return e.jsxs("div",{className:`media-preview ${a.uploading?"uploading":""} ${a.uploadFailed?"failed":""} ${n?"broken":""}`,children:[a.type==="youtube"?e.jsxs("div",{className:"video-preview-img",children:[e.jsx("img",{src:a.thumbnail||ve(a.url),alt:""}),e.jsx(Y,{size:16,className:"play-icon"})]}):a.type==="video"?a.thumbnail?e.jsxs("div",{className:"video-preview-img",children:[e.jsx("img",{src:a.thumbnailBackupUrl||a.thumbnail,alt:""}),e.jsx(Y,{size:16,className:"play-icon"})]}):e.jsxs("div",{className:"video-preview-auto",children:[e.jsx("video",{src:a.backupUrl||a.url,muted:!0,preload:"metadata"}),e.jsx(Y,{size:16,className:"play-icon"})]}):e.jsx("img",{src:a.backupUrl||a.url,alt:""}),a.uploading&&e.jsx("div",{className:"upload-overlay",children:e.jsx("div",{className:"mini-spinner"})}),a.uploadFailed&&e.jsx("div",{className:"upload-failed-badge",title:"ä¸Šå‚³å¤±æ•—ï¼Œå°‡ä½¿ç”¨åŽŸå§‹é€£çµ",children:"âš ï¸"}),n&&e.jsx("div",{className:"broken-image-badge",title:"æ­¤åœ–ç‰‡å·²æå£žï¼Œè«‹é‡æ–°ä¸Šå‚³",children:e.jsx(ye,{size:14})}),e.jsx("button",{className:"remove-media",onClick:()=>Aa(t),children:e.jsx(de,{size:14})})]},t)}),e.jsxs("label",{className:"upload-btn",children:[e.jsx("input",{type:"file",accept:"image/*,video/*",multiple:!0,onChange:Da,disabled:De}),De?e.jsx("span",{className:"uploading",children:"ä¸Šå‚³ä¸­..."}):e.jsxs(e.Fragment,{children:[e.jsx(os,{size:20}),e.jsx("span",{children:"ä¸Šå‚³"})]})]}),e.jsxs("button",{type:"button",className:"manual-url-toggle",onClick:()=>V(!We),children:[e.jsx(ua,{size:16}),e.jsx("span",{children:"è²¼ä¸Šç¶²å€"})]})]}),We&&e.jsxs("div",{className:"manual-url-input",children:[e.jsx("p",{className:"manual-hint",children:"ðŸ’¡ æç¤ºï¼šæ”¯æ´åœ–ç‰‡ã€å½±ç‰‡ã€YouTube é€£çµï¼Œæ¯è¡Œä¸€å€‹"}),e.jsx("textarea",{placeholder:`è²¼ä¸Šåœ–ç‰‡/å½±ç‰‡/YouTube ç¶²å€ï¼Œæ¯è¡Œä¸€å€‹...
ä¾‹å¦‚ï¼š
https://scontent-xxx.cdninstagram.com/...jpg
https://www.youtube.com/watch?v=xxxxx`,value:be,onChange:a=>je(a.target.value),rows:4}),e.jsxs("div",{className:"manual-actions",children:[e.jsx("button",{type:"button",className:"cancel-manual",onClick:()=>{V(!1),je("")},children:"å–æ¶ˆ"}),e.jsx("button",{type:"button",className:"submit-manual",onClick:za,children:"æ–°å¢žåª’é«”"})]})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"åŽŸæ–‡å…§å®¹"}),e.jsx("textarea",{placeholder:"è²¼ä¸Š IG åŽŸæ–‡å…§å®¹...",value:h.caption,onChange:a=>j(t=>({...t,caption:a.target.value})),rows:4})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"å‚™è¨»ï¼ˆé¸å¡«ï¼‰"}),e.jsx("textarea",{placeholder:"å…¶ä»–å‚™è¨»...",value:h.notes,onChange:a=>j(t=>({...t,notes:a.target.value})),rows:2})]})]}),e.jsxs("div",{className:"modal-footer",children:[w&&e.jsxs("button",{className:"delete-btn",onClick:()=>{Fa(w.id),B(!1)},children:[e.jsx(ds,{size:16})," åˆªé™¤"]}),e.jsx("button",{className:"cancel-btn",onClick:()=>B(!1),children:"å–æ¶ˆ"}),e.jsxs("button",{className:"save-btn",onClick:Pa,disabled:Ce,children:[e.jsx(us,{size:16})," ",Ce?"å„²å­˜ä¸­...":"å„²å­˜"]})]})]})}),P&&F.length>0&&e.jsxs("div",{className:"batch-action-bar",children:[e.jsxs("span",{className:"batch-count",children:["å·²é¸å– ",F.length," ç­†"]}),e.jsxs("div",{className:"batch-actions",children:[!Fe&&e.jsx("button",{className:"batch-cancel-btn",onClick:()=>L([]),children:"å–æ¶ˆé¸å–"}),Fe?e.jsxs("button",{className:"batch-stop-btn",onClick:Ea,children:[e.jsx(de,{size:16}),"å–æ¶ˆåŒæ­¥ (",Ge.current,"/",Ge.total,")"]}):e.jsxs("button",{className:"batch-sync-btn",onClick:La,children:[e.jsx(Ne,{size:16}),"åŒæ­¥æŠ“å–"]})]})]}),K&&e.jsxs("div",{className:`toast ${K.type}`,children:[K.type==="error"?e.jsx(ms,{size:16}):e.jsx(hs,{size:16}),K.msg]}),k&&e.jsx("div",{className:"confirm-modal-overlay",onClick:k.onCancel,children:e.jsxs("div",{className:`confirm-modal confirm-modal-${k.type}`,onClick:a=>a.stopPropagation(),children:[e.jsx("h3",{className:"confirm-modal-title",children:k.title}),e.jsx("div",{className:"confirm-modal-body",children:k.content}),e.jsxs("div",{className:"confirm-modal-actions",children:[e.jsx("button",{className:"confirm-modal-cancel",onClick:k.onCancel,children:k.cancelText}),e.jsx("button",{className:`confirm-modal-confirm confirm-modal-confirm-${k.type}`,onClick:k.onConfirm,children:k.confirmText})]})]})})]})}const ws=u.memo(xs);export{ws as default};
