import{m as _,n as ws,j as e,o as We,g as le,a as ks,b as re,f as Cs,c as Ss,d as Us,e as Is,_ as $s,u as be,l as je,i as qe,h as Ts}from"./index-BaNA-BqL.js";import{a as l,D as ve,d as Ms,l as zs,p as Ps,G as Ds,q as As,w as He,f as oe,C as Es,X as ce,E as Fs,b as Bs,e as _s,v as Ke,I as Ls,U as Os,T as Vs,S as Ys,j as Gs,i as Rs}from"./icons-BnVRUeaG.js";import{u as Ws}from"./index-V2gf2ww2.js";import"./vendor-m-KbOPhb.js";function qs({src:P,className:Ne}){const L=l.useRef(null);return l.useEffect(()=>{const I=L.current;if(!I||!P)return;if(I.canPlayType("application/vnd.apple.mpegurl")){I.src=P;return}let C=null;return $s(async()=>{const{default:S}=await import("./hls-jw_vZdHi.js");return{default:S}},[]).then(({default:S})=>{if(!S.isSupported()){I.src=P;return}C=new S,C.loadSource(P),C.attachMedia(I)}).catch(()=>{I.src=P}),()=>{C&&C.destroy()}},[P]),e.jsx("video",{ref:L,controls:!0,playsInline:!0,className:Ne})}const R={gdragon:{label:"G-Dragon (gdragon.ai)",domain:"gdragon.ai",mediaPrefix:"gd",authorIds:"67a5e27bc8affa6b2c4b893b%2C677e145d5dba936413e31764",defaultMember:"G-Dragon",authorMap:{"67a5e27bc8affa6b2c4b893b":"G-Dragon","677e145d5dba936413e31764":"G-Dragon"}},daesung:{label:"Daesung (daesung.bstage.in)",domain:"daesung.bstage.in",mediaPrefix:"daesung",authorIds:"64cb4a2654046402f5bde521",defaultMember:"å¤§è²",authorMap:{"64cb4a2654046402f5bde521":"å¤§è²"}},taeyang:{label:"Taeyang (taeyang.bstage.in)",domain:"taeyang.bstage.in",mediaPrefix:"taeyang",authorIds:"67361d0527162e668b09c620",defaultMember:"å¤ªé™½",authorMap:{"67361d0527162e668b09c620":"å¤ªé™½"}}};function Hs({isAdmin:P,onBack:Ne,currentPage:L,setCurrentPage:I}){var Ye,Ge,Re;const[C,S]=l.useState([]),[Xe,ye]=l.useState(!0),[we,ke]=l.useState(!1),[se,Ce]=l.useState(null),[Se,W]=l.useState(!1),[q,Je]=l.useState("all"),[ae,Qe]=l.useState("all"),[te,Ze]=l.useState(""),[D,Ue]=l.useState("grid"),[es,F]=l.useState(!1),[$,Ie]=l.useState(null),[h,j]=l.useState({member:"å…¨å“¡",date:new Date().toISOString().split("T")[0],time:"",caption:"",media:[],sourceUrl:"",notes:""}),[$e,Te]=l.useState(!1),[r,O]=l.useState(null),[A,V]=l.useState(0),[z,de]=l.useState(null),me=l.useRef(null),[H,ue]=l.useState(()=>window.innerWidth<500?2:Math.max(2,Math.floor(Math.min(900,window.innerWidth)/280))),[Me,K]=l.useState(!1),[he,X]=l.useState(""),[ze,Pe]=l.useState(0),[ss,J]=l.useState(!1),[ie,Q]=l.useState(""),[pe,De]=l.useState("gdragon"),[w,B]=l.useState(null),[Ae,Ee]=l.useState({page:0,totalItems:0}),[E,Y]=l.useState({current:0,total:0,skipped:0,success:0,failed:0}),[Fe,Z]=l.useState([]),[Be,as]=l.useState(!1),[ne,ts]=l.useState(!1),G=l.useRef(!1);l.useEffect(()=>{is()},[]);async function is(){ye(!0);try{const s=await _.load();S(s)}catch(s){console.error("è¼‰å…¥å¤±æ•—",s),N("è¼‰å…¥å¤±æ•—","error")}finally{ye(!1)}}function x(s,a="info"){Z(i=>[...i,{msg:s,type:a,ts:Date.now()}])}async function ns(s,a){var f;const i=R[a],t=[];let c=1;const d=24;let m=!1;for(;!m&&!G.current;){const T=`https://${i.domain}/svc/home/api/v1/home/star/feeds?authorIds=${i.authorIds}&page=${c}&pageSize=${d}`,p=await fetch(T,{headers:{authorization:`Bearer ${s}`}});if(!p.ok)throw p.status===401?new Error("Token å·²éŽæœŸï¼Œè«‹é‡æ–°ç™»å…¥ b.stage å–å¾—æ–°çš„ Token"):new Error(`API éŒ¯èª¤: ${p.status}`);const n=await p.json();((f=n==null?void 0:n.items)==null?void 0:f.length)>0&&t.push(...n.items),m=(n==null?void 0:n.isLast)??!0,c++,Ee({page:c-1,totalItems:t.length}),x(`ç¬¬ ${c-1} é ï¼šå·²æŠ“å– ${t.length} ç­†`,"info"),await new Promise(U=>setTimeout(U,100))}return t}function ge(s){if(!s)return s;const a=s.split(`

`);return a.length===2&&a[0].trim()===a[1].trim()?a[0].trim():s}function ls(s,a){var u,y,M;const i=R[a],t=new Date(s.publishedAt||s.createdAt),c=t.toISOString().split("T")[0],d=t.toTimeString().slice(0,5),m=[];if(s.images&&s.images.length>0)for(const o of s.images){const b=typeof o=="string"?o:o.url||o.path||o.source;b&&m.push({originalUrl:b,type:"image"})}else if(s.mainImage){const o=typeof s.mainImage=="string"?s.mainImage:s.mainImage.url||s.mainImage.path;o&&m.push({originalUrl:o,type:"image"})}let f="";if(s.video){const o=s.video.thumbnailPaths||[];for(const g of o){const v=typeof g=="string"?g:g.url||g.path;if(v){m.unshift({originalUrl:v,type:"image"});break}}const b=s.video.id||s.video._id||"";if(b){const g=`https://media.static.bstage.in/${i.mediaPrefix}/media/${b}/hls/ori.m3u8`;m.push({originalUrl:g,type:"video"}),f=`[å½±ç‰‡] ${g}`}else{const g=((u=s.video.hlsPath)==null?void 0:u.path)||((y=s.video.dashPath)==null?void 0:y.path)||"";if(g){let v=g;if(!g.startsWith("http")){const ys=g.startsWith("/")?g.slice(1):g;v=`https://media.static.bstage.in/${i.mediaPrefix}/${ys}`}m.push({originalUrl:v,type:"video"}),f=`[å½±ç‰‡] ${v}`}}}const T=i.authorMap[(M=s.author)==null?void 0:M.id]||i.defaultMember;let p="";const n=(s.title||"").trim(),U=(s.description||"").trim();return n&&U?p=n===U?n:U.includes(n)?U:`${n}

${U}`:p=n||U,{id:`mb-bstage-${s.id}`,member:T,date:c,time:d,caption:p||"",images:m,sourceUrl:`https://${i.domain}/story/feed/${s.typeId||s.id}`,notes:f,bstageId:s.id,paid:s.paid||!1}}async function rs(s){var c,d,m,f,T;B("processing"),Y({current:0,total:s.length,skipped:0,success:0,failed:0});let a=C;try{a=await _.load(),S(a)}catch(p){console.warn("é‡æ–°è¼‰å…¥è³‡æ–™å¤±æ•—ï¼Œä½¿ç”¨ç¾æœ‰ state åŽ»é‡",p)}const i=new Set(a.map(p=>p.id)),t=new Set(a.map(p=>p.sourceUrl).filter(Boolean));for(let p=0;p<s.length&&!G.current;p++){const n=s[p],U=(c=n.images)==null?void 0:c.some(u=>u.type==="video");if(ne&&!U){Y(u=>({...u,current:u.current+1,skipped:u.skipped+1})),x(`â­ è·³éŽï¼ˆéžå½±ç‰‡ï¼‰: ${n.date} ${((d=n.caption)==null?void 0:d.slice(0,30))||"(ç„¡æ–‡å­—)"}`,"info");continue}if(i.has(n.id)||t.has(n.sourceUrl)){if(Be||ne){const u=i.has(n.id)?n.id:null,y=a.find(M=>M.id===u||M.sourceUrl===n.sourceUrl);if(y){const M=ge(n.caption),o={...y,caption:M,date:n.date,time:n.time,updatedAt:Date.now()};if(ne&&U){const b=(y.media||[]).filter(v=>v.type!=="video"),g=n.images.filter(v=>v.type==="video").map(v=>({url:v.originalUrl,type:"video"}));o.media=[...b,...g],o.notes=n.notes||y.notes}await _.update(o).catch(b=>console.warn("æ›´æ–°å¤±æ•—:",b)),S(b=>b.map(g=>g.id===o.id?o:g)),x(`ðŸ”„ å·²æ›´æ–°${U?"ï¼ˆå«å½±ç‰‡ï¼‰":""}: ${n.date} ${(M==null?void 0:M.slice(0,30))||"(ç„¡æ–‡å­—)"}`,"info")}}else x(`â­ è·³éŽï¼ˆå·²å­˜åœ¨ï¼‰: ${n.date} ${((m=n.caption)==null?void 0:m.slice(0,30))||"(ç„¡æ–‡å­—)"}`,"info");Y(u=>({...u,current:u.current+1,skipped:u.skipped+1}));continue}try{const u=[];for(const o of n.images){if(o.type==="video"){u.push({url:o.originalUrl,type:"video"});continue}try{const b={context:"membership"},[g,v]=await Promise.all([be(o.originalUrl,b),je(o.originalUrl,b)]);u.push({url:g,type:o.type,...v&&{backupUrl:v}})}catch(b){console.warn("åœ–ç‰‡ä¸Šå‚³å¤±æ•—ï¼Œä½¿ç”¨åŽŸå§‹ URL:",b),u.push({url:o.originalUrl,type:o.type}),x("âš  åœ–ç‰‡å‚™ä»½å¤±æ•—ï¼Œä½¿ç”¨åŽŸå§‹é€£çµ","warn")}}const y={id:n.id,member:n.member,date:n.date,time:n.time,caption:n.caption,media:u,sourceUrl:n.sourceUrl,notes:n.notes,paid:n.paid||!1,createdAt:Date.now(),updatedAt:Date.now()};(await _.create(y)).skipped?(Y(o=>({...o,current:o.current+1,skipped:o.skipped+1})),x(`â­ è·³éŽï¼ˆD1 å·²å­˜åœ¨ï¼‰: ${n.date} ${((f=n.caption)==null?void 0:f.slice(0,30))||"(ç„¡æ–‡å­—)"}`,"info")):(S(o=>[y,...o]),i.add(n.id),t.add(n.sourceUrl),Y(o=>({...o,current:o.current+1,success:o.success+1})),x(`âœ… ${n.date} ${((T=n.caption)==null?void 0:T.slice(0,40))||"(ç„¡æ–‡å­—)"}`,"success"))}catch(u){console.error(`åŒ¯å…¥å¤±æ•—: ${n.id}`,u),Y(y=>({...y,current:y.current+1,failed:y.failed+1})),x(`âŒ å¤±æ•—: ${n.date} - ${u.message}`,"error")}await new Promise(u=>setTimeout(u,50))}}async function os(){if(!ie.trim()){N("è«‹è¼¸å…¥ b.stage Token","error");return}let s=ie.trim();s.toLowerCase().startsWith("bearer ")&&(s=s.slice(7));const a=pe,i=R[a].label;G.current=!1,Z([]),B("fetching"),Ee({page:0,totalItems:0}),x(`é–‹å§‹å¾ž ${i} æŠ“å–è³‡æ–™...`,"info");try{const t=await ns(s,a);if(G.current){B("done"),x("å·²å–æ¶ˆåŒ¯å…¥","warn");return}x(`âœ… æŠ“å–å®Œæˆï¼šå…± ${t.length} ç­†è²¼æ–‡`,"success");const c=t.map(m=>ls(m,a)),d=c.filter(m=>{var f;return(f=m.images)==null?void 0:f.some(T=>T.type==="video")}).length;d>0&&x(`ðŸŽ¬ å…¶ä¸­ ${d} ç­†å«å½±ç‰‡`,"info"),await rs(c),G.current?x("å·²å–æ¶ˆåŒ¯å…¥","warn"):x("ðŸŽ‰ åŒ¯å…¥å®Œæˆï¼","success")}catch(t){x(`âŒ éŒ¯èª¤: ${t.message}`,"error"),N(t.message,"error")}finally{B("done")}}function _e(){G.current=!0,x("æ­£åœ¨å–æ¶ˆ...","warn")}function N(s,a="success"){Ce({msg:s,type:a}),setTimeout(()=>Ce(null),2500)}function Le({title:s,content:a,type:i="warning",confirmText:t="ç¢ºå®š",cancelText:c="å–æ¶ˆ"}){return new Promise(d=>{de({title:s,content:a,type:i,confirmText:t,cancelText:c,onConfirm:()=>{de(null),d(!0)},onCancel:()=>{de(null),d(!1)}})})}const k=l.useMemo(()=>C.filter(s=>{var a,i,t;return!(q!=="all"&&s.member!==q&&!((a=ws[q])!=null&&a.includes(s.member))||ae==="video"&&!((i=s.notes)!=null&&i.includes("[å½±ç‰‡]"))||ae==="paid"&&!s.paid||te&&!((t=s.caption)!=null&&t.toLowerCase().includes(te.toLowerCase())))}).sort((s,a)=>new Date(a.date)-new Date(s.date)),[C,q,ae,te]);l.useEffect(()=>{const s=me.current;if(!s)return;const a=()=>{if(D!=="grid"){ue(1);return}const t=Math.min(s.clientWidth,window.innerWidth);if(t<500){ue(2);return}ue(Math.max(2,Math.floor(t/280)))};a();const i=new ResizeObserver(a);return i.observe(s),()=>i.disconnect()},[D]);const cs=l.useMemo(()=>Math.ceil(k.length/H),[k.length,H]),fe=Ws({count:cs,getScrollElement:()=>me.current,estimateSize:()=>D==="grid"?340:120,overscan:3,gap:D==="grid"?16:10});function Oe(){Ie(null),j({member:"å…¨å“¡",date:new Date().toISOString().split("T")[0],time:"",caption:"",media:[],sourceUrl:"",notes:"",paid:!1}),K(!1),X(""),F(!0)}function ds(s){Ie(s),j({member:s.member,date:s.date,time:s.time||"",caption:s.caption||"",media:s.media||[],sourceUrl:s.sourceUrl||"",notes:s.notes||"",paid:s.paid||!1}),K(!1),X(""),F(!0)}function ms(s){O(s),V(0)}function us(){const s=k.findIndex(a=>a.id===(r==null?void 0:r.id));s>0&&(O(k[s-1]),V(0))}function hs(){const s=k.findIndex(a=>a.id===(r==null?void 0:r.id));s<k.length-1&&(O(k[s+1]),V(0))}function xe(){return k.findIndex(s=>s.id===(r==null?void 0:r.id))}function ps(){r&&(ds(r),O(null))}async function gs(){if(!he.trim())return;const s=he.split(`
`).map(t=>t.trim()).filter(t=>t&&(t.startsWith("http")||t.startsWith("//")));if(s.length===0){N("è«‹è¼¸å…¥æœ‰æ•ˆçš„ç¶²å€","error");return}const a=s.map((t,c)=>qe(t)?{url:t,type:"youtube",thumbnail:le(t),index:h.media.length+c}:{url:t,type:"image",uploading:!0,originalUrl:t,index:h.media.length+c});j(t=>({...t,media:[...t.media,...a]}));const i=a.filter(t=>t.type==="image");Pe(t=>t+i.length);for(const t of i)fs(t.originalUrl,t.index);X(""),K(!1),N(`å·²æ–°å¢ž ${s.length} å€‹åª’é«”`)}async function fs(s,a){try{const i={context:"membership"},[t,c]=await Promise.all([be(s,i),je(s,i)]);j(d=>({...d,media:d.media.map((m,f)=>f===a?{...m,url:t,backupUrl:c,uploading:!1}:m)})),c&&console.log(`âœ… åœ–ç‰‡ ${a+1} é›™é‡å‚™ä»½å®Œæˆ`)}catch(i){console.warn(`åœ–ç‰‡ ${a+1} ä¸Šå‚³å¤±æ•—`,i),j(t=>({...t,media:t.media.map((c,d)=>d===a?{...c,uploading:!1,uploadFailed:!0}:c)}))}finally{Pe(i=>i-1)}}async function xs(s){const a=Array.from(s.target.files);if(a.length){Te(!0);try{const i=[];for(const t of a){const c={context:"membership"},[d,m]=await Promise.all([be(t,c),je(t,c)]);i.push({url:d,type:"image",...m&&{backupUrl:m}})}j(t=>({...t,media:[...t.media,...i]})),N(`å·²æ–°å¢ž ${i.length} å€‹æª”æ¡ˆ`)}catch(i){console.error("ä¸Šå‚³å¤±æ•—",i),N("ä¸Šå‚³å¤±æ•—","error")}finally{Te(!1)}}}const[ee,Ve]=l.useState("");function bs(){if(!ee.trim())return;if(!qe(ee)){N("è«‹è¼¸å…¥æœ‰æ•ˆçš„ YouTube é€£çµ","error");return}const s=le(ee);j(a=>({...a,media:[...a.media,{url:ee.trim(),type:"youtube",thumbnail:s}]})),Ve(""),N("å·²æ–°å¢ž YouTube å½±ç‰‡")}function js(s){j(a=>({...a,media:a.media.filter((i,t)=>t!==s)}))}async function vs(){if(!h.date||!h.member){N("è«‹å¡«å¯«å¿…è¦æ¬„ä½","error");return}if(h.media.some(i=>i.uploading)&&!await Le({title:"âš ï¸ ä¸Šå‚³æœªå®Œæˆ",type:"warning",confirmText:"ä»è¦å„²å­˜",cancelText:"ç­‰å¾…ä¸Šå‚³",content:e.jsxs("div",{className:"confirm-content",children:[e.jsx("p",{children:"é‚„æœ‰åœ–ç‰‡æ­£åœ¨ä¸Šå‚³ä¸­ï¼Œç¢ºå®šè¦ç¾åœ¨å„²å­˜å—Žï¼Ÿ"}),e.jsx("p",{className:"confirm-warning",children:"æœªå®Œæˆä¸Šå‚³çš„åœ–ç‰‡å¯èƒ½ç„¡æ³•æ­£å¸¸é¡¯ç¤º"})]})}))return;const a={id:($==null?void 0:$.id)||Ts("mb"),member:h.member,date:h.date,time:h.time,caption:h.caption,media:h.media.map(i=>({url:i.url,type:i.type,...i.backupUrl&&{backupUrl:i.backupUrl},...i.thumbnail&&{thumbnail:i.thumbnail}})),sourceUrl:h.sourceUrl,notes:h.notes,paid:h.paid||!1,createdAt:($==null?void 0:$.createdAt)||Date.now(),updatedAt:Date.now()};ke(!0);try{$?(await _.update(a),S(C.map(i=>i.id===$.id?a:i))):(await _.create(a),S([a,...C])),N("å·²å„²å­˜"),F(!1)}catch(i){console.error("å„²å­˜å¤±æ•—",i),N("å„²å­˜å¤±æ•—","error")}finally{ke(!1)}}async function Ns(s){if(await Le({title:"ðŸ—‘ï¸ åˆªé™¤ç¢ºèª",type:"danger",confirmText:"åˆªé™¤",cancelText:"å–æ¶ˆ",content:e.jsxs("div",{className:"confirm-content",children:[e.jsx("p",{children:"ç¢ºå®šè¦åˆªé™¤é€™ç­†å‚™ä»½å—Žï¼Ÿ"}),e.jsx("p",{className:"confirm-warning",children:"æ­¤æ“ä½œç„¡æ³•å¾©åŽŸ"})]})}))try{await _.delete(s),S(C.filter(i=>i.id!==s)),N("å·²åˆªé™¤")}catch(i){console.error("åˆªé™¤å¤±æ•—",i),N("åˆªé™¤å¤±æ•—","error")}}return Xe?e.jsxs("div",{className:"membership-loading",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"è¼‰å…¥ä¸­..."})]}):e.jsxs("div",{className:"membership-archive",children:[e.jsxs("header",{className:"membership-header",children:[e.jsx("div",{style:{display:"flex",alignItems:"center",gap:8},children:e.jsx("h1",{children:"ðŸ”’ æœƒå“¡å‚™ä»½"})}),e.jsxs("div",{className:"header-actions",children:[P&&e.jsx("button",{className:"membership-import-btn",onClick:()=>J(!0),title:"å¾ž b.stage åŒ¯å…¥",children:e.jsx(ve,{size:18})}),e.jsx("button",{className:"add-btn",onClick:Oe,title:"æ–°å¢žå‚™ä»½",children:e.jsx(Ms,{size:20})}),I&&e.jsxs("div",{className:"nav-menu-wrapper",children:[e.jsx("button",{onClick:()=>W(!Se),className:"hamburger-btn",title:"é¸å–®",children:e.jsx(zs,{size:18})}),Se&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"nav-menu-overlay",onClick:()=>W(!1)}),e.jsxs("div",{className:"nav-menu",children:[e.jsxs("button",{className:`nav-menu-item ${L==="timeline"?"active":""}`,onClick:()=>{I("timeline"),W(!1)},children:[e.jsx("span",{children:"ðŸ“…"})," æ™‚é–“è»¸"]}),e.jsxs("button",{className:`nav-menu-item ${L==="social"?"active":""}`,onClick:()=>{I("social"),W(!1)},children:[e.jsx("span",{children:"ðŸ“·"})," ç¤¾ç¾¤å‚™ä»½"]}),e.jsxs("button",{className:`nav-menu-item ${L==="membership"?"active":""}`,onClick:()=>{I("membership"),W(!1)},children:[e.jsx("span",{children:"ðŸ”’"})," æœƒå“¡å‚™ä»½"]})]})]})]})]})]}),e.jsxs("div",{className:"membership-filters",children:[e.jsxs("div",{className:"filter-row",children:[e.jsxs("select",{value:q,onChange:s=>Je(s.target.value),className:"filter-select",children:[e.jsx("option",{value:"all",children:"æ‰€æœ‰æˆå“¡"}),We.map(s=>e.jsx("option",{value:s.name,children:s.name},s.name))]}),e.jsxs("select",{value:ae,onChange:s=>Qe(s.target.value),className:"filter-select",children:[e.jsx("option",{value:"all",children:"æ‰€æœ‰é¡žåž‹"}),e.jsx("option",{value:"video",children:"ðŸŽ¬ å«å½±ç‰‡"}),e.jsx("option",{value:"paid",children:"ðŸ”’ æœƒå“¡é™å®š"})]}),e.jsxs("div",{className:"search-box",children:[e.jsx(Ps,{size:16}),e.jsx("input",{type:"text",placeholder:"æœå°‹å…§å®¹...",value:te,onChange:s=>Ze(s.target.value)})]}),e.jsxs("div",{className:"view-toggle",children:[e.jsx("button",{className:D==="grid"?"active":"",onClick:()=>Ue("grid"),children:e.jsx(Ds,{size:16})}),e.jsx("button",{className:D==="list"?"active":"",onClick:()=>Ue("list"),children:e.jsx(As,{size:16})})]})]}),e.jsxs("div",{className:"filter-stats",children:["å…± ",k.length," ç­†å‚™ä»½"]})]}),e.jsx("div",{ref:me,className:"membership-content-scroll",children:k.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx(He,{size:48}),e.jsx("p",{children:"å°šç„¡æœƒå“¡å‚™ä»½è³‡æ–™"}),e.jsx("button",{onClick:Oe,children:"æ–°å¢žç¬¬ä¸€ç­†"})]}):e.jsx("div",{style:{height:fe.getTotalSize(),position:"relative"},children:fe.getVirtualItems().map(s=>{const a=s.index*H,i=k.slice(a,a+H);return e.jsx("div",{className:`membership-content ${D}`,style:{position:"absolute",top:0,left:0,right:0,transform:`translateY(${s.start}px)`,...D==="grid"?{gridTemplateColumns:`repeat(${H}, 1fr)`}:{}},ref:fe.measureElement,"data-index":s.index,children:i.map(t=>{var c;return e.jsxs("div",{className:"archive-card",onClick:()=>ms(t),children:[e.jsxs("div",{className:"archive-thumb",children:[(()=>{var f,T,p;const d=((f=t.media)==null?void 0:f.find(n=>n.type!=="video"))||((T=t.media)==null?void 0:T[0]),m=(p=t.media)==null?void 0:p.some(n=>n.type==="video");return d?d.type==="youtube"?e.jsxs("div",{className:"video-thumb-img",children:[e.jsx("img",{src:d.thumbnail||le(d.url),alt:"",loading:"lazy",width:260,height:260}),e.jsx(oe,{size:24,className:"play-overlay"})]}):e.jsxs("div",{className:m?"video-thumb-img":"",children:[e.jsx("img",{src:ks(d),alt:"",loading:"lazy",width:260,height:260}),m&&e.jsx(oe,{size:24,className:"play-overlay"})]}):e.jsx("div",{className:"no-thumb",children:e.jsx("img",{src:"/bigbang-timeline/bigbang-default.png",alt:"BIGBANG"})})})(),((c=t.media)==null?void 0:c.length)>1&&e.jsxs("span",{className:"media-count",children:["+",t.media.length-1]}),t.paid&&e.jsx("span",{className:"paid-overlay",children:e.jsx(He,{size:14})})]}),e.jsxs("div",{className:"archive-info",children:[e.jsxs("div",{className:"archive-meta",children:[e.jsx("span",{className:"member-tag",style:{background:re(t.member)+"30",color:re(t.member)},children:t.member}),e.jsx("span",{className:"date",children:Cs(t.date)})]}),t.caption&&e.jsx("p",{className:"archive-caption",children:ge(t.caption)})]})]},t.id)})},s.key)})})}),r&&e.jsxs("div",{className:"modal-overlay view-modal-overlay",onClick:()=>O(null),children:[e.jsxs("div",{className:"post-nav-indicator",onClick:s=>s.stopPropagation(),children:[xe()+1," / ",k.length]}),e.jsx("button",{className:"post-nav-side prev",onClick:s=>{s.stopPropagation(),us()},disabled:xe()<=0,title:"ä¸Šä¸€å‰‡",children:e.jsx(Es,{size:32})}),e.jsxs("div",{className:"view-modal",onClick:s=>s.stopPropagation(),children:[e.jsx("button",{className:"view-close-btn",onClick:()=>O(null),children:e.jsx(ce,{size:24})}),e.jsx("div",{className:"view-media-area",children:((Ye=r.media)==null?void 0:Ye.length)>0?e.jsxs(e.Fragment,{children:[((Ge=r.media[A])==null?void 0:Ge.type)==="youtube"?e.jsx("iframe",{src:`https://www.youtube.com/embed/${Ss(r.media[A].url)}?autoplay=1`,allow:"autoplay; encrypted-media",allowFullScreen:!0,className:"view-media view-youtube"}):((Re=r.media[A])==null?void 0:Re.type)==="video"?e.jsx(qs,{src:r.media[A].url,className:"view-media"},`${r.id}-${A}`):e.jsx("img",{src:Us(r.media[A]),alt:"",className:"view-media"},`${r.id}-${A}`),r.media.length>1&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"media-nav prev",onClick:()=>V(s=>(s-1+r.media.length)%r.media.length),children:"â€¹"}),e.jsx("button",{className:"media-nav next",onClick:()=>V(s=>(s+1)%r.media.length),children:"â€º"}),e.jsx("div",{className:"media-dots",children:r.media.map((s,a)=>e.jsx("span",{className:`dot ${a===A?"active":""}`,onClick:()=>V(a)},a))})]})]}):e.jsx("div",{className:"no-media",children:e.jsx("img",{src:"/bigbang-timeline/bigbang-default.png",alt:"BIGBANG",className:"no-media-img"})})}),e.jsxs("div",{className:"view-info-area",children:[e.jsxs("div",{className:"view-header",children:[e.jsx("span",{className:"member-tag",style:{background:re(r.member)+"30",color:re(r.member)},children:r.member}),r.paid&&e.jsx("span",{className:"paid-badge",children:"ðŸ”’ æœƒå“¡é™å®š"}),e.jsx("span",{className:"view-date",children:Is(r.date,r.time)})]}),r.caption&&e.jsx("div",{className:"view-caption",children:e.jsx("p",{children:ge(r.caption)})}),P&&r.notes&&e.jsxs("div",{className:"view-notes",children:[e.jsx("strong",{children:"å‚™è¨»ï¼š"}),e.jsx("p",{children:(()=>{var a;const s=((a=Object.values(R).find(i=>{var t;return(t=r.sourceUrl)==null?void 0:t.includes(i.domain)}))==null?void 0:a.mediaPrefix)||"";return r.notes.split(/(https?:\/\/[^\s]+|\/media\/[^\s]+)/g).map((i,t)=>{if(/^https?:\/\//.test(i))return e.jsx("a",{href:i,target:"_blank",rel:"noopener noreferrer",style:{color:"#D4AF37",wordBreak:"break-all"},children:i},t);if(/^\/media\//.test(i)){const c=`https://media.static.bstage.in/${s}${i}`;return e.jsx("a",{href:c,target:"_blank",rel:"noopener noreferrer",style:{color:"#D4AF37",wordBreak:"break-all"},children:i},t)}return i})})()})]}),e.jsxs("div",{className:"view-actions",children:[r.sourceUrl&&e.jsxs("a",{href:r.sourceUrl,target:"_blank",rel:"noopener noreferrer",className:"view-link-btn",children:[e.jsx(Fs,{size:16})," é–‹å•ŸåŽŸæ–‡"]}),e.jsx("button",{className:"view-edit-btn",onClick:ps,children:"âœï¸ ç·¨è¼¯"})]})]})]}),e.jsx("button",{className:"post-nav-side next",onClick:s=>{s.stopPropagation(),hs()},disabled:xe()>=k.length-1,title:"ä¸‹ä¸€å‰‡",children:e.jsx(Bs,{size:32})})]}),es&&e.jsx("div",{className:"modal-overlay",onClick:()=>F(!1),children:e.jsxs("div",{className:"membership-modal",onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{children:$?"ç·¨è¼¯å‚™ä»½":"æ–°å¢žå‚™ä»½"}),e.jsx("button",{className:"close-btn",onClick:()=>F(!1),children:e.jsx(ce,{size:20})})]}),e.jsxs("div",{className:"modal-body",children:[e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"æˆå“¡"}),e.jsx("select",{value:h.member,onChange:s=>j(a=>({...a,member:s.target.value})),children:We.map(s=>e.jsx("option",{value:s.name,children:s.name},s.name))})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{children:[e.jsx(_s,{size:14})," ç™¼æ–‡æ—¥æœŸ"]}),e.jsx("input",{type:"date",value:h.date,onChange:s=>j(a=>({...a,date:s.target.value}))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"æ™‚é–“ï¼ˆé¸å¡«ï¼‰"}),e.jsx("input",{type:"time",value:h.time,onChange:s=>j(a=>({...a,time:s.target.value}))})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{children:[e.jsx(Ke,{size:14})," b.stage åŽŸå§‹é€£çµï¼ˆé¸å¡«ï¼‰"]}),e.jsx("input",{type:"url",placeholder:"è²¼ä¸Š b.stage åŽŸå§‹é€£çµ...",value:h.sourceUrl,onChange:s=>j(a=>({...a,sourceUrl:s.target.value}))})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{children:[e.jsx(Ls,{size:14})," åœ–ç‰‡ / YouTube å½±ç‰‡",ze>0&&e.jsxs("span",{className:"upload-status",children:["ï¼ˆ",ze," å¼µä¸Šå‚³ä¸­...ï¼‰"]})]}),e.jsxs("div",{className:"media-upload-area",children:[h.media.map((s,a)=>e.jsxs("div",{className:`media-preview ${s.uploading?"uploading":""} ${s.uploadFailed?"failed":""}`,children:[s.type==="youtube"?e.jsxs("div",{className:"video-preview-img",children:[e.jsx("img",{src:s.thumbnail||le(s.url),alt:""}),e.jsx(oe,{size:16,className:"play-icon"})]}):e.jsx("img",{src:s.url,alt:""}),s.uploading&&e.jsx("div",{className:"upload-overlay",children:e.jsx("div",{className:"mini-spinner"})}),s.uploadFailed&&e.jsx("div",{className:"upload-failed-badge",title:"ä¸Šå‚³å¤±æ•—ï¼Œå°‡ä½¿ç”¨åŽŸå§‹é€£çµ",children:"âš ï¸"}),e.jsx("button",{className:"remove-media",onClick:()=>js(a),children:e.jsx(ce,{size:14})})]},a)),e.jsxs("label",{className:"upload-btn",children:[e.jsx("input",{type:"file",accept:"image/*",multiple:!0,onChange:xs,disabled:$e}),$e?e.jsx("span",{className:"uploading-text",children:"ä¸Šå‚³ä¸­..."}):e.jsxs(e.Fragment,{children:[e.jsx(Os,{size:20}),e.jsx("span",{children:"ä¸Šå‚³åœ–ç‰‡"})]})]}),e.jsxs("button",{type:"button",className:"manual-url-toggle",onClick:()=>K(!Me),children:[e.jsx(Ke,{size:16}),e.jsx("span",{children:"è²¼ä¸Šç¶²å€"})]})]}),e.jsxs("div",{className:"youtube-input-row",children:[e.jsx("input",{type:"url",placeholder:"è²¼ä¸Š YouTube é€£çµ...",value:ee,onChange:s=>Ve(s.target.value)}),e.jsxs("button",{onClick:bs,title:"æ–°å¢ž YouTube å½±ç‰‡",children:[e.jsx(oe,{size:16})," æ–°å¢žå½±ç‰‡"]})]}),Me&&e.jsxs("div",{className:"manual-url-input",children:[e.jsx("p",{className:"manual-hint",children:"ðŸ’¡ æç¤ºï¼šæ¯è¡Œè²¼ä¸€å€‹åœ–ç‰‡ç¶²å€ï¼Œæ”¯æ´åœ–ç‰‡å’Œ YouTube é€£çµ"}),e.jsx("textarea",{placeholder:"è²¼ä¸Šåœ–ç‰‡/YouTube ç¶²å€ï¼Œæ¯è¡Œä¸€å€‹...",value:he,onChange:s=>X(s.target.value),rows:4}),e.jsxs("div",{className:"manual-actions",children:[e.jsx("button",{type:"button",className:"cancel-manual",onClick:()=>{K(!1),X("")},children:"å–æ¶ˆ"}),e.jsx("button",{type:"button",className:"submit-manual",onClick:gs,children:"æ–°å¢žåª’é«”"})]})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"è²¼æ–‡å…§å®¹"}),e.jsx("textarea",{placeholder:"è²¼ä¸Š b.stage è²¼æ–‡å…§å®¹...",value:h.caption,onChange:s=>j(a=>({...a,caption:s.target.value})),rows:4})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"å‚™è¨»ï¼ˆé¸å¡«ï¼‰"}),e.jsx("textarea",{placeholder:"å…¶ä»–å‚™è¨»...",value:h.notes,onChange:s=>j(a=>({...a,notes:s.target.value})),rows:2})]}),e.jsx("div",{className:"form-group paid-checkbox-group",children:e.jsxs("label",{className:"paid-checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:h.paid||!1,onChange:s=>j(a=>({...a,paid:s.target.checked}))}),e.jsx("span",{children:"ðŸ”’ æœƒå“¡é™å®šå…§å®¹"})]})})]}),e.jsxs("div",{className:"modal-footer",children:[$&&e.jsxs("button",{className:"delete-btn",onClick:()=>{Ns($.id),F(!1)},children:[e.jsx(Vs,{size:16})," åˆªé™¤"]}),e.jsx("button",{className:"cancel-btn",onClick:()=>F(!1),children:"å–æ¶ˆ"}),e.jsxs("button",{className:"save-btn",onClick:vs,disabled:we,children:[e.jsx(Ys,{size:16})," ",we?"å„²å­˜ä¸­...":"å„²å­˜"]})]})]})}),se&&e.jsxs("div",{className:`toast ${se.type}`,children:[se.type==="error"?e.jsx(Gs,{size:16}):e.jsx(Rs,{size:16}),se.msg]}),z&&e.jsx("div",{className:"confirm-modal-overlay",onClick:z.onCancel,children:e.jsxs("div",{className:`confirm-modal confirm-modal-${z.type}`,onClick:s=>s.stopPropagation(),children:[e.jsx("h3",{className:"confirm-modal-title",children:z.title}),e.jsx("div",{className:"confirm-modal-body",children:z.content}),e.jsxs("div",{className:"confirm-modal-actions",children:[e.jsx("button",{className:"confirm-modal-cancel",onClick:z.onCancel,children:z.cancelText}),e.jsx("button",{className:`confirm-modal-confirm confirm-modal-confirm-${z.type}`,onClick:z.onConfirm,children:z.confirmText})]})]})}),ss&&e.jsx("div",{className:"modal-overlay",onClick:()=>{(!w||w==="done")&&(J(!1),B(null),Q(""),Z([]))},children:e.jsxs("div",{className:"membership-modal import-modal",onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("h2",{children:[e.jsx(ve,{size:18})," å¾ž b.stage åŒ¯å…¥"]}),e.jsx("button",{className:"close-btn",onClick:()=>{w&&w!=="done"?_e():(J(!1),B(null),Q(""),Z([]))},children:e.jsx(ce,{size:20})})]}),e.jsxs("div",{className:"modal-body",children:[!w&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"é¸æ“‡ç«™å°"}),e.jsx("select",{className:"import-site-select",value:pe,onChange:s=>De(s.target.value),children:Object.entries(R).map(([s,a])=>e.jsx("option",{value:s,children:a.label},s))})]}),e.jsxs("div",{className:"form-group",style:{marginTop:12},children:[e.jsx("label",{children:"Bearer Token"}),e.jsx("textarea",{className:"import-token-input",placeholder:"å¾ž b.stage é–‹ç™¼è€…å·¥å…·è¤‡è£½ Bearer token...",value:ie,onChange:s=>Q(s.target.value),rows:3}),e.jsxs("p",{className:"import-hint",children:["åœ¨ ",R[pe].domain," ç™»å…¥ â†’ F12 é–‹ç™¼è€…å·¥å…· â†’ Network â†’ æ‰¾ä»»æ„ API è«‹æ±‚ â†’ è¤‡è£½ authorization header çš„å€¼",e.jsx("br",{}),"âš ï¸ Token ç´„ 30 åˆ†é˜éŽæœŸï¼Œæ¯å€‹ç«™å°éœ€ä½¿ç”¨å„è‡ªçš„ Token"]})]}),e.jsxs("div",{className:"form-group",style:{marginTop:12,display:"flex",flexDirection:"column",gap:8},children:[e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8,cursor:"pointer"},children:[e.jsx("input",{type:"checkbox",checked:Be,onChange:s=>as(s.target.checked)}),"å¼·åˆ¶æ›´æ–°å·²å­˜åœ¨çš„è²¼æ–‡ï¼ˆä¸é‡å‚³åœ–ç‰‡ï¼Œåƒ…æ›´æ–°æ–‡å­—/æ—¥æœŸï¼‰"]}),e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8,cursor:"pointer"},children:[e.jsx("input",{type:"checkbox",checked:ne,onChange:s=>ts(s.target.checked)}),"ðŸŽ¬ åªè™•ç†å«å½±ç‰‡çš„è²¼æ–‡ï¼ˆæ›´æ–°å½±ç‰‡é€£çµåˆ°å·²å­˜åœ¨çš„è²¼æ–‡ï¼‰"]})]})]}),w==="fetching"&&e.jsxs("div",{className:"import-progress-section",children:[e.jsx("h3",{children:"ðŸ”„ æŠ“å– b.stage è³‡æ–™ä¸­..."}),e.jsxs("p",{className:"import-progress-text",children:["ç¬¬ ",Ae.page," é ï¼Œå·²æŠ“å– ",Ae.totalItems," ç­†"]}),e.jsx("div",{className:"import-progress-bar",children:e.jsx("div",{className:"import-progress-bar-fill fetching"})})]}),(w==="processing"||w==="done")&&e.jsxs("div",{className:"import-progress-section",children:[e.jsx("h3",{children:w==="done"?"âœ… åŒ¯å…¥å®Œæˆ":"ðŸ“¦ è™•ç†ä¸­..."}),e.jsxs("div",{className:"import-stats",children:[e.jsxs("span",{className:"import-stat success",children:["âœ… ",E.success]}),e.jsxs("span",{className:"import-stat skipped",children:["â­ ",E.skipped]}),e.jsxs("span",{className:"import-stat failed",children:["âŒ ",E.failed]})]}),E.total>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"import-progress-bar",children:e.jsx("div",{className:"import-progress-bar-fill",style:{width:`${E.current/E.total*100}%`}})}),e.jsxs("p",{className:"import-progress-text",children:[E.current," / ",E.total]})]})]}),Fe.length>0&&e.jsx("div",{className:"import-log",children:Fe.map((s,a)=>e.jsx("div",{className:`import-log-line import-log-${s.type}`,children:s.msg},a))})]}),e.jsxs("div",{className:"modal-footer",children:[!w&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"cancel-btn",onClick:()=>{J(!1),Q("")},children:"å–æ¶ˆ"}),e.jsxs("button",{className:"save-btn",onClick:os,disabled:!ie.trim(),children:[e.jsx(ve,{size:16})," é–‹å§‹åŒ¯å…¥"]})]}),w&&w!=="done"&&e.jsx("button",{className:"cancel-btn",onClick:_e,children:"å–æ¶ˆåŒ¯å…¥"}),w==="done"&&e.jsx("button",{className:"save-btn",onClick:()=>{J(!1),B(null),Q(""),Z([]),De("gdragon")},children:"é—œé–‰"})]})]})})]})}const Zs=l.memo(Hs);export{Zs as default};
