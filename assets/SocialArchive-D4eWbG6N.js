import{j as e,s as _,N as Ds,M as zs,g as st,a as Gt,b as Te,f as Lt,c as Fs,d as Ps,e as As,h as Os,u as Gs,i as Ls,k as Rt,l as Rs,m as Ie,n as Me}from"./index-CNT9JRFB.js";import{a as d,U as Be,d as Es,A as Ys,F as _s,o as at,p as Ws,G as Hs,q as Vs,s as Et,t as nt,u as qs,f as ce,R as lt,C as Js,X as oe,E as Xs,b as Ks,v as it,e as Qs,I as Zs,T as Yt,S as ea,w as ta,i as _t,j as sa}from"./icons-51PM2evP.js";import{u as aa}from"./ArchiveBase-D6wGan7_.js";import"./vendor-DhQqL_yF.js";function Wt({label:N,options:C,value:U,onChange:I,isOpen:w,onToggle:T,allLabel:P="å…¨éƒ¨",allValue:D="all",className:R=""}){const[te,H]=d.useState(!1),se=d.useRef(null);d.useEffect(()=>{const S=()=>{H("ontouchstart"in window||window.matchMedia("(pointer: coarse)").matches||window.innerWidth<768)};return S(),window.addEventListener("resize",S),()=>window.removeEventListener("resize",S)},[]),d.useEffect(()=>{if(!w)return;const S=Oe=>{se.current&&!se.current.contains(Oe.target)&&T()};return document.addEventListener("mousedown",S),()=>document.removeEventListener("mousedown",S)},[w,T]);const E=C.find(S=>S.value===U),Ae=U===D?N:(E==null?void 0:E.label)||U;return te?e.jsxs("select",{className:"filter-select",value:U,onChange:S=>I(S.target.value),children:[e.jsx("option",{value:D,children:P}),C.map(S=>e.jsx("option",{value:S.value,children:S.label},S.value))]}):e.jsxs("div",{ref:se,className:`filter-dropdown ${R}`,children:[e.jsxs("button",{className:`filter-btn dropdown-toggle ${U!==D?"active":""}`,onClick:T,children:[Ae,e.jsx("span",{className:"dropdown-arrow",children:w?"â–²":"â–¼"})]}),w&&e.jsxs("div",{className:"filter-dropdown-list",children:[e.jsx("button",{className:`filter-dropdown-item ${U===D?"active":""}`,onClick:()=>I(D),children:P}),C.map(S=>e.jsx("button",{className:`filter-dropdown-item ${U===S.value?"active":""}`,style:{color:U===S.value?S.color:void 0},onClick:()=>I(S.value),children:S.label},S.value))]})]})}const ee=[{id:"post",label:"è²¼æ–‡",icon:"ðŸ“·",color:"#E1306C"},{id:"story",label:"Story",icon:"â­•",color:"#833AB4"},{id:"reels",label:"Reels",icon:"ðŸŽ¬",color:"#F77737"}],Ht={"G-Dragon":{main:"xxxibgdrgn"},"T.O.P":{main:"ttt",extra:[{username:"tttopost",type:"post",dateFormat:"auto"},{username:"top.ttt.story",type:"story",dateFormat:"auto",isPrefix:!0}]},å¤ªé™½:{main:"__youngbae__"},å¤§è²:{main:"d_lable_official"},å‹åˆ©:{main:""},å…¨å“¡:{main:"bigbangofficial"}};function De(N){if(!N)return"å…¨å“¡";const C=N.toLowerCase();for(const[U,I]of Object.entries(Ht)){if(I.main&&C===I.main.toLowerCase())return U;if(I.extra)for(const w of I.extra){const T=w.username.toLowerCase();if(w.isPrefix?C.startsWith(T):C===T)return U}}return"å…¨å“¡"}function ze(N){if(!N)return null;const C=N.toLowerCase();for(const U of Object.values(Ht))if(U.extra)for(const I of U.extra){const w=I.username.toLowerCase();if(I.isPrefix?C.startsWith(w):C===w)return I}return null}function W(N,C){if(!N||!C)return null;function U(w){const T=w.match(/(\d{4})-(\d{1,2})-(\d{1,2})/);if(T){const P=T[1],D=T[2].padStart(2,"0"),R=T[3].padStart(2,"0");return`${P}-${D}-${R}`}return null}function I(w){const T=w.match(/\b(\d{6})\b/);if(T){const P=T[1],D=parseInt(P.substring(0,2),10),R=P.substring(2,4),te=P.substring(4,6);return`${D>=50?1900+D:2e3+D}-${R}-${te}`}return null}return C==="auto"?U(N)||I(N):C==="iso"?U(N):C==="6digits"?I(N):null}function na(N){if(!N)return null;const C=N.match(/instagram\.com\/stories\/([^\/]+)\//);if(C)return C[1];const U=N.match(/instagram\.com\/([^\/]+)\/(?:p|reel|reels|tv)\//);return U&&!["p","reel","reels","tv","stories","explore"].includes(U[1])?U[1]:null}function Fe(N,C){return N||na(C)||null}async function Pe(N){try{const C=`${Rs.IG_SCRAPER_URL}/scrape?url=${encodeURIComponent(N)}`;return await(await fetch(C)).json()}catch(C){return console.error("IG æŠ“å–å¤±æ•—:",C),{success:!1,error:C.message}}}function la({isAdmin:N,onBack:C,currentPage:U,setCurrentPage:I}){var Mt,Bt,Dt,zt,Ft,Pt;const[w,T]=d.useState([]),[P,D]=d.useState(!0),[R,te]=d.useState(!1),[H,se]=d.useState(null),[E,Ae]=d.useState([]),[S,Oe]=d.useState("all"),[de,Vt]=d.useState(!1),[be,qt]=d.useState(!1),[je,Jt]=d.useState("all"),[ae,Xt]=d.useState(!0),[rt,ve]=d.useState(!1),[ct,Ge]=d.useState(!1),[ot,we]=d.useState(!1),[ye,Kt]=d.useState(""),[Y,dt]=d.useState("grid"),[V,Qt]=d.useState({}),[Le,ut]=d.useState(!1),[mt,ht]=d.useState({current:0,total:0}),[Zt,q]=d.useState(!1),[z,pt]=d.useState(null),[v,M]=d.useState({type:"post",member:"å…¨å“¡",date:new Date().toISOString().split("T")[0],time:"",igUrl:"",caption:"",media:[],notes:""}),[ft,gt]=d.useState(!1),[h,J]=d.useState(null),[G,X]=d.useState(0),[K,Re]=d.useState(!1),[A,Q]=d.useState([]),[xt,bt]=d.useState(!1),[jt,vt]=d.useState({current:0,total:0}),[es,wt]=d.useState(null),ne=d.useRef(!1),[ts,ue]=d.useState(!1),[me,Ee]=d.useState(""),[le,yt]=d.useState(!1),[he,Ye]=d.useState({current:0,total:0}),[pe,Z]=d.useState([]),ie=d.useRef(!1),[_e,ss]=d.useState(!1),[as,We]=d.useState(!1),[O,He]=d.useState(null),Ve=d.useRef(null),[fe,qe]=d.useState(()=>window.innerWidth<500?2:Math.max(2,Math.floor(Math.min(900,window.innerWidth)/280)));d.useEffect(()=>{ns()},[]);async function ns(){D(!0);try{const t=await _.load();T(t)}catch(t){console.error("è¼‰å…¥å¤±æ•—",t),x("è¼‰å…¥å¤±æ•—","error")}finally{D(!1)}}function x(t,a="success"){se({msg:t,type:a}),setTimeout(()=>se(null),2500)}function ge({title:t,content:a,type:n="warning",confirmText:s="ç¢ºå®š",cancelText:u="å–æ¶ˆ"}){return new Promise(r=>{He({title:t,content:a,type:n,confirmText:s,cancelText:u,onConfirm:()=>{He(null),r(!0)},onCancel:()=>{He(null),r(!1)}})})}function ls(t){var a;return(a=t.media)==null?void 0:a.some(n=>n.type==="video"||n.type==="youtube")}function is(t){var a;return((a=V[t.id])==null?void 0:a.length)>0}async function xe(t){if(!t)return!1;try{const a=new AbortController,n=setTimeout(()=>a.abort(),1e4),s=await fetch(t,{method:"HEAD",mode:"cors",signal:a.signal});return clearTimeout(n),s.ok?!0:(console.log(`âŒ åœ–ç‰‡æª¢æŸ¥å¤±æ•— (HTTP ${s.status}): ${t}`),!1)}catch{return new Promise(n=>{const s=new window.Image,u=setTimeout(()=>{s.src="",n(!1)},1e4);s.onload=()=>{clearTimeout(u),s.naturalWidth===0||s.naturalHeight===0?n(!1):n(!0)},s.onerror=()=>{clearTimeout(u),n(!1)},s.src=t})}}async function rs(){var s;ut(!0),ht({current:0,total:w.length});const t={};let a=0;for(const u of w){const r=[];if(((s=u.media)==null?void 0:s.length)>0)for(let c=0;c<u.media.length;c++){const l=u.media[c],b=l.type==="video"?l.thumbnail:l.url;b&&(await xe(b)||r.push(c))}r.length>0&&(t[u.id]=r),a++,ht({current:a,total:w.length})}Qt(t),ut(!1);const n=Object.keys(t).length;n>0?x(`æª¢æŸ¥å®Œæˆï¼š${n} ç­†æœ‰å£žåœ–`,"error"):x("æª¢æŸ¥å®Œæˆï¼šæ²’æœ‰ç™¼ç¾å£žåœ– âœ…")}const cs=d.useMemo(()=>{const t=new Set;w.forEach(n=>{if(n.date){const s=n.date.substring(0,4);s&&t.add(s)}});const a=Array.from(t).sort((n,s)=>s-n);return ae?a:a.reverse()},[w,ae]),B=d.useMemo(()=>w.filter(t=>{var a;return!(E.length>0&&!E.includes(t.member)||S!=="all"&&t.type!==S||de&&!ls(t)||be&&!is(t)||je!=="all"&&t.date&&!t.date.startsWith(je)||ye&&!((a=t.caption)!=null&&a.toLowerCase().includes(ye.toLowerCase())))}).sort((t,a)=>{const n=new Date(t.date),s=new Date(a.date);return ae?s-n:n-s}),[w,E,S,de,be,je,ye,ae,V]);d.useEffect(()=>{const t=Ve.current;if(!t)return;const a=()=>{if(Y!=="grid"){qe(1);return}const s=Math.min(t.clientWidth,window.innerWidth);if(s<500){qe(2);return}qe(Math.max(2,Math.floor(s/280)))};a();const n=new ResizeObserver(a);return n.observe(t),()=>n.disconnect()},[Y]);const os=d.useMemo(()=>Math.ceil(B.length/fe),[B.length,fe]),Je=aa({count:os,getScrollElement:()=>Ve.current,estimateSize:()=>Y==="grid"?340:120,overscan:3,gap:Y==="grid"?16:10});function Nt(){pt(null),M({type:"post",member:"å…¨å“¡",date:new Date().toISOString().split("T")[0],time:"",igUrl:"",caption:"",media:[],notes:""}),q(!0)}function ds(t){pt(t),M({type:t.type,member:t.member,date:t.date,time:t.time||"",igUrl:t.igUrl||"",caption:t.caption||"",media:t.media||[],notes:t.notes||""}),q(!0)}function us(t){J(t),X(0)}function ms(){const t=B.findIndex(a=>a.id===(h==null?void 0:h.id));t>0&&(J(B[t-1]),X(0))}function hs(){const t=B.findIndex(a=>a.id===(h==null?void 0:h.id));t<B.length-1&&(J(B[t+1]),X(0))}function Xe(){return B.findIndex(t=>t.id===(h==null?void 0:h.id))}const[kt,Ne]=d.useState(new Set);function ke(t){return kt.has(t)}async function ps(){var n,s,u,r,c;if(!(h!=null&&h.igUrl)){x("æ­¤è²¼æ–‡æ²’æœ‰ IG é€£çµ","error");return}if(ke(h.id)){x("æ­¤è²¼æ–‡æ­£åœ¨åŒæ­¥ä¸­...","info");return}const t={...h},a=h.id;Ne(l=>new Set(l).add(a));try{const l=await Pe(t.igUrl);if(!l.success||!((n=l.media)!=null&&n.length)){if(!await ge({title:"âš ï¸ æŠ“å–å¤±æ•—",type:"warning",confirmText:"æ¸…ç©ºåª’é«”",cancelText:"å–æ¶ˆ",content:e.jsxs("div",{className:"confirm-content",children:[e.jsx("p",{children:"å¯èƒ½åŽŸå› ï¼š"}),e.jsxs("ul",{children:[e.jsx("li",{children:"IG è²¼æ–‡å·²è¢«åˆªé™¤"}),e.jsx("li",{children:"IG API æš«æ™‚ç„¡æ³•å­˜å–"}),e.jsx("li",{children:"ç¶²è·¯é€£ç·šå•é¡Œ"})]}),e.jsx("p",{className:"confirm-warning",children:"æ˜¯å¦ä»è¦æ¸…ç©ºæ­¤è²¼æ–‡çš„åª’é«”è³‡æ–™ï¼Ÿ"})]})})){Ne(f=>{const k=new Set(f);return k.delete(a),k});return}}else{const y=((s=t.media)==null?void 0:s.length)||0,f=((u=l.media)==null?void 0:u.length)||0,k=(t.caption||"").trim(),L=(l.caption||"").trim(),$e=y!==f,At=k!==L&&L!=="";if($e||At){const Is=k.substring(0,80)+(k.length>80?"...":""),Ms=L.substring(0,80)+(L.length>80?"...":"");if(!await ge({title:"ðŸ“ è³‡æ–™è®Šæ›´ç¢ºèª",type:"info",confirmText:"è¦†è“‹",cancelText:"å–æ¶ˆ",content:e.jsxs("div",{className:"confirm-content",children:[e.jsx("p",{children:"æŠ“å–åˆ°çš„è³‡æ–™èˆ‡ç¾æœ‰è³‡æ–™ä¸åŒï¼š"}),$e&&e.jsxs("div",{className:"diff-item",children:[e.jsx("span",{className:"diff-label",children:"ðŸ“· åª’é«”æ•¸é‡"}),e.jsxs("div",{className:"diff-values",children:[e.jsxs("span",{className:"diff-old",children:[y," å¼µ"]}),e.jsx("span",{className:"diff-arrow",children:"â†’"}),e.jsxs("span",{className:"diff-new",children:[f," å¼µ"]})]})]}),At&&e.jsxs("div",{className:"diff-item",children:[e.jsx("span",{className:"diff-label",children:"ðŸ“ å…§å®¹"}),e.jsxs("div",{className:"diff-text",children:[e.jsx("div",{className:"diff-old",children:Is||"(ç©º)"}),e.jsx("div",{className:"diff-new",children:Ms})]})]}),e.jsx("p",{className:"confirm-question",children:"ç¢ºå®šè¦è¦†è“‹å—Žï¼Ÿ"})]})})){Ne(Bs=>{const Ot=new Set(Bs);return Ot.delete(a),Ot}),x("å·²å–æ¶ˆåŒæ­¥");return}}}x("åŒæ­¥ä¸­ï¼Œæª¢æŸ¥ä¸¦ä¸Šå‚³åœ–ç‰‡...","info");const b=((r=l.media)==null?void 0:r.length)>0?await et(l.media,t.media||[],t.member):[],o=(t.media||[]).filter(y=>y.type==="youtube"),p=[...b,...o],m=Fe((c=l.owner)==null?void 0:c.username,t.igUrl),i=De(m),g=ze(m);let j=t.date,$=t.time||"";if(g!=null&&g.dateFormat&&l.caption){const y=W(l.caption,g.dateFormat);y&&(j=y)}else if(l.date){const y=new Date(l.date),f=new Date(y.getTime()+480*60*1e3);j=`${f.getUTCFullYear()}-${String(f.getUTCMonth()+1).padStart(2,"0")}-${String(f.getUTCDate()).padStart(2,"0")}`,$=`${String(f.getUTCHours()).padStart(2,"0")}:${String(f.getUTCMinutes()).padStart(2,"0")}`}if(!g&&i==="å…¨å“¡"&&l.caption){const y=W(l.caption,"auto");y&&(j=y,$="")}const F={...t,media:p,caption:l.caption||t.caption,type:(g==null?void 0:g.type)||t.type,date:j,time:$,updatedAt:Date.now()};T(y=>{const f=y.map(k=>k.id===a?F:k);return _.update(F).catch(k=>console.warn("D1 å„²å­˜å¤±æ•—:",k)),f}),J(y=>(y==null?void 0:y.id)===a?F:y),X(0),b.length>0?x(`âœ… åŒæ­¥å®Œæˆï¼š${b.length} å€‹åª’é«”`):x("å·²æ¸…ç©ºåª’é«”è³‡æ–™","info")}catch(l){console.error("åŒæ­¥å¤±æ•—:",l),x("âŒ åŒæ­¥å¤±æ•—ï¼š"+l.message,"error")}finally{Ne(l=>{const b=new Set(l);return b.delete(a),b})}}function fs(){h&&(ds(h),J(null))}const[Ke,Ce]=d.useState(!1),[Ct,Se]=d.useState(""),[St,Ue]=d.useState(0),[Ut,re]=d.useState(!1),[Qe,Ze]=d.useState("");async function $t(){var t,a;if(v.igUrl){Ce(!0),Se("æŠ“å–ä¸­...");try{const n=await Pe(v.igUrl);if(n.success&&((t=n.media)==null?void 0:t.length)>0){const s=Fe((a=n.owner)==null?void 0:a.username,v.igUrl),u=De(s),r=ze(s);let c=v.date,l="";if(r!=null&&r.dateFormat&&n.caption){const i=W(n.caption,r.dateFormat);i&&(c=i)}else if(n.date){const i=new Date(n.date),g=new Date(i.getTime()+480*60*1e3);c=`${g.getUTCFullYear()}-${String(g.getUTCMonth()+1).padStart(2,"0")}-${String(g.getUTCDate()).padStart(2,"0")}`,l=`${String(g.getUTCHours()).padStart(2,"0")}:${String(g.getUTCMinutes()).padStart(2,"0")}`}if(!r&&u==="å…¨å“¡"&&n.caption){const i=W(n.caption,"auto");i&&(c=i,l="")}const b=n.media||[],o=b.map((i,g)=>({url:i.url||i.thumbnail,type:i.type,thumbnail:i.thumbnail||null,uploading:i.type==="image",thumbnailUploading:i.type==="video"&&i.thumbnail,originalUrl:i.url,originalThumbnail:i.thumbnail,index:g}));M(i=>({...i,type:(r==null?void 0:r.type)||n.type||i.type,member:u,date:c,time:l||i.time,caption:n.caption||i.caption,media:o})),Ce(!1),Se(""),re(!1),x(`âœ… å·²æŠ“å– ${b.length} å€‹åª’é«”ï¼ŒèƒŒæ™¯ä¸Šå‚³ä¸­...`);const p=o.filter(i=>i.type==="image"),m=o.filter(i=>i.type==="video"&&i.thumbnail);Ue(p.length+m.length);for(const i of p)Tt(i.originalUrl,i.index,u);for(const i of m)xs(i.originalThumbnail,i.index,u)}else{const s=v.igUrl.match(/instagram\.com\/p\//),u=v.igUrl.match(/instagram\.com\/(?:reel|reels)\//);let r="post";u&&(r="reels"),M(c=>({...c,type:r})),re(!0),x("âš ï¸ è‡ªå‹•æŠ“å–å¤±æ•—ï¼Œè«‹æ‰‹å‹•è¼¸å…¥åª’é«”ç¶²å€","info"),Ce(!1),Se("")}}catch(n){console.error("è§£æžå¤±æ•—",n),re(!0),x("âš ï¸ æŠ“å–å¤±æ•—ï¼Œè«‹æ‰‹å‹•è¼¸å…¥åª’é«”ç¶²å€","error"),Ce(!1),Se("")}}}async function gs(){if(!Qe.trim())return;const t=Qe.split(`
`).map(s=>s.trim()).filter(s=>s&&(s.startsWith("http")||s.startsWith("//")));if(t.length===0){x("è«‹è¼¸å…¥æœ‰æ•ˆçš„ç¶²å€","error");return}const a=t.map((s,u)=>{if(Ls(s))return{url:s,type:"youtube",thumbnail:st(s),index:v.media.length+u};const r=/\.(mp4|mov|webm|m4v)/i.test(s)||s.includes("video");return{url:s,type:r?"video":"image",uploading:!r,originalUrl:s,index:v.media.length+u}});M(s=>({...s,media:[...s.media,...a]}));const n=a.filter(s=>s.type==="image");Ue(s=>s+n.length);for(const s of n)Tt(s.originalUrl,s.index,v.member);Ze(""),re(!1),x(`å·²æ–°å¢ž ${t.length} å€‹åª’é«”`)}async function Tt(t,a,n){try{const s={context:"social",member:n},[u,r]=await Promise.all([Ie(t,s),Me(t,s).catch(c=>(console.warn("ImgBB å‚™ä»½å¤±æ•—:",c.message),null))]);M(c=>({...c,media:c.media.map((l,b)=>b===a?{...l,url:u,backupUrl:r,uploading:!1}:l)}))}catch(s){console.warn(`åœ–ç‰‡ ${a+1} ä¸Šå‚³å¤±æ•—`,s),M(u=>({...u,media:u.media.map((r,c)=>c===a?{...r,uploading:!1,uploadFailed:!0}:r)}))}finally{Ue(s=>s-1)}}async function xs(t,a,n){try{const s={context:"social",member:n},[u,r]=await Promise.all([Ie(t,s),Me(t,s).catch(c=>(console.warn("ImgBB å‚™ä»½å¤±æ•—:",c.message),null))]);M(c=>({...c,media:c.media.map((l,b)=>b===a?{...l,thumbnail:u,thumbnailBackupUrl:r,thumbnailUploading:!1}:l)})),r&&console.log(`âœ… å½±ç‰‡ ${a+1} ç¸®åœ–é›™é‡å‚™ä»½å®Œæˆ`)}catch(s){console.warn(`å½±ç‰‡ ${a+1} ç¸®åœ–ä¸Šå‚³å¤±æ•—`,s),M(u=>({...u,media:u.media.map((r,c)=>c===a?{...r,thumbnailUploading:!1,thumbnailFailed:!0}:r)}))}finally{Ue(s=>s-1)}}async function bs(t){const a=Array.from(t.target.files);if(a.length){gt(!0);try{const n=[];for(const s of a)if(s.type.startsWith("video/")){const r=URL.createObjectURL(s);n.push({url:r,type:"video",localFile:s})}else{const{url:r,backupUrl:c}=await Gs(s,{context:"social",member:v.member});n.push({url:r,type:"image",...c&&{backupUrl:c}})}M(s=>({...s,media:[...s.media,...n]})),x(`å·²æ–°å¢ž ${n.length} å€‹æª”æ¡ˆ`)}catch(n){console.error("ä¸Šå‚³å¤±æ•—",n),x("ä¸Šå‚³å¤±æ•—","error")}finally{gt(!1)}}}function js(t){M(a=>({...a,media:a.media.filter((n,s)=>s!==t)}))}async function vs(){if(!v.date||!v.member){x("è«‹å¡«å¯«å¿…è¦æ¬„ä½","error");return}if(v.media.some(n=>n.uploading)&&!await ge({title:"âš ï¸ ä¸Šå‚³æœªå®Œæˆ",type:"warning",confirmText:"ä»è¦å„²å­˜",cancelText:"ç­‰å¾…ä¸Šå‚³",content:e.jsxs("div",{className:"confirm-content",children:[e.jsx("p",{children:"é‚„æœ‰åœ–ç‰‡æ­£åœ¨ä¸Šå‚³ä¸­ï¼Œç¢ºå®šè¦ç¾åœ¨å„²å­˜å—Žï¼Ÿ"}),e.jsx("p",{className:"confirm-warning",children:"æœªå®Œæˆä¸Šå‚³çš„åœ–ç‰‡å¯èƒ½ç„¡æ³•æ­£å¸¸é¡¯ç¤º"})]})}))return;const a={id:(z==null?void 0:z.id)||Rt("s"),type:v.type,member:v.member,date:v.date,time:v.time,igUrl:v.igUrl,caption:v.caption,media:v.media.map(n=>({url:n.url,type:n.type,...n.backupUrl&&{backupUrl:n.backupUrl},...n.thumbnail&&{thumbnail:n.thumbnail},...n.thumbnailBackupUrl&&{thumbnailBackupUrl:n.thumbnailBackupUrl}})),notes:v.notes,createdAt:(z==null?void 0:z.createdAt)||Date.now(),updatedAt:Date.now()};te(!0);try{z?(await _.update(a),T(w.map(n=>n.id===z.id?a:n))):(await _.create(a),T([a,...w])),x("å·²å„²å­˜"),q(!1)}catch(n){console.error("å„²å­˜å¤±æ•—",n),x("å„²å­˜å¤±æ•—","error")}finally{te(!1)}}async function ws(t){if(await ge({title:"ðŸ—‘ï¸ åˆªé™¤ç¢ºèª",type:"danger",confirmText:"åˆªé™¤",cancelText:"å–æ¶ˆ",content:e.jsxs("div",{className:"confirm-content",children:[e.jsx("p",{children:"ç¢ºå®šè¦åˆªé™¤é€™ç­†å‚™ä»½å—Žï¼Ÿ"}),e.jsx("p",{className:"confirm-warning",children:"æ­¤æ“ä½œç„¡æ³•å¾©åŽŸ"})]})}))try{await _.delete(t),T(w.filter(n=>n.id!==t)),x("å·²åˆªé™¤")}catch(n){console.error("åˆªé™¤å¤±æ•—",n),x("åˆªé™¤å¤±æ•—","error")}}async function ys(){const t=A.length;if(!await ge({title:"ðŸ—‘ï¸ æ‰¹æ¬¡åˆªé™¤ç¢ºèª",type:"danger",confirmText:`åˆªé™¤ ${t} ç­†`,cancelText:"å–æ¶ˆ",content:e.jsxs("div",{className:"confirm-content",children:[e.jsxs("p",{children:["ç¢ºå®šè¦åˆªé™¤é¸å–çš„ ",e.jsx("strong",{children:t})," ç­†å‚™ä»½å—Žï¼Ÿ"]}),e.jsx("p",{className:"confirm-warning",children:"æ­¤æ“ä½œç„¡æ³•å¾©åŽŸ"})]})}))return;let n=0,s=0;for(const u of A)try{await _.delete(u),n++}catch(r){console.error(`åˆªé™¤ ${u} å¤±æ•—`,r),s++}T(u=>u.filter(r=>!A.includes(r.id))),Q([]),Re(!1),s>0?x(`å·²åˆªé™¤ ${n} ç­†ï¼Œ${s} ç­†å¤±æ•—`,"error"):x(`å·²åˆªé™¤ ${n} ç­†`)}function It(t){Q(a=>a.includes(t)?a.filter(n=>n!==t):[...a,t])}function Ns(){A.length===B.length?Q([]):Q(B.map(t=>t.id))}async function et(t,a=[],n){var r,c,l,b;const s=[],u=[];for(let o=0;o<t.length;o++){const p=t[o],m=a[o];if(p.type==="image"){if((m==null?void 0:m.type)==="image"){if((r=m==null?void 0:m.url)!=null&&r.includes("cloudinary")&&await xe(m.url)){console.log(`âœ… åœ–ç‰‡ ${o+1} Cloudinary å‚™ä»½å¯ç”¨ï¼Œè·³éŽä¸Šå‚³`),s.push({...m});continue}if((c=m==null?void 0:m.backupUrl)!=null&&c.includes("i.ibb.co")&&await xe(m.backupUrl)){console.log(`âœ… åœ–ç‰‡ ${o+1} ImgBB å‚™ä»½å¯ç”¨ï¼Œåˆ‡æ›ä½¿ç”¨`),s.push({url:m.backupUrl,type:"image",backupUrl:m.backupUrl});continue}console.log(`âš ï¸ åœ–ç‰‡ ${o+1} æ‰€æœ‰å‚™ä»½éƒ½å¤±æ•ˆï¼Œé‡æ–°ä¸Šå‚³`)}try{console.log(`ðŸ“¤ ä¸Šå‚³åœ–ç‰‡ ${o+1}...`);const i={context:"social",member:n},j={url:await Ie(p.url,i),type:"image"};s.push(j);const $=s.length-1;u.push(Me(p.url,i).then(F=>{F&&(s[$].backupUrl=F)}).catch(F=>console.warn("ImgBB èƒŒæ™¯ä¸Šå‚³å¤±æ•—:",F)))}catch(i){console.warn("åœ–ç‰‡ä¸Šå‚³å¤±æ•—:",i),s.push({url:p.url,type:"image"})}}else if(p.type==="video"){const i={url:p.url,type:"video"};if(p.thumbnail){if((m==null?void 0:m.type)==="video"){if((l=m==null?void 0:m.thumbnail)!=null&&l.includes("cloudinary")&&await xe(m.thumbnail)){console.log(`âœ… å½±ç‰‡ ${o+1} ç¸®åœ– Cloudinary å‚™ä»½å¯ç”¨ï¼Œè·³éŽä¸Šå‚³`),i.thumbnail=m.thumbnail,m.thumbnailBackupUrl&&(i.thumbnailBackupUrl=m.thumbnailBackupUrl),s.push(i);continue}if((b=m==null?void 0:m.thumbnailBackupUrl)!=null&&b.includes("i.ibb.co")&&await xe(m.thumbnailBackupUrl)){console.log(`âœ… å½±ç‰‡ ${o+1} ç¸®åœ– ImgBB å‚™ä»½å¯ç”¨ï¼Œåˆ‡æ›ä½¿ç”¨`),i.thumbnail=m.thumbnailBackupUrl,i.thumbnailBackupUrl=m.thumbnailBackupUrl,s.push(i);continue}console.log(`âš ï¸ å½±ç‰‡ ${o+1} ç¸®åœ–æ‰€æœ‰å‚™ä»½éƒ½å¤±æ•ˆï¼Œé‡æ–°ä¸Šå‚³`)}try{console.log(`ðŸ“¤ ä¸Šå‚³å½±ç‰‡ ${o+1} ç¸®åœ–...`);const g={context:"social",member:n},j=await Ie(p.thumbnail,g);i.thumbnail=j,u.push(Me(p.thumbnail,g).then($=>{$&&(i.thumbnailBackupUrl=$)}).catch($=>console.warn("ImgBB ç¸®åœ–èƒŒæ™¯ä¸Šå‚³å¤±æ•—:",$)))}catch(g){console.warn("ç¸®åœ–ä¸Šå‚³å¤±æ•—:",g),i.thumbnail=p.thumbnail}}s.push(i)}}return u.length>0&&Promise.all(u).then(()=>{console.log("âœ… ImgBB èƒŒæ™¯ä¸Šå‚³å®Œæˆ")}),s}function ks(t,a){return t.map((s,u)=>{const r=a[u];return s.type==="video"&&(r==null?void 0:r.type)==="video"?{...s,url:r.url}:(s.type==="image",s)})}function Cs(){ne.current=!0,x("æ­£åœ¨å–æ¶ˆåŒæ­¥...","info")}async function Ss(){var u,r;const t=w.filter(c=>A.includes(c.id)&&c.igUrl);if(t.length===0){x("æ²’æœ‰å¯åŒæ­¥çš„é …ç›®ï¼ˆéœ€æœ‰ IG é€£çµï¼‰","error");return}const a=de;ne.current=!1,bt(!0),vt({current:0,total:t.length});let n=0;for(const c of t){if(ne.current)break;wt(c.id),await new Promise(l=>setTimeout(l,0));try{const l=await Pe(c.igUrl);if(ne.current)break;if(l.success&&((u=l.media)==null?void 0:u.length)>0){const b=Fe((r=l.owner)==null?void 0:r.username,c.igUrl),o=De(b),p=ze(b);let m=c.date,i=c.time||"";if(p!=null&&p.dateFormat&&l.caption){const j=W(l.caption,p.dateFormat);j&&(m=j)}else if(l.date){const j=new Date(l.date),$=new Date(j.getTime()+480*60*1e3);m=`${$.getUTCFullYear()}-${String($.getUTCMonth()+1).padStart(2,"0")}-${String($.getUTCDate()).padStart(2,"0")}`,i=`${String($.getUTCHours()).padStart(2,"0")}:${String($.getUTCMinutes()).padStart(2,"0")}`}if(!p&&o==="å…¨å“¡"&&l.caption){const j=W(l.caption,"auto");j&&(m=j,i="")}let g;if(a){const j=ks(c.media,l.media);g={...c,media:j,type:(p==null?void 0:p.type)||c.type,date:m,time:i,updatedAt:Date.now()},console.log(`âœ… ${c.id} å½±ç‰‡ URL å·²æ›´æ–°ï¼ˆä¿ç•™ thumbnailï¼‰`)}else{const j=await et(l.media,c.media||[],c.member);if(ne.current)break;const $=(c.media||[]).filter(y=>y.type==="youtube"),F=[...j,...$];g={...c,media:F,caption:l.caption||c.caption,type:(p==null?void 0:p.type)||c.type,date:m,time:i,updatedAt:Date.now()}}T(j=>j.map($=>$.id===c.id?g:$)),_.update(g).catch(j=>console.warn("D1 å„²å­˜å¤±æ•—:",j)),n++,await new Promise(j=>setTimeout(j,0))}}catch(l){console.warn(`åŒæ­¥ ${c.id} å¤±æ•—:`,l)}vt(l=>({...l,current:l.current+1})),await new Promise(l=>setTimeout(l,0))}const s=ne.current;wt(null),bt(!1),Re(!1),Q([]),s?x(`å·²å–æ¶ˆåŒæ­¥ï¼ˆå·²å®Œæˆ ${n} ç­†ï¼‰`,"info"):x(a?`å½±ç‰‡åŒæ­¥å®Œæˆï¼š${n}/${t.length} ç­†æˆåŠŸ`:`åŒæ­¥å®Œæˆï¼š${n}/${t.length} ç­†æˆåŠŸ`)}const Us=`(async()=>{const d=ms=>new Promise(r=>setTimeout(r,ms));const urls=new Set();let last=0,retries=0;console.log('é–‹å§‹æ”¶é›†è²¼æ–‡ URL...');while(retries<5){document.querySelectorAll('a[href*="/p/"],a[href*="/reel/"],a[href*="/reels/"]').forEach(a=>{const h=a.href.split('?')[0];if(/\\/(p|reel|reels)\\//.test(h))urls.add(h)});console.log('å·²æ‰¾åˆ° '+urls.size+' ç­†');if(urls.size===last)retries++;else{retries=0;last=urls.size}window.scrollTo(0,document.body.scrollHeight);await d(1500)}const r=[...urls].join('\\n');console.log('\\nå®Œæˆï¼å…± '+urls.size+' ç­†ï¼š\\n'+r);try{await navigator.clipboard.writeText(r);console.log('\\nâœ… å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿')}catch{console.log('\\nâš ï¸ è«‹æ‰‹å‹•è¤‡è£½ä¸Šæ–¹æ–‡å­—')}})();`;function tt(t){const a=new Set;return t.split(`
`).map(n=>n.trim()).filter(n=>n&&/instagram\.com\/(?:[^\/]+\/)?(p|reel|reels|tv)\//.test(n)).filter(n=>{const s=n.split("?")[0].replace(/\/$/,"");return a.has(s)?!1:(a.add(s),!0)})}function $s(){ie.current=!0,x("æ­£åœ¨å–æ¶ˆæ‰¹æ¬¡å‚™ä»½...","info")}async function Ts(){var r,c;const t=tt(me);if(t.length===0){x("æ²’æœ‰æœ‰æ•ˆçš„ IG é€£çµ","error");return}new Set(w.map(l=>l.igUrl).filter(Boolean));const a=[],n=[];for(const l of t){const b=l.split("?")[0].replace(/\/$/,"");w.some(p=>p.igUrl?p.igUrl.split("?")[0].replace(/\/$/,"")===b:!1)?n.push(l):a.push(l)}if(a.length===0){x(`å…¨éƒ¨ ${n.length} ç­†éƒ½æ˜¯é‡è¤‡çš„`,"error");return}ie.current=!1,yt(!0),Ye({current:0,total:a.length}),Z(a.map(l=>({url:l,status:"pending"})));let s=0;for(let l=0;l<a.length&&!ie.current;l++){const b=a[l];Z(o=>o.map((p,m)=>m===l?{...p,status:"processing"}:p)),await new Promise(o=>setTimeout(o,0));try{console.log(`[æ‰¹æ¬¡å‚™ä»½ ${l+1}] é–‹å§‹æŠ“å–: ${b}`);const o=await Pe(b);if(console.log(`[æ‰¹æ¬¡å‚™ä»½ ${l+1}] fetchIGData å›žå‚³:`,JSON.stringify(o,null,2)),ie.current)break;if(!o.success||!((r=o.media)!=null&&r.length)){const f=o.error||o.message||(o.success?"ç„¡åª’é«”":"æŠ“å–å¤±æ•—");console.warn(`[æ‰¹æ¬¡å‚™ä»½ ${l+1}] è·³éŽ: ${f}`),Z(k=>k.map((L,$e)=>$e===l?{...L,status:"error",error:f}:L)),Ye(k=>({...k,current:k.current+1}));continue}const p=Fe((c=o.owner)==null?void 0:c.username,b),m=De(p),i=ze(p);console.log(`[æ‰¹æ¬¡å‚™ä»½ ${l+1}] æˆå“¡: ${m}, username: ${p}, media: ${o.media.length} ç­†`);let g=new Date().toISOString().split("T")[0],j="";if(i!=null&&i.dateFormat&&o.caption){const f=W(o.caption,i.dateFormat);f&&(g=f)}else if(o.date){const f=new Date(o.date),k=new Date(f.getTime()+480*60*1e3);g=`${k.getUTCFullYear()}-${String(k.getUTCMonth()+1).padStart(2,"0")}-${String(k.getUTCDate()).padStart(2,"0")}`,j=`${String(k.getUTCHours()).padStart(2,"0")}:${String(k.getUTCMinutes()).padStart(2,"0")}`}if(!i&&m==="å…¨å“¡"&&o.caption){const f=W(o.caption,"auto");f&&(g=f,j="")}console.log(`[æ‰¹æ¬¡å‚™ä»½ ${l+1}] æ—¥æœŸ: ${g} ${j}`),console.log(`[æ‰¹æ¬¡å‚™ä»½ ${l+1}] é–‹å§‹ä¸Šå‚³åª’é«”...`);const $=await et(o.media,[],m);if(console.log(`[æ‰¹æ¬¡å‚™ä»½ ${l+1}] ä¸Šå‚³å®Œæˆ:`,$.map(f=>{var k;return{url:(k=f.url)==null?void 0:k.substring(0,50),type:f.type}})),ie.current)break;const F=(i==null?void 0:i.type)||o.type||"post",y={id:Rt("s"),type:F,member:m,date:g,time:j,igUrl:b,caption:o.caption||"",media:$.map(f=>({url:f.url,type:f.type,...f.backupUrl&&{backupUrl:f.backupUrl},...f.thumbnail&&{thumbnail:f.thumbnail},...f.thumbnailBackupUrl&&{thumbnailBackupUrl:f.thumbnailBackupUrl}})),notes:"",createdAt:Date.now(),updatedAt:Date.now()};console.log(`[æ‰¹æ¬¡å‚™ä»½ ${l+1}] å­˜å…¥ D1...`,{id:y.id,type:y.type,member:y.member,mediaCount:y.media.length}),await _.create(y),T(f=>[y,...f]),s++,console.log(`[æ‰¹æ¬¡å‚™ä»½ ${l+1}] âœ… æˆåŠŸ`),Z(f=>f.map((k,L)=>L===l?{...k,status:"success",member:m,type:F}:k))}catch(o){console.error(`[æ‰¹æ¬¡å‚™ä»½ ${l+1}] âŒ å¤±æ•—:`,o),Z(p=>p.map((m,i)=>i===l?{...m,status:"error",error:o.message||"æœªçŸ¥éŒ¯èª¤"}:m))}Ye(o=>({...o,current:o.current+1})),await new Promise(o=>setTimeout(o,0))}const u=ie.current;if(yt(!1),u)x(`å·²å–æ¶ˆï¼ˆå·²å®Œæˆ ${s} ç­†ï¼‰`,"info");else{const l=a.length-s,b=n.length>0?`ï¼Œè·³éŽ ${n.length} ç­†é‡è¤‡`:"";x(`æ‰¹æ¬¡å‚™ä»½å®Œæˆï¼š${s} ç­†æˆåŠŸ${l>0?`ï¼Œ${l} ç­†å¤±æ•—`:""}${b}`)}}return P?e.jsxs("div",{className:"archive-page-loading",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"è¼‰å…¥ä¸­..."})]}):e.jsxs("div",{className:"social-archive archive-page",children:[e.jsxs("header",{className:"archive-header",children:[e.jsx("div",{style:{display:"flex",alignItems:"center",gap:8},children:e.jsx("h1",{children:"ðŸ“± ç¤¾ç¾¤å‚™ä»½"})}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6},children:[N&&e.jsx("button",{className:"add-btn",onClick:()=>ue(!0),title:"æ‰¹æ¬¡å‚™ä»½",children:e.jsx(Be,{size:20})}),e.jsx("button",{className:"add-btn",onClick:Nt,title:"æ–°å¢žå‚™ä»½",children:e.jsx(Es,{size:20})}),I&&e.jsx(Ds,{currentPage:U,setCurrentPage:I})]})]}),e.jsxs("div",{className:"archive-filters",children:[e.jsxs("div",{className:"filter-row",children:[e.jsx(zs,{selectedMembers:E,onChange:Ae,isOpen:ct,onToggle:()=>{Ge(!ct),ve(!1),we(!1)}}),e.jsx(Wt,{label:"é¡žåž‹",allLabel:"å…¨éƒ¨é¡žåž‹",options:ee.map(t=>({value:t.id,label:`${t.icon} ${t.label}`})),value:S,onChange:t=>{Oe(t),we(!1)},isOpen:ot,onToggle:()=>{we(!ot),Ge(!1),ve(!1)}}),e.jsx(Wt,{label:"å¹´ä»½",allLabel:"å…¨éƒ¨æ—¥æœŸ",options:cs.map(t=>({value:t,label:t})),value:je,onChange:t=>{Jt(t),ve(!1)},isOpen:rt,onToggle:()=>{ve(!rt),Ge(!1),we(!1)},className:"year-filter"}),e.jsx("button",{className:"year-sort-btn",onClick:()=>Xt(!ae),title:ae?"ç›®å‰ï¼šæ–° â†’ èˆŠ":"ç›®å‰ï¼šèˆŠ â†’ æ–°",children:e.jsx(Ys,{size:12})})]}),e.jsxs("div",{className:"filter-row",children:[N&&e.jsxs("button",{className:`filter-video-btn ${de?"active":""}`,onClick:()=>Vt(!de),title:"åªé¡¯ç¤ºå«å½±ç‰‡çš„è²¼æ–‡",children:[e.jsx(_s,{size:16}),e.jsx("span",{children:"å½±ç‰‡"})]}),N&&e.jsx("button",{className:`filter-broken-btn ${be?"active":""}`,onClick:()=>{Object.keys(V).length===0&&!Le&&rs(),qt(!be)},title:"æª¢æŸ¥ä¸¦ç¯©é¸å£žåœ–",disabled:Le,children:Le?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"mini-spinner"}),e.jsxs("span",{children:[mt.current,"/",mt.total]})]}):e.jsx(e.Fragment,{children:e.jsx(at,{size:16})})}),e.jsxs("div",{className:"search-box",children:[e.jsx(Ws,{size:16}),e.jsx("input",{type:"text",placeholder:"æœå°‹å…§å®¹...",value:ye,onChange:t=>Kt(t.target.value)})]}),e.jsxs("div",{className:"view-toggle",children:[e.jsx("button",{className:Y==="grid"?"active":"",onClick:()=>dt("grid"),children:e.jsx(Hs,{size:16})}),e.jsx("button",{className:Y==="list"?"active":"",onClick:()=>dt("list"),children:e.jsx(Vs,{size:16})})]}),N&&e.jsx("button",{className:`select-mode-btn ${K?"active":""}`,onClick:()=>{Re(!K),Q([])},title:"å‹¾é¸æ¨¡å¼",children:e.jsx(Et,{size:16})})]}),e.jsxs("div",{className:"filter-stats",children:["å…± ",B.length," ç­†å‚™ä»½",K&&B.length>0&&e.jsx("button",{className:"select-all-btn",onClick:Ns,children:A.length===B.length?"å–æ¶ˆå…¨é¸":"å…¨é¸"})]})]}),e.jsx("div",{ref:Ve,className:"social-content-scroll",children:B.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx(nt,{size:48}),e.jsx("p",{children:"å°šç„¡å‚™ä»½è³‡æ–™"}),e.jsx("button",{onClick:Nt,children:"æ–°å¢žç¬¬ä¸€ç­†"})]}):e.jsx("div",{style:{height:Je.getTotalSize(),position:"relative"},children:Je.getVirtualItems().map(t=>{const a=t.index*fe,n=B.slice(a,a+fe);return e.jsx("div",{className:`archive-content ${Y}`,style:{position:"absolute",top:0,left:0,right:0,transform:`translateY(${t.start}px)`,...Y==="grid"?{gridTemplateColumns:`repeat(${fe}, 1fr)`}:{}},ref:Je.measureElement,"data-index":t.index,children:n.map(s=>{var u,r,c,l,b;return e.jsxs("div",{className:`archive-card ${K&&A.includes(s.id)?"selected":""}`,onClick:()=>K?It(s.id):us(s),children:[K&&e.jsx("div",{className:"card-checkbox",onClick:o=>{o.stopPropagation(),It(s.id)},children:A.includes(s.id)?e.jsx(Et,{size:20}):e.jsx(qs,{size:20})}),e.jsxs("div",{className:"archive-thumb",children:[(u=s.media)!=null&&u[0]?s.media[0].type==="youtube"?e.jsxs("div",{className:"video-thumb-img",children:[e.jsx("img",{src:s.media[0].thumbnail||st(s.media[0].url),alt:"",loading:"lazy",width:260,height:260}),e.jsx(ce,{size:24,className:"play-overlay"})]}):s.media[0].type==="video"?s.media[0].thumbnail?e.jsxs("div",{className:"video-thumb-img",children:[e.jsx("img",{src:Gt(s.media[0]),alt:"",loading:"lazy",width:260,height:260}),e.jsx(ce,{size:24,className:"play-overlay"})]}):e.jsxs("div",{className:"video-thumb-auto",children:[e.jsx("video",{src:s.media[0].backupUrl||s.media[0].url,muted:!0,preload:"metadata"}),e.jsx(ce,{size:24,className:"play-overlay"})]}):e.jsx("img",{src:Gt(s.media[0]),alt:"",loading:"lazy",width:260,height:260}):e.jsx("div",{className:"no-thumb",children:e.jsx("img",{src:"/bigbang-timeline/bigbang-default.png",alt:"BIGBANG"})}),((r=s.media)==null?void 0:r.length)>1&&e.jsxs("span",{className:"media-count",children:["+",s.media.length-1]}),e.jsx("span",{className:"type-badge",style:{background:(c=ee.find(o=>o.id===s.type))==null?void 0:c.color},children:(l=ee.find(o=>o.id===s.type))==null?void 0:l.icon}),((b=V[s.id])==null?void 0:b.length)>0&&e.jsxs("span",{className:"broken-badge",title:`${V[s.id].length} å¼µåœ–ç‰‡æå£ž`,children:[e.jsx(at,{size:14}),V[s.id].length]}),(kt.has(s.id)||es===s.id)&&e.jsxs("div",{className:"syncing-overlay",children:[e.jsx(lt,{size:24,className:"spinning"}),e.jsx("span",{children:"åŒæ­¥ä¸­..."})]})]}),e.jsxs("div",{className:"archive-info",children:[e.jsxs("div",{className:"archive-meta",children:[e.jsx("span",{className:"member-tag",style:{background:Te(s.member)+"30",color:Te(s.member)},children:s.member}),e.jsx("span",{className:"date",children:Lt(s.date)})]}),s.caption&&e.jsx("p",{className:"archive-caption",children:s.caption})]})]},s.id)})},t.key)})})}),h&&e.jsxs("div",{className:"modal-overlay view-modal-overlay",onClick:()=>J(null),children:[e.jsxs("div",{className:"post-nav-indicator",onClick:t=>t.stopPropagation(),children:[Xe()+1," / ",B.length]}),e.jsx("button",{className:"post-nav-side prev",onClick:t=>{t.stopPropagation(),ms()},disabled:Xe()<=0,title:"ä¸Šä¸€å‰‡",children:e.jsx(Js,{size:32})}),e.jsxs("div",{className:"view-modal",onClick:t=>t.stopPropagation(),children:[e.jsx("button",{className:"view-close-btn",onClick:()=>J(null),children:e.jsx(oe,{size:24})}),e.jsx("div",{className:"view-media-area",children:((Mt=h.media)==null?void 0:Mt.length)>0?e.jsxs(e.Fragment,{children:[((Bt=h.media[G])==null?void 0:Bt.type)==="youtube"?e.jsx("iframe",{src:`https://www.youtube.com/embed/${Fs(h.media[G].url)}?autoplay=1`,allow:"autoplay; encrypted-media",allowFullScreen:!0,className:"view-media view-youtube"}):((Dt=h.media[G])==null?void 0:Dt.type)==="video"?e.jsx("video",{src:h.media[G].backupUrl||h.media[G].url,controls:!0,autoPlay:!0,className:"view-media"},`${h.id}-${G}`):e.jsx("img",{src:Ps(h.media[G]),alt:"",className:"view-media"},`${h.id}-${G}`),h.media.length>1&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"media-nav prev",onClick:()=>X(t=>(t-1+h.media.length)%h.media.length),children:"â€¹"}),e.jsx("button",{className:"media-nav next",onClick:()=>X(t=>(t+1)%h.media.length),children:"â€º"}),e.jsx("div",{className:"media-dots",children:h.media.map((t,a)=>e.jsx("span",{className:`dot ${a===G?"active":""}`,onClick:()=>X(a)},a))})]})]}):e.jsx("div",{className:"no-media",children:e.jsx("img",{src:"/bigbang-timeline/bigbang-default.png",alt:"BIGBANG",className:"no-media-img"})})}),e.jsxs("div",{className:"view-info-area",children:[e.jsxs("div",{className:"view-header",children:[e.jsx("span",{className:"member-tag",style:{background:Te(h.member)+"30",color:Te(h.member)},children:h.member}),e.jsxs("span",{className:"type-badge",style:{background:(zt=ee.find(t=>t.id===h.type))==null?void 0:zt.color},children:[(Ft=ee.find(t=>t.id===h.type))==null?void 0:Ft.icon," ",(Pt=ee.find(t=>t.id===h.type))==null?void 0:Pt.label]}),e.jsx("span",{className:"view-date",children:N&&h.time?As(h.date,h.time):Lt(h.date)})]}),h.caption&&e.jsx("div",{className:"view-caption",children:e.jsx("p",{children:h.caption})}),h.notes&&e.jsxs("div",{className:"view-notes",children:[e.jsx("strong",{children:"å‚™è¨»ï¼š"}),e.jsx("p",{children:h.notes})]}),e.jsxs("div",{className:"view-actions",children:[h.igUrl&&e.jsxs(e.Fragment,{children:[e.jsxs("a",{href:h.igUrl,target:"_blank",rel:"noopener noreferrer",className:"view-link-btn",children:[e.jsx(Xs,{size:16})," é–‹å•Ÿ IG"]}),N&&e.jsxs("button",{className:"view-sync-btn",onClick:ps,disabled:ke(h.id),title:"é‡æ–°æŠ“å– IG è³‡æ–™",children:[e.jsx(lt,{size:16,className:ke(h.id)?"spinning":""}),ke(h.id)?"åŒæ­¥ä¸­...":"åŒæ­¥"]})]}),e.jsx("button",{className:"view-edit-btn",onClick:fs,children:"âœï¸ ç·¨è¼¯"})]})]})]}),e.jsx("button",{className:"post-nav-side next",onClick:t=>{t.stopPropagation(),hs()},disabled:Xe()>=B.length-1,title:"ä¸‹ä¸€å‰‡",children:e.jsx(Ks,{size:32})})]}),Zt&&e.jsx("div",{className:"modal-overlay",onClick:()=>q(!1),children:e.jsxs("div",{className:"archive-modal",onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{children:z?"ç·¨è¼¯å‚™ä»½":"æ–°å¢žå‚™ä»½"}),e.jsx("button",{className:"close-btn",onClick:()=>q(!1),children:e.jsx(oe,{size:20})})]}),e.jsxs("div",{className:"modal-body",children:[e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{children:[e.jsx(nt,{size:14})," IG é€£çµ","ï¼ˆè‡ªå‹•æŠ“å–ï¼‰"]}),e.jsxs("div",{className:"ig-url-input",children:[e.jsx("input",{type:"url",placeholder:"è²¼ä¸Š Instagram é€£çµï¼Œè‡ªå‹•æŠ“å–åœ–ç‰‡å’Œæ–‡å­—...",value:v.igUrl,onChange:t=>M(a=>({...a,igUrl:t.target.value})),onBlur:$t,disabled:Ke}),e.jsx("button",{onClick:$t,title:"æŠ“å–è³‡æ–™",disabled:Ke,children:Ke?e.jsx("span",{className:"fetching-spinner"}):e.jsx(it,{size:16})}),Ct&&e.jsx("span",{className:"fetch-progress",children:Ct})]})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"é¡žåž‹"}),e.jsx("div",{className:"type-selector",children:ee.map(t=>e.jsxs("button",{className:v.type===t.id?"active":"",style:v.type===t.id?{background:t.color}:{},onClick:()=>M(a=>({...a,type:t.id})),children:[t.icon," ",t.label]},t.id))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"æˆå“¡"}),e.jsx("select",{value:v.member,onChange:t=>M(a=>({...a,member:t.target.value})),children:Os.map(t=>e.jsx("option",{value:t.name,children:t.name},t.name))})]})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{children:[e.jsx(Qs,{size:14})," ç™¼æ–‡æ—¥æœŸ"]}),e.jsx("input",{type:"date",value:v.date,onChange:t=>M(a=>({...a,date:t.target.value}))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"æ™‚é–“ï¼ˆé¸å¡«ï¼‰"}),e.jsx("input",{type:"time",value:v.time,onChange:t=>M(a=>({...a,time:t.target.value}))})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{children:[e.jsx(Zs,{size:14})," åœ–ç‰‡/å½±ç‰‡",St>0&&e.jsxs("span",{className:"upload-status",children:["ï¼ˆ",St," å¼µä¸Šå‚³ä¸­...ï¼‰"]})]}),e.jsxs("div",{className:"media-upload-area",children:[v.media.map((t,a)=>{var s;const n=z&&((s=V[z.id])==null?void 0:s.includes(a));return e.jsxs("div",{className:`media-preview ${t.uploading?"uploading":""} ${t.uploadFailed?"failed":""} ${n?"broken":""}`,children:[t.type==="youtube"?e.jsxs("div",{className:"video-preview-img",children:[e.jsx("img",{src:t.thumbnail||st(t.url),alt:""}),e.jsx(ce,{size:16,className:"play-icon"})]}):t.type==="video"?t.thumbnail?e.jsxs("div",{className:"video-preview-img",children:[e.jsx("img",{src:t.thumbnailBackupUrl||t.thumbnail,alt:""}),e.jsx(ce,{size:16,className:"play-icon"})]}):e.jsxs("div",{className:"video-preview-auto",children:[e.jsx("video",{src:t.backupUrl||t.url,muted:!0,preload:"metadata"}),e.jsx(ce,{size:16,className:"play-icon"})]}):e.jsx("img",{src:t.backupUrl||t.url,alt:""}),t.uploading&&e.jsx("div",{className:"upload-overlay",children:e.jsx("div",{className:"mini-spinner"})}),t.uploadFailed&&e.jsx("div",{className:"upload-failed-badge",title:"ä¸Šå‚³å¤±æ•—ï¼Œå°‡ä½¿ç”¨åŽŸå§‹é€£çµ",children:"âš ï¸"}),n&&e.jsx("div",{className:"broken-image-badge",title:"æ­¤åœ–ç‰‡å·²æå£žï¼Œè«‹é‡æ–°ä¸Šå‚³",children:e.jsx(at,{size:14})}),e.jsx("button",{className:"remove-media",onClick:()=>js(a),children:e.jsx(oe,{size:14})})]},a)}),e.jsxs("label",{className:"upload-btn",children:[e.jsx("input",{type:"file",accept:"image/*,video/*",multiple:!0,onChange:bs,disabled:ft}),ft?e.jsx("span",{className:"uploading",children:"ä¸Šå‚³ä¸­..."}):e.jsxs(e.Fragment,{children:[e.jsx(Be,{size:20}),e.jsx("span",{children:"ä¸Šå‚³"})]})]}),e.jsxs("button",{type:"button",className:"manual-url-toggle",onClick:()=>re(!Ut),children:[e.jsx(it,{size:16}),e.jsx("span",{children:"è²¼ä¸Šç¶²å€"})]})]}),Ut&&e.jsxs("div",{className:"manual-url-input",children:[e.jsx("p",{className:"manual-hint",children:"ðŸ’¡ æç¤ºï¼šæ”¯æ´åœ–ç‰‡ã€å½±ç‰‡ã€YouTube é€£çµï¼Œæ¯è¡Œä¸€å€‹"}),e.jsx("textarea",{placeholder:`è²¼ä¸Šåœ–ç‰‡/å½±ç‰‡/YouTube ç¶²å€ï¼Œæ¯è¡Œä¸€å€‹...
ä¾‹å¦‚ï¼š
https://scontent-xxx.cdninstagram.com/...jpg
https://www.youtube.com/watch?v=xxxxx`,value:Qe,onChange:t=>Ze(t.target.value),rows:4}),e.jsxs("div",{className:"manual-actions",children:[e.jsx("button",{type:"button",className:"cancel-manual",onClick:()=>{re(!1),Ze("")},children:"å–æ¶ˆ"}),e.jsx("button",{type:"button",className:"submit-manual",onClick:gs,children:"æ–°å¢žåª’é«”"})]})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"åŽŸæ–‡å…§å®¹"}),e.jsx("textarea",{placeholder:"è²¼ä¸Š IG åŽŸæ–‡å…§å®¹...",value:v.caption,onChange:t=>M(a=>({...a,caption:t.target.value})),rows:4})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"å‚™è¨»ï¼ˆé¸å¡«ï¼‰"}),e.jsx("textarea",{placeholder:"å…¶ä»–å‚™è¨»...",value:v.notes,onChange:t=>M(a=>({...a,notes:t.target.value})),rows:2})]})]}),e.jsxs("div",{className:"modal-footer",children:[z&&e.jsxs("button",{className:"delete-btn",onClick:()=>{ws(z.id),q(!1)},children:[e.jsx(Yt,{size:16})," åˆªé™¤"]}),e.jsx("button",{className:"cancel-btn",onClick:()=>q(!1),children:"å–æ¶ˆ"}),e.jsxs("button",{className:"save-btn",onClick:vs,disabled:R,children:[e.jsx(ea,{size:16})," ",R?"å„²å­˜ä¸­...":"å„²å­˜"]})]})]})}),ts&&e.jsx("div",{className:"modal-overlay",onClick:()=>!le&&ue(!1),children:e.jsxs("div",{className:"archive-modal batch-create-modal",onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("h2",{children:[e.jsx(Be,{size:20})," æ‰¹æ¬¡å‚™ä»½ IG è²¼æ–‡"]}),!le&&e.jsx("button",{className:"close-btn",onClick:()=>ue(!1),children:e.jsx(oe,{size:20})})]}),!le&&pe.length===0&&e.jsxs("div",{className:"batch-create-input",children:[e.jsx("label",{children:"æ¯è¡Œè²¼ä¸Šä¸€å€‹ IG é€£çµï¼š"}),e.jsxs("div",{className:"script-helper",children:[e.jsxs("button",{className:"script-helper-toggle",onClick:()=>{ss(!_e),We(!1)},children:[e.jsx(nt,{size:14}),e.jsx("span",{children:"å¾ž IG å¸³è™Ÿä¸€æ¬¡åŒ¯å…¥æ‰€æœ‰è²¼æ–‡ URL"}),e.jsx(ta,{size:14,style:{transform:_e?"rotate(180deg)":"none",transition:"transform 0.2s"}})]}),_e&&e.jsxs("div",{className:"script-helper-content",children:[e.jsxs("ol",{className:"script-helper-steps",children:[e.jsx("li",{children:"åœ¨ç€è¦½å™¨é–‹å•Ÿç›®æ¨™ IG å¸³è™Ÿé é¢"}),e.jsxs("li",{children:["æŒ‰ ",e.jsx("kbd",{children:"F12"})," é–‹å•Ÿ DevTools â†’ ",e.jsx("kbd",{children:"Console"})]}),e.jsx("li",{children:"é»žä¸‹æ–¹æŒ‰éˆ•è¤‡è£½è…³æœ¬ï¼Œè²¼åˆ° Console æŒ‰ Enter"}),e.jsx("li",{children:"ç­‰å¾…è‡ªå‹•æ»¾å‹•å®Œæˆï¼ŒURL æœƒè¤‡è£½åˆ°å‰ªè²¼ç°¿"}),e.jsx("li",{children:"å›žåˆ°é€™è£¡ï¼Œç›´æŽ¥ Ctrl+V è²¼ä¸Š"})]}),e.jsx("button",{className:"copy-script-btn",onClick:()=>{navigator.clipboard.writeText(Us),We(!0),setTimeout(()=>We(!1),3e3)},children:as?e.jsxs(e.Fragment,{children:[e.jsx(_t,{size:14})," å·²è¤‡è£½ï¼"]}):e.jsxs(e.Fragment,{children:[e.jsx(it,{size:14})," è¤‡è£½è…³æœ¬"]})})]})]}),e.jsx("textarea",{className:"batch-urls-textarea",value:me,onChange:t=>Ee(t.target.value),placeholder:`https://www.instagram.com/p/ABC123/
https://www.instagram.com/tttopost/p/DEF456/
https://www.instagram.com/reel/GHI789/`,rows:8,autoFocus:!0}),(()=>{const t=tt(me),a=me.split(`
`).filter(s=>s.trim()).length,n=t.filter(s=>{const u=s.split("?")[0].replace(/\/$/,"");return w.some(r=>r.igUrl&&r.igUrl.split("?")[0].replace(/\/$/,"")===u)}).length;return e.jsxs("div",{className:"batch-url-info",children:[e.jsxs("span",{children:[t.length," ç­†æœ‰æ•ˆé€£çµ",a>t.length?`ï¼ˆ${a-t.length} ç­†ç„¡æ•ˆå·²å¿½ç•¥ï¼‰`:""]}),n>0&&e.jsxs("span",{className:"batch-dup-warn",children:["å…¶ä¸­ ",n," ç­†å·²å‚™ä»½éŽï¼Œå°‡è‡ªå‹•è·³éŽ"]})]})})(),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{className:"cancel-btn",onClick:()=>ue(!1),children:"å–æ¶ˆ"}),e.jsxs("button",{className:"save-btn",onClick:Ts,disabled:tt(me).length===0,children:[e.jsx(Be,{size:16})," é–‹å§‹å‚™ä»½"]})]})]}),(le||pe.length>0)&&e.jsxs("div",{className:"batch-create-progress",children:[e.jsx("div",{className:"batch-progress-bar-container",children:e.jsx("div",{className:"batch-progress-bar-fill",style:{width:`${he.total>0?he.current/he.total*100:0}%`}})}),e.jsx("div",{className:"batch-progress-text",children:le?`è™•ç†ä¸­ ${he.current}/${he.total}`:`å®Œæˆ ${pe.filter(t=>t.status==="success").length}/${pe.length}`}),e.jsx("div",{className:"batch-results-list",children:pe.map((t,a)=>e.jsxs("div",{className:`batch-result-item batch-result-${t.status}`,children:[e.jsxs("span",{className:"batch-result-icon",children:[t.status==="success"&&"âœ“",t.status==="error"&&"âœ—",t.status==="processing"&&"â³",t.status==="pending"&&"Â·"]}),e.jsx("span",{className:"batch-result-url",children:t.url.replace(/https?:\/\/(www\.)?instagram\.com\//,"")}),t.status==="success"&&e.jsxs("span",{className:"batch-result-meta",children:[t.member," Â· ",t.type]}),t.status==="error"&&e.jsx("span",{className:"batch-result-error",children:t.error})]},a))}),e.jsx("div",{className:"modal-footer",children:le?e.jsxs("button",{className:"cancel-btn",onClick:$s,children:[e.jsx(oe,{size:16})," å–æ¶ˆ"]}):e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"cancel-btn",onClick:()=>{ue(!1),Z([]),Ee("")},children:"é—œé–‰"}),e.jsx("button",{className:"save-btn",onClick:()=>{Z([]),Ee("")},children:"ç¹¼çºŒæ–°å¢ž"})]})})]})]})}),K&&A.length>0&&e.jsxs("div",{className:"batch-action-bar",children:[e.jsxs("span",{className:"batch-count",children:["å·²é¸å– ",A.length," ç­†"]}),e.jsxs("div",{className:"batch-actions",children:[!xt&&e.jsx("button",{className:"batch-cancel-btn",onClick:()=>Q([]),children:"å–æ¶ˆé¸å–"}),xt?e.jsxs("button",{className:"batch-stop-btn",onClick:Cs,children:[e.jsx(oe,{size:16}),"å–æ¶ˆåŒæ­¥ (",jt.current,"/",jt.total,")"]}):e.jsxs(e.Fragment,{children:[e.jsxs("button",{className:"batch-sync-btn",onClick:Ss,children:[e.jsx(lt,{size:16}),"åŒæ­¥æŠ“å–"]}),e.jsxs("button",{className:"batch-delete-btn",onClick:ys,children:[e.jsx(Yt,{size:16}),"åˆªé™¤"]})]})]})]}),H&&e.jsxs("div",{className:`toast ${H.type}`,children:[H.type==="error"?e.jsx(sa,{size:16}):e.jsx(_t,{size:16}),H.msg]}),O&&e.jsx("div",{className:"confirm-modal-overlay",onClick:O.onCancel,children:e.jsxs("div",{className:`confirm-modal confirm-modal-${O.type}`,onClick:t=>t.stopPropagation(),children:[e.jsx("h3",{className:"confirm-modal-title",children:O.title}),e.jsx("div",{className:"confirm-modal-body",children:O.content}),e.jsxs("div",{className:"confirm-modal-actions",children:[e.jsx("button",{className:"confirm-modal-cancel",onClick:O.onCancel,children:O.cancelText}),e.jsx("button",{className:`confirm-modal-confirm confirm-modal-confirm-${O.type}`,onClick:O.onConfirm,children:O.confirmText})]})]})})]})}const ua=d.memo(la);export{ua as default};
