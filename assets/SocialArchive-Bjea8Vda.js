import{j as e,s as K,N as Ms,M as Bs,g as et,a as Ot,b as Ie,f as Gt,c as Ds,d as zs,e as Ps,h as Fs,u as As,i as Os,k as Rt,l as Gs,m as Me,n as Be}from"./index-DpZCkE7P.js";import{a as d,U as De,d as Rs,A as Ls,F as Es,o as tt,p as Ys,G as _s,q as Ws,s as Lt,t as st,u as Hs,f as ce,R as at,C as Vs,X as oe,E as qs,b as Js,v as nt,e as Xs,I as Ks,T as Qs,S as Zs,w as ea,i as Et,j as ta}from"./icons-51PM2evP.js";import{u as sa}from"./ArchiveBase-DG1HYpDb.js";import"./vendor-DhQqL_yF.js";function Yt({label:N,options:C,value:S,onChange:I,isOpen:k,onToggle:$,allLabel:F="å…¨éƒ¨",allValue:D="all",className:L=""}){const[Z,_]=d.useState(!1);d.useEffect(()=>{const T=()=>{_("ontouchstart"in window||window.matchMedia("(pointer: coarse)").matches||window.innerWidth<768)};return T(),window.addEventListener("resize",T),()=>window.removeEventListener("resize",T)},[]);const ee=C.find(T=>T.value===S),te=S===D?N:(ee==null?void 0:ee.label)||S;return Z?e.jsxs("select",{className:"filter-select",value:S,onChange:T=>I(T.target.value),children:[e.jsx("option",{value:D,children:F}),C.map(T=>e.jsx("option",{value:T.value,children:T.label},T.value))]}):e.jsxs("div",{className:`filter-dropdown ${L}`,children:[e.jsxs("button",{className:`filter-btn dropdown-toggle ${S!==D?"active":""}`,onClick:$,children:[te,e.jsx("span",{className:"dropdown-arrow",children:k?"â–²":"â–¼"})]}),k&&e.jsxs("div",{className:"filter-dropdown-list",children:[e.jsx("button",{className:`filter-dropdown-item ${S===D?"active":""}`,onClick:()=>I(D),children:F}),C.map(T=>e.jsx("button",{className:`filter-dropdown-item ${S===T.value?"active":""}`,style:{color:S===T.value?T.color:void 0},onClick:()=>I(T.value),children:T.label},T.value))]})]})}const Q=[{id:"post",label:"è²¼æ–‡",icon:"ðŸ“·",color:"#E1306C"},{id:"story",label:"Story",icon:"â­•",color:"#833AB4"},{id:"reels",label:"Reels",icon:"ðŸŽ¬",color:"#F77737"}],_t={"G-Dragon":{main:"xxxibgdrgn"},"T.O.P":{main:"ttt",extra:[{username:"tttopost",type:"post",dateFormat:"auto"},{username:"top.ttt.story",type:"story",dateFormat:"auto",isPrefix:!0}]},å¤ªé™½:{main:"__youngbae__"},å¤§è²:{main:"d_lable_official"},å‹åˆ©:{main:""},å…¨å“¡:{main:"bigbangofficial"}};function ze(N){if(!N)return"å…¨å“¡";const C=N.toLowerCase();for(const[S,I]of Object.entries(_t)){if(I.main&&C===I.main.toLowerCase())return S;if(I.extra)for(const k of I.extra){const $=k.username.toLowerCase();if(k.isPrefix?C.startsWith($):C===$)return S}}return"å…¨å“¡"}function Pe(N){if(!N)return null;const C=N.toLowerCase();for(const S of Object.values(_t))if(S.extra)for(const I of S.extra){const k=I.username.toLowerCase();if(I.isPrefix?C.startsWith(k):C===k)return I}return null}function Y(N,C){if(!N||!C)return null;function S(k){const $=k.match(/(\d{4})-(\d{1,2})-(\d{1,2})/);if($){const F=$[1],D=$[2].padStart(2,"0"),L=$[3].padStart(2,"0");return`${F}-${D}-${L}`}return null}function I(k){const $=k.match(/\b(\d{6})\b/);if($){const F=$[1],D=parseInt(F.substring(0,2),10),L=F.substring(2,4),Z=F.substring(4,6);return`${D>=50?1900+D:2e3+D}-${L}-${Z}`}return null}return C==="auto"?S(N)||I(N):C==="iso"?S(N):C==="6digits"?I(N):null}function aa(N){if(!N)return null;const C=N.match(/instagram\.com\/stories\/([^\/]+)\//);if(C)return C[1];const S=N.match(/instagram\.com\/([^\/]+)\/(?:p|reel|reels|tv)\//);return S&&!["p","reel","reels","tv","stories","explore"].includes(S[1])?S[1]:null}function Fe(N,C){return N||aa(C)||null}async function Ae(N){try{const C=`${Gs.IG_SCRAPER_URL}/scrape?url=${encodeURIComponent(N)}`;return await(await fetch(C)).json()}catch(C){return console.error("IG æŠ“å–å¤±æ•—:",C),{success:!1,error:C.message}}}function na({isAdmin:N,onBack:C,currentPage:S,setCurrentPage:I}){var It,Mt,Bt,Dt,zt,Pt;const[k,$]=d.useState([]),[F,D]=d.useState(!0),[L,Z]=d.useState(!1),[_,ee]=d.useState(null),[te,T]=d.useState([]),[xe,Wt]=d.useState("all"),[de,Ht]=d.useState(!1),[be,Vt]=d.useState(!1),[je,qt]=d.useState("all"),[se,Jt]=d.useState(!0),[lt,ve]=d.useState(!1),[it,Oe]=d.useState(!1),[rt,ye]=d.useState(!1),[we,Xt]=d.useState(""),[E,ct]=d.useState("grid"),[O,Kt]=d.useState({}),[Ge,ot]=d.useState(!1),[dt,ut]=d.useState({current:0,total:0}),[Qt,W]=d.useState(!1),[z,mt]=d.useState(null),[v,M]=d.useState({type:"post",member:"å…¨å“¡",date:new Date().toISOString().split("T")[0],time:"",igUrl:"",caption:"",media:[],notes:""}),[ht,pt]=d.useState(!1),[m,H]=d.useState(null),[G,V]=d.useState(0),[q,ft]=d.useState(!1),[J,ae]=d.useState([]),[gt,xt]=d.useState(!1),[bt,jt]=d.useState({current:0,total:0}),[Zt,vt]=d.useState(null),ne=d.useRef(!1),[es,ue]=d.useState(!1),[me,Re]=d.useState(""),[le,yt]=d.useState(!1),[he,Le]=d.useState({current:0,total:0}),[pe,X]=d.useState([]),ie=d.useRef(!1),[Ee,ts]=d.useState(!1),[ss,Ye]=d.useState(!1),[A,_e]=d.useState(null),We=d.useRef(null),[fe,He]=d.useState(()=>window.innerWidth<500?2:Math.max(2,Math.floor(Math.min(900,window.innerWidth)/280)));d.useEffect(()=>{as()},[]);async function as(){D(!0);try{const t=await K.load();$(t)}catch(t){console.error("è¼‰å…¥å¤±æ•—",t),b("è¼‰å…¥å¤±æ•—","error")}finally{D(!1)}}function b(t,a="success"){ee({msg:t,type:a}),setTimeout(()=>ee(null),2500)}function Ne({title:t,content:a,type:n="warning",confirmText:s="ç¢ºå®š",cancelText:h="å–æ¶ˆ"}){return new Promise(c=>{_e({title:t,content:a,type:n,confirmText:s,cancelText:h,onConfirm:()=>{_e(null),c(!0)},onCancel:()=>{_e(null),c(!1)}})})}function ns(t){var a;return(a=t.media)==null?void 0:a.some(n=>n.type==="video"||n.type==="youtube")}function ls(t){var a;return((a=O[t.id])==null?void 0:a.length)>0}async function ge(t){if(!t)return!1;try{const a=new AbortController,n=setTimeout(()=>a.abort(),1e4),s=await fetch(t,{method:"HEAD",mode:"cors",signal:a.signal});return clearTimeout(n),s.ok?!0:(console.log(`âŒ åœ–ç‰‡æª¢æŸ¥å¤±æ•— (HTTP ${s.status}): ${t}`),!1)}catch{return new Promise(n=>{const s=new window.Image,h=setTimeout(()=>{s.src="",n(!1)},1e4);s.onload=()=>{clearTimeout(h),s.naturalWidth===0||s.naturalHeight===0?n(!1):n(!0)},s.onerror=()=>{clearTimeout(h),n(!1)},s.src=t})}}async function is(){var s;ot(!0),ut({current:0,total:k.length});const t={};let a=0;for(const h of k){const c=[];if(((s=h.media)==null?void 0:s.length)>0)for(let r=0;r<h.media.length;r++){const l=h.media[r],x=l.type==="video"?l.thumbnail:l.url;x&&(await ge(x)||c.push(r))}c.length>0&&(t[h.id]=c),a++,ut({current:a,total:k.length})}Kt(t),ot(!1);const n=Object.keys(t).length;n>0?b(`æª¢æŸ¥å®Œæˆï¼š${n} ç­†æœ‰å£žåœ–`,"error"):b("æª¢æŸ¥å®Œæˆï¼šæ²’æœ‰ç™¼ç¾å£žåœ– âœ…")}const rs=d.useMemo(()=>{const t=new Set;k.forEach(n=>{if(n.date){const s=n.date.substring(0,4);s&&t.add(s)}});const a=Array.from(t).sort((n,s)=>s-n);return se?a:a.reverse()},[k,se]),B=d.useMemo(()=>k.filter(t=>{var a;return!(te.length>0&&!te.includes(t.member)||xe!=="all"&&t.type!==xe||de&&!ns(t)||be&&!ls(t)||je!=="all"&&t.date&&!t.date.startsWith(je)||we&&!((a=t.caption)!=null&&a.toLowerCase().includes(we.toLowerCase())))}).sort((t,a)=>{const n=new Date(t.date),s=new Date(a.date);return se?s-n:n-s}),[k,te,xe,de,be,je,we,se,O]);d.useEffect(()=>{const t=We.current;if(!t)return;const a=()=>{if(E!=="grid"){He(1);return}const s=Math.min(t.clientWidth,window.innerWidth);if(s<500){He(2);return}He(Math.max(2,Math.floor(s/280)))};a();const n=new ResizeObserver(a);return n.observe(t),()=>n.disconnect()},[E]);const cs=d.useMemo(()=>Math.ceil(B.length/fe),[B.length,fe]),Ve=sa({count:cs,getScrollElement:()=>We.current,estimateSize:()=>E==="grid"?340:120,overscan:3,gap:E==="grid"?16:10});function wt(){mt(null),M({type:"post",member:"å…¨å“¡",date:new Date().toISOString().split("T")[0],time:"",igUrl:"",caption:"",media:[],notes:""}),W(!0)}function os(t){mt(t),M({type:t.type,member:t.member,date:t.date,time:t.time||"",igUrl:t.igUrl||"",caption:t.caption||"",media:t.media||[],notes:t.notes||""}),W(!0)}function ds(t){H(t),V(0)}function us(){const t=B.findIndex(a=>a.id===(m==null?void 0:m.id));t>0&&(H(B[t-1]),V(0))}function ms(){const t=B.findIndex(a=>a.id===(m==null?void 0:m.id));t<B.length-1&&(H(B[t+1]),V(0))}function qe(){return B.findIndex(t=>t.id===(m==null?void 0:m.id))}const[Nt,ke]=d.useState(new Set);function Ce(t){return Nt.has(t)}async function hs(){var n,s,h,c,r;if(!(m!=null&&m.igUrl)){b("æ­¤è²¼æ–‡æ²’æœ‰ IG é€£çµ","error");return}if(Ce(m.id)){b("æ­¤è²¼æ–‡æ­£åœ¨åŒæ­¥ä¸­...","info");return}const t={...m},a=m.id;ke(l=>new Set(l).add(a));try{const l=await Ae(t.igUrl);if(!l.success||!((n=l.media)!=null&&n.length)){if(!await Ne({title:"âš ï¸ æŠ“å–å¤±æ•—",type:"warning",confirmText:"æ¸…ç©ºåª’é«”",cancelText:"å–æ¶ˆ",content:e.jsxs("div",{className:"confirm-content",children:[e.jsx("p",{children:"å¯èƒ½åŽŸå› ï¼š"}),e.jsxs("ul",{children:[e.jsx("li",{children:"IG è²¼æ–‡å·²è¢«åˆªé™¤"}),e.jsx("li",{children:"IG API æš«æ™‚ç„¡æ³•å­˜å–"}),e.jsx("li",{children:"ç¶²è·¯é€£ç·šå•é¡Œ"})]}),e.jsx("p",{className:"confirm-warning",children:"æ˜¯å¦ä»è¦æ¸…ç©ºæ­¤è²¼æ–‡çš„åª’é«”è³‡æ–™ï¼Ÿ"})]})})){ke(f=>{const w=new Set(f);return w.delete(a),w});return}}else{const y=((s=t.media)==null?void 0:s.length)||0,f=((h=l.media)==null?void 0:h.length)||0,w=(t.caption||"").trim(),R=(l.caption||"").trim(),Te=y!==f,Ft=w!==R&&R!=="";if(Te||Ft){const $s=w.substring(0,80)+(w.length>80?"...":""),Ts=R.substring(0,80)+(R.length>80?"...":"");if(!await Ne({title:"ðŸ“ è³‡æ–™è®Šæ›´ç¢ºèª",type:"info",confirmText:"è¦†è“‹",cancelText:"å–æ¶ˆ",content:e.jsxs("div",{className:"confirm-content",children:[e.jsx("p",{children:"æŠ“å–åˆ°çš„è³‡æ–™èˆ‡ç¾æœ‰è³‡æ–™ä¸åŒï¼š"}),Te&&e.jsxs("div",{className:"diff-item",children:[e.jsx("span",{className:"diff-label",children:"ðŸ“· åª’é«”æ•¸é‡"}),e.jsxs("div",{className:"diff-values",children:[e.jsxs("span",{className:"diff-old",children:[y," å¼µ"]}),e.jsx("span",{className:"diff-arrow",children:"â†’"}),e.jsxs("span",{className:"diff-new",children:[f," å¼µ"]})]})]}),Ft&&e.jsxs("div",{className:"diff-item",children:[e.jsx("span",{className:"diff-label",children:"ðŸ“ å…§å®¹"}),e.jsxs("div",{className:"diff-text",children:[e.jsx("div",{className:"diff-old",children:$s||"(ç©º)"}),e.jsx("div",{className:"diff-new",children:Ts})]})]}),e.jsx("p",{className:"confirm-question",children:"ç¢ºå®šè¦è¦†è“‹å—Žï¼Ÿ"})]})})){ke(Is=>{const At=new Set(Is);return At.delete(a),At}),b("å·²å–æ¶ˆåŒæ­¥");return}}}b("åŒæ­¥ä¸­ï¼Œæª¢æŸ¥ä¸¦ä¸Šå‚³åœ–ç‰‡...","info");const x=((c=l.media)==null?void 0:c.length)>0?await Qe(l.media,t.media||[],t.member):[],o=(t.media||[]).filter(y=>y.type==="youtube"),p=[...x,...o],u=Fe((r=l.owner)==null?void 0:r.username,t.igUrl),i=ze(u),g=Pe(u);let j=t.date,U=t.time||"";if(g!=null&&g.dateFormat&&l.caption){const y=Y(l.caption,g.dateFormat);y&&(j=y)}else if(l.date){const y=new Date(l.date),f=new Date(y.getTime()+480*60*1e3);j=`${f.getUTCFullYear()}-${String(f.getUTCMonth()+1).padStart(2,"0")}-${String(f.getUTCDate()).padStart(2,"0")}`,U=`${String(f.getUTCHours()).padStart(2,"0")}:${String(f.getUTCMinutes()).padStart(2,"0")}`}if(!g&&i==="å…¨å“¡"&&l.caption){const y=Y(l.caption,"auto");y&&(j=y,U="")}const P={...t,media:p,caption:l.caption||t.caption,type:(g==null?void 0:g.type)||t.type,date:j,time:U,updatedAt:Date.now()};$(y=>{const f=y.map(w=>w.id===a?P:w);return K.update(P).catch(w=>console.warn("D1 å„²å­˜å¤±æ•—:",w)),f}),H(y=>(y==null?void 0:y.id)===a?P:y),V(0),x.length>0?b(`âœ… åŒæ­¥å®Œæˆï¼š${x.length} å€‹åª’é«”`):b("å·²æ¸…ç©ºåª’é«”è³‡æ–™","info")}catch(l){console.error("åŒæ­¥å¤±æ•—:",l),b("âŒ åŒæ­¥å¤±æ•—ï¼š"+l.message,"error")}finally{ke(l=>{const x=new Set(l);return x.delete(a),x})}}function ps(){m&&(os(m),H(null))}const[Je,Se]=d.useState(!1),[kt,Ue]=d.useState(""),[Ct,$e]=d.useState(0),[St,re]=d.useState(!1),[Xe,Ke]=d.useState("");async function Ut(){var t,a;if(v.igUrl){Se(!0),Ue("æŠ“å–ä¸­...");try{const n=await Ae(v.igUrl);if(n.success&&((t=n.media)==null?void 0:t.length)>0){const s=Fe((a=n.owner)==null?void 0:a.username,v.igUrl),h=ze(s),c=Pe(s);let r=v.date,l="";if(c!=null&&c.dateFormat&&n.caption){const i=Y(n.caption,c.dateFormat);i&&(r=i)}else if(n.date){const i=new Date(n.date),g=new Date(i.getTime()+480*60*1e3);r=`${g.getUTCFullYear()}-${String(g.getUTCMonth()+1).padStart(2,"0")}-${String(g.getUTCDate()).padStart(2,"0")}`,l=`${String(g.getUTCHours()).padStart(2,"0")}:${String(g.getUTCMinutes()).padStart(2,"0")}`}if(!c&&h==="å…¨å“¡"&&n.caption){const i=Y(n.caption,"auto");i&&(r=i,l="")}const x=n.media||[],o=x.map((i,g)=>({url:i.url||i.thumbnail,type:i.type,thumbnail:i.thumbnail||null,uploading:i.type==="image",thumbnailUploading:i.type==="video"&&i.thumbnail,originalUrl:i.url,originalThumbnail:i.thumbnail,index:g}));M(i=>({...i,type:(c==null?void 0:c.type)||n.type||i.type,member:h,date:r,time:l||i.time,caption:n.caption||i.caption,media:o})),Se(!1),Ue(""),re(!1),b(`âœ… å·²æŠ“å– ${x.length} å€‹åª’é«”ï¼ŒèƒŒæ™¯ä¸Šå‚³ä¸­...`);const p=o.filter(i=>i.type==="image"),u=o.filter(i=>i.type==="video"&&i.thumbnail);$e(p.length+u.length);for(const i of p)$t(i.originalUrl,i.index,h);for(const i of u)gs(i.originalThumbnail,i.index,h)}else{const s=v.igUrl.match(/instagram\.com\/p\//),h=v.igUrl.match(/instagram\.com\/(?:reel|reels)\//);let c="post";h&&(c="reels"),M(r=>({...r,type:c})),re(!0),b("âš ï¸ è‡ªå‹•æŠ“å–å¤±æ•—ï¼Œè«‹æ‰‹å‹•è¼¸å…¥åª’é«”ç¶²å€","info"),Se(!1),Ue("")}}catch(n){console.error("è§£æžå¤±æ•—",n),re(!0),b("âš ï¸ æŠ“å–å¤±æ•—ï¼Œè«‹æ‰‹å‹•è¼¸å…¥åª’é«”ç¶²å€","error"),Se(!1),Ue("")}}}async function fs(){if(!Xe.trim())return;const t=Xe.split(`
`).map(s=>s.trim()).filter(s=>s&&(s.startsWith("http")||s.startsWith("//")));if(t.length===0){b("è«‹è¼¸å…¥æœ‰æ•ˆçš„ç¶²å€","error");return}const a=t.map((s,h)=>{if(Os(s))return{url:s,type:"youtube",thumbnail:et(s),index:v.media.length+h};const c=/\.(mp4|mov|webm|m4v)/i.test(s)||s.includes("video");return{url:s,type:c?"video":"image",uploading:!c,originalUrl:s,index:v.media.length+h}});M(s=>({...s,media:[...s.media,...a]}));const n=a.filter(s=>s.type==="image");$e(s=>s+n.length);for(const s of n)$t(s.originalUrl,s.index,v.member);Ke(""),re(!1),b(`å·²æ–°å¢ž ${t.length} å€‹åª’é«”`)}async function $t(t,a,n){try{const s={context:"social",member:n},[h,c]=await Promise.all([Me(t,s),Be(t,s).catch(r=>(console.warn("ImgBB å‚™ä»½å¤±æ•—:",r.message),null))]);M(r=>({...r,media:r.media.map((l,x)=>x===a?{...l,url:h,backupUrl:c,uploading:!1}:l)}))}catch(s){console.warn(`åœ–ç‰‡ ${a+1} ä¸Šå‚³å¤±æ•—`,s),M(h=>({...h,media:h.media.map((c,r)=>r===a?{...c,uploading:!1,uploadFailed:!0}:c)}))}finally{$e(s=>s-1)}}async function gs(t,a,n){try{const s={context:"social",member:n},[h,c]=await Promise.all([Me(t,s),Be(t,s).catch(r=>(console.warn("ImgBB å‚™ä»½å¤±æ•—:",r.message),null))]);M(r=>({...r,media:r.media.map((l,x)=>x===a?{...l,thumbnail:h,thumbnailBackupUrl:c,thumbnailUploading:!1}:l)})),c&&console.log(`âœ… å½±ç‰‡ ${a+1} ç¸®åœ–é›™é‡å‚™ä»½å®Œæˆ`)}catch(s){console.warn(`å½±ç‰‡ ${a+1} ç¸®åœ–ä¸Šå‚³å¤±æ•—`,s),M(h=>({...h,media:h.media.map((c,r)=>r===a?{...c,thumbnailUploading:!1,thumbnailFailed:!0}:c)}))}finally{$e(s=>s-1)}}async function xs(t){const a=Array.from(t.target.files);if(a.length){pt(!0);try{const n=[];for(const s of a)if(s.type.startsWith("video/")){const c=URL.createObjectURL(s);n.push({url:c,type:"video",localFile:s})}else{const{url:c,backupUrl:r}=await As(s,{context:"social",member:v.member});n.push({url:c,type:"image",...r&&{backupUrl:r}})}M(s=>({...s,media:[...s.media,...n]})),b(`å·²æ–°å¢ž ${n.length} å€‹æª”æ¡ˆ`)}catch(n){console.error("ä¸Šå‚³å¤±æ•—",n),b("ä¸Šå‚³å¤±æ•—","error")}finally{pt(!1)}}}function bs(t){M(a=>({...a,media:a.media.filter((n,s)=>s!==t)}))}async function js(){if(!v.date||!v.member){b("è«‹å¡«å¯«å¿…è¦æ¬„ä½","error");return}if(v.media.some(n=>n.uploading)&&!await Ne({title:"âš ï¸ ä¸Šå‚³æœªå®Œæˆ",type:"warning",confirmText:"ä»è¦å„²å­˜",cancelText:"ç­‰å¾…ä¸Šå‚³",content:e.jsxs("div",{className:"confirm-content",children:[e.jsx("p",{children:"é‚„æœ‰åœ–ç‰‡æ­£åœ¨ä¸Šå‚³ä¸­ï¼Œç¢ºå®šè¦ç¾åœ¨å„²å­˜å—Žï¼Ÿ"}),e.jsx("p",{className:"confirm-warning",children:"æœªå®Œæˆä¸Šå‚³çš„åœ–ç‰‡å¯èƒ½ç„¡æ³•æ­£å¸¸é¡¯ç¤º"})]})}))return;const a={id:(z==null?void 0:z.id)||Rt("s"),type:v.type,member:v.member,date:v.date,time:v.time,igUrl:v.igUrl,caption:v.caption,media:v.media.map(n=>({url:n.url,type:n.type,...n.backupUrl&&{backupUrl:n.backupUrl},...n.thumbnail&&{thumbnail:n.thumbnail},...n.thumbnailBackupUrl&&{thumbnailBackupUrl:n.thumbnailBackupUrl}})),notes:v.notes,createdAt:(z==null?void 0:z.createdAt)||Date.now(),updatedAt:Date.now()};Z(!0);try{z?(await K.update(a),$(k.map(n=>n.id===z.id?a:n))):(await K.create(a),$([a,...k])),b("å·²å„²å­˜"),W(!1)}catch(n){console.error("å„²å­˜å¤±æ•—",n),b("å„²å­˜å¤±æ•—","error")}finally{Z(!1)}}async function vs(t){if(await Ne({title:"ðŸ—‘ï¸ åˆªé™¤ç¢ºèª",type:"danger",confirmText:"åˆªé™¤",cancelText:"å–æ¶ˆ",content:e.jsxs("div",{className:"confirm-content",children:[e.jsx("p",{children:"ç¢ºå®šè¦åˆªé™¤é€™ç­†å‚™ä»½å—Žï¼Ÿ"}),e.jsx("p",{className:"confirm-warning",children:"æ­¤æ“ä½œç„¡æ³•å¾©åŽŸ"})]})}))try{await K.delete(t),$(k.filter(n=>n.id!==t)),b("å·²åˆªé™¤")}catch(n){console.error("åˆªé™¤å¤±æ•—",n),b("åˆªé™¤å¤±æ•—","error")}}function Tt(t){ae(a=>a.includes(t)?a.filter(n=>n!==t):[...a,t])}function ys(){J.length===B.length?ae([]):ae(B.map(t=>t.id))}async function Qe(t,a=[],n){var c,r,l,x;const s=[],h=[];for(let o=0;o<t.length;o++){const p=t[o],u=a[o];if(p.type==="image"){if((u==null?void 0:u.type)==="image"){if((c=u==null?void 0:u.url)!=null&&c.includes("cloudinary")&&await ge(u.url)){console.log(`âœ… åœ–ç‰‡ ${o+1} Cloudinary å‚™ä»½å¯ç”¨ï¼Œè·³éŽä¸Šå‚³`),s.push({...u});continue}if((r=u==null?void 0:u.backupUrl)!=null&&r.includes("i.ibb.co")&&await ge(u.backupUrl)){console.log(`âœ… åœ–ç‰‡ ${o+1} ImgBB å‚™ä»½å¯ç”¨ï¼Œåˆ‡æ›ä½¿ç”¨`),s.push({url:u.backupUrl,type:"image",backupUrl:u.backupUrl});continue}console.log(`âš ï¸ åœ–ç‰‡ ${o+1} æ‰€æœ‰å‚™ä»½éƒ½å¤±æ•ˆï¼Œé‡æ–°ä¸Šå‚³`)}try{console.log(`ðŸ“¤ ä¸Šå‚³åœ–ç‰‡ ${o+1}...`);const i={context:"social",member:n},j={url:await Me(p.url,i),type:"image"};s.push(j);const U=s.length-1;h.push(Be(p.url,i).then(P=>{P&&(s[U].backupUrl=P)}).catch(P=>console.warn("ImgBB èƒŒæ™¯ä¸Šå‚³å¤±æ•—:",P)))}catch(i){console.warn("åœ–ç‰‡ä¸Šå‚³å¤±æ•—:",i),s.push({url:p.url,type:"image"})}}else if(p.type==="video"){const i={url:p.url,type:"video"};if(p.thumbnail){if((u==null?void 0:u.type)==="video"){if((l=u==null?void 0:u.thumbnail)!=null&&l.includes("cloudinary")&&await ge(u.thumbnail)){console.log(`âœ… å½±ç‰‡ ${o+1} ç¸®åœ– Cloudinary å‚™ä»½å¯ç”¨ï¼Œè·³éŽä¸Šå‚³`),i.thumbnail=u.thumbnail,u.thumbnailBackupUrl&&(i.thumbnailBackupUrl=u.thumbnailBackupUrl),s.push(i);continue}if((x=u==null?void 0:u.thumbnailBackupUrl)!=null&&x.includes("i.ibb.co")&&await ge(u.thumbnailBackupUrl)){console.log(`âœ… å½±ç‰‡ ${o+1} ç¸®åœ– ImgBB å‚™ä»½å¯ç”¨ï¼Œåˆ‡æ›ä½¿ç”¨`),i.thumbnail=u.thumbnailBackupUrl,i.thumbnailBackupUrl=u.thumbnailBackupUrl,s.push(i);continue}console.log(`âš ï¸ å½±ç‰‡ ${o+1} ç¸®åœ–æ‰€æœ‰å‚™ä»½éƒ½å¤±æ•ˆï¼Œé‡æ–°ä¸Šå‚³`)}try{console.log(`ðŸ“¤ ä¸Šå‚³å½±ç‰‡ ${o+1} ç¸®åœ–...`);const g={context:"social",member:n},j=await Me(p.thumbnail,g);i.thumbnail=j,h.push(Be(p.thumbnail,g).then(U=>{U&&(i.thumbnailBackupUrl=U)}).catch(U=>console.warn("ImgBB ç¸®åœ–èƒŒæ™¯ä¸Šå‚³å¤±æ•—:",U)))}catch(g){console.warn("ç¸®åœ–ä¸Šå‚³å¤±æ•—:",g),i.thumbnail=p.thumbnail}}s.push(i)}}return h.length>0&&Promise.all(h).then(()=>{console.log("âœ… ImgBB èƒŒæ™¯ä¸Šå‚³å®Œæˆ")}),s}function ws(t,a){return t.map((s,h)=>{const c=a[h];return s.type==="video"&&(c==null?void 0:c.type)==="video"?{...s,url:c.url}:(s.type==="image",s)})}function Ns(){ne.current=!0,b("æ­£åœ¨å–æ¶ˆåŒæ­¥...","info")}async function ks(){var h,c;const t=k.filter(r=>J.includes(r.id)&&r.igUrl);if(t.length===0){b("æ²’æœ‰å¯åŒæ­¥çš„é …ç›®ï¼ˆéœ€æœ‰ IG é€£çµï¼‰","error");return}const a=de;ne.current=!1,xt(!0),jt({current:0,total:t.length});let n=0;for(const r of t){if(ne.current)break;vt(r.id),await new Promise(l=>setTimeout(l,0));try{const l=await Ae(r.igUrl);if(ne.current)break;if(l.success&&((h=l.media)==null?void 0:h.length)>0){const x=Fe((c=l.owner)==null?void 0:c.username,r.igUrl),o=ze(x),p=Pe(x);let u=r.date,i=r.time||"";if(p!=null&&p.dateFormat&&l.caption){const j=Y(l.caption,p.dateFormat);j&&(u=j)}else if(l.date){const j=new Date(l.date),U=new Date(j.getTime()+480*60*1e3);u=`${U.getUTCFullYear()}-${String(U.getUTCMonth()+1).padStart(2,"0")}-${String(U.getUTCDate()).padStart(2,"0")}`,i=`${String(U.getUTCHours()).padStart(2,"0")}:${String(U.getUTCMinutes()).padStart(2,"0")}`}if(!p&&o==="å…¨å“¡"&&l.caption){const j=Y(l.caption,"auto");j&&(u=j,i="")}let g;if(a){const j=ws(r.media,l.media);g={...r,media:j,type:(p==null?void 0:p.type)||r.type,date:u,time:i,updatedAt:Date.now()},console.log(`âœ… ${r.id} å½±ç‰‡ URL å·²æ›´æ–°ï¼ˆä¿ç•™ thumbnailï¼‰`)}else{const j=await Qe(l.media,r.media||[],r.member);if(ne.current)break;const U=(r.media||[]).filter(y=>y.type==="youtube"),P=[...j,...U];g={...r,media:P,caption:l.caption||r.caption,type:(p==null?void 0:p.type)||r.type,date:u,time:i,updatedAt:Date.now()}}$(j=>j.map(U=>U.id===r.id?g:U)),K.update(g).catch(j=>console.warn("D1 å„²å­˜å¤±æ•—:",j)),n++,await new Promise(j=>setTimeout(j,0))}}catch(l){console.warn(`åŒæ­¥ ${r.id} å¤±æ•—:`,l)}jt(l=>({...l,current:l.current+1})),await new Promise(l=>setTimeout(l,0))}const s=ne.current;vt(null),xt(!1),ft(!1),ae([]),s?b(`å·²å–æ¶ˆåŒæ­¥ï¼ˆå·²å®Œæˆ ${n} ç­†ï¼‰`,"info"):b(a?`å½±ç‰‡åŒæ­¥å®Œæˆï¼š${n}/${t.length} ç­†æˆåŠŸ`:`åŒæ­¥å®Œæˆï¼š${n}/${t.length} ç­†æˆåŠŸ`)}const Cs=`(async()=>{const d=ms=>new Promise(r=>setTimeout(r,ms));const urls=new Set();let last=0,retries=0;console.log('é–‹å§‹æ”¶é›†è²¼æ–‡ URL...');while(retries<5){document.querySelectorAll('a[href*="/p/"],a[href*="/reel/"],a[href*="/reels/"]').forEach(a=>{const h=a.href.split('?')[0];if(/\\/(p|reel|reels)\\//.test(h))urls.add(h)});console.log('å·²æ‰¾åˆ° '+urls.size+' ç­†');if(urls.size===last)retries++;else{retries=0;last=urls.size}window.scrollTo(0,document.body.scrollHeight);await d(1500)}const r=[...urls].join('\\n');console.log('\\nå®Œæˆï¼å…± '+urls.size+' ç­†ï¼š\\n'+r);try{await navigator.clipboard.writeText(r);console.log('\\nâœ… å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿')}catch{console.log('\\nâš ï¸ è«‹æ‰‹å‹•è¤‡è£½ä¸Šæ–¹æ–‡å­—')}})();`;function Ze(t){const a=new Set;return t.split(`
`).map(n=>n.trim()).filter(n=>n&&/instagram\.com\/(?:[^\/]+\/)?(p|reel|reels|tv)\//.test(n)).filter(n=>{const s=n.split("?")[0].replace(/\/$/,"");return a.has(s)?!1:(a.add(s),!0)})}function Ss(){ie.current=!0,b("æ­£åœ¨å–æ¶ˆæ‰¹æ¬¡å‚™ä»½...","info")}async function Us(){var c,r;const t=Ze(me);if(t.length===0){b("æ²’æœ‰æœ‰æ•ˆçš„ IG é€£çµ","error");return}new Set(k.map(l=>l.igUrl).filter(Boolean));const a=[],n=[];for(const l of t){const x=l.split("?")[0].replace(/\/$/,"");k.some(p=>p.igUrl?p.igUrl.split("?")[0].replace(/\/$/,"")===x:!1)?n.push(l):a.push(l)}if(a.length===0){b(`å…¨éƒ¨ ${n.length} ç­†éƒ½æ˜¯é‡è¤‡çš„`,"error");return}ie.current=!1,yt(!0),Le({current:0,total:a.length}),X(a.map(l=>({url:l,status:"pending"})));let s=0;for(let l=0;l<a.length&&!ie.current;l++){const x=a[l];X(o=>o.map((p,u)=>u===l?{...p,status:"processing"}:p)),await new Promise(o=>setTimeout(o,0));try{console.log(`[æ‰¹æ¬¡å‚™ä»½ ${l+1}] é–‹å§‹æŠ“å–: ${x}`);const o=await Ae(x);if(console.log(`[æ‰¹æ¬¡å‚™ä»½ ${l+1}] fetchIGData å›žå‚³:`,JSON.stringify(o,null,2)),ie.current)break;if(!o.success||!((c=o.media)!=null&&c.length)){const f=o.error||o.message||(o.success?"ç„¡åª’é«”":"æŠ“å–å¤±æ•—");console.warn(`[æ‰¹æ¬¡å‚™ä»½ ${l+1}] è·³éŽ: ${f}`),X(w=>w.map((R,Te)=>Te===l?{...R,status:"error",error:f}:R)),Le(w=>({...w,current:w.current+1}));continue}const p=Fe((r=o.owner)==null?void 0:r.username,x),u=ze(p),i=Pe(p);console.log(`[æ‰¹æ¬¡å‚™ä»½ ${l+1}] æˆå“¡: ${u}, username: ${p}, media: ${o.media.length} ç­†`);let g=new Date().toISOString().split("T")[0],j="";if(i!=null&&i.dateFormat&&o.caption){const f=Y(o.caption,i.dateFormat);f&&(g=f)}else if(o.date){const f=new Date(o.date),w=new Date(f.getTime()+480*60*1e3);g=`${w.getUTCFullYear()}-${String(w.getUTCMonth()+1).padStart(2,"0")}-${String(w.getUTCDate()).padStart(2,"0")}`,j=`${String(w.getUTCHours()).padStart(2,"0")}:${String(w.getUTCMinutes()).padStart(2,"0")}`}if(!i&&u==="å…¨å“¡"&&o.caption){const f=Y(o.caption,"auto");f&&(g=f,j="")}console.log(`[æ‰¹æ¬¡å‚™ä»½ ${l+1}] æ—¥æœŸ: ${g} ${j}`),console.log(`[æ‰¹æ¬¡å‚™ä»½ ${l+1}] é–‹å§‹ä¸Šå‚³åª’é«”...`);const U=await Qe(o.media,[],u);if(console.log(`[æ‰¹æ¬¡å‚™ä»½ ${l+1}] ä¸Šå‚³å®Œæˆ:`,U.map(f=>{var w;return{url:(w=f.url)==null?void 0:w.substring(0,50),type:f.type}})),ie.current)break;const P=(i==null?void 0:i.type)||o.type||"post",y={id:Rt("s"),type:P,member:u,date:g,time:j,igUrl:x,caption:o.caption||"",media:U.map(f=>({url:f.url,type:f.type,...f.backupUrl&&{backupUrl:f.backupUrl},...f.thumbnail&&{thumbnail:f.thumbnail},...f.thumbnailBackupUrl&&{thumbnailBackupUrl:f.thumbnailBackupUrl}})),notes:"",createdAt:Date.now(),updatedAt:Date.now()};console.log(`[æ‰¹æ¬¡å‚™ä»½ ${l+1}] å­˜å…¥ D1...`,{id:y.id,type:y.type,member:y.member,mediaCount:y.media.length}),await K.create(y),$(f=>[y,...f]),s++,console.log(`[æ‰¹æ¬¡å‚™ä»½ ${l+1}] âœ… æˆåŠŸ`),X(f=>f.map((w,R)=>R===l?{...w,status:"success",member:u,type:P}:w))}catch(o){console.error(`[æ‰¹æ¬¡å‚™ä»½ ${l+1}] âŒ å¤±æ•—:`,o),X(p=>p.map((u,i)=>i===l?{...u,status:"error",error:o.message||"æœªçŸ¥éŒ¯èª¤"}:u))}Le(o=>({...o,current:o.current+1})),await new Promise(o=>setTimeout(o,0))}const h=ie.current;if(yt(!1),h)b(`å·²å–æ¶ˆï¼ˆå·²å®Œæˆ ${s} ç­†ï¼‰`,"info");else{const l=a.length-s,x=n.length>0?`ï¼Œè·³éŽ ${n.length} ç­†é‡è¤‡`:"";b(`æ‰¹æ¬¡å‚™ä»½å®Œæˆï¼š${s} ç­†æˆåŠŸ${l>0?`ï¼Œ${l} ç­†å¤±æ•—`:""}${x}`)}}return F?e.jsxs("div",{className:"archive-page-loading",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"è¼‰å…¥ä¸­..."})]}):e.jsxs("div",{className:"social-archive archive-page",children:[e.jsxs("header",{className:"archive-header",children:[e.jsx("div",{style:{display:"flex",alignItems:"center",gap:8},children:e.jsx("h1",{children:"ðŸ“± ç¤¾ç¾¤å‚™ä»½"})}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6},children:[N&&e.jsx("button",{className:"add-btn",onClick:()=>ue(!0),title:"æ‰¹æ¬¡å‚™ä»½",children:e.jsx(De,{size:20})}),e.jsx("button",{className:"add-btn",onClick:wt,title:"æ–°å¢žå‚™ä»½",children:e.jsx(Rs,{size:20})}),I&&e.jsx(Ms,{currentPage:S,setCurrentPage:I})]})]}),e.jsxs("div",{className:"archive-filters",children:[e.jsxs("div",{className:"filter-row",children:[e.jsx(Bs,{selectedMembers:te,onChange:T,isOpen:it,onToggle:()=>{Oe(!it),ve(!1),ye(!1)}}),e.jsx(Yt,{label:"é¡žåž‹",options:Q.map(t=>({value:t.id,label:`${t.icon} ${t.label}`})),value:xe,onChange:t=>{Wt(t),ye(!1)},isOpen:rt,onToggle:()=>{ye(!rt),Oe(!1),ve(!1)}}),e.jsx(Yt,{label:"å¹´ä»½",options:rs.map(t=>({value:t,label:t})),value:je,onChange:t=>{qt(t),ve(!1)},isOpen:lt,onToggle:()=>{ve(!lt),Oe(!1),ye(!1)},className:"year-filter"}),e.jsx("button",{className:"year-sort-btn",onClick:()=>Jt(!se),title:se?"ç›®å‰ï¼šæ–° â†’ èˆŠ":"ç›®å‰ï¼šèˆŠ â†’ æ–°",children:e.jsx(Ls,{size:12})}),e.jsxs("button",{className:`filter-video-btn ${de?"active":""}`,onClick:()=>Ht(!de),title:"åªé¡¯ç¤ºå«å½±ç‰‡çš„è²¼æ–‡",children:[e.jsx(Es,{size:16}),e.jsx("span",{children:"å½±ç‰‡"})]}),N&&e.jsx("button",{className:`filter-broken-btn ${be?"active":""}`,onClick:()=>{Object.keys(O).length===0&&!Ge&&is(),Vt(!be)},title:"æª¢æŸ¥ä¸¦ç¯©é¸å£žåœ–",disabled:Ge,children:Ge?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"mini-spinner"}),e.jsxs("span",{children:[dt.current,"/",dt.total]})]}):e.jsxs(e.Fragment,{children:[e.jsx(tt,{size:16}),e.jsxs("span",{children:["å£žåœ–",Object.keys(O).length>0?` (${Object.keys(O).length})`:""]})]})}),e.jsxs("div",{className:"search-box",children:[e.jsx(Ys,{size:16}),e.jsx("input",{type:"text",placeholder:"æœå°‹å…§å®¹...",value:we,onChange:t=>Xt(t.target.value)})]}),e.jsxs("div",{className:"view-toggle",children:[e.jsx("button",{className:E==="grid"?"active":"",onClick:()=>ct("grid"),children:e.jsx(_s,{size:16})}),e.jsx("button",{className:E==="list"?"active":"",onClick:()=>ct("list"),children:e.jsx(Ws,{size:16})})]}),N&&e.jsx("button",{className:`select-mode-btn ${q?"active":""}`,onClick:()=>{ft(!q),ae([])},title:"å‹¾é¸æ¨¡å¼",children:e.jsx(Lt,{size:16})})]}),e.jsxs("div",{className:"filter-stats",children:["å…± ",B.length," ç­†å‚™ä»½",q&&B.length>0&&e.jsx("button",{className:"select-all-btn",onClick:ys,children:J.length===B.length?"å–æ¶ˆå…¨é¸":"å…¨é¸"})]})]}),e.jsx("div",{ref:We,className:"social-content-scroll",children:B.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx(st,{size:48}),e.jsx("p",{children:"å°šç„¡å‚™ä»½è³‡æ–™"}),e.jsx("button",{onClick:wt,children:"æ–°å¢žç¬¬ä¸€ç­†"})]}):e.jsx("div",{style:{height:Ve.getTotalSize(),position:"relative"},children:Ve.getVirtualItems().map(t=>{const a=t.index*fe,n=B.slice(a,a+fe);return e.jsx("div",{className:`archive-content ${E}`,style:{position:"absolute",top:0,left:0,right:0,transform:`translateY(${t.start}px)`,...E==="grid"?{gridTemplateColumns:`repeat(${fe}, 1fr)`}:{}},ref:Ve.measureElement,"data-index":t.index,children:n.map(s=>{var h,c,r,l,x;return e.jsxs("div",{className:`archive-card ${q&&J.includes(s.id)?"selected":""}`,onClick:()=>q?Tt(s.id):ds(s),children:[q&&e.jsx("div",{className:"card-checkbox",onClick:o=>{o.stopPropagation(),Tt(s.id)},children:J.includes(s.id)?e.jsx(Lt,{size:20}):e.jsx(Hs,{size:20})}),e.jsxs("div",{className:"archive-thumb",children:[(h=s.media)!=null&&h[0]?s.media[0].type==="youtube"?e.jsxs("div",{className:"video-thumb-img",children:[e.jsx("img",{src:s.media[0].thumbnail||et(s.media[0].url),alt:"",loading:"lazy",width:260,height:260}),e.jsx(ce,{size:24,className:"play-overlay"})]}):s.media[0].type==="video"?s.media[0].thumbnail?e.jsxs("div",{className:"video-thumb-img",children:[e.jsx("img",{src:Ot(s.media[0]),alt:"",loading:"lazy",width:260,height:260}),e.jsx(ce,{size:24,className:"play-overlay"})]}):e.jsxs("div",{className:"video-thumb-auto",children:[e.jsx("video",{src:s.media[0].backupUrl||s.media[0].url,muted:!0,preload:"metadata"}),e.jsx(ce,{size:24,className:"play-overlay"})]}):e.jsx("img",{src:Ot(s.media[0]),alt:"",loading:"lazy",width:260,height:260}):e.jsx("div",{className:"no-thumb",children:e.jsx("img",{src:"/bigbang-timeline/bigbang-default.png",alt:"BIGBANG"})}),((c=s.media)==null?void 0:c.length)>1&&e.jsxs("span",{className:"media-count",children:["+",s.media.length-1]}),e.jsx("span",{className:"type-badge",style:{background:(r=Q.find(o=>o.id===s.type))==null?void 0:r.color},children:(l=Q.find(o=>o.id===s.type))==null?void 0:l.icon}),((x=O[s.id])==null?void 0:x.length)>0&&e.jsxs("span",{className:"broken-badge",title:`${O[s.id].length} å¼µåœ–ç‰‡æå£ž`,children:[e.jsx(tt,{size:14}),O[s.id].length]}),(Nt.has(s.id)||Zt===s.id)&&e.jsxs("div",{className:"syncing-overlay",children:[e.jsx(at,{size:24,className:"spinning"}),e.jsx("span",{children:"åŒæ­¥ä¸­..."})]})]}),e.jsxs("div",{className:"archive-info",children:[e.jsxs("div",{className:"archive-meta",children:[e.jsx("span",{className:"member-tag",style:{background:Ie(s.member)+"30",color:Ie(s.member)},children:s.member}),e.jsx("span",{className:"date",children:Gt(s.date)})]}),s.caption&&e.jsx("p",{className:"archive-caption",children:s.caption})]})]},s.id)})},t.key)})})}),m&&e.jsxs("div",{className:"modal-overlay view-modal-overlay",onClick:()=>H(null),children:[e.jsxs("div",{className:"post-nav-indicator",onClick:t=>t.stopPropagation(),children:[qe()+1," / ",B.length]}),e.jsx("button",{className:"post-nav-side prev",onClick:t=>{t.stopPropagation(),us()},disabled:qe()<=0,title:"ä¸Šä¸€å‰‡",children:e.jsx(Vs,{size:32})}),e.jsxs("div",{className:"view-modal",onClick:t=>t.stopPropagation(),children:[e.jsx("button",{className:"view-close-btn",onClick:()=>H(null),children:e.jsx(oe,{size:24})}),e.jsx("div",{className:"view-media-area",children:((It=m.media)==null?void 0:It.length)>0?e.jsxs(e.Fragment,{children:[((Mt=m.media[G])==null?void 0:Mt.type)==="youtube"?e.jsx("iframe",{src:`https://www.youtube.com/embed/${Ds(m.media[G].url)}?autoplay=1`,allow:"autoplay; encrypted-media",allowFullScreen:!0,className:"view-media view-youtube"}):((Bt=m.media[G])==null?void 0:Bt.type)==="video"?e.jsx("video",{src:m.media[G].backupUrl||m.media[G].url,controls:!0,autoPlay:!0,className:"view-media"},`${m.id}-${G}`):e.jsx("img",{src:zs(m.media[G]),alt:"",className:"view-media"},`${m.id}-${G}`),m.media.length>1&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"media-nav prev",onClick:()=>V(t=>(t-1+m.media.length)%m.media.length),children:"â€¹"}),e.jsx("button",{className:"media-nav next",onClick:()=>V(t=>(t+1)%m.media.length),children:"â€º"}),e.jsx("div",{className:"media-dots",children:m.media.map((t,a)=>e.jsx("span",{className:`dot ${a===G?"active":""}`,onClick:()=>V(a)},a))})]})]}):e.jsx("div",{className:"no-media",children:e.jsx("img",{src:"/bigbang-timeline/bigbang-default.png",alt:"BIGBANG",className:"no-media-img"})})}),e.jsxs("div",{className:"view-info-area",children:[e.jsxs("div",{className:"view-header",children:[e.jsx("span",{className:"member-tag",style:{background:Ie(m.member)+"30",color:Ie(m.member)},children:m.member}),e.jsxs("span",{className:"type-badge",style:{background:(Dt=Q.find(t=>t.id===m.type))==null?void 0:Dt.color},children:[(zt=Q.find(t=>t.id===m.type))==null?void 0:zt.icon," ",(Pt=Q.find(t=>t.id===m.type))==null?void 0:Pt.label]}),e.jsx("span",{className:"view-date",children:N&&m.time?Ps(m.date,m.time):Gt(m.date)})]}),m.caption&&e.jsx("div",{className:"view-caption",children:e.jsx("p",{children:m.caption})}),m.notes&&e.jsxs("div",{className:"view-notes",children:[e.jsx("strong",{children:"å‚™è¨»ï¼š"}),e.jsx("p",{children:m.notes})]}),e.jsxs("div",{className:"view-actions",children:[m.igUrl&&e.jsxs(e.Fragment,{children:[e.jsxs("a",{href:m.igUrl,target:"_blank",rel:"noopener noreferrer",className:"view-link-btn",children:[e.jsx(qs,{size:16})," é–‹å•Ÿ IG"]}),N&&e.jsxs("button",{className:"view-sync-btn",onClick:hs,disabled:Ce(m.id),title:"é‡æ–°æŠ“å– IG è³‡æ–™",children:[e.jsx(at,{size:16,className:Ce(m.id)?"spinning":""}),Ce(m.id)?"åŒæ­¥ä¸­...":"åŒæ­¥"]})]}),e.jsx("button",{className:"view-edit-btn",onClick:ps,children:"âœï¸ ç·¨è¼¯"})]})]})]}),e.jsx("button",{className:"post-nav-side next",onClick:t=>{t.stopPropagation(),ms()},disabled:qe()>=B.length-1,title:"ä¸‹ä¸€å‰‡",children:e.jsx(Js,{size:32})})]}),Qt&&e.jsx("div",{className:"modal-overlay",onClick:()=>W(!1),children:e.jsxs("div",{className:"archive-modal",onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{children:z?"ç·¨è¼¯å‚™ä»½":"æ–°å¢žå‚™ä»½"}),e.jsx("button",{className:"close-btn",onClick:()=>W(!1),children:e.jsx(oe,{size:20})})]}),e.jsxs("div",{className:"modal-body",children:[e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{children:[e.jsx(st,{size:14})," IG é€£çµ","ï¼ˆè‡ªå‹•æŠ“å–ï¼‰"]}),e.jsxs("div",{className:"ig-url-input",children:[e.jsx("input",{type:"url",placeholder:"è²¼ä¸Š Instagram é€£çµï¼Œè‡ªå‹•æŠ“å–åœ–ç‰‡å’Œæ–‡å­—...",value:v.igUrl,onChange:t=>M(a=>({...a,igUrl:t.target.value})),onBlur:Ut,disabled:Je}),e.jsx("button",{onClick:Ut,title:"æŠ“å–è³‡æ–™",disabled:Je,children:Je?e.jsx("span",{className:"fetching-spinner"}):e.jsx(nt,{size:16})}),kt&&e.jsx("span",{className:"fetch-progress",children:kt})]})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"é¡žåž‹"}),e.jsx("div",{className:"type-selector",children:Q.map(t=>e.jsxs("button",{className:v.type===t.id?"active":"",style:v.type===t.id?{background:t.color}:{},onClick:()=>M(a=>({...a,type:t.id})),children:[t.icon," ",t.label]},t.id))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"æˆå“¡"}),e.jsx("select",{value:v.member,onChange:t=>M(a=>({...a,member:t.target.value})),children:Fs.map(t=>e.jsx("option",{value:t.name,children:t.name},t.name))})]})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{children:[e.jsx(Xs,{size:14})," ç™¼æ–‡æ—¥æœŸ"]}),e.jsx("input",{type:"date",value:v.date,onChange:t=>M(a=>({...a,date:t.target.value}))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"æ™‚é–“ï¼ˆé¸å¡«ï¼‰"}),e.jsx("input",{type:"time",value:v.time,onChange:t=>M(a=>({...a,time:t.target.value}))})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{children:[e.jsx(Ks,{size:14})," åœ–ç‰‡/å½±ç‰‡",Ct>0&&e.jsxs("span",{className:"upload-status",children:["ï¼ˆ",Ct," å¼µä¸Šå‚³ä¸­...ï¼‰"]})]}),e.jsxs("div",{className:"media-upload-area",children:[v.media.map((t,a)=>{var s;const n=z&&((s=O[z.id])==null?void 0:s.includes(a));return e.jsxs("div",{className:`media-preview ${t.uploading?"uploading":""} ${t.uploadFailed?"failed":""} ${n?"broken":""}`,children:[t.type==="youtube"?e.jsxs("div",{className:"video-preview-img",children:[e.jsx("img",{src:t.thumbnail||et(t.url),alt:""}),e.jsx(ce,{size:16,className:"play-icon"})]}):t.type==="video"?t.thumbnail?e.jsxs("div",{className:"video-preview-img",children:[e.jsx("img",{src:t.thumbnailBackupUrl||t.thumbnail,alt:""}),e.jsx(ce,{size:16,className:"play-icon"})]}):e.jsxs("div",{className:"video-preview-auto",children:[e.jsx("video",{src:t.backupUrl||t.url,muted:!0,preload:"metadata"}),e.jsx(ce,{size:16,className:"play-icon"})]}):e.jsx("img",{src:t.backupUrl||t.url,alt:""}),t.uploading&&e.jsx("div",{className:"upload-overlay",children:e.jsx("div",{className:"mini-spinner"})}),t.uploadFailed&&e.jsx("div",{className:"upload-failed-badge",title:"ä¸Šå‚³å¤±æ•—ï¼Œå°‡ä½¿ç”¨åŽŸå§‹é€£çµ",children:"âš ï¸"}),n&&e.jsx("div",{className:"broken-image-badge",title:"æ­¤åœ–ç‰‡å·²æå£žï¼Œè«‹é‡æ–°ä¸Šå‚³",children:e.jsx(tt,{size:14})}),e.jsx("button",{className:"remove-media",onClick:()=>bs(a),children:e.jsx(oe,{size:14})})]},a)}),e.jsxs("label",{className:"upload-btn",children:[e.jsx("input",{type:"file",accept:"image/*,video/*",multiple:!0,onChange:xs,disabled:ht}),ht?e.jsx("span",{className:"uploading",children:"ä¸Šå‚³ä¸­..."}):e.jsxs(e.Fragment,{children:[e.jsx(De,{size:20}),e.jsx("span",{children:"ä¸Šå‚³"})]})]}),e.jsxs("button",{type:"button",className:"manual-url-toggle",onClick:()=>re(!St),children:[e.jsx(nt,{size:16}),e.jsx("span",{children:"è²¼ä¸Šç¶²å€"})]})]}),St&&e.jsxs("div",{className:"manual-url-input",children:[e.jsx("p",{className:"manual-hint",children:"ðŸ’¡ æç¤ºï¼šæ”¯æ´åœ–ç‰‡ã€å½±ç‰‡ã€YouTube é€£çµï¼Œæ¯è¡Œä¸€å€‹"}),e.jsx("textarea",{placeholder:`è²¼ä¸Šåœ–ç‰‡/å½±ç‰‡/YouTube ç¶²å€ï¼Œæ¯è¡Œä¸€å€‹...
ä¾‹å¦‚ï¼š
https://scontent-xxx.cdninstagram.com/...jpg
https://www.youtube.com/watch?v=xxxxx`,value:Xe,onChange:t=>Ke(t.target.value),rows:4}),e.jsxs("div",{className:"manual-actions",children:[e.jsx("button",{type:"button",className:"cancel-manual",onClick:()=>{re(!1),Ke("")},children:"å–æ¶ˆ"}),e.jsx("button",{type:"button",className:"submit-manual",onClick:fs,children:"æ–°å¢žåª’é«”"})]})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"åŽŸæ–‡å…§å®¹"}),e.jsx("textarea",{placeholder:"è²¼ä¸Š IG åŽŸæ–‡å…§å®¹...",value:v.caption,onChange:t=>M(a=>({...a,caption:t.target.value})),rows:4})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"å‚™è¨»ï¼ˆé¸å¡«ï¼‰"}),e.jsx("textarea",{placeholder:"å…¶ä»–å‚™è¨»...",value:v.notes,onChange:t=>M(a=>({...a,notes:t.target.value})),rows:2})]})]}),e.jsxs("div",{className:"modal-footer",children:[z&&e.jsxs("button",{className:"delete-btn",onClick:()=>{vs(z.id),W(!1)},children:[e.jsx(Qs,{size:16})," åˆªé™¤"]}),e.jsx("button",{className:"cancel-btn",onClick:()=>W(!1),children:"å–æ¶ˆ"}),e.jsxs("button",{className:"save-btn",onClick:js,disabled:L,children:[e.jsx(Zs,{size:16})," ",L?"å„²å­˜ä¸­...":"å„²å­˜"]})]})]})}),es&&e.jsx("div",{className:"modal-overlay",onClick:()=>!le&&ue(!1),children:e.jsxs("div",{className:"archive-modal batch-create-modal",onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("h2",{children:[e.jsx(De,{size:20})," æ‰¹æ¬¡å‚™ä»½ IG è²¼æ–‡"]}),!le&&e.jsx("button",{className:"close-btn",onClick:()=>ue(!1),children:e.jsx(oe,{size:20})})]}),!le&&pe.length===0&&e.jsxs("div",{className:"batch-create-input",children:[e.jsx("label",{children:"æ¯è¡Œè²¼ä¸Šä¸€å€‹ IG é€£çµï¼š"}),e.jsxs("div",{className:"script-helper",children:[e.jsxs("button",{className:"script-helper-toggle",onClick:()=>{ts(!Ee),Ye(!1)},children:[e.jsx(st,{size:14}),e.jsx("span",{children:"å¾ž IG å¸³è™Ÿä¸€æ¬¡åŒ¯å…¥æ‰€æœ‰è²¼æ–‡ URL"}),e.jsx(ea,{size:14,style:{transform:Ee?"rotate(180deg)":"none",transition:"transform 0.2s"}})]}),Ee&&e.jsxs("div",{className:"script-helper-content",children:[e.jsxs("ol",{className:"script-helper-steps",children:[e.jsx("li",{children:"åœ¨ç€è¦½å™¨é–‹å•Ÿç›®æ¨™ IG å¸³è™Ÿé é¢"}),e.jsxs("li",{children:["æŒ‰ ",e.jsx("kbd",{children:"F12"})," é–‹å•Ÿ DevTools â†’ ",e.jsx("kbd",{children:"Console"})]}),e.jsx("li",{children:"é»žä¸‹æ–¹æŒ‰éˆ•è¤‡è£½è…³æœ¬ï¼Œè²¼åˆ° Console æŒ‰ Enter"}),e.jsx("li",{children:"ç­‰å¾…è‡ªå‹•æ»¾å‹•å®Œæˆï¼ŒURL æœƒè¤‡è£½åˆ°å‰ªè²¼ç°¿"}),e.jsx("li",{children:"å›žåˆ°é€™è£¡ï¼Œç›´æŽ¥ Ctrl+V è²¼ä¸Š"})]}),e.jsx("button",{className:"copy-script-btn",onClick:()=>{navigator.clipboard.writeText(Cs),Ye(!0),setTimeout(()=>Ye(!1),3e3)},children:ss?e.jsxs(e.Fragment,{children:[e.jsx(Et,{size:14})," å·²è¤‡è£½ï¼"]}):e.jsxs(e.Fragment,{children:[e.jsx(nt,{size:14})," è¤‡è£½è…³æœ¬"]})})]})]}),e.jsx("textarea",{className:"batch-urls-textarea",value:me,onChange:t=>Re(t.target.value),placeholder:`https://www.instagram.com/p/ABC123/
https://www.instagram.com/tttopost/p/DEF456/
https://www.instagram.com/reel/GHI789/`,rows:8,autoFocus:!0}),(()=>{const t=Ze(me),a=me.split(`
`).filter(s=>s.trim()).length,n=t.filter(s=>{const h=s.split("?")[0].replace(/\/$/,"");return k.some(c=>c.igUrl&&c.igUrl.split("?")[0].replace(/\/$/,"")===h)}).length;return e.jsxs("div",{className:"batch-url-info",children:[e.jsxs("span",{children:[t.length," ç­†æœ‰æ•ˆé€£çµ",a>t.length?`ï¼ˆ${a-t.length} ç­†ç„¡æ•ˆå·²å¿½ç•¥ï¼‰`:""]}),n>0&&e.jsxs("span",{className:"batch-dup-warn",children:["å…¶ä¸­ ",n," ç­†å·²å‚™ä»½éŽï¼Œå°‡è‡ªå‹•è·³éŽ"]})]})})(),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{className:"cancel-btn",onClick:()=>ue(!1),children:"å–æ¶ˆ"}),e.jsxs("button",{className:"save-btn",onClick:Us,disabled:Ze(me).length===0,children:[e.jsx(De,{size:16})," é–‹å§‹å‚™ä»½"]})]})]}),(le||pe.length>0)&&e.jsxs("div",{className:"batch-create-progress",children:[e.jsx("div",{className:"batch-progress-bar-container",children:e.jsx("div",{className:"batch-progress-bar-fill",style:{width:`${he.total>0?he.current/he.total*100:0}%`}})}),e.jsx("div",{className:"batch-progress-text",children:le?`è™•ç†ä¸­ ${he.current}/${he.total}`:`å®Œæˆ ${pe.filter(t=>t.status==="success").length}/${pe.length}`}),e.jsx("div",{className:"batch-results-list",children:pe.map((t,a)=>e.jsxs("div",{className:`batch-result-item batch-result-${t.status}`,children:[e.jsxs("span",{className:"batch-result-icon",children:[t.status==="success"&&"âœ“",t.status==="error"&&"âœ—",t.status==="processing"&&"â³",t.status==="pending"&&"Â·"]}),e.jsx("span",{className:"batch-result-url",children:t.url.replace(/https?:\/\/(www\.)?instagram\.com\//,"")}),t.status==="success"&&e.jsxs("span",{className:"batch-result-meta",children:[t.member," Â· ",t.type]}),t.status==="error"&&e.jsx("span",{className:"batch-result-error",children:t.error})]},a))}),e.jsx("div",{className:"modal-footer",children:le?e.jsxs("button",{className:"cancel-btn",onClick:Ss,children:[e.jsx(oe,{size:16})," å–æ¶ˆ"]}):e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"cancel-btn",onClick:()=>{ue(!1),X([]),Re("")},children:"é—œé–‰"}),e.jsx("button",{className:"save-btn",onClick:()=>{X([]),Re("")},children:"ç¹¼çºŒæ–°å¢ž"})]})})]})]})}),q&&J.length>0&&e.jsxs("div",{className:"batch-action-bar",children:[e.jsxs("span",{className:"batch-count",children:["å·²é¸å– ",J.length," ç­†"]}),e.jsxs("div",{className:"batch-actions",children:[!gt&&e.jsx("button",{className:"batch-cancel-btn",onClick:()=>ae([]),children:"å–æ¶ˆé¸å–"}),gt?e.jsxs("button",{className:"batch-stop-btn",onClick:Ns,children:[e.jsx(oe,{size:16}),"å–æ¶ˆåŒæ­¥ (",bt.current,"/",bt.total,")"]}):e.jsxs("button",{className:"batch-sync-btn",onClick:ks,children:[e.jsx(at,{size:16}),"åŒæ­¥æŠ“å–"]})]})]}),_&&e.jsxs("div",{className:`toast ${_.type}`,children:[_.type==="error"?e.jsx(ta,{size:16}):e.jsx(Et,{size:16}),_.msg]}),A&&e.jsx("div",{className:"confirm-modal-overlay",onClick:A.onCancel,children:e.jsxs("div",{className:`confirm-modal confirm-modal-${A.type}`,onClick:t=>t.stopPropagation(),children:[e.jsx("h3",{className:"confirm-modal-title",children:A.title}),e.jsx("div",{className:"confirm-modal-body",children:A.content}),e.jsxs("div",{className:"confirm-modal-actions",children:[e.jsx("button",{className:"confirm-modal-cancel",onClick:A.onCancel,children:A.cancelText}),e.jsx("button",{className:`confirm-modal-confirm confirm-modal-confirm-${A.type}`,onClick:A.onConfirm,children:A.confirmText})]})]})})]})}const da=d.memo(na);export{da as default};
